var oh=Object.defineProperty;var ah=(r,e,t)=>e in r?oh(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var d=(r,e,t)=>ah(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();const y={currentView:Symbol("currentView"),cursorTagStart:Symbol("cursorTagStart"),computedKeys:Symbol("computedKeys"),destroy:Symbol("destroy"),getChildren:Symbol("getChildren"),holder:Symbol("holder"),id:Symbol("id"),identifier:Symbol("identifier"),index:Symbol("index"),init:Symbol("init"),inputEvents:Symbol("inputEvents"),intervals:Symbol("intervals"),launched:Symbol("launched"),level:Symbol("level"),methodKeys:Symbol("methodKeys"),originalState:Symbol("originalState"),propKeys:Symbol("propKeys"),raw:Symbol("raw"),ready:Symbol("ready"),renderer:Symbol("renderer"),routes:Symbol("routes"),routerHooks:Symbol("routerHooks"),settings:Symbol("settings"),state:Symbol("state"),stateKeys:Symbol("stateKeys"),textnode:Symbol("textnode"),timeouts:Symbol("timeouts"),type:Symbol("type"),watchers:Symbol("watchers"),watchKeys:Symbol("watchKeys"),wrapper:Symbol("wrapper"),children:Symbol.for("children"),components:Symbol.for("components"),config:Symbol.for("config"),isSlot:Symbol.for("isSlot"),props:Symbol.for("props"),slots:Symbol.for("slots"),componentType:Symbol.for("componentType"),isComponent:Symbol.for("isComponent"),effects:Symbol.for("effects"),removeGlobalEffects:Symbol.for("removeGlobalEffects")},Me={[y.settings]:{},get(r,e=null){return r in this[y.settings]?this[y.settings][r]:e},set(r,e){typeof r=="object"?Object.keys(r).forEach(t=>{this.set(t,r[t])}):this[y.settings][r]=e}},Cs=()=>{},Yr=()=>new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),ya=r=>{const e=Me.get("debugLevel"),t={};return Object.defineProperty(t,"info",{get(){return(e>=1||Array.isArray(e)&&e.indexOf("info")>-1)&&console.info.bind(window.console,`%c ⚡️ ${r} %c ${Yr()}`,"background-color: #0284c7; color: white; padding: 3px 6px 3px 1px; border-radius: 3px","color: ##94a3b8;")||Cs}}),Object.defineProperty(t,"warn",{get(){return(e>=1||Array.isArray(e)&&e.indexOf("warn")>-1)&&console.warn.bind(window.console,`%c ⚡️ ${r} %c ${Yr()}`,"background-color: #fbbf24; color: white; padding: 3px 6px 3px 1px; border-radius: 3px","color: ##94a3b8;")||Cs}}),Object.defineProperty(t,"error",{get(){return(e>=1||Array.isArray(e)&&e.indexOf("error")>-1)&&console.error.bind(window.console,`%c ⚡️ ${r} %c ${Yr()}`,"background-color: #dc2626; color: white; padding: 3px 6px 3px 1px; border-radius: 3px","color: ##94a3b8;")||Cs}}),Object.defineProperty(t,"debug",{get(){return(e>=2||Array.isArray(e)&&e.indexOf("debug")>-1)&&console.debug.bind(window.console,`%c ⚡️ ${r} %c (${new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"})})`,"background-color: #e2e8f0; color: #334155; padding: 3px 6px 3px 1px; border-radius: 3px","color: ##94a3b8;")||Cs}}),t};let J;const lh=()=>{J=ya("Blits")},Rs={aliceblue:"0xf0f8ffff",antiquewhite:"0xfaebd7ff",aqua:"0xffffff00",aquamarine:"0x7fffd4ff",azure:"0xf0ffffff",beige:"0xf5f5dcff",bisque:"0xffe4c4ff",black:"0x000000ff",blanchedalmond:"0xffebcdff",blue:"0x0000ffff",blueviolet:"0x8a2be2ff",brown:"0xa52a2aff",burlywood:"0xdeb887ff",cadetblue:"0x5f9ea0ff",chartreuse:"0x7fff00ff",chocolate:"0xd2691eff",coral:"0xff7f50ff",cornflowerblue:"0x6495edff",cornsilk:"0xfff8dcff",crimson:"0xdc143cff",cyan:"0x00ffffff",darkblue:"0x00008bff",darkcyan:"0x008b8bff",darkgoldenrod:"0xb8860bff",darkgray:"0xa9a9a9ff",darkgreen:"0x006400ff",darkgrey:"0xa9a9a9ff",darkkhaki:"0xbdb76bff",darkmagenta:"0x8b008bff",darkolivegreen:"0x556b2fff",darkorange:"0xff8c00ff",darkorchid:"0x9932ccff",darkred:"0x8b0000ff",darksalmon:"0xe9967aff",darkseagreen:"0x8fbc8fff",darkslateblue:"0x483d8bff",darkslategray:"0x2f4f4fff",darkslategrey:"0x2f4f4fff",darkturquoise:"0x00ced1ff",darkviolet:"0x9400d3ff",deeppink:"0xff1493ff",deepskyblue:"0x00bfffff",dimgray:"0x696969ff",dimgrey:"0x696969ff",dodgerblue:"0x1e90ffff",firebrick:"0xb22222ff",floralwhite:"0xfffaf0ff",forestgreen:"0x228b22ff",fuchsia:"0xff00ffff",gainsboro:"0xdcdcdcff",ghostwhite:"0xf8f8ffff",gold:"0xffd700ff",goldenrod:"0xdaa520ff",gray:"0x808080ff",green:"0x008000ff",greenyellow:"0xadff2fff",grey:"0x808080ff",honeydew:"0xf0fff0ff",hotpink:"0xff69b4ff",indianred:"0xcd5c5cff",indigo:"0x4b0082ff",ivory:"0xfffff0ff",khaki:"0xf0e68cff",lavender:"0xe6e6faff",lavenderblush:"0xfff0f5ff",lawngreen:"0x7cfc00ff",lemonchiffon:"0xfffacdff",lightblue:"0xadd8e6ff",lightcoral:"0xf08080ff",lightcyan:"0xe0ffffff",lightgoldenrodyellow:"0xfafad2ff",lightgray:"0xd3d3d3ff",lightgreen:"0x90ee90ff",lightgrey:"0xd3d3d3ff",lightpink:"0xffb6c1ff",lightsalmon:"0xffa07aff",lightseagreen:"0x20b2aaff",lightskyblue:"0x87cefaff",lightslategray:"0x778899ff",lightslategrey:"0x778899ff",lightsteelblue:"0xb0c4deff",lightyellow:"0xffffe0ff",lime:"0x00ff00ff",limegreen:"0x32cd32ff",linen:"0xfaf0e6ff",magenta:"0xff00ffff",maroon:"0x800000ff",mediumaquamarine:"0x66cdaaff",mediumblue:"0x0000cdff",mediumorchid:"0xba55d3ff",mediumpurple:"0x9370dbff",mediumseagreen:"0x3cb371ff",mediumslateblue:"0x7b68eeff",mediumspringgreen:"0x00fa9aff",mediumturquoise:"0x48d1ccff",mediumvioletred:"0xc71585ff",midnightblue:"0x191970ff",mintcream:"0xf5fffaff",mistyrose:"0xffe4e1ff",moccasin:"0xffe4b5ff",navajowhite:"0xffdeadff",navy:"0x000080ff",oldlace:"0xfdf5e6ff",olive:"0x808000ff",olivedrab:"0x6b8e23ff",orange:"0xffa500ff",orangered:"0xff4500ff",orchid:"0xda70d6ff",palegoldenrod:"0xeee8aaff",palegreen:"0x98fb98ff",paleturquoise:"0xafeeeeff",palevioletred:"0xdb7093ff",papayawhip:"0xffefd5ff",peachpuff:"0xffdab9ff",peru:"0xcd853fff",pink:"0xffc0cbff",plum:"0xdda0ddff",powderblue:"0xb0e0e6ff",purple:"0x800080ff",rebeccapurple:"0x663399ff",red:"0xff0000ff",rosybrown:"0xbc8f8fff",royalblue:"0x4169e1ff",saddlebrown:"0x8b4513ff",salmon:"0xfa8072ff",sandybrown:"0xf4a460ff",seagreen:"0x2e8b57ff",seashell:"0xfff5eeff",sienna:"0xa0522dff",silver:"0xc0c0c0ff",skyblue:"0x87ceebff",slateblue:"0x6a5acdff",slategray:"0x708090ff",slategrey:"0x708090ff",snow:"0xfffafaff",springgreen:"0x00ff7fff",steelblue:"0x4682b4ff",tan:"0xd2b48cff",teal:"0x008080ff",thistle:"0xd8bfd8ff",tomato:"0xff6347ff",transparent:"0x00000000",turquoise:"0x40e0d0ff",violet:"0xee82eeff",wheat:"0xf5deb3ff",white:"0xffffffff",whitesmoke:"0xf5f5f5ff",yellow:"0xffff00ff",yellowgreen:"0x9acd32ff"},hh=/^#?([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i,uh=/^(rgba?)\((\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\s*),(\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\s*),(\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\s*)(,(\s*(-?\d+(?:\.\d+)?)\s*))?\)$/,ch=/^(hsla?)\((\s*(360|3[0-5][0-9]|[12]?[0-9]{1,2})\s*),(\s*(100|[1-9]?[0-9])\s*)%,(\s*(100|[1-9]?[0-9])\s*)%(,(\s*(1|0(?:\.\d+)?)\s*))?\)$/,jr={},As=r=>{if(jr[r]!==void 0)return jr[r];const e=parseInt(r).toString(16).padStart(2,"0");return jr[r]=e,e},wi={normalize:(r="",e="0xffffffff")=>{if(r=r.toString(),r.startsWith("0x")&&r.length===10)return r;if(Rs[r]!==void 0)return Rs[r];if(hh.test(r)){r=r.replace("#","").toLowerCase(),r.length===3&&(r=r.split("").map(s=>s+s).join(""));const i="0x"+r.padEnd(8,"f");return Rs[r]=i,i}const t=uh.exec(r);if(t){const i=As(t[3]),s=As(t[5]),n=As(t[7]);let o="ff";if(t[10]&&t[1]==="rgba"){const l=Math.min(Math.max(Math.round(parseFloat(t[10])*255),0),255);o=As(l)}const a="0x"+i+s+n+o;return Rs[r]=a,a}return ch.test(r)?(console.warn("HSL(A) color format is not supported yet"),"0xffffffff"):e}},fh=(r="",e,t,i=null)=>{let s=0,n=0,o=[],a=null,l=0;const h=/^<\/?([a-zA-Z0-9_\-.]+)\s*/,u=/^\s*(\/?>)\s*/,f=/^([A-Za-z0-9:.\-_@$]+)=\s*(["'])/,c=/^<>\s*/,p=/^\s*(<\/>)\s*/,_=()=>{r=x(r);try{return g(T),U(o)}catch(C){throw(C.name=="TemplateParseError"||C.name=="TemplateStructureError")&&(C.message=`${C.message}
${C.context}`),C}},g=C=>{s>=r.length||C()},x=C=>C.replace(/<!--.*?-->/gms,"").replace(/\r?\n\s*\r\n/gm," ").replace(/\r?\n\s*(\S)/gm," $1").replace(/\r?\n/g,"").trim(),m=C=>{const M=r.slice(s).match(C);return M&&(n=s,s+=M[0].length),M},T=()=>{m(c)?(o.push({[Symbol.for("componentType")]:null,[y.type]:"opening",[y.level]:l,[y.cursorTagStart]:n}),l++,g(T)):g(b)},b=()=>{m(p)?(l--,o.push({[Symbol.for("componentType")]:null,[y.type]:"closing",[y.level]:l}),g(T)):g(S)},S=()=>{const C=m(h);if(C)a={[Symbol.for("componentType")]:C[1],[y.level]:l,[y.cursorTagStart]:n},C[0].startsWith("</")?(l--,a[y.type]="closing",a[y.level]=l):(a[y.type]="opening",l++),g(R);else throw O("InvalidTag")},R=()=>{const C=m(u);if(C){if(C[1]==="/>"){if(a[y.type]==="closing")throw O("InvalidClosingTag");a[y.type]="self-closing",l--}if(a[y.type]==="opening"){const M=r.slice(s,r.indexOf("<",s));M&&(a.content=M,s+=M.length)}o.push(a),g(T)}else g(A)},A=()=>{const C=m(f);if(C){if(a[y.type]==="closing")throw O("AttributesInClosingTag");const M=C[2],j=new RegExp(`^(.*?)${M}\\s*`),q=m(j);if(q){const K=L(C[1],q[1]);a[K.name]=K.value,g(R)}else throw O("MissingOrInvalidAttributeValue")}else throw O("InvalidAttribute")},L=(C,M)=>{if(C.includes(".")){const[j,q]=C.split(".");return{name:j,value:`{${q}: ${M}}`}}return["color",":color",":effects","effects"].includes(C)?E(C,M):{name:C,value:M}},E=(C,M)=>{let j=M,q=wi.normalize(j,null);if(q===null){const K=/'([^']+)'/g;let Q,Y=0,oe="";for(;(Q=K.exec(M))!==null;){const Se=Q[1],ve=Q.index,ne=Q[0].length;oe+=M.slice(Y,ve),q=wi.normalize(Se,null),q===null?oe+=M.slice(ve,ve+ne):oe+=`'${q}'`,Y=ve+ne}oe+=M.slice(Y),j=oe}else j=q;return{name:C,value:j}},U=C=>{let M=[],j=!1,q={children:[]},K=q;for(let Q=0;Q<C.length;Q++){let Y=C[Q];if(Y[y.level]===0&&Y[y.type]!=="closing"){if(j)throw B("MultipleTopLevelTags",Y);if(Y[":for"]!==void 0)throw B("ForAttributeOnRootElement",Y);j=!0}if(Y[y.type]==="opening")M.push({[y.level]:Y[y.level],[y.type]:Y[y.type],[y.cursorTagStart]:Y[y.cursorTagStart],[Symbol.for("componentType")]:Y[Symbol.for("componentType")],parent:K});else if(Y[y.type]==="closing"){const Se=M.length===0;let ve=!1,ne=!1;if(Se||(ve=M[M.length-1][y.level]!==Y[y.level],ne=M[M.length-1][Symbol.for("componentType")]!==Y[Symbol.for("componentType")]),Se||ve||ne)throw B("MismatchedClosingTag",Y);K=M.pop().parent}const oe={...Y};delete oe[y.type],delete oe[y.level],delete oe[y.cursorTagStart],Y[y.type]==="opening"?(Q+1<C.length&&C[Q+1][y.type]!=="closing"&&(oe.children=[]),K.children.push(oe),K=oe):Y[y.type]==="self-closing"&&K.children.push(oe)}if(M.length>0)throw B("UnclosedTags",M);return q},z=10,k=50,O=C=>{const M=P();C=`${C} in ${M}`;const j=new Error(C);j.name="TemplateParseError";const q=Math.max(0,n-z),K=Math.min(r.length,s+k),Q=r.slice(q,K),Y=s-q;return j.context=$(Y,Q),j},B=(C,M)=>{const j=P();C=`${C} in ${j}`;const q=new Error(C);q.name="TemplateStructureError",Array.isArray(M)?q.context=M.map(Q=>K(Q)).join(`
`):q.context=K(M);function K(Q){const Y=Math.max(0,Q[y.cursorTagStart]-z),oe=r.slice(Y,Y+k);return $(z,oe)}return q},$=(C,M)=>{const j=" ".repeat(C)+"^";return`
${M}
${j}
`},P=()=>i||"Blits.Application";return _()};let V,or;function dh(r={children:[]},e=!1){const t={renderCode:["const elms = []","let componentType","const rootComponent = component","let propData","let slotComponent","let inSlot = false","let slotChildCounter = 0"],effectsCode:[],context:{props:[],components:this.components}};return V=-1,or=e,or===!0&&t.renderCode.push(`
      function propInComponent(prop, kind="dynamic") {
        const property = prop.includes('.') ? prop.split('.')[0] : prop
        if (kind === 'reactive' || prop.includes('.') === false) {
          if (property in component === false) {
            Log.warn('Property ' +  property + ' was accessed during render but is not defined on instance')
          }
        } else {
          const nestedKeys = prop.split('.')
          let base = component
          for(let i =0; i<nestedKeys.length;i++){
            if (base[nestedKeys[i]] === undefined) {
              Log.warn('Property ' +  nestedKeys.slice(0,i+1).join('.') + ' was accessed during render but is not defined on instance')
            }
            base = base[nestedKeys[i]]
          }
        }
      }
    `),Sa.call(t,r),t.renderCode.push("return elms"),{render:new Function("parent","component","context","components","effect","getRaw","Log",t.renderCode.join(`
`)),effects:t.effectsCode.map(i=>new Function("component","elms","context","components","rootComponent","effect",i)),context:t.context}}const ph=function(r){const e=/\$\$?\w+(\.\w+)?/g,t=r.match(e);if(t!==null){const i=/\$shader/;return t.filter(s=>!i.test(s))}else return!1},Co=function(r,e,t="dynamic"){const i=ph(r);if(i!==!1)for(let s=0;s<i.length;s++){let n=i[s];t==="reactive"&&n.includes(".")&&(n=n.split(".")[0]),e.push(`propInComponent('${n.replace("$","")}', '${t}')`)}},ar=function(r,e=!1,t={key:!1,component:"component.",forceEffect:!1,forloop:!1}){const i=t.forceEffect?this.effectsCode:this.renderCode;e&&i.push(`parent = ${e}`),"key"in r&&(t.key=Ae(r.key,t.component));const s=t.key?`elms[${V}][${t.key}]`:`elms[${V}]`;t.key&&i.push(`
      if(elms[${V}] === undefined) {
        elms[${V}] = {}
      }
    `),i.push(`const elementConfig${V} = {}`),t.forloop&&i.push(`if(${s} === undefined) {`),i.push(`
    ${s} = this.element({parent: parent || 'root'}, inSlot === true ? slotComponent : component)
  `),t.forloop&&i.push("}");const n=r.children;delete r.children,r[Symbol.for("componentType")]==="Slot"&&i.push(`elementConfig${V}[Symbol.for('isSlot')] = true`),Object.keys(r).forEach(o=>{if(o==="slot"&&i.push(`
        elementConfig${V}['parent'] = slotComponent[Symbol.for('slots')] !== undefined && Array.isArray(slotComponent[Symbol.for('slots')]) === true && slotComponent[Symbol.for('slots')].filter(slot => slot.ref === '${r.slot}').shift() || parent
      `),o==="key")return;const a=r[o];if(ba(o)){if(t.holder&&o===":color")return;t.holder?this.effectsCode.push(`
        if(typeof skip${V} === 'undefined' ||
          skip${V}.indexOf('${o.substring(1)}') === -1)
          ${s}.set('${o.substring(1)}', ${Ae(r[o],t.component)})
        `):this.effectsCode.push(`
            ${s}.set('${o.substring(1)}', ${Ae(r[o],t.component)})
          `),or===!0&&t.component!=="scope."&&a.includes("$")&&Co(a,i,"reactive"),i.push(`elementConfig${V}['${o.substring(1)}'] = ${Ae(a,t.component)}`)}else or===!0&&t.component!=="scope."&&a.includes("$")&&Co(a,i),i.push(`elementConfig${V}['${o}'] = ${Vn(a,o,t.component)}`)}),t.holder===!0&&i.push(`
    const skip${V} = []
    if(typeof cmp${V} !== 'undefined') {
      for(let key in cmp${V}[Symbol.for('config')].props) {
        delete elementConfig${V}[cmp${V}[Symbol.for('config')].props[key]]
        skip${V}.push(cmp${V}[Symbol.for('config')].props[key])
      }
    }
    `),t.forloop&&i.push(`if(${s}.nodeId === undefined) {`),i.push(`${s}.populate(elementConfig${V})`),i.push(`
    if(inSlot === true) {
      slotChildCounter -= 1
    }
  `),t.forloop&&i.push("}"),n&&Sa.call(this,{children:n},`${s}`,t)},Ta=function(r,e=!1,t={key:!1,component:"component.",forceEffect:!1,holder:!1,forloop:!1}){const i=t.forceEffect?this.effectsCode:this.renderCode;i.push(`
    const cmp${V} =
      (context.components && context.components['${r[Symbol.for("componentType")]}']) || components['${r[Symbol.for("componentType")]}']
  `),"key"in r&&(t.key=Ae(r.key,t.component));const s=r.children;delete r.children,ar.call(this,r,e,{...t,holder:!0}),e=t.key?`elms[${V}][${t.key}]`:`elms[${V}]`,V++;const n=t.key?`elms[${V}][${t.key}]`:`elms[${V}]`;t.key&&i.push(`
      if(elms[${V}] === undefined) {
        elms[${V}] = {}
      }
    `),e&&i.push(`parent = ${e}`),i.push(`const props${V} = {}`),t.forloop&&i.push(`if(${n} === undefined) {`),Object.keys(r).forEach(o=>{ba(o)?(this.effectsCode.push(`
        ${n}[Symbol.for('props')]['${o.substring(1)}'] = ${Ae(r[o],t.component)}`),i.push(`
        propData = ${Ae(r[o],t.component)}
        if (Array.isArray(propData) === true) {
          propData = getRaw(propData).slice(0)
        }
        props${V}['${o.substring(1)}'] = propData`)):i.push(`props${V}['${o}'] = ${Vn(r[o],o,t.component)}`)}),i.push(`
    componentType = props${V}['is'] || '${r[Symbol.for("componentType")]}'

    let component${V}
    if(typeof componentType === 'string') {
      component${V} = context.components && context.components[componentType] || components[componentType]
      if(!component${V}) {
        throw new Error('Component "${r[Symbol.for("componentType")]}" not found')
      }
    } else if(typeof componentType === 'function' && componentType[Symbol.for('isComponent')] === true) {
      component${V} = componentType
    }

    ${n} = component${V}.call(null, {props: props${V}}, ${e}, component)

    if (${n}[Symbol.for('slots')][0]) {
      parent = ${n}[Symbol.for('slots')][0]
      slotComponent = ${n}
      inSlot = true
    } else {
      parent = ${n}[Symbol.for('children')][0]
    }
  `),t.forloop&&i.push("}"),s&&(t.forloop||i.push(`
        if(inSlot === true) {
          slotChildCounter = ${s.length}  + 1
        }
      `),V++,ar.call(this,{children:s},!1,{...t})),t.forloop||i.push(`
      if (inSlot === true && slotChildCounter === 0) {
        inSlot = false
      }
    `)},gh=function(r,e){const t=r[":for"];delete r[":for"];const i=r.range||r[":range"]||"{}";delete r.range,delete r[":range"];const s=r.key,n=Ae(s,"scope."),o=!(r.$shallow&&r.$shallow.toLowerCase()==="false");delete r.$shallow,delete r.key;const l=/(.+)\s+in\s+(.+)/gi.exec(t),[h,u]=l[1].replace("(","").replace(")","").split(/\s*,\s*/),f=new RegExp(`(scope\\.(?!${h}\\.|${u}|key)(\\w+))`,"gi"),c={renderCode:[],effectsCode:[],context:{props:[],components:this.components}};if(e&&c.renderCode.push(`parent = ${e}`),u!==void 0){const L=new RegExp(`\\$${u}(?!['\\w])`).exec(s);Array.isArray(L)&&c.renderCode.push(`console.warn(" Using '${u}' in the key, like key=${s},  is not recommended")`)}const p=V;c.renderCode.push(`
    const created${p} = []

    let from${p}
    let to${p}

    const forloop${p} = (collection = [], elms, created) => {
      const rawCollection = getRaw(collection)
      const keys = new Set()
      let l = rawCollection.length

      const range = ${Ae(i)} || {}
      from${p} = range['from'] || 0
      to${p} = 'to' in range ? range['to'] : rawCollection.length

      while(l--) {
        const ${h} = rawCollection[l]
  `),u!==void 0&&c.renderCode.push(`
        const ${u} = l
    `),c.renderCode.push(`
        if(l < to${p} && l >= from${p}) {
          keys.add('' +  ${Ae(s,"")||"l"})
        }
      }
  `);const _=c.renderCode.length;c.renderCode.push(`
      created.length = 0
      const length = rawCollection.length
      const effects = []
      for(let __index = 0; __index < length; __index++) {
        if(__index < from${p} || __index >= to${p}) continue
        const scope = Object.create(component)
        parent = ${e}
        scope['${h}'] = rawCollection[__index]
  `),u!==""&&c.renderCode.push(`
        scope['${u}'] = __index
    `),c.renderCode.push(`
        scope['key'] = '' + ${n||"__index"}
  `),"ref"in r&&r.ref.indexOf("$")===-1&&(c.renderCode.push(`
        scope['__ref'] = '${r.ref}' + __index
    `),r.ref="$__ref"),c.renderCode.push(`
        created.push(scope.key)
  `),r[Symbol.for("componentType")]==="Element"||r[Symbol.for("componentType")]==="Slot"||r[Symbol.for("componentType")]==="Text"?(r[Symbol.for("componentType")]==="Text"&&(r.__textnode="true"),ar.call(c,r,e,{key:"scope.key",component:"scope.",forceEffect:!1,forloop:!0})):Ta.call(c,r,!1,{key:"scope.key",component:"scope.",forceEffect:!1,forloop:!0});const g=c.effectsCode.filter(A=>[...A.matchAll(f)].length===0),x=c.effectsCode.filter(A=>[...A.matchAll(f)].length!==0);o===!1&&c.renderCode.push(`
      scope['${h}'] = null
      scope['${h}'] = collection[__index]
  `),g.forEach((A,L)=>{const E=A.indexOf(`scope.${L}`)>-1?`'${Ae(l[2],"")}'`:null;A.indexOf("Symbol.for('props')")===-1?c.renderCode.push(`
        let eff${L} = () => {
          ${A}
        }
        effect(eff${L}, ${E})
        effects.push(eff${L})
        component[Symbol.for('effects')].push(eff${L})
      `):c.renderCode.push(`
        ${A}
      `)}),c.renderCode.push(`
    }
    return effects
  }`);const m=[];m.push(`
      let i = created.length

      while (i--) {
        if (keys.has(created[i]) === false) {
          const key = created[i]
  `);const T=V;for(let A=p;A<=T;A++)m.push(`
          elms[${A}][key] && elms[${A}][key].destroy()
          delete elms[${A}][key]
      `);m.push(`
      }
    }
  `),c.renderCode.splice(_,0,...m);let b=`${Ae(l[2],"")}`;b&&b.includes(".")&&(b=b.match(/[^.]+$/)[0]);const S=/\$([^,} ]+)/g,R=[...i.matchAll(S)].map(A=>`'${A[1]}'`);c.renderCode.push(`
    let forEffects${p}
    const eff${p} = () => {
      component[Symbol.for('removeGlobalEffects')](forEffects${p})
      forEffects${p} = null
      forEffects${p} = forloop${p}(${Vn(l[2],":for")}, elms, created${p})
    }

    component[Symbol.for('effects')].push(eff${p})

    effect(eff${p}, ['${b}', ${R.join(",")}] )
  `),x.forEach((A,L)=>{const E=[...A.matchAll(f)];let U=E.length;const z=[];for(;U--;){const k=E[U],O=`component.${k[2]}`;z.indexOf(O)===-1&&z.push(O),k[2]!==h&&(A=A.substring(0,k.index)+O+A.substring(k.index+k[1].length))}c.renderCode.push(`
      const eff${p}_${L} = () => {
        void ${z.join(", ")}
        for(let __index = 0; __index < ${Ae(l[2])}.length; __index++) {
          if(__index < from${p} || __index >= to${p}) continue
          const scope = {}
          scope['${u}'] = __index
          scope['${h}'] = ${Ae(l[2])}[__index]
          scope['key'] = ${n||"__index"}
    `),c.renderCode.push(`
          ${A}
        }
      }
      component[Symbol.for('effects')].push(eff${p}_${L})
      effect(eff${p}_${L})
    `)}),this.renderCode.push(c.renderCode.join(`
`))},Sa=function(r,e=!1,t={}){r.children&&r.children.forEach(i=>{V++,Object.keys(i).indexOf(":for")>-1?gh.call(this,i,e):i[Symbol.for("componentType")]==="Element"||i[Symbol.for("componentType")]==="Slot"||i[Symbol.for("componentType")]==="Text"||i[Symbol.for("componentType")]==="Layout"?(i[Symbol.for("componentType")]==="Text"&&(i.__textnode="true"),i[Symbol.for("componentType")]==="Layout"&&(i.__layout="true"),ar.call(this,i,e,t)):Ta.call(this,i,e,t)})},Ae=(r,e="component.")=>{if(r===void 0)return r;const t=/('.*?')+/gi,i=/\$(\$(?=\$)|\$?)/g,s=r.matchAll(t),n=[];let o=0;for(const a of s)n.push(a[0]),r=r.replace(a[0],`[@@REPLACEMENT${o}@@]`),o++;return r=r.replace(i,(a,l)=>{if(l==="")return e;if(l==="$")return e+"$"}),n.forEach((a,l)=>{r=r.replace(`[@@REPLACEMENT${l}@@]`,a)}),r},Vn=(r="",e=!1,t="component.")=>{const i=/\$\w+/gi;let s;if(e==="content")if(r.startsWith("$"))s=`${t}${r.replace("$","")}`;else{const n=r.replace(/\\\\/g,"__DOUBLE_BACKSLASH__").replace(/(^|[^\\])'/g,"$1\\'").replace(/__DOUBLE_BACKSLASH__/g,"\\\\");s=`'${_h(n,t)}'`}else if(e!=="color"&&/[^0-9%\s.eE]/.test(r)===!1&&!isNaN(parseFloat(r))){if(s=parseFloat(r),r.endsWith("%")){const o={w:"width",width:"width",x:"width",h:"height",height:"height",y:"height"}[e];o&&(s=`parent.node.${o} * (${s} / 100)`)}}else if(r.toLowerCase()==="true")s=!0;else if(r.toLowerCase()==="false")s=!1;else if(e.startsWith("@")&&r){const n=t.slice(0,-1);s=`${n}['${r.replace("$","")}'] && ${n}['${r.replace("$","")}'].bind(${n})`}else if(r.startsWith("$"))s=`${t}${r.replace("$","")}`;else if(i.exec(r)){const n=/\w+\s*:\s*(?:[^\s,}]+|".*?"|'.*?')/g,o=r.match(n);if(s={},o)for(let a=0;a<o.length;a++){const l=o[a].split(/\s*:\s*/);l&&mh(l[0],l[1],t,s)}return xh(s)}else s=`"${r}"`;return s},ba=r=>r.startsWith(":"),_h=(r,e)=>{const t=/\{\{\s*(\$\S+)\s*\}\}/g,i=[...r.matchAll(t)];if(i.length)for(let[s,n]of i)r=r.replace(s,`${n.replace("$",`'+${e}`)}+'`);return r},mh=(r,e,t,i)=>{e.startsWith("$")?i[r]=`${t}${e.replace("$","")}`:i[r]=e},xh=r=>{const e=[];return Object.keys(r).forEach(t=>{e.push(`${t}: ${r[t]}`)}),` { ${e.join(", ")} }`},Ro={};let yh=0;const Th=r=>`BlitsComponent::${r}_${Ro[r]=(Ro[r]||0)+1}`,Sh=()=>++yh,Bt={},cn=(r,e,t,i=[])=>{Bt[e]&&Bt[e][r]&&Bt[e][r].apply(t,i)},bh=(r,e,t)=>{const i=y[r];Bt[e]&&Bt[e][i]&&Bt[e][i].apply(t)},vh=(r={},e)=>{Bt[e]={},[...Object.keys(r),...Object.getOwnPropertySymbols(r)].forEach(i=>{typeof r[i]=="function"&&(Bt[e][i]=r[i])})};let Ci=null,mi=null,Lr=!1;const wh=()=>{Lr=!0},Ch=()=>{Lr=!1},lr=new WeakMap,Vs=new Map,Ao=r=>{if(Vs.size!==0)for(const[e,t]of Vs){if(r.indexOf(e)===-1)continue;const i=lr.get(t);if(i!==void 0)for(const s of i.values())s.delete(e),Vs.delete(e)}},Xs=(r,e,t=!1)=>{if(Ci!==null){if(Lr)return;if(Array.isArray(mi)===!0){if(mi.includes(e)===!1)return}else if(mi!==null&&e!==mi)return;let i=lr.get(r);i===void 0&&(i=new Map,lr.set(r,i));let s=i.get(e);s===void 0&&(s=new Set,i.set(e,s)),s.add(Ci),t===!0&&Vs.set(Ci,r)}},Ri=(r,e,t=!1)=>{if(Lr===!0)return;const i=lr.get(r);if(i===void 0)return;const s=i.get(e);if(s!==void 0)for(let n of s)n(t)},Es=(r,e=null)=>{Ci=r,mi=e,Ci(),Ci=null,mi=null},fn=(r,e)=>{if(r===e)return!0;if(r.length!==e.length)return!1;let t=r.length;for(;t--;){const i=r[t],s=e[t];if(Array.isArray(i)&&Array.isArray(s)){if(fn(i,s)===!1)return!1}else if(typeof i=="object"&&i!==null&&typeof s=="object"&&s!==null){if(fn(Object.entries(i),Object.entries(s))===!1)return!1}else if(i!==s)return!1}return!0},Gs=["push","pop","shift","unshift","splice","sort"],Eo=new WeakMap,Xt=r=>{const e=r&&r[y.raw];return e?Xt(e):r},dn=(r,e=null,t,i)=>{if(typeof r=="object"&&Array.isArray(r)===!1&&Object.getPrototypeOf(r)!==Object.prototype)return r;const s=Eo.get(r);if(s!==void 0)return s;const n={get(a,l,h){return l===y.raw?r:Array.isArray(a)===!0?typeof a[l]=="object"&&a[l]!==null?(Array.isArray(a[l])===!0&&Xs(a,l,i),dn(Xt(a[l]),a,l)):Gs.indexOf(l)!==-1?function(...u){wh();const f=a[l].apply(this,u);return Ch(),Ri(e,t),f}:l==="length"?r.length:Reflect.get(a,l,h):typeof a[l]=="object"&&a[l]!==null?(Array.isArray(a[l])===!0&&Xs(a,l,i),dn(Xt(a[l]),a,l)):(Xs(a,l,i),Reflect.get(a,l,h))},set(a,l,h,u){const f=Xt(a[l]),c=Xt(h);let p=!0,_=!1;return Array.isArray(c)===!0&&Array.isArray(f)===!0?_=fn(f,c):f===c&&(_=!0),_===!1&&(typeof h=="object"&&(Array.isArray(h)===!0?h=Xt(h).slice(0):h!==null&&a[l]!==null&&a[l]!==void 0&&Array.isArray(a)===!1&&Object.getPrototypeOf(h)===Object.prototype&&(h=Object.assign(u[l],h))),p=Reflect.set(a,l,h,u)),p===!0&&_===!1&&(Array.isArray(a)===!0&&l in a&&Ri(e,t,!0),Ri(a,l,!0)),p}},o=new Proxy(r,n);return Eo.set(r,o),o},va=(r,e)=>(Object.keys(r).forEach(t=>{let i=r[t];if(r[t]!==null&&typeof r[t]=="object"){if(Object.getPrototypeOf(r[t])===Object.prototype)return va(r[t]);if(Array.isArray(r[t])===!0)for(let s=0;s<Gs.length-1;s++)r[t][Gs[s]]=function(n){Array.prototype[Gs[s]].call(this,n),Ri(r,t)}}Object.defineProperty(r,t,{enumerable:!0,configurable:!0,get(){return Xs(r,t,e),i},set(s){i!==s&&(i=s,Ri(r,t))}})}),r),Rh=typeof Proxy<"u",pn=(r,e="Proxy",t=!1)=>(Rh===!1&&(e="defineProperty"),e==="defineProperty"?va(r,t):dn(r,void 0,void 0,t)),Ah=["init","ready","focus","unfocus","destroy","attach","detach","enter","exit"],Eh={previous:null,current:null,get state(){return this.current},set state(r){Ah.indexOf(r)>-1&&(r!==this.current||r==="focus")&&(J.debug(`Setting lifecycle state from ${this.current} to ${r} for ${this.component.componentId}`),this.previous=this.current,this.current=r,bh(r,this.component[y.identifier],this.component),cn(r,this.component[y.identifier],this.component))}},Lh="modulepreload",Ph=function(r){return"/"+r},Lo={},Ih=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let o=function(h){return Promise.all(h.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=o(t.map(h=>{if(h=Ph(h),h in Lo)return;Lo[h]=!0;const u=h.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${f}`))return;const c=document.createElement("link");if(c.rel=u?"stylesheet":Lh,u||(c.as="script"),c.crossOrigin="",c.href=h,l&&c.setAttribute("nonce",l),document.head.appendChild(c),u)return new Promise((p,_)=>{c.addEventListener("load",p),c.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${h}`)))})}))}function n(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&n(a.reason);return e().catch(n)})},Mh={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function Fh(r,e=!1,t){const i={alpha:!0,antialias:!1,depth:!1,stencil:!0,desynchronized:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!1},s=r.getContext(e?"webgl2":"webgl",i)||r.getContext("experimental-webgl",i);if(!s)throw new Error("Unable to create WebGL context");return t?new Proxy(s,{get(n,o){const a=n[o];return typeof a=="function"?(t.increment(String(o)),a.bind(n)):a}}):s}function I(r,e){if(Pi()!==!0&&!r)throw new Error(e||"Assertion failed")}function Po(r,e,t){const i=Math.trunc(r>>>24),s=Math.trunc(r>>>16&255),n=Math.trunc(r>>>8&255),o=Math.trunc(r&255),a=Math.trunc(e>>>24),l=Math.trunc(e>>>16&255),h=Math.trunc(e>>>8&255),u=Math.trunc(e&255),f=Math.round(a*t+i*(1-t)),c=Math.round(l*t+s*(1-t)),p=Math.round(h*t+n*(1-t)),_=Math.round(u*t+o*(1-t));return(f<<24|c<<16|p<<8|_)>>>0}function Oh(r,e){const t=r>>>24,i=r>>>16&255,s=r>>>8&255,n=Math.trunc((r&255)*e);return(t<<24|i<<16|s<<8|n)>>>0}let wa=!0;function zh(r){wa=r==="webgl"}function Ls(r,e,t=!1){const i=(r&255)/255*e,s=wa?i:1,n=Math.trunc((r>>>24)*s),o=Math.trunc((r>>>16&255)*s),a=Math.trunc((r>>>8&255)*s),l=Math.trunc(i*255);return t?(l<<24|a<<16|o<<8|n)>>>0:(n<<24|o<<16|a<<8|l)>>>0}function hr(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Pi(){return Mh&&!0}let Uh=1;function Bh(){return Uh++}let ht=class{constructor(){d(this,"eventListeners",{})}on(e,t){let i=this.eventListeners[e];i||(i=[]),i.push(t),this.eventListeners[e]=i}off(e,t){const i=this.eventListeners[e];if(!i)return;if(!t){delete this.eventListeners[e];return}const s=i.indexOf(t);s>=0&&i.splice(s,1)}once(e,t){const i=(s,n)=>{this.off(e,i),t(s,n)};this.on(e,i)}emit(e,t){const i=this.eventListeners[e];i&&[...i].forEach(s=>{s(this,t)})}removeAllListeners(){this.eventListeners={}}};var ie;(function(r){r[r.generic=0]="generic",r[r.color=1]="color",r[r.image=2]="image",r[r.noise=3]="noise",r[r.renderToTexture=4]="renderToTexture",r[r.subTexture=5]="subTexture"})(ie||(ie={}));let ts=class extends ht{constructor(t){super();d(this,"txManager");d(this,"_dimensions",null);d(this,"_error",null);d(this,"state","initial");d(this,"renderableOwners",new Set);d(this,"renderable",!1);d(this,"type",ie.generic);d(this,"preventCleanup",!1);d(this,"ctxTexture");d(this,"textureData",null);this.txManager=t}get dimensions(){return this._dimensions}get error(){return this._error}setRenderableOwner(t,i){var n,o;const s=this.renderableOwners.size;if(i===!0){this.renderableOwners.has(t)===!1&&this.renderableOwners.add(t);const a=this.renderableOwners.size;a>s&&a===1&&(this.renderable=!0,(n=this.onChangeIsRenderable)==null||n.call(this,!0),this.load())}else{this.renderableOwners.delete(t);const a=this.renderableOwners.size;a<s&&a===0&&(this.renderable=!1,(o=this.onChangeIsRenderable)==null||o.call(this,!1),this.txManager.orphanTexture(this))}}load(){this.txManager.loadTexture(this)}loadCtxTexture(){return this.ctxTexture===void 0&&(this.ctxTexture=this.txManager.renderer.createCtxTexture(this)),this.ctxTexture}free(){var t;(t=this.ctxTexture)==null||t.free()}freeTextureData(){this.textureData=null}setState(t,i){if(this.state===t)return;let s=null;t==="loaded"?(i!==void 0&&"width"in i&&"height"in i&&i.width!==void 0&&i.height!==void 0&&(this._dimensions=i),s=this._dimensions):t==="failed"&&(this._error=i,s=this._error),this.state=t,this.emit(t,s)}async getTextureData(){return this.textureData===null&&(this.textureData=await this.getTextureSource()),this.textureData}static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}};const kh=/^(data|ftps?|https?):/,is=r=>{const e=r>>>24,t=r>>>16&255,i=r>>>8&255,s=r&255;return[e/255,t/255,i/255,s/255]},Io=r=>{const e=r>>>24,t=r>>>16&255,i=r>>>8&255,s=r&255;return[e,t,i,s]};function Mo(r){return(r&255)/255}function Kr(r){const e=Math.floor(r[0]*255),t=Math.floor(r[1]*255),i=Math.floor(r[2]*255),s=Math.floor(r[3]*255);return`rgba(${e},${t},${i},${s.toFixed(4)})`}function xi(r,e,t,i,s){return s?(s.x1=r,s.y1=e,s.x2=t,s.y2=i,s):{x1:r,y1:e,x2:t,y2:i}}function qr(r,e){return r.x1<e.x2&&r.x2>e.x1&&r.y1<e.y2&&r.y2>e.y1}function Dh(r,e){return e?(e.x=r.x1,e.y=r.y1,e.width=r.x2-r.x1,e.height=r.y2-r.y1,e):{x:r.x1,y:r.y1,width:r.x2-r.x1,height:r.y2-r.y1}}function Ca(r,e,t){const i=Math.max(r.x,e.x),s=Math.max(r.y,e.y),n=Math.min(r.x+r.width,e.x+e.width)-i,o=Math.min(r.y+r.height,e.y+e.height)-s;return n>0&&o>0?t?(t.x=i,t.y=s,t.width=n,t.height=o,t):{x:i,y:s,width:n,height:o}:t?(t.x=0,t.y=0,t.width=0,t.height=0,t):{x:0,y:0,width:0,height:0}}function Ra(r,e){return e?(e.x=r.x,e.y=r.y,e.width=r.width,e.height=r.height,e):{x:r.x,y:r.y,width:r.width,height:r.height}}function Nh(r,e){return r===e?!0:r===null||e===null?!1:r.x===e.x&&r.y===e.y&&r.width===e.width&&r.height===e.height}function Zr(r,e){return r.x1<=e.x2&&r.y1<=e.y2&&r.x2>=e.x1&&r.y2>=e.y1}function $h(r,e){return r.x1<e.x1&&r.x2>e.x2&&r.y1<e.y1&&r.y2>e.y2}function Hh(r){return r.x1<r.x2&&r.y1<r.y2}function gn(r,e){return xi(r.x1-e[3],r.y1-e[0],r.x2+e[1],r.y2+e[2])}function Wh(r){if(self.location.protocol==="file:"&&!kh.test(r)){const t=self.location.pathname.split("/");t.pop();const i=t.join("/"),s=self.location.protocol+"//"+i;return r.charAt(0)==="."&&(r=r.slice(1)),r.charAt(0)==="/"&&(r=r.slice(1)),s+"/"+r}return new URL(r,self.location.href).href}function Qr(r){return r.startsWith("data:")===!0}function Vh(r){var l,h;r=r.replace(/^data:/,"");const e=((l=r.match(/image\/[^;]+/))==null?void 0:l[0])||"",t=r.replace(/^[^,]+,/,""),i=1024,s=atob(t),n=s.length,o=Math.ceil(n/i),a=new Array(o);for(let u=0;u<o;++u){const f=u*i,c=Math.min(f+i,n),p=new Array(c-f);for(let _=f,g=0;_<c;++g,++_)p[g]=(h=s[_])==null?void 0:h.charCodeAt(0);a[u]=new Uint8Array(p)}return new Blob(a,{type:e})}class de{constructor(){d(this,"ta");d(this,"tb");d(this,"tx");d(this,"tc");d(this,"td");d(this,"ty");d(this,"_floatArr",null);d(this,"mutation");this.ta=0,this.tb=0,this.tx=0,this.tc=0,this.td=0,this.ty=0,this.mutation=!0}static get temp(){return Xh}static multiply(e,t,i){const s=e.ta*t.ta+e.tb*t.tc,n=e.ta*t.tb+e.tb*t.td,o=e.ta*t.tx+e.tb*t.ty+e.tx,a=e.tc*t.ta+e.td*t.tc,l=e.tc*t.tb+e.td*t.td,h=e.tc*t.tx+e.td*t.ty+e.ty;return i||(i=new de),i.ta=s,i.tb=n,i.tx=o,i.tc=a,i.td=l,i.ty=h,i.mutation=!0,i}static identity(e){return e||(e=new de),e.ta=1,e.tb=0,e.tx=0,e.tc=0,e.td=1,e.ty=0,e.mutation=!0,e}static translate(e,t,i){return i||(i=new de),i.ta=1,i.tb=0,i.tx=e,i.tc=0,i.td=1,i.ty=t,i.mutation=!0,i}static scale(e,t,i){return i||(i=new de),i.ta=e,i.tb=0,i.tx=0,i.tc=0,i.td=t,i.ty=0,i.mutation=!0,i}static rotate(e,t){const i=Math.cos(e),s=Math.sin(e);return t||(t=new de),t.ta=i,t.tb=-s,t.tx=0,t.tc=s,t.td=i,t.ty=0,t.mutation=!0,t}static copy(e,t){return t||(t=new de),t.ta=e.ta,t.tc=e.tc,t.tb=e.tb,t.td=e.td,t.tx=e.tx,t.ty=e.ty,t.mutation=!0,t}translate(e,t){return this.tx=this.ta*e+this.tb*t+this.tx,this.ty=this.tc*e+this.td*t+this.ty,this.mutation=!0,this}scale(e,t){return this.ta=this.ta*e,this.tb=this.tb*t,this.tc=this.tc*e,this.td=this.td*t,this.mutation=!0,this}rotate(e){if(e===0||!(e%Math.PI*2))return this;const t=Math.cos(e),i=Math.sin(e),s=this.ta*t+this.tb*i,n=this.tb*t-this.ta*i,o=this.tc*t+this.td*i,a=this.td*t-this.tc*i;return this.ta=s,this.tb=n,this.tc=o,this.td=a,this.mutation=!0,this}multiply(e){return de.multiply(this,e,this)}getFloatArr(){return this._floatArr||(this._floatArr=new Float32Array(9)),this.mutation&&(this._floatArr[0]=this.ta,this._floatArr[1]=this.tc,this._floatArr[2]=0,this._floatArr[3]=this.tb,this._floatArr[4]=this.td,this._floatArr[5]=0,this._floatArr[6]=this.tx,this._floatArr[7]=this.ty,this._floatArr[8]=1,this.mutation=!1),this._floatArr}}const Xh=new de,Ps=0,Is=2,Ms=4,Fs=6,Os=1,zs=3,Us=5,Bs=7;class yi{constructor(e){d(this,"data");this.data=new Float32Array(8),e&&(this.data[Ps]=e[Ps],this.data[Is]=e[Is],this.data[Ms]=e[Ms],this.data[Fs]=e[Fs],this.data[Os]=e[Os],this.data[zs]=e[zs],this.data[Us]=e[Us],this.data[Bs]=e[Bs])}static translate(e,t,i,s,n,o,a,l,h){return h||(h=new yi),h.data[Ps]=e,h.data[Is]=i,h.data[Ms]=n,h.data[Fs]=a,h.data[Os]=t,h.data[zs]=s,h.data[Us]=o,h.data[Bs]=l,h}get x1(){return this.data[Ps]}get x2(){return this.data[Is]}get x3(){return this.data[Ms]}get x4(){return this.data[Fs]}get y1(){return this.data[Os]}get y2(){return this.data[zs]}get y3(){return this.data[Us]}get y4(){return this.data[Bs]}}const Aa=(r,e,t,i)=>{const s=3*r,n=3*(t-r)-s,o=1-s-n,a=3*e,l=3*(i-e)-a,h=1-a-l;return function(u){if(u>=1)return 1;if(u<=0)return 0;let f=.5,c,p,_;for(let m=0;m<20;m++){if(c=f*(f*(f*o+n)+s),_=u-c,_>-1e-8&&_<1e-8)return f*(f*(f*h+l)+a);if(p=f*(f*(3*o)+2*n)+s,p>1e-10&&p<1e-10)break;f+=_/p}let g=0,x=1;for(let m=0;m<20;m++){if(f=.5*(g+x),c=f*(f*(f*o+n)+s),_=u-c,_>-1e-8&&_<1e-8)return f*(f*(f*h+l)+a);_<0?x=f:g=f}}},Ys={},Gh={ease:[.25,.1,.25,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1],"ease-in-sine":[.12,0,.39,0],"ease-out-sine":[.12,0,.39,0],"ease-in-out-sine":[.37,0,.63,1],"ease-in-cubic":[.32,0,.67,0],"ease-out-cubic":[.33,1,.68,1],"ease-in-out-cubic":[.65,0,.35,1],"ease-in-circ":[.55,0,1,.45],"ease-out-circ":[0,.55,.45,1],"ease-in-out-circ":[.85,0,.15,1],"ease-in-back":[.36,0,.66,-.56],"ease-out-back":[.34,1.56,.64,1],"ease-in-out-back":[.68,-.6,.32,1.6]},js=r=>r,Yh=r=>{const e=/-?\d*\.?\d+/g,t=r.match(e);if(t){const[i,s,n,o]=t,a=parseFloat(i||"0.42"),l=parseFloat(s||"0"),h=parseFloat(n||"1"),u=parseFloat(o||"1"),f=Aa(a,l,h,u);return Ys[r]=f,f}return console.warn("Unknown cubic-bezier timing: "+r),js},jh=r=>{if(r==="linear")return js;if(Ys[r]!==void 0)return Ys[r]||js;if(r==="step-start")return()=>1;if(r==="step-end")return t=>t===1?1:0;const e=Gh[r];if(e!==void 0){const[t,i,s,n]=e,o=Aa(t,i,s,n);return Ys[r]=o,o}return r.startsWith("cubic-bezier")?Yh(r):(console.warn("Unknown timing function: "+r),js)};function Fo(r){return(r/1024/1024).toFixed(2)}class Kh extends ht{constructor(t,i,s){super();d(this,"node");d(this,"props");d(this,"settings");d(this,"progress",0);d(this,"delayFor",0);d(this,"delay",0);d(this,"timingFunction");d(this,"propValuesMap",{});d(this,"dynPropValuesMap");this.node=t,this.props=i;for(const a in i)if(a!=="shaderProps")this.propValuesMap.props===void 0&&(this.propValuesMap.props={}),this.propValuesMap.props[a]={start:t[a]||0,target:i[a]};else if(t.shader.type!=="DynamicShader"){this.propValuesMap.shaderProps={};for(const l in i.shaderProps)this.propValuesMap.shaderProps[l]={start:t.shader.props[l],target:i.shaderProps[l]}}else{const l=Object.keys(i.shaderProps),h=l.length;this.dynPropValuesMap={};for(let u=0;u<h;u++){const f=l[u],c=i.shaderProps[f];this.dynPropValuesMap[f]={};const p=Object.entries(c),_=p.length;for(let g=0;g<_;g++){const[x,m]=p[g];this.dynPropValuesMap[f][x]={start:t.shader.props[f][x],target:m}}}}const n=s.easing||"linear",o=s.delay??0;this.settings={duration:s.duration??0,delay:o,easing:n,loop:s.loop??!1,repeat:s.repeat??0,repeatDelay:s.repeatDelay??0,stopMethod:s.stopMethod??!1},this.timingFunction=jh(n),this.delayFor=o,this.delay=o}reset(){this.progress=0,this.delayFor=this.settings.delay||0,this.update(0)}restoreValues(t,i){const s=Object.entries(i),n=s.length;for(let o=0;o<n;o++){const[a,l]=s[o];t[a]=l.start}}restore(){if(this.reset(),this.propValuesMap.props!==void 0&&this.restoreValues(this.node,this.propValuesMap.props),this.propValuesMap.shaderProps!==void 0&&this.restoreValues(this.node.shader.props,this.propValuesMap.shaderProps),this.dynPropValuesMap!==void 0){const t=Object.keys(this.dynPropValuesMap),i=t.length;if(i>0)for(let s=0;s<i;s++){const n=t[s];this.restoreValues(this.node.shader.props[n],this.dynPropValuesMap[n])}}}reverseValues(t){const i=Object.entries(t),s=i.length;for(let n=0;n<s;n++){const[o,a]=i[n];t[o]={start:a.target,target:a.start}}}reverse(){if(this.progress=0,this.propValuesMap.props!==void 0&&this.reverseValues(this.propValuesMap.props),this.propValuesMap.shaderProps!==void 0&&this.reverseValues(this.propValuesMap.shaderProps),this.dynPropValuesMap!==void 0){const t=Object.keys(this.dynPropValuesMap),i=t.length;if(i>0)for(let s=0;s<i;s++){const n=t[s];this.reverseValues(this.dynPropValuesMap[n])}}this.settings.loop||(this.settings.stopMethod=!1)}applyEasing(t,i,s){return(this.timingFunction(t)||t)*(s-i)+i}updateValue(t,i,s,n){if(this.progress===1)return i;if(this.progress===0)return s;const o=i;if(t.indexOf("color")!==-1){if(s===o)return s;if(n){const a=this.timingFunction(this.progress)||this.progress;return Po(s,o,a)}return Po(s,o,this.progress)}return n?this.applyEasing(this.progress,s,o):s+(o-s)*this.progress}updateValues(t,i,s){const n=Object.entries(i),o=n.length;for(let a=0;a<o;a++){const[l,h]=n[a];t[l]=this.updateValue(l,h.target,h.start,s)}}update(t){const{duration:i,loop:s,easing:n,stopMethod:o}=this.settings,{delayFor:a}=this;if(this.node.destroyed){this.emit("destroyed",{});return}if(i===0&&a===0){this.emit("finished",{});return}if(this.delayFor>0){if(this.delayFor-=t,this.delayFor>=0)return;t=-this.delayFor,this.delayFor=0}if(i===0){this.emit("finished",{});return}if(this.progress===0&&this.emit("animating",{}),this.progress+=t/i,this.progress>1&&(this.progress=s?0:1,this.delayFor=this.delay,o)){this.emit("finished",{});return}if(this.propValuesMap.props!==void 0&&this.updateValues(this.node,this.propValuesMap.props,n),this.propValuesMap.shaderProps!==void 0&&this.updateValues(this.node.shader.props,this.propValuesMap.shaderProps,n),this.dynPropValuesMap!==void 0){const l=Object.keys(this.dynPropValuesMap),h=l.length;if(h>0)for(let u=0;u<h;u++){const f=l[u];this.updateValues(this.node.shader.props[f],this.dynPropValuesMap[f],n)}}this.progress<1&&this.emit("tick",{progress:this.progress}),this.progress===1&&this.emit("finished",{})}}class qh extends ht{constructor(t,i){super();d(this,"manager");d(this,"animation");d(this,"stoppedPromise");d(this,"stoppedResolve",null);d(this,"state");this.manager=t,this.animation=i,this.state="stopped",this.stoppedPromise=Promise.resolve(),this.onAnimating=this.onAnimating.bind(this),this.onFinished=this.onFinished.bind(this),this.onTick=this.onTick.bind(this),this.onDestroy=this.onDestroy.bind(this)}start(){return this.state!=="running"&&this.state!=="scheduled"&&(this.makeStoppedPromise(),this.registerAnimation(),this.state="scheduled"),this}stop(){return this.unregisterAnimation(),this.stoppedResolve!==null&&(this.stoppedResolve(),this.stoppedResolve=null,this.emit("stopped",this)),this.animation.reset(),this.state="stopped",this}pause(){return this.unregisterAnimation(),this.state="paused",this}restore(){return this.stoppedResolve=null,this.animation.restore(),this}waitUntilStopped(){return this.stoppedPromise}registerAnimation(){this.animation.once("finished",this.onFinished),this.animation.on("animating",this.onAnimating),this.animation.on("tick",this.onTick),this.animation.on("destroyed",this.onDestroy),this.manager.registerAnimation(this.animation)}unregisterAnimation(){this.manager.unregisterAnimation(this.animation),this.animation.off("finished",this.onFinished),this.animation.off("animating",this.onAnimating),this.animation.off("tick",this.onTick),this.animation.off("destroy",this.onDestroy)}makeStoppedPromise(){this.stoppedResolve===null&&(this.stoppedPromise=new Promise(t=>{this.stoppedResolve=t}))}onDestroy(){this.unregisterAnimation(),this.state="stopped"}onFinished(){I(this.stoppedResolve);const{loop:t,stopMethod:i}=this.animation.settings;if(i==="reverse"){this.animation.once("finished",this.onFinished),this.animation.reverse();return}t||(this.unregisterAnimation(),this.stoppedResolve(),this.stoppedResolve=null,this.emit("stopped",this),this.state="stopped")}onAnimating(){this.state="running",this.emit("animating",this)}onTick(t,i){this.emit("tick",i)}}var ge;(function(r){r[r.Init=0]="Init",r[r.OutOfBounds=2]="OutOfBounds",r[r.InBounds=4]="InBounds",r[r.InViewport=8]="InViewport"})(ge||(ge={}));const ss=new Map;ss.set(ge.Init,"init");ss.set(ge.OutOfBounds,"outOfBounds");ss.set(ge.InBounds,"inBounds");ss.set(ge.InViewport,"inViewport");var v;(function(r){r[r.Children=1]="Children",r[r.ScaleRotate=2]="ScaleRotate",r[r.Local=4]="Local",r[r.Global=8]="Global",r[r.Clipping=16]="Clipping",r[r.CalculatedZIndex=32]="CalculatedZIndex",r[r.ZIndexSortedChildren=64]="ZIndexSortedChildren",r[r.PremultipliedColors=128]="PremultipliedColors",r[r.WorldAlpha=256]="WorldAlpha",r[r.RenderState=512]="RenderState",r[r.IsRenderable=1024]="IsRenderable",r[r.RenderTexture=2048]="RenderTexture",r[r.ParentRenderTexture=4096]="ParentRenderTexture",r[r.RenderBounds=8192]="RenderBounds",r[r.None=0]="None",r[r.All=14335]="All"})(v||(v={}));class _n extends ht{constructor(t,i){super();d(this,"stage");d(this,"children",[]);d(this,"_id",Bh());d(this,"props");d(this,"updateType",v.All);d(this,"childUpdateType",v.None);d(this,"globalTransform");d(this,"scaleRotateTransform");d(this,"localTransform");d(this,"sceneGlobalTransform");d(this,"renderCoords");d(this,"sceneRenderCoords");d(this,"renderBound");d(this,"strictBound");d(this,"preloadBound");d(this,"clippingRect",{x:0,y:0,width:0,height:0,valid:!1});d(this,"isRenderable",!1);d(this,"renderState",ge.Init);d(this,"worldAlpha",1);d(this,"premultipliedColorTl",0);d(this,"premultipliedColorTr",0);d(this,"premultipliedColorBl",0);d(this,"premultipliedColorBr",0);d(this,"calcZIndex",0);d(this,"hasRTTupdates",!1);d(this,"parentHasRenderTexture",!1);d(this,"rttParent",null);d(this,"destroyed",!1);d(this,"onTextureLoaded",(t,i)=>{var s,n;this.autosizeNode(i),this.setUpdateType(v.IsRenderable),this.stage.requestRender(),this.parentHasRenderTexture&&this.notifyParentRTTOfUpdate(),i.width>1&&i.height>1&&this.emit("loaded",{type:"texture",dimensions:i}),((n=(s=this.props.textureOptions)==null?void 0:s.resizeMode)==null?void 0:n.type)==="contain"&&this.setUpdateType(v.Local)});d(this,"onTextureFailed",(t,i)=>{this.setUpdateType(v.IsRenderable),this.parentHasRenderTexture&&this.notifyParentRTTOfUpdate(),this.emit("failed",{type:"texture",error:i})});d(this,"onTextureFreed",()=>{this.setUpdateType(v.IsRenderable),this.parentHasRenderTexture&&this.notifyParentRTTOfUpdate(),this.emit("freed",{type:"texture"})});this.stage=t,this.props={...i,parent:null,texture:null,src:null,rtt:!1},this.parent=i.parent,this.texture=i.texture,this.src=i.src,this.rtt=i.rtt,i.boundsMargin&&(this.boundsMargin=Array.isArray(i.boundsMargin)?i.boundsMargin:[i.boundsMargin,i.boundsMargin,i.boundsMargin,i.boundsMargin]),this.setUpdateType(v.ScaleRotate|v.Local|v.RenderBounds|v.RenderState),Pi()===!1&&i.preventCleanup===!0&&console.warn("CoreNode.preventCleanup: Is deprecated and will be removed in upcoming release, please use textureOptions.preventCleanup instead"),this.stage.defaultTexture&&this.stage.defaultTexture.state!=="loaded"&&this.stage.defaultTexture.once("loaded",()=>{this.setUpdateType(v.IsRenderable)})}loadTexture(){const{texture:t}=this.props;I(t),queueMicrotask(()=>{var i;if(this.textureOptions.preload===!0&&this.stage.txManager.loadTexture(t),t.preventCleanup=((i=this.props.textureOptions)==null?void 0:i.preventCleanup)??!1,t.on("loaded",this.onTextureLoaded),t.on("failed",this.onTextureFailed),t.on("freed",this.onTextureFreed),this.parentHasRenderTexture){this.notifyParentRTTOfUpdate();return}t.state==="loaded"?(I(t.dimensions),this.onTextureLoaded(t,t.dimensions)):t.state==="failed"?(I(t.error),this.onTextureFailed(t,t.error)):t.state==="freed"&&this.onTextureFreed(t)})}unloadTexture(){this.texture!==null&&(this.texture.off("loaded",this.onTextureLoaded),this.texture.off("failed",this.onTextureFailed),this.texture.off("freed",this.onTextureFreed),this.texture.setRenderableOwner(this,!1))}autosizeNode(t){this.autosize&&(this.width=t.width,this.height=t.height)}setUpdateType(t){this.updateType|=t;const i=this.props.parent;i&&(i.updateType&v.Children)===0&&i.setUpdateType(v.Children)}sortChildren(){this.children.sort((t,i)=>t.calcZIndex-i.calcZIndex)}updateScaleRotateTransform(){const{rotation:t,scaleX:i,scaleY:s}=this.props;if(t===0&&i===1&&s===1){this.scaleRotateTransform=void 0;return}this.scaleRotateTransform=de.rotate(t,this.scaleRotateTransform).scale(i,s)}updateLocalTransform(){var h,u;const{x:t,y:i,width:s,height:n}=this.props,o=this.props.mountX*s,a=this.props.mountY*n;if(this.scaleRotateTransform){const f=this.props.pivotX*s,c=this.props.pivotY*n;this.localTransform=de.translate(t-o+f,i-a+c,this.localTransform).multiply(this.scaleRotateTransform).translate(-f,-c)}else this.localTransform=de.translate(t-o,i-a,this.localTransform);const l=this.props.texture;if(l&&l.dimensions&&((u=(h=this.props.textureOptions)==null?void 0:h.resizeMode)==null?void 0:u.type)==="contain"){let f=1,c=1,p=0,_=0;const{width:g,height:x}=l.dimensions,m=g/x,T=s/n;if(m>T){const b=s/g,S=x*b;_=(n-S)/2,c=S/n}else{const b=n/x,S=g*b;p=(s-S)/2,f=S/s}this.localTransform.translate(p,_).scale(f,c)}this.setUpdateType(v.Global)}update(t,i){this.updateType&v.ScaleRotate&&(this.updateScaleRotateTransform(),this.setUpdateType(v.Local)),this.updateType&v.Local&&(this.updateLocalTransform(),this.setUpdateType(v.Global));const s=this.props.parent;let n=null;if(this.updateType&v.RenderTexture&&this.rtt&&(this.hasRTTupdates=!0),this.updateType&v.Global&&(I(this.localTransform),this.parentHasRenderTexture===!0&&(s==null?void 0:s.rtt)===!0?(this.globalTransform=de.identity(),this.sceneGlobalTransform=de.copy((s==null?void 0:s.globalTransform)||de.identity()).multiply(this.localTransform)):this.parentHasRenderTexture===!0&&(s==null?void 0:s.rtt)===!1?(this.sceneGlobalTransform=de.copy((s==null?void 0:s.sceneGlobalTransform)||this.localTransform).multiply(this.localTransform),this.globalTransform=de.copy((s==null?void 0:s.globalTransform)||this.localTransform,this.globalTransform)):this.globalTransform=de.copy((s==null?void 0:s.globalTransform)||this.localTransform,this.globalTransform),s!==null&&this.globalTransform.multiply(this.localTransform),this.calculateRenderCoords(),this.updateBoundingRect(),this.setUpdateType(v.RenderState|v.Children),this.childUpdateType|=v.Global,this.clipping===!0&&(this.setUpdateType(v.Clipping|v.RenderBounds),this.childUpdateType|=v.RenderBounds)),this.updateType&v.RenderBounds&&(this.createRenderBounds(),this.setUpdateType(v.RenderState),this.setUpdateType(v.Children),this.childUpdateType|=v.RenderBounds),this.updateType&v.RenderState&&(n=this.checkRenderBounds(),this.setUpdateType(v.IsRenderable),n!==ge.OutOfBounds&&this.updateRenderState(n)),this.updateType&v.WorldAlpha&&(s?this.worldAlpha=s.worldAlpha*this.props.alpha:this.worldAlpha=this.props.alpha,this.setUpdateType(v.Children|v.PremultipliedColors|v.IsRenderable),this.childUpdateType|=v.WorldAlpha),this.updateType&v.IsRenderable&&this.updateIsRenderable(),this.updateType&v.Clipping&&(this.calculateClippingRect(i),this.setUpdateType(v.Children),this.childUpdateType|=v.Clipping,this.childUpdateType|=v.RenderBounds),this.updateType&v.PremultipliedColors&&(this.premultipliedColorTl=Ls(this.props.colorTl,this.worldAlpha,!0),this.props.colorTl===this.props.colorTr&&this.props.colorBl===this.props.colorBr&&this.props.colorTl===this.props.colorBl?this.premultipliedColorTr=this.premultipliedColorBl=this.premultipliedColorBr=this.premultipliedColorTl:(this.premultipliedColorTr=Ls(this.props.colorTr,this.worldAlpha,!0),this.premultipliedColorBl=Ls(this.props.colorBl,this.worldAlpha,!0),this.premultipliedColorBr=Ls(this.props.colorBr,this.worldAlpha,!0))),s!==null&&this.updateType&v.CalculatedZIndex&&(this.calculateZIndex(),s.setUpdateType(v.ZIndexSortedChildren)),this.props.strictBounds===!0&&this.renderState===ge.OutOfBounds){this.updateType&=~v.RenderBounds;return}if(this.updateType&v.Children&&this.children.length>0)for(let o=0,a=this.children.length;o<a;o++){const l=this.children[o];if(l.setUpdateType(this.childUpdateType),l.updateType===0)continue;let h=this.clippingRect;this.rtt===!0&&(h={x:0,y:0,width:0,height:0,valid:!1}),l.update(t,h)}this.parentHasRenderTexture&&this.updateType>0&&this.notifyParentRTTOfUpdate(),this.updateType&v.ZIndexSortedChildren&&this.sortChildren(),n===ge.OutOfBounds&&(this.updateRenderState(n),this.updateIsRenderable(),this.rtt===!0&&n===ge.OutOfBounds&&this.notifyChildrenRTTOfUpdate(n)),this.updateType=0,this.childUpdateType=0}findParentRTTNode(){let t=this.parent;for(;t&&!t.rtt;)t=t.parent;return t}getRTTParentRenderState(){const t=this.rttParent||this.findParentRTTNode();return t?t.renderState:null}notifyChildrenRTTOfUpdate(t){for(const i of this.children)i.updateRenderState(t),i.updateIsRenderable(),i.notifyChildrenRTTOfUpdate(t)}notifyParentRTTOfUpdate(){if(this.parent===null)return;const t=this.rttParent||this.findParentRTTNode();t&&(t.hasRTTupdates=!0,t.setUpdateType(v.RenderTexture),t.parentHasRenderTexture===!0&&t.notifyParentRTTOfUpdate())}checkRenderBounds(){return I(this.renderBound),I(this.strictBound),I(this.preloadBound),Zr(this.renderBound,this.strictBound)?ge.InViewport:Zr(this.renderBound,this.preloadBound)?ge.InBounds:$h(this.renderBound,this.strictBound)?ge.InViewport:this.parent!==null&&(this.props.width===0||this.props.height===0)?this.parent.renderState:ge.OutOfBounds}updateBoundingRect(){const t=this.sceneGlobalTransform||this.globalTransform,i=this.sceneRenderCoords||this.renderCoords;I(t),I(i);const{tb:s,tc:n}=t,{x1:o,y1:a,x3:l,y3:h}=i;if(s===0||n===0)this.renderBound=xi(o,a,l,h,this.renderBound);else{const{x2:u,x4:f,y2:c,y4:p}=i;this.renderBound=xi(Math.min(o,u,l,f),Math.min(a,c,h,p),Math.max(o,u,l,f),Math.max(a,c,h,p),this.renderBound)}}createRenderBounds(){if(I(this.stage),this.parent!==null&&this.parent.strictBound!==void 0){const u=this.parent.strictBound;this.strictBound=xi(u.x1,u.y1,u.x2,u.y2),this.preloadBound=gn(this.strictBound,this.boundsMargin)}else this.strictBound=this.stage.strictBound,this.preloadBound=this.stage.preloadBound;if(this.props.clipping===!1||this.renderBound===void 0||Zr(this.renderBound,this.strictBound)===!1)return;const{x:t,y:i,width:s,height:n}=this.props,{tx:o,ty:a}=this.sceneGlobalTransform||this.globalTransform||{},l=o??t,h=a??i;this.strictBound=xi(l,h,l+s,h+n,this.strictBound),this.preloadBound=gn(this.strictBound,this.boundsMargin)}updateRenderState(t){if(t===this.renderState)return;const i=this.renderState;this.renderState=t;const s=ss.get(t);I(s),this.emit(s,{previous:i,current:t})}updateIsRenderable(){let t=!1,i=!1;if(this.checkBasicRenderability()===!1){this.updateTextureOwnership(!1),this.setRenderable(!1);return}this.texture!==null?(i=!0,t=this.texture.state==="loaded"):(this.hasShader()||this.hasColorProperties()===!0)&&this.hasDimensions()===!0&&this.stage.defaultTexture&&this.stage.defaultTexture.state==="loaded"&&(t=!0),this.updateTextureOwnership(i),this.setRenderable(t)}checkBasicRenderability(){return!(this.worldAlpha===0||this.isOutOfBounds()===!0)}setRenderable(t){this.isRenderable=t}updateTextureOwnership(t){var i;(i=this.texture)==null||i.setRenderableOwner(this,t)}isOutOfBounds(){return this.renderState<=ge.OutOfBounds}hasDimensions(){return this.props.width!==0&&this.props.height!==0}hasColorProperties(){return this.props.color!==0||this.props.colorTop!==0||this.props.colorBottom!==0||this.props.colorLeft!==0||this.props.colorRight!==0||this.props.colorTl!==0||this.props.colorTr!==0||this.props.colorBl!==0||this.props.colorBr!==0}hasShader(){return this.props.shader!==null}calculateRenderCoords(){const{width:t,height:i}=this,{tx:s,ty:n,ta:o,tb:a,tc:l,td:h}=this.globalTransform;if(a===0&&l===0){const x=s,m=s+t*o,T=n,b=n+i*h;this.renderCoords=yi.translate(x,T,m,T,m,b,x,b,this.renderCoords)}else this.renderCoords=yi.translate(s,n,s+t*o,n+t*l,s+t*o+i*a,n+t*l+i*h,s+i*a,n+i*h,this.renderCoords);if(this.sceneGlobalTransform===void 0)return;const{tx:u,ty:f,ta:c,tb:p,tc:_,td:g}=this.sceneGlobalTransform;if(p===0&&_===0){const x=u,m=u+t*c,T=f,b=f+i*g;this.sceneRenderCoords=yi.translate(x,T,m,T,m,b,x,b,this.sceneRenderCoords)}else this.sceneRenderCoords=yi.translate(u,f,u+t*c,f+t*_,u+t*c+i*p,f+t*_+i*g,u+i*p,f+i*g,this.sceneRenderCoords)}calculateClippingRect(t){I(this.globalTransform);const{clippingRect:i,props:s,globalTransform:n}=this,{clipping:o}=s,a=n.tb!==0||n.tc!==0;o===!0&&a===!1?(i.x=n.tx,i.y=n.ty,i.width=this.width*n.ta,i.height=this.height*n.td,i.valid=!0):i.valid=!1,t.valid===!0&&i.valid===!0?Ca(t,i,i):t.valid===!0&&(Ra(t,i),i.valid=!0)}calculateZIndex(){var o,a;const t=this.props,i=t.zIndex||0,s=((o=t.parent)==null?void 0:o.zIndex)||0;let n=i;(a=t.parent)!=null&&a.zIndexLocked&&(n=i<s?i:s),this.calcZIndex=n}destroy(){var t;if(this.destroyed!==!0){for(this.destroyed=!0,this.unloadTexture(),this.clippingRect.valid=!1,this.isRenderable=!1,this.renderCoords=void 0,this.renderBound=void 0,this.strictBound=void 0,this.preloadBound=void 0,this.globalTransform=void 0,this.scaleRotateTransform=void 0,this.localTransform=void 0,this.props.texture=null,this.props.shader=this.stage.defShaderCtr;this.children.length>0;)(t=this.children[0])==null||t.destroy();this.parent=null,this.rtt&&this.stage.renderer.removeRTTNode(this),this.removeAllListeners()}}renderQuads(t){this.parentHasRenderTexture&&(!t.renderToTextureActive||this.parentRenderTexture!==t.activeRttNode)||(I(this.globalTransform),I(this.renderCoords),t.addQuad({width:this.props.width,height:this.props.height,colorTl:this.premultipliedColorTl,colorTr:this.premultipliedColorTr,colorBl:this.premultipliedColorBl,colorBr:this.premultipliedColorBr,texture:this.texture||this.stage.defaultTexture,textureOptions:this.textureOptions,zIndex:this.zIndex,shader:this.shader.shader,shaderProps:this.shader.getResolvedProps(),alpha:this.worldAlpha,clippingRect:this.clippingRect,tx:this.globalTransform.tx,ty:this.globalTransform.ty,ta:this.globalTransform.ta,tb:this.globalTransform.tb,tc:this.globalTransform.tc,td:this.globalTransform.td,renderCoords:this.renderCoords,rtt:this.rtt,parentHasRenderTexture:this.parentHasRenderTexture,framebufferDimensions:this.framebufferDimensions}))}get id(){return this._id}get data(){return this.props.data}set data(t){this.props.data=t}get x(){return this.props.x}set x(t){this.props.x!==t&&(this.props.x=t,this.setUpdateType(v.Local))}get absX(){var t,i,s;return this.props.x+-this.props.width*this.props.mountX+(((t=this.props.parent)==null?void 0:t.absX)||((s=(i=this.props.parent)==null?void 0:i.globalTransform)==null?void 0:s.tx)||0)}get absY(){var t;return this.props.y+-this.props.height*this.props.mountY+(((t=this.props.parent)==null?void 0:t.absY)??0)}get y(){return this.props.y}set y(t){this.props.y!==t&&(this.props.y=t,this.setUpdateType(v.Local))}get width(){return this.props.width}set width(t){this.props.width!==t&&(this.props.width=t,this.setUpdateType(v.Local),this.props.rtt&&(this.texture=this.stage.txManager.createTexture("RenderTexture",{width:this.width,height:this.height}),this.setUpdateType(v.RenderTexture)))}get height(){return this.props.height}set height(t){this.props.height!==t&&(this.props.height=t,this.setUpdateType(v.Local),this.props.rtt&&(this.texture=this.stage.txManager.createTexture("RenderTexture",{width:this.width,height:this.height}),this.setUpdateType(v.RenderTexture)))}get scale(){return this.scaleX}set scale(t){this.scaleX=t,this.scaleY=t}get scaleX(){return this.props.scaleX}set scaleX(t){this.props.scaleX!==t&&(this.props.scaleX=t,this.setUpdateType(v.ScaleRotate))}get scaleY(){return this.props.scaleY}set scaleY(t){this.props.scaleY!==t&&(this.props.scaleY=t,this.setUpdateType(v.ScaleRotate))}get mount(){return this.props.mount}set mount(t){(this.props.mountX!==t||this.props.mountY!==t)&&(this.props.mountX=t,this.props.mountY=t,this.props.mount=t,this.setUpdateType(v.Local))}get mountX(){return this.props.mountX}set mountX(t){this.props.mountX!==t&&(this.props.mountX=t,this.setUpdateType(v.Local))}get mountY(){return this.props.mountY}set mountY(t){this.props.mountY!==t&&(this.props.mountY=t,this.setUpdateType(v.Local))}get pivot(){return this.props.pivot}set pivot(t){(this.props.pivotX!==t||this.props.pivotY!==t)&&(this.props.pivotX=t,this.props.pivotY=t,this.props.pivot=t,this.setUpdateType(v.Local))}get pivotX(){return this.props.pivotX}set pivotX(t){this.props.pivotX!==t&&(this.props.pivotX=t,this.setUpdateType(v.Local))}get pivotY(){return this.props.pivotY}set pivotY(t){this.props.pivotY!==t&&(this.props.pivotY=t,this.setUpdateType(v.Local))}get rotation(){return this.props.rotation}set rotation(t){this.props.rotation!==t&&(this.props.rotation=t,this.setUpdateType(v.ScaleRotate))}get alpha(){return this.props.alpha}set alpha(t){this.props.alpha=t,this.setUpdateType(v.PremultipliedColors|v.WorldAlpha|v.Children|v.IsRenderable),this.childUpdateType|=v.WorldAlpha}get autosize(){return this.props.autosize}set autosize(t){this.props.autosize=t}get boundsMargin(){var t;return this.props.boundsMargin??((t=this.parent)==null?void 0:t.boundsMargin)??this.stage.boundsMargin}set boundsMargin(t){if(t!==this.props.boundsMargin){if(t===null)this.props.boundsMargin=t;else{const i=Array.isArray(t)?t:[t,t,t,t];this.props.boundsMargin=i}this.setUpdateType(v.RenderBounds)}}get clipping(){return this.props.clipping}set clipping(t){this.props.clipping=t,this.setUpdateType(v.Clipping|v.RenderBounds|v.Children),this.childUpdateType|=v.Global|v.Clipping}get color(){return this.props.color}set color(t){this.colorTop=t,this.colorBottom=t,this.colorLeft=t,this.colorRight=t,this.props.color=t,this.setUpdateType(v.PremultipliedColors)}get colorTop(){return this.props.colorTop}set colorTop(t){(this.props.colorTl!==t||this.props.colorTr!==t)&&(this.colorTl=t,this.colorTr=t),this.props.colorTop=t,this.setUpdateType(v.PremultipliedColors)}get colorBottom(){return this.props.colorBottom}set colorBottom(t){(this.props.colorBl!==t||this.props.colorBr!==t)&&(this.colorBl=t,this.colorBr=t),this.props.colorBottom=t,this.setUpdateType(v.PremultipliedColors)}get colorLeft(){return this.props.colorLeft}set colorLeft(t){(this.props.colorTl!==t||this.props.colorBl!==t)&&(this.colorTl=t,this.colorBl=t),this.props.colorLeft=t,this.setUpdateType(v.PremultipliedColors)}get colorRight(){return this.props.colorRight}set colorRight(t){(this.props.colorTr!==t||this.props.colorBr!==t)&&(this.colorTr=t,this.colorBr=t),this.props.colorRight=t,this.setUpdateType(v.PremultipliedColors)}get colorTl(){return this.props.colorTl}set colorTl(t){this.props.colorTl=t,this.setUpdateType(v.PremultipliedColors)}get colorTr(){return this.props.colorTr}set colorTr(t){this.props.colorTr=t,this.setUpdateType(v.PremultipliedColors)}get colorBl(){return this.props.colorBl}set colorBl(t){this.props.colorBl=t,this.setUpdateType(v.PremultipliedColors)}get colorBr(){return this.props.colorBr}set colorBr(t){this.props.colorBr=t,this.setUpdateType(v.PremultipliedColors)}get zIndexLocked(){return this.props.zIndexLocked||0}set zIndexLocked(t){this.props.zIndexLocked=t,this.setUpdateType(v.CalculatedZIndex|v.Children);for(let i=0,s=this.children.length;i<s;i++)this.children[i].setUpdateType(v.CalculatedZIndex)}get zIndex(){return this.props.zIndex}set zIndex(t){this.props.zIndex=t,this.setUpdateType(v.CalculatedZIndex|v.Children);for(let i=0,s=this.children.length;i<s;i++)this.children[i].setUpdateType(v.CalculatedZIndex)}get parent(){return this.props.parent}set parent(t){const i=this.props.parent;if(i!==t){if(this.props.parent=t,i){const s=i.children.indexOf(this);I(s!==-1,"CoreNode.parent: Node not found in old parent's children!"),i.children.splice(s,1),i.setUpdateType(v.Children|v.ZIndexSortedChildren)}t&&(t.children.push(this),this.setUpdateType(v.All),t.setUpdateType(v.Children|v.ZIndexSortedChildren),(t.rtt||t.parentHasRenderTexture)&&this.applyRTTInheritance(t)),this.updateScaleRotateTransform(),this.setUpdateType(v.RenderBounds|v.Children)}}get preventCleanup(){return this.props.textureOptions.preventCleanup||!1}set preventCleanup(t){Pi()===!1&&console.warn("CoreNode.preventCleanup: Is deprecated and will be removed in upcoming release, please use textureOptions.preventCleanup instead"),this.props.textureOptions.preventCleanup=t}get rtt(){return this.props.rtt}set rtt(t){this.props.rtt!==t&&(this.props.rtt=t,t===!0?(this.initRenderTexture(),this.markChildrenWithRTT()):this.cleanupRenderTexture(),this.setUpdateType(v.RenderTexture),this.parentHasRenderTexture===!0&&this.notifyParentRTTOfUpdate())}initRenderTexture(){this.texture=this.stage.txManager.createTexture("RenderTexture",{width:this.width,height:this.height}),this.stage.renderer.renderToTexture(this)}cleanupRenderTexture(){this.unloadTexture(),this.clearRTTInheritance(),this.hasRTTupdates=!1,this.texture=null}markChildrenWithRTT(t=null){const i=t||this;for(const s of i.children)s.setUpdateType(v.All),s.parentHasRenderTexture=!0,s.markChildrenWithRTT()}applyRTTInheritance(t){t.rtt&&t.setUpdateType(v.RenderTexture),this.markChildrenWithRTT(t)}clearRTTInheritance(){if(!this.rtt)for(const t of this.children)t.parentHasRenderTexture=!1,t.rttParent=null,t.setUpdateType(v.All),t.clearRTTInheritance()}get shader(){return this.props.shader}set shader(t){this.props.shader!==t&&(this.props.shader=t,this.setUpdateType(v.IsRenderable))}get src(){return this.props.src}set src(t){if(this.props.src!==t){if(this.props.src=t,!t){this.texture=null;return}this.texture=this.stage.txManager.createTexture("ImageTexture",{src:t,width:this.props.width,height:this.props.height,type:this.props.imageType,sx:this.props.srcX,sy:this.props.srcY,sw:this.props.srcWidth,sh:this.props.srcHeight})}}set imageType(t){this.props.imageType!==t&&(this.props.imageType=t)}get imageType(){return this.props.imageType||null}get srcHeight(){return this.props.srcHeight}set srcHeight(t){this.props.srcHeight=t}get srcWidth(){return this.props.srcWidth}set srcWidth(t){this.props.srcWidth=t}get srcX(){return this.props.srcX}set srcX(t){this.props.srcX=t}get srcY(){return this.props.srcY}set srcY(t){this.props.srcY=t}get framebufferDimensions(){return this.parentHasRenderTexture&&!this.rtt&&this.parent?this.parent.framebufferDimensions:{width:this.width,height:this.height}}get parentRenderTexture(){let t=this.parent;for(;t;){if(t.rtt)return t;t=t.parent}return null}get texture(){return this.props.texture}set texture(t){if(this.props.texture===t)return;const i=this.props.texture;i&&(i.setRenderableOwner(this,!1),this.unloadTexture()),this.props.texture=t,t!==null&&(t.setRenderableOwner(this,this.isRenderable),this.loadTexture()),this.setUpdateType(v.IsRenderable)}set textureOptions(t){this.props.textureOptions=t}get textureOptions(){return this.props.textureOptions}get strictBounds(){return this.props.strictBounds}set strictBounds(t){t!==this.props.strictBounds&&(this.props.strictBounds=t,this.setUpdateType(v.RenderBounds|v.Children),this.childUpdateType|=v.RenderBounds|v.Children)}animate(t,i){const s=new Kh(this,t,i);return new qh(this.stage.animationManager,s)}flush(){}}const Zh=r=>{let e=!1;const t=()=>{if(r.updateFrameTime(),r.updateAnimations(),!r.hasSceneUpdates()){r.calculateFps(),setTimeout(t,16.666666666666668),e||(r.eventBus.emit("idle"),e=!0),r.txMemManager.checkCleanup()===!0&&r.txMemManager.cleanup(!1),r.flushFrameEvents();return}e=!1,r.drawFrame(),r.flushFrameEvents(),requestAnimationFrame(t)};requestAnimationFrame(t)},qt=()=>performance?performance.now():Date.now();let Qh=class{constructor(){d(this,"activeAnimations",new Set)}registerAnimation(e){this.activeAnimations.add(e)}unregisterAnimation(e){this.activeAnimations.delete(e)}update(e){this.activeAnimations.forEach(t=>{t.update(e)})}};function Jh(){function r(t){return t.indexOf("image/png")!==-1}function e(t,i,s,n,o,a,l){return new Promise(function(h,u){var f=new XMLHttpRequest;f.open("GET",t,!0),f.responseType="blob",f.onload=function(){if(f.status!==200&&f.status!==0)return u(new Error("Failed to load image: "+f.statusText));var c=f.response;i!==void 0||r(c.type),createImageBitmap(c).then(function(p){h({data:p,premultiplyAlpha:i})}).catch(function(p){u(p)})},f.onerror=function(){u(new Error("Network error occurred while trying to fetch the image."))},f.send()})}self.onmessage=t=>{var i=t.data.src,s=t.data.id,n=t.data.premultiplyAlpha;t.data.sx,t.data.sy,t.data.sw,t.data.sh,e(i,n).then(function(o){self.postMessage({id:s,src:i,data:o},[o.data])}).catch(function(o){self.postMessage({id:s,src:i,error:o.message})})}}class eu{constructor(e,t){d(this,"imageWorkersEnabled",!0);d(this,"messageManager",{});d(this,"workers",[]);d(this,"workerIndex",0);d(this,"nextId",0);this.workers=this.createWorkers(e,t),this.workers.forEach(i=>{i.onmessage=this.handleMessage.bind(this)})}handleMessage(e){const{id:t,data:i,error:s}=e.data,n=this.messageManager[t];if(n){const[o,a]=n;delete this.messageManager[t],s?a(new Error(s)):o(i)}}createWorkers(e=1,t){let i=`(${Jh.toString()})()`;t.options===!0&&(i=i.replace("var supportsOptionsCreateImageBitmap = false;","var supportsOptionsCreateImageBitmap = true;")),t.full===!0&&(i=i.replace("var supportsOptionsCreateImageBitmap = false;","var supportsOptionsCreateImageBitmap = true;"),i=i.replace("var supportsFullCreateImageBitmap = false;","var supportsFullCreateImageBitmap = true;")),i=i.replace('"use strict";',"");const s=new Blob([i],{type:"application/javascript"}),n=(self.URL?URL:webkitURL).createObjectURL(s),o=[];for(let a=0;a<e;a++)o.push(new Worker(n));return o}getNextWorker(){const e=this.workers[this.workerIndex];return this.workerIndex=(this.workerIndex+1)%this.workers.length,e}getImage(e,t,i,s,n,o){return new Promise((a,l)=>{try{if(this.workers){const h=this.nextId++;this.messageManager[h]=[a,l];const u=this.getNextWorker();u&&u.postMessage({id:h,src:e,premultiplyAlpha:t,sx:i,sy:s,sw:n,sh:o})}}catch(h){l(h)}})}}const Ki=class Ki extends ts{constructor(t,i){super(t);d(this,"type",ie.color);d(this,"props");this.props=Ki.resolveDefaults(i||{})}get color(){return this.props.color}set color(t){this.props.color=t}async getTextureSource(){const t=new Uint8Array(4);return this.color===4294967295?(t[0]=255,t[1]=255,t[2]=255,t[3]=255):(t[0]=this.color>>16&255,t[1]=this.color>>8&255,t[2]=this.color&255,t[3]=this.color>>>24&255),this.setState("fetched",{width:1,height:1}),{data:t,premultiplyAlpha:!0}}static makeCacheKey(t){return`ColorTexture,${Ki.resolveDefaults(t).color}`}static resolveDefaults(t){return{color:t.color||4294967295}}};d(Ki,"z$__type__Props");let ur=Ki;function tu(r){return/\.(ktx|pvr)$/.test(r)}const Oo=async r=>{const t=await(await fetch(r)).arrayBuffer();return r.indexOf(".ktx")!==-1?iu(t):su(t)},iu=async r=>{const e=new DataView(r),t=e.getUint32(12)===16909060,i=[],s={glInternalFormat:e.getUint32(28,t),pixelWidth:e.getUint32(36,t),pixelHeight:e.getUint32(40,t),numberOfMipmapLevels:e.getUint32(56,t),bytesOfKeyValueData:e.getUint32(60,t)};let n=64;n+=s.bytesOfKeyValueData;for(let o=0;o<s.numberOfMipmapLevels;o++){const a=e.getUint32(n);n+=4,i.push(e.buffer.slice(n,a)),n+=a}return{data:{glInternalFormat:s.glInternalFormat,mipmaps:i,width:s.pixelWidth||0,height:s.pixelHeight||0,type:"ktx"},premultiplyAlpha:!1}},su=async r=>{const a=r,l=new Int32Array(a,0,13),h=l[12]+52,u=new Uint8Array(a,h),f=[],c={pixelWidth:l[7],pixelHeight:l[6],numberOfMipmapLevels:l[11]||0};let p=0,_=c.pixelWidth||0,g=c.pixelHeight||0;for(let x=0;x<c.numberOfMipmapLevels;x++){const m=(_+3>>2)*(g+3>>2)*8,T=new Uint8Array(a,u.byteOffset+p,m);f.push(T),p+=m,_=_>>1,g=g>>1}return{data:{glInternalFormat:36196,mipmaps:f,width:c.pixelWidth||0,height:c.pixelHeight||0,type:"pvr"},premultiplyAlpha:!1}};function ru(r){return/\.(svg)(\?.*)?$/.test(r)}const zo=(r,e,t,i,s,n,o)=>new Promise((a,l)=>{const h=document.createElement("canvas"),u=h.getContext("2d");I(u),u.imageSmoothingEnabled=!0;const f=new Image;f.onload=()=>{const c=i??0,p=s??0,_=e||f.width,g=t||f.height;h.width=_,h.height=g,u.drawImage(f,0,0,_,g),a({data:u.getImageData(c,p,n??_,o??g),premultiplyAlpha:!1})},f.onerror=c=>{l(c)},f.src=r});function Ea(r,e=""){return new Promise((t,i)=>{const s=new XMLHttpRequest;s.responseType=e,s.onreadystatechange=function(){s.readyState==XMLHttpRequest.DONE&&(s.status===0||s.status===200?t(s.response):i(s.statusText))},s.open("GET",r,!0),s.send(null)})}var zt;let mn=(zt=class extends ts{constructor(t,i){super(t);d(this,"props");d(this,"type",ie.image);this.props=zt.resolveDefaults(i)}hasAlphaChannel(t){return t.indexOf("image/png")!==-1}async loadImageFallback(t,i){const s=new Image;return typeof t=="string"&&Qr(t)===!1&&(s.crossOrigin="anonymous"),new Promise(n=>{s.onload=()=>{n({data:s,premultiplyAlpha:i})},s.onerror=()=>{console.warn("Image loading failed, returning fallback object."),n({data:s,premultiplyAlpha:i})},t instanceof Blob?s.src=URL.createObjectURL(t):s.src=t})}async createImageBitmap(t,i,s,n,o,a){const l=i??t.type.includes("image/png"),h=this.txManager.imageBitmapSupported;return h.full===!0&&o!==null&&a!==null?{data:await createImageBitmap(t,s||0,n||0,o,a,{premultiplyAlpha:l?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}),premultiplyAlpha:l}:h.basic===!0?{data:await createImageBitmap(t),premultiplyAlpha:l}:{data:await createImageBitmap(t,{premultiplyAlpha:l?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}),premultiplyAlpha:l}}async loadImage(t){const{premultiplyAlpha:i,sx:s,sy:n,sw:o,sh:a}=this.props;if(this.txManager.hasCreateImageBitmap===!0){if(Qr(t)===!1&&this.txManager.hasWorker===!0&&this.txManager.imageWorkerManager!==null)return this.txManager.imageWorkerManager.getImage(t,i,s,n,o,a);let l;return Qr(t)===!0?l=Vh(t):l=await Ea(t,"blob").then(h=>h),this.createImageBitmap(l,i,s,n,o,a)}return this.loadImageFallback(t,i??!0)}async getTextureSource(){var n,o;let t;try{t=await this.determineImageTypeAndLoadImage()}catch(a){return this.setState("failed",a),{data:null}}if(t.data===null)return this.setState("failed",Error("ImageTexture: No image data")),{data:null};let i,s;return t.data instanceof Uint8Array?(i=this.props.width??0,s=this.props.height??0):(i=((n=t.data)==null?void 0:n.width)??(this.props.width||0),s=((o=t.data)==null?void 0:o.height)??(this.props.height||0)),this.setState("fetched",{width:i,height:s}),{data:t.data,premultiplyAlpha:this.props.premultiplyAlpha??!0}}determineImageTypeAndLoadImage(){const{src:t,premultiplyAlpha:i,type:s}=this.props;if(t===null)return{data:null};if(typeof t!="string"){if(t instanceof Blob)if(this.txManager.hasCreateImageBitmap===!0){const{sx:o,sy:a,sw:l,sh:h}=this.props;return this.createImageBitmap(t,i,o,a,l,h)}else return this.loadImageFallback(t,i??!0);return t instanceof ImageData?{data:t,premultiplyAlpha:i}:{data:t(),premultiplyAlpha:i}}const n=Wh(t);return s==="regular"?this.loadImage(n):s==="svg"?zo(n,this.props.width,this.props.height,this.props.sx,this.props.sy,this.props.sw,this.props.sh):ru(t)===!0?zo(n,this.props.width,this.props.height,this.props.sx,this.props.sy,this.props.sw,this.props.sh):s==="compressed"||tu(t)===!0?Oo(n):this.loadImage(n)}static makeCacheKey(t){const i=zt.resolveDefaults(t),s=i.key||i.src;if(typeof s!="string")return!1;let n="";return i.sh!==null&&i.sw!==null&&(n+=",",n+=i.sx??"",n+=i.sy??"",n+=i.sw||"",n+=i.sh||""),`ImageTexture,${s},${i.premultiplyAlpha??"true"}${n}`}static resolveDefaults(t){return{src:t.src??"",premultiplyAlpha:t.premultiplyAlpha??!0,key:t.key??null,type:t.type??null,width:t.width??null,height:t.height??null,sx:t.sx??null,sy:t.sy??null,sw:t.sw??null,sh:t.sh??null}}},d(zt,"z$__type__Props"),zt);var Ut;let nu=(Ut=class extends ts{constructor(t,i){super(t);d(this,"props");d(this,"type",ie.noise);this.props=Ut.resolveDefaults(i)}async getTextureSource(){const{width:t,height:i}=this.props,s=t*i*4,n=new Uint8ClampedArray(s);for(let o=0;o<s;o+=4){const a=Math.floor(Math.random()*256);n[o]=a,n[o+1]=a,n[o+2]=a,n[o+3]=255}return this.setState("fetched"),{data:new ImageData(n,t,i)}}static makeCacheKey(t){if(t.cacheId===void 0)return!1;const i=Ut.resolveDefaults(t);return`NoiseTexture,${i.width},${i.height},${i.cacheId}`}static resolveDefaults(t){return{width:t.width??128,height:t.height??128,cacheId:t.cacheId??0}}},d(Ut,"z$__type__Props"),Ut);const Rr=class Rr extends ts{constructor(t,i){super(t);d(this,"props");d(this,"parentTexture");d(this,"type",ie.subTexture);d(this,"onParentTxLoaded",()=>{this.forwardParentTxState("loaded",{width:this.props.width,height:this.props.height})});d(this,"onParentTxFailed",(t,i)=>{this.forwardParentTxState("failed",i)});d(this,"onParentTxFetched",()=>{this.forwardParentTxState("fetched",{width:this.props.width,height:this.props.height})});d(this,"onParentTxFetching",()=>{this.forwardParentTxState("fetching")});d(this,"onParentTxLoading",()=>{this.forwardParentTxState("loading")});d(this,"onParentTxFreed",()=>{this.forwardParentTxState("freed")});this.props=Rr.resolveDefaults(i||{}),I(this.props.texture,"SubTexture requires a parent texture"),I(this.props.texture instanceof mn,"SubTexture requires an ImageTexture parent"),this.parentTexture=t.resolveParentTexture(this.props.texture),this.renderableOwners.size>0&&this.parentTexture.setRenderableOwner(this,!0),queueMicrotask(()=>{const s=this.parentTexture;s.state==="loaded"?this.onParentTxLoaded(s,s.dimensions):s.state==="fetching"?this.onParentTxFetching():s.state==="fetched"?this.onParentTxFetched():s.state==="loading"?this.onParentTxLoading():s.state==="failed"?this.onParentTxFailed(s,s.error):s.state==="freed"&&this.onParentTxFreed(),s.on("fetched",this.onParentTxFetched),s.on("loading",this.onParentTxLoading),s.on("fetching",this.onParentTxFetching),s.on("loaded",this.onParentTxLoaded),s.on("failed",this.onParentTxFailed),s.on("freed",this.onParentTxFreed)})}forwardParentTxState(t,i){this.setState(t,i)}onChangeIsRenderable(t){this.parentTexture.setRenderableOwner(this,t)}async getTextureSource(){return new Promise((t,i)=>{this.setState("fetched"),t({data:this.props})})}static makeCacheKey(t){return!1}static resolveDefaults(t){return{texture:t.texture,x:t.x||0,y:t.y||0,width:t.width||0,height:t.height||0}}};d(Rr,"z$__type__Props");let Zi=Rr;const Ar=class Ar extends ts{constructor(t,i){super(t);d(this,"props");d(this,"type",ie.renderToTexture);this.props=Ar.resolveDefaults(i||{})}get width(){return this.props.width}set width(t){this.props.width=t}get height(){return this.props.height}set height(t){this.props.height=t}async getTextureSource(){return this.setState("fetched"),{data:null,premultiplyAlpha:null}}static resolveDefaults(t){return{width:t.width||256,height:t.height||256}}};d(Ar,"z$__type__Props");let cr=Ar;async function ou(){var s,n,o;const r=new Uint8Array([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,1,0,0,0,1,1,3,0,0,0,37,219,86,202,0,0,0,3,80,76,84,69,0,0,0,167,122,61,218,0,0,0,1,116,82,78,83,0,64,230,216,102,0,0,0,10,73,68,65,84,8,215,99,96,0,0,0,2,0,1,226,33,188,51,0,0,0,0,73,69,78,68,174,66,96,130]),e={basic:!1,options:!1,full:!1},t=new Blob([r],{type:"image/png"}),i=await createImageBitmap(t);(s=i.close)==null||s.call(i),e.basic=!0;try{const a={premultiplyAlpha:"none"},l=await createImageBitmap(t,a);(n=l.close)==null||n.call(l),e.options=!0}catch{}try{const a=await createImageBitmap(t,0,0,1,1,{premultiplyAlpha:"none"});(o=a.close)==null||o.call(a),e.full=!0}catch{}return e}class au extends ht{constructor(t,i){super();d(this,"keyCache",new Map);d(this,"inverseKeyCache",new WeakMap);d(this,"txConstructors",{});d(this,"downloadTextureSourceQueue",[]);d(this,"priorityQueue",[]);d(this,"uploadTextureQueue",[]);d(this,"initialized",!1);d(this,"stage");d(this,"numImageWorkers");d(this,"imageWorkerManager",null);d(this,"hasCreateImageBitmap",!!self.createImageBitmap);d(this,"imageBitmapSupported",{basic:!1,options:!1,full:!1});d(this,"hasWorker",!!self.Worker);d(this,"renderer");d(this,"frameTime",0);const{numImageWorkers:s,createImageBitmapSupport:n}=i;this.stage=t,this.numImageWorkers=s,n==="auto"?ou().then(o=>{this.initialize(o)}).catch(o=>{console.warn("[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower."),this.initialized=!0,this.emit("initialized")}):this.initialize({basic:n==="basic",options:n==="options",full:n==="full"}),this.registerTextureType("ImageTexture",mn),this.registerTextureType("ColorTexture",ur),this.registerTextureType("NoiseTexture",nu),this.registerTextureType("SubTexture",Zi),this.registerTextureType("RenderTexture",cr)}registerTextureType(t,i){this.txConstructors[t]=i}initialize(t){this.hasCreateImageBitmap=t.basic||t.options||t.full,this.imageBitmapSupported=t,this.hasCreateImageBitmap||console.warn("[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower."),this.hasCreateImageBitmap&&this.hasWorker&&this.numImageWorkers>0?this.imageWorkerManager=new eu(this.numImageWorkers,t):console.warn("[Lightning] Imageworker is 0 or not supported on this browser. Image loading will be slower."),this.initialized=!0,this.emit("initialized")}enqueueDownloadTextureSource(t){this.downloadTextureSourceQueue.includes(t)||this.downloadTextureSourceQueue.push(t)}enqueueUploadTexture(t){this.uploadTextureQueue.includes(t)===!1&&this.uploadTextureQueue.push(t)}createTexture(t,i){let s;const n=this.txConstructors[t];if(!n)throw new Error(`Texture type "${t}" is not registered`);const o=n.makeCacheKey(i);return o&&this.keyCache.has(o)?s=this.keyCache.get(o):(s=new n(this,i),o&&this.initTextureToCache(s,o)),s}orphanTexture(t){this.removeTextureFromQueue(t),t.type!==ie.subTexture&&this.stage.txMemManager.addToOrphanedTextures(t)}loadTexture(t,i){if(this.stage.txMemManager.removeFromOrphanedTextures(t),t.type!==ie.subTexture){if(t.ctxTexture!==void 0&&t.ctxTexture.state==="loaded"){t.setState("loaded");return}if(!(this.downloadTextureSourceQueue.includes(t)===!0||this.uploadTextureQueue.includes(t)===!0)){if(t.ctxTexture!==void 0&&t.ctxTexture.state==="loading"){if(t.textureData!==null){this.enqueueUploadTexture(t);return}t.free()}if(this.initialized===!1){this.priorityQueue.push(t);return}if(t.state==="failed"&&(t.free(),t.freeTextureData()),(t.type===ie.color||t.type===ie.renderToTexture)&&t.state!=="initial"){t.setState("fetched"),this.enqueueUploadTexture(t);return}t.setState("loading"),i===!0&&t.getTextureData().then(()=>{this.uploadTexture(t)}).catch(s=>{console.error(s)}),this.enqueueDownloadTextureSource(t)}}}uploadTexture(t){if(this.stage.txMemManager.doNotExceedCriticalThreshold===!0&&this.stage.txMemManager.criticalCleanupRequested===!0){this.enqueueUploadTexture(t);return}const i=t.loadCtxTexture();if(i!==null&&i.state==="loaded"){t.setState("loaded");return}i.load()}isProcessingTexture(t){return this.downloadTextureSourceQueue.includes(t)===!0||this.uploadTextureQueue.includes(t)===!0}processSome(t){if(this.initialized===!1)return;const i=qt();for(;this.priorityQueue.length>0&&qt()-i<t;){const s=this.priorityQueue.pop();s.getTextureData().then(()=>{this.uploadTexture(s)})}for(;this.uploadTextureQueue.length>0&&qt()-i<t;)this.uploadTexture(this.uploadTextureQueue.pop());for(;this.downloadTextureSourceQueue.length>0&&qt()-i<t;){const s=this.downloadTextureSourceQueue.shift();s.getTextureData().then(()=>{s.state==="fetched"&&this.enqueueUploadTexture(s)})}}hasUpdates(){return this.downloadTextureSourceQueue.length>0||this.uploadTextureQueue.length>0}initTextureToCache(t,i){const{keyCache:s,inverseKeyCache:n}=this;s.set(i,t),n.set(t,i)}getTextureFromCache(t){return this.keyCache.get(t)}removeTextureFromCache(t){const{inverseKeyCache:i,keyCache:s}=this,n=i.get(t);n&&s.delete(n)}removeTextureFromQueue(t){const i=this.downloadTextureSourceQueue.indexOf(t);i!==-1&&this.downloadTextureSourceQueue.splice(i,1);const s=this.uploadTextureQueue.indexOf(t);s!==-1&&this.uploadTextureQueue.splice(s,1)}resolveParentTexture(t){if(!(t!=null&&t.props))return t;const i=mn.makeCacheKey(t.props);return(i?this.getTextureFromCache(i):void 0)??t}}const lu={normal:400,bold:700,bolder:900,lighter:100},Uo=r=>typeof r=="number"?r:lu[r]||400;function hu(r,e,t,i,s){let n=Uo(t);for(const o of r){const a=o[e];if(!a)continue;if(a.size===1)return console.warn(`TrFontManager: Only one font face found for family: '${e}' - will be used for all weights and styles`),a.values().next().value;const l=new Map;for(const u of a){const f=Uo(u.descriptors.weight);if(f===n&&u.descriptors.style===i&&u.descriptors.stretch===s)return u;l.set(f,u)}const h=`TrFontManager: No exact match: '${e} Weight: ${n} Style: ${i} Stretch: ${s}'`;if(console.error(h),n===400&&l.has(500))return l.get(500);if(n===500&&l.has(400))return l.get(400);if(n<400){for(;n>0;){if(l.has(n))return l.get(n);n-=100}n=600}for(;n<1e3;){if(l.has(n))return l.get(n);n+=100}for(n=500;n>0;){if(l.has(n))return l.get(n);n-=100}}}class uu{constructor(e){d(this,"textRenderers");d(this,"fontCache",new Map);this.textRenderers=e}addFontFace(e){for(const t in this.textRenderers){const i=this.textRenderers[t];i&&i.isFontFaceSupported(e)&&i.addFontFace(e)}}resolveFontFace(e,t,i){const{fontFamily:s,fontWeight:n,fontStyle:o,fontStretch:a}=t,l=`${i}_${s}_${o}_${n}_${a}`;if(this.fontCache.has(l)===!0)return this.fontCache.get(l);const h=hu(e,s,n,o,a);return h!==void 0&&this.fontCache.set(l,h),h}}class La{static makeCacheKey(e){return!1}static resolveDefaults(e){return{}}}function Bo(r,e,t){const i=r.createShader(e);if(!i){const n=r.getError();throw new Error(`Unable to create the shader: ${e===r.VERTEX_SHADER?"VERTEX_SHADER":"FRAGMENT_SHADER"}.${n?` WebGlContext Error: ${n}`:""}`)}if(r.shaderSource(i,t),r.compileShader(i),!!r.getShaderParameter(i,r.COMPILE_STATUS))return i;console.error(r.getShaderInfoLog(i)),r.deleteShader(i)}function cu(r,e,t){const i=r.createProgram();if(!i)throw new Error("Unable to create program");if(r.attachShader(i,e),r.attachShader(i,t),r.linkProgram(i),!!r.getProgramParameter(i,r.LINK_STATUS))return i;console.warn(r.getProgramInfoLog(i)),r.deleteProgram(i)}class ti extends La{constructor(t){super();d(this,"boundBufferCollection",null);d(this,"buffersBound",!1);d(this,"program");d(this,"vao");d(this,"renderer");d(this,"glw");d(this,"attributeBuffers");d(this,"attributeLocations");d(this,"attributeNames");d(this,"uniformLocations");d(this,"uniformTypes");d(this,"supportsIndexedTextures");const i=this.renderer=t.renderer,s=this.glw=this.renderer.glw;this.supportsIndexedTextures=t.supportsIndexedTextures||!1;const n=s.isWebGl2(),o=n&&t.webgl2Extensions||!n&&t.webgl1Extensions||[],a=n?"2.0":"1.0";o.forEach(g=>{if(!s.getExtension(g))throw new Error(`Shader "${this.constructor.name}" requires extension "${g}" for WebGL ${a} but wasn't found`)});const l=t.shaderSources||this.constructor.shaderSources;if(l)n&&(l!=null&&l.webGl2)&&(l.fragment=l.webGl2.fragment,l.vertex=l.webGl2.vertex,delete l.webGl2);else throw new Error(`Shader "${this.constructor.name}" is missing shaderSources.`);const h=i.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,u=l.vertex instanceof Function?l.vertex(h):l.vertex,f=l.fragment instanceof Function?l.fragment(h):l.fragment,c=Bo(s,s.VERTEX_SHADER,u),p=Bo(s,s.FRAGMENT_SHADER,f);if(!c||!p)throw new Error(`Unable to create the following shader(s): ${[!c&&"VERTEX_SHADER",!p&&"FRAGMENT_SHADER"].filter(Boolean).join(" and ")}`);const _=cu(s,c,p);if(!_)throw new Error("Unable to create program");this.program=_,this.attributeLocations={},this.attributeBuffers={},this.attributeNames=[],[...t.attributes].forEach(g=>{const x=s.getAttribLocation(this.program,g);if(x<0)throw new Error(`${this.constructor.name}: Vertex shader must have an attribute "${g}"!`);const m=s.createBuffer();if(!m)throw new Error(`${this.constructor.name}: Could not create buffer for attribute "${g}"`);this.attributeLocations[g]=x,this.attributeBuffers[g]=m,this.attributeNames.push(g)}),this.uniformLocations={},this.uniformTypes={},t.uniforms.forEach(g=>{const x=s.getUniformLocation(this.program,g.name);if(this.uniformTypes[g.name]=g.uniform,!x){console.warn(`Shader "${this.constructor.name}" could not get uniform location for "${g.name}"`);return}this.uniformLocations[g.name]=x})}bindBufferAttribute(t,i,s){const{glw:n}=this;n.enableVertexAttribArray(t),n.vertexAttribPointer(i,t,s.size,s.type,s.normalized,s.stride,s.offset)}disableAttribute(t){this.glw.disableVertexAttribArray(t)}disableAttributes(){for(const t in this.attributeLocations)this.disableAttribute(this.attributeLocations[t]);this.boundBufferCollection=null}canBatchShaderProps(t,i){return!1}bindRenderOp(t,i){this.bindBufferCollection(t.buffers),t.textures.length>0&&this.bindTextures(t.textures);const{glw:s,parentHasRenderTexture:n,renderToTexture:o}=t;if(!(o&&n)){if(n){const{width:a,height:l}=t.framebufferDimensions||{};s.uniform1f(this.getUniformLocation("u_pixelRatio"),1),s.uniform2f(this.getUniformLocation("u_resolution"),a??0,l??0)}else s.uniform1f(this.getUniformLocation("u_pixelRatio"),t.options.pixelRatio),s.uniform2f(this.getUniformLocation("u_resolution"),s.canvas.width,s.canvas.height);if(i){if(hr(i,"$dimensions")){let a=i.$dimensions;a||(a=t.dimensions),s.uniform2f(this.getUniformLocation("u_dimensions"),a.width,a.height)}if(hr(i,"$alpha")){let a=i.$alpha;a||(a=t.alpha),s.uniform1f(this.getUniformLocation("u_alpha"),a)}this.bindProps(i)}}}getUniformLocation(t){return this.uniformLocations[t]||null}bindBufferCollection(t){if(this.boundBufferCollection!==t){for(const i in this.attributeLocations){const s=t.getBuffer(i),n=t.getAttributeInfo(i);I(s,`Buffer for "${i}" not found`),I(n),this.bindBufferAttribute(this.attributeLocations[i],s,n)}this.boundBufferCollection=t}}bindProps(t){}bindTextures(t){}attach(){this.glw.useProgram(this.program),this.glw.isWebGl2()&&this.vao&&this.glw.bindVertexArray(this.vao)}detach(){this.disableAttributes()}}d(ti,"shaderSources");var un;let fu=(un=class extends ti{constructor(e){super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"}]})}bindTextures(e){const{glw:t}=this;t.activeTexture(0),t.bindTexture(e[0].ctxTexture)}},d(un,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;
      attribute vec4 a_color;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;


      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
        vec2 normalized = a_position * u_pixelRatio;
        vec2 screenSpace = vec2(2.0 / u_resolution.x, -2.0 / u_resolution.y);

        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;

        gl_Position = vec4(normalized.x * screenSpace.x - 1.0, normalized.y * -abs(screenSpace.y) + 1.0, 0.0, 1.0);
        gl_Position.y = -sign(screenSpace.y) * gl_Position.y;
      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform sampler2D u_texture;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
          vec4 color = texture2D(u_texture, v_textureCoordinate);
          gl_FragColor = vec4(v_color) * texture2D(u_texture, v_textureCoordinate);
      }
    `}),un);class Pa extends ti{constructor(t){super({renderer:t,attributes:["a_position","a_textureCoordinate","a_color","a_textureIndex"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_textures[0]",uniform:"uniform1iv"}]});d(this,"supportsIndexedTextures",!0)}bindTextures(t){const{renderer:i,glw:s}=this;if(t.length>i.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS)throw new Error(`DefaultShaderBatched: Cannot bind more than ${i.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS} textures`);t.forEach((o,a)=>{s.activeTexture(a),s.bindTexture(o.ctxTexture)});const n=Array.from(Array(t.length).keys());this.glw.uniform1iv(this.getUniformLocation("u_textures[0]"),n)}}d(Pa,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_textureCoordinate;
      attribute vec2 a_position;
      attribute vec4 a_color;
      attribute float a_textureIndex;
      attribute float a_depth;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;
      varying float v_textureIndex;

      void main(){
        vec2 normalized = a_position * u_pixelRatio / u_resolution;
        vec2 zero_two = normalized * 2.0;
        vec2 clip_space = zero_two - 1.0;

        // pass to fragment
        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;
        v_textureIndex = a_textureIndex;

        // flip y
        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
      }
    `,fragment:t=>`
      #define txUnits ${t}
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform sampler2D u_image;
      uniform sampler2D u_textures[txUnits];

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;
      varying float v_textureIndex;

      vec4 sampleFromTexture(sampler2D textures[${t}], int idx, vec2 uv) {
        ${Array.from(Array(t).keys()).map(i=>`
          ${i!==0?"else ":""}if (idx == ${i}) {
            return texture2D(textures[${i}], uv);
          }
        `).join("")}
        return texture2D(textures[0], uv);
      }

      void main(){
        gl_FragColor = vec4(v_color) * sampleFromTexture(u_textures, int(v_textureIndex), v_textureCoordinate);
      }
    `});class _e{constructor(e){d(this,"priority",1);d(this,"name","");d(this,"ref");d(this,"target");d(this,"passParameters","");d(this,"declaredUniforms","");d(this,"uniformInfo",{});const{ref:t,target:i,props:s={}}=e;this.ref=t,this.target=i;const n={},o=[];let a="";const l=this.constructor.uniforms||{};for(const h in l){const u=l[h],f=u.type,c=`${t}_${h}`;let p="";u.size&&(p=`[${u.size(s)}]`),o.push(c),a+=`uniform ${f} ${c}${p};`,n[h]={name:c,uniform:l[h].method}}this.passParameters=o.join(","),this.declaredUniforms=a,this.uniformInfo=n}static getEffectKey(e){return""}static getMethodParameters(e,t){const i=[];for(const s in e){const n=e[s];let o="";n.size&&(o=`[${n.size(t)}]`),i.push(`${n.type} ${s}${o}`)}return i.join(",")}static resolveDefaults(e){return{}}static makeEffectKey(e){return!1}}d(_e,"uniforms",{}),d(_e,"methods"),d(_e,"onShaderMask"),d(_e,"onColorize"),d(_e,"onEffectMask");const Jr=new Map,du=(r,e)=>{const t=JSON.stringify(r);if(Jr.has(t))return Jr.get(t);r=r??[];const i=[],s=r.length;let n=0;for(;n<s;n++){const{name:o,type:a,props:l}=r[n],h={name:o,type:a,props:{}},u=e[a],f=u.resolveDefaults(l),c=u.uniforms,p=Object.keys(c),_=p.length;let g=0;for(;g<_;g++){const x=p[g],m=c[x],T={value:f[x],programValue:void 0,method:m.method,updateOnBind:m.updateOnBind||!1,hasValidator:m.validator!==void 0,hasProgramValueUpdater:m.updateProgramValue!==void 0},b=T.hasValidator&&m.validator(f[x],f)||f[x];f[x]!==b&&(T.validatedValue=b),T.hasProgramValueUpdater&&m.updateProgramValue(T),T.programValue===void 0&&(T.programValue=T.value),h.props[x]=T}i.push(h)}return Jr.set(t,i),i},it=class it extends ti{constructor(t,i,s){const n=it.createShader(i,s);super({renderer:t,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2fv"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_alpha",uniform:"uniform1f"},...n.uniforms],shaderSources:{vertex:n.vertex,fragment:n.fragment}});d(this,"effects",[]);this.effects=n.effects}bindTextures(t){const{glw:i}=this;i.activeTexture(0),i.bindTexture(t[0].ctxTexture)}bindUniformMethods(t){const i=this.glw,s=t.effects,n=s.length;for(let o=0;o<n;o++){const a=this.effects[o].uniformInfo,l=s[o],h=Object.keys(l.props),u=h.length;for(let f=0;f<u;f++){const c=h[f],p=l.props[c].method,_=this.getUniformLocation(a[c].name);if(p==="uniform2fv"||p==="uniform2iv"||p==="uniform3iv"||p==="uniform4fv"||p==="uniform4iv"||p==="uniformMatrix2fv"||p==="uniformMatrix3fv"||p==="uniformMatrix4fv"||p==="uniform1f"||p==="uniform1fv"||p==="uniform1i"||p==="uniform1iv"){l.props[c].setUniformValue=function(){i[p](_,this.programValue)};continue}if(p==="uniform2f"||p==="uniform2i"){l.props[c].setUniformValue=function(){i[p](_,this.programValue[0],this.programValue[1])};continue}if(p==="uniform3f"||p==="uniform3i"){l.props[c].setUniformValue=function(){i[p](_,this.programValue[0],this.programValue[1],this.programValue[2])};continue}if(p==="uniform4f"||p==="uniform4i"){l.props[c].setUniformValue=function(){i[p](_,this.programValue[0],this.programValue[1],this.programValue[2],this.programValue[3])};continue}}}}bindProps(t){var o;const i=t.effects,s=i.length;let n=0;for(;n<s;n++){const a=i[n],l=Object.keys(a.props),h=l.length;let u=0;for(;u<h;u++){const f=l[u],c=a.props[f];if(c.updateOnBind===!0){const p=(o=this.renderer.shManager.getRegisteredEffects()[a.type])==null?void 0:o.uniforms[f];p==null||p.updateProgramValue(a.props[f],t)}c.setUniformValue()}}}canBatchShaderProps(t,i){if(t.$alpha!==i.$alpha||t.$dimensions.width!==i.$dimensions.width||t.$dimensions.height!==i.$dimensions.height||t.effects.length!==i.effects.length)return!1;const s=t.effects.length;let n=0;for(;n<s;n++){const o=t.effects[n],a=i.effects[n];if(o.type!==a.type)return!1;for(const l in o.props)if(a.props&&!a.props[l]||o.props[l].value!==a.props[l].value)return!1}return!0}static createShader(t,i){const s={},n={};let o="";const a=[],l=[],h=t.effects.map(_=>{const g=i[_.type],x=g.getEffectKey(_.props||{});s[x]=s[x]?++s[x]:1;const m=s[x];m===1&&l.push({key:x,type:_.type,props:_.props});const T=new g({ref:`${x}${m===1?"":m}`,target:x,props:_.props});return o+=T.declaredUniforms,a.push(...Object.values(T.uniformInfo)),T});let u="";l==null||l.forEach(_=>{const g=i[_.type],x=g.resolveDefaults(_.props??{}),m=[];for(const L in g.methods){let E=L;const U=g.methods[L];n[L]&&n[L]!==U&&(E=it.resolveMethodDuplicate(L,U,n)),n[E]=U.replace("function",E),m.push({m:L,cm:E})}let T=g.onShaderMask instanceof Function?g.onShaderMask(x):g.onShaderMask,b=g.onColorize instanceof Function?g.onColorize(x):g.onColorize,S=g.onEffectMask instanceof Function?g.onEffectMask(x):g.onEffectMask;m.forEach(L=>{const{m:E,cm:U}=L,z=new RegExp(`\\$${E}`,"g");T&&(T=T.replace(z,U)),b&&(b=b.replace(z,U)),S&&(S=S.replace(z,U))});const R=g.getMethodParameters(g.uniforms,x),A=R.length>0?`, ${R}`:"";T&&(u+=`
        float fx_${_.key}_onShaderMask(float shaderMask ${A}) {
          ${T}
        }
        `),b&&(u+=`
          vec4 fx_${_.key}_onColorize(float shaderMask, vec4 maskColor, vec4 shaderColor${A}) {
            ${b}
          }
        `),S&&(u+=`
          vec4 fx_${_.key}_onEffectMask(float shaderMask, vec4 maskColor, vec4 shaderColor${A}) {
            ${S}
          }
        `)});let f="";for(const _ in n)f+=n[_];let c="mix(shaderColor, maskColor, clamp(-(lng_DefaultMask), 0.0, 1.0))",p=`

    `;for(let _=0;_<h.length;_++){const g=h[_],x=g.passParameters.length>0?`, ${g.passParameters}`:"",m=i[g.name];m.onShaderMask&&(p+=`
        shaderMask = fx_${g.target}_onShaderMask(shaderMask ${x});
        `),m.onColorize&&(p+=`
        maskColor = fx_${g.target}_onColorize(shaderMask, maskColor, shaderColor${x});
        `),m.onEffectMask&&(c=`fx_${g.target}_onEffectMask(shaderMask, maskColor, shaderColor${x})`);const T=h[_+1];(T===void 0||i[T.name].onEffectMask)&&(p+=`
          shaderColor = ${c};
        `)}return{effects:h,uniforms:a,fragment:it.fragment(o,f,u,p),vertex:it.vertex()}}static resolveMethodDuplicate(t,i,s,n=0){const o=t+(n>0?n:"");return s[o]&&s[o]!==i?this.resolveMethodDuplicate(t,i,s,++n):o}static resolveDefaults(t,i){return I(i),{effects:du(t.effects??[],i),$dimensions:{width:0,height:0},$alpha:0}}static makeCacheKey(t,i){var n;let s="";return(n=t.effects)==null||n.forEach(o=>{const l=i[o.type].getEffectKey(o.props||{});s+=`,${l}`}),`DynamicShader${s}`}};d(it,"z$__type__Props"),d(it,"vertex",()=>`
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision mediump float;
    # endif

    attribute vec2 a_textureCoordinate;
    attribute vec2 a_position;
    attribute vec4 a_color;
    attribute float a_textureIndex;

    uniform vec2 u_resolution;
    uniform float u_pixelRatio;

    varying vec4 v_color;
    varying vec2 v_textureCoordinate;
    varying float v_textureIndex;

    void main(){
      vec2 normalized = a_position * u_pixelRatio / u_resolution;
      vec2 zero_two = normalized * 2.0;
      vec2 clip_space = zero_two - 1.0;

      // pass to fragment
      v_color = a_color;
      v_textureCoordinate = a_textureCoordinate;
      v_textureIndex = a_textureIndex;

      // flip y
      gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
    }
  `),d(it,"fragment",(t,i,s,n)=>`
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision mediump float;
    # endif

    #define PI 3.14159265359

    uniform vec2 u_resolution;
    uniform vec2 u_dimensions;
    uniform float u_alpha;
    uniform float u_radius;
    uniform sampler2D u_texture;
    uniform float u_pixelRatio;

    ${t}

    varying vec4 v_color;
    varying vec2 v_textureCoordinate;

    ${i}

    ${s}

    void main() {
      vec2 p = v_textureCoordinate.xy * u_dimensions - u_dimensions * 0.5;
      vec2 d = abs(p) - (u_dimensions) * 0.5;
      float lng_DefaultMask = min(max(d.x, d.y), 0.0) + length(max(d, 0.0));

      vec4 shaderColor = vec4(0.0);
      float shaderMask = lng_DefaultMask;

      vec4 maskColor = texture2D(u_texture, v_textureCoordinate) * v_color;

      shaderColor = mix(shaderColor, maskColor, clamp(-(lng_DefaultMask + 0.5), 0.0, 1.0));

      ${n}

      gl_FragColor = shaderColor * u_alpha;
    }
  `);let Ti=it;class xn extends ti{constructor(e){super({renderer:e,attributes:["a_position","a_textureCoordinate","a_color"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_dimensions",uniform:"uniform2fv"},{name:"u_radius",uniform:"uniform1f"}]})}static resolveDefaults(e){return{radius:e.radius||10,$dimensions:{width:0,height:0}}}bindTextures(e){const{glw:t}=this;t.activeTexture(0),t.bindTexture(e[0].ctxTexture)}bindProps(e){const t=Math.min(e.$dimensions.width,e.$dimensions.height)/(2*e.radius);this.glw.uniform1f(this.getUniformLocation("u_radius"),e.radius*Math.min(t,1))}canBatchShaderProps(e,t){return e.radius===t.radius&&e.$dimensions.width===t.$dimensions.width&&e.$dimensions.height===t.$dimensions.height}}d(xn,"z$__type__Props"),d(xn,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;
      attribute vec4 a_color;
      attribute float a_textureIndex;
      attribute float a_depth;

      uniform vec2 u_resolution;
      uniform float u_pixelRatio;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      void main() {
        vec2 normalized = a_position * u_pixelRatio / u_resolution;
        vec2 zero_two = normalized * 2.0;
        vec2 clip_space = zero_two - 1.0;

        // pass to fragment
        v_color = a_color;
        v_textureCoordinate = a_textureCoordinate;

        // flip y
        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);
      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif

      uniform vec2 u_resolution;
      uniform vec2 u_dimensions;
      uniform float u_radius;
      uniform sampler2D u_texture;

      varying vec4 v_color;
      varying vec2 v_textureCoordinate;

      float boxDist(vec2 p, vec2 size, float radius){
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }

      float fillMask(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }

      void main() {
        vec4 color = texture2D(u_texture, v_textureCoordinate) * v_color;
        vec2 halfDimensions = u_dimensions * 0.5;

        float d = boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions + 0.5, u_radius);
        gl_FragColor = mix(vec4(0.0), color, fillMask(d));
      }
    `});const pu=new Float32Array([1,0,0,0,1,0,0,0,1]),qi=class qi extends ti{constructor(e){super({renderer:e,attributes:["a_position","a_textureCoordinate"],uniforms:[{name:"u_resolution",uniform:"uniform2fv"},{name:"u_transform",uniform:"uniformMatrix3fv"},{name:"u_scrollY",uniform:"uniform1f"},{name:"u_pixelRatio",uniform:"uniform1f"},{name:"u_texture",uniform:"uniform2f"},{name:"u_color",uniform:"uniform4fv"},{name:"u_size",uniform:"uniform1f"},{name:"u_distanceRange",uniform:"uniform1f"},{name:"u_debug",uniform:"uniform1i"}]})}bindTextures(e){const{glw:t}=this;t.activeTexture(0),t.bindTexture(e[0].ctxTexture)}bindProps(e){const t=qi.resolveDefaults(e);for(const i in t)if(i==="transform")this.glw.uniformMatrix3fv(this.getUniformLocation("u_transform"),t[i]);else if(i==="scrollY")this.glw.uniform1f(this.getUniformLocation("u_scrollY"),t[i]);else if(i==="color"){const s=is(t.color);this.glw.uniform4fv(this.getUniformLocation("u_color"),s)}else i==="size"?this.glw.uniform1f(this.getUniformLocation("u_size"),t[i]):i==="distanceRange"?this.glw.uniform1f(this.getUniformLocation("u_distanceRange"),t[i]):i==="debug"&&this.glw.uniform1i(this.getUniformLocation("u_debug"),t[i]?1:0)}static resolveDefaults(e={}){return{transform:e.transform??pu,scrollY:e.scrollY??0,color:e.color??4294967295,size:e.size??16,distanceRange:e.distanceRange??1,debug:e.debug??!1}}};d(qi,"z$__type__Props"),d(qi,"shaderSources",{vertex:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif
      // an attribute is an input (in) to a vertex shader.
      // It will receive data from a buffer
      attribute vec2 a_position;
      attribute vec2 a_textureCoordinate;

      uniform vec2 u_resolution;
      uniform mat3 u_transform;
      uniform float u_scrollY;
      uniform float u_pixelRatio;
      uniform float u_size;

      varying vec2 v_texcoord;

      void main() {
        vec2 scrolledPosition = a_position * u_size - vec2(0, u_scrollY);
        vec2 transformedPosition = (u_transform * vec3(scrolledPosition, 1)).xy;

        // Calculate screen space with pixel ratio
        vec2 screenSpace = (transformedPosition * u_pixelRatio / u_resolution * 2.0 - 1.0) * vec2(1, -1);

        gl_Position = vec4(screenSpace, 0.0, 1.0);
        v_texcoord = a_textureCoordinate;

      }
    `,fragment:`
      # ifdef GL_FRAGMENT_PRECISION_HIGH
      precision highp float;
      # else
      precision mediump float;
      # endif
      uniform vec4 u_color;
      uniform sampler2D u_texture;
      uniform float u_distanceRange;
      uniform float u_pixelRatio;
      uniform int u_debug;

      varying vec2 v_texcoord;

      float median(float r, float g, float b) {
          return max(min(r, g), min(max(r, g), b));
      }

      void main() {
          vec3 sample = texture2D(u_texture, v_texcoord).rgb;
          if (u_debug == 1) {
            gl_FragColor = vec4(sample.r, sample.g, sample.b, 1.0);
            return;
          }
          float scaledDistRange = u_distanceRange * u_pixelRatio;
          float sigDist = scaledDistRange * (median(sample.r, sample.g, sample.b) - 0.5);
          float opacity = clamp(sigDist + 0.5, 0.0, 1.0) * u_color.a;

          // Build the final color.
          // IMPORTANT: We must premultiply the color by the alpha value before returning it.
          gl_FragColor = vec4(u_color.r * opacity, u_color.g * opacity, u_color.b * opacity, opacity);
      }
    `});let yn=qi;const Fi=r=>{r.programValue===void 0&&(r.programValue=new Float32Array(4));const e=r.value,t=r.programValue;t[0]=(e>>>24)/255,t[1]=(e>>>16&255)/255,t[2]=(e>>>8&255)/255,t[3]=(e&255)/255},gu=r=>{const e=r.validatedValue||r.value;if(r.programValue instanceof Float32Array){const t=r.programValue;t[0]=e[0],t[1]=e[1]}else r.programValue=new Float32Array(e)},_u=r=>{const e=r.validatedValue||r.value;if(r.programValue instanceof Float32Array){const t=r.programValue;t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]}else r.programValue=new Float32Array(e)},Ia=r=>{const e=r.validatedValue||r.value;if(r.programValue instanceof Float32Array){const t=e.length,i=r.programValue;for(let s=0;s<t;s++)i[s]=e[s]}else r.programValue=new Float32Array(e)},Xn=r=>{const e=Array.isArray(r);if(e){if(e&&r.length===4)return r;if(e&&r.length===2)return[r[0],r[1],r[0],r[1]];if(e&&r.length===3)return[r[0],r[1],r[2],r[0]]}else return[r,r,r,r];return[r[0],r[0],r[0],r[0]]},Ma=(r,e)=>{r.programValue===void 0&&(r.programValue=new Float32Array(4));const t=r.programValue,i=r.validatedValue||r.value;if(e===void 0&&r.$dimensions===void 0){t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3];return}let s=r.$dimensions;if(e!==void 0){const{$dimensions:c}=e;if(s!==void 0&&(s.width===c.width||s.height===c.height))return;s===void 0&&(s={width:c==null?void 0:c.width,height:c==null?void 0:c.height},r.$dimensions=s)}const{width:n,height:o}=s,[a,l,h,u]=i,f=Math.min(Math.min(Math.min(n/Math.max(n,a+l),n/Math.max(n,h+u)),Math.min(o/Math.max(o,a+h),o/Math.max(o,l+u))),1);t[0]=a*f,t[1]=l*f,t[2]=h*f,t[3]=u*f};class li extends _e{constructor(){super(...arguments);d(this,"name","radius")}static getEffectKey(){return"radius"}static resolveDefaults(t){return{radius:t.radius??10}}}d(li,"z$__type__Props"),d(li,"uniforms",{radius:{value:0,method:"uniform4fv",type:"vec4",updateOnBind:!0,validator:Xn,updateProgramValue:Ma}}),d(li,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,boxDist:`
      float function(vec2 p, vec2 size, float radius) {
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }
    `}),d(li,"onShaderMask",`
  vec2 halfDimensions = u_dimensions * 0.5;
  float r = radius[0] * step(v_textureCoordinate.x, 0.5) * step(v_textureCoordinate.y, 0.5);
  r = r + radius[1] * step(0.5, v_textureCoordinate.x) * step(v_textureCoordinate.y, 0.5);
  r = r + radius[2] * step(0.5, v_textureCoordinate.x) * step(0.5, v_textureCoordinate.y);
  r = r + radius[3] * step(v_textureCoordinate.x, 0.5) * step(0.5, v_textureCoordinate.y);
  return $boxDist(v_textureCoordinate.xy * u_dimensions - halfDimensions, halfDimensions, r);
  `),d(li,"onEffectMask",`
  return mix(vec4(0.0), maskColor, $fillMask(shaderMask));
  `);class Bi extends _e{constructor(){super(...arguments);d(this,"name","border")}static getEffectKey(){return"border"}static resolveDefaults(t){return{width:t.width??10,color:t.color??4294967295}}}d(Bi,"z$__type__Props"),d(Bi,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Fi,method:"uniform4fv",type:"vec4"}}),d(Bi,"onEffectMask",`
  float intR = shaderMask + 1.0;
  float mask = clamp(intR + width, 0.0, 1.0) - clamp(intR, 0.0, 1.0);
  return mix(shaderColor, mix(shaderColor, maskColor, maskColor.a), mask);
  `),d(Bi,"onColorize",`
    return color;
  `);const Pt=class Pt extends _e{constructor(){super(...arguments);d(this,"name","linearGradient")}static getEffectKey(t){return t.colors.value?`linearGradient${t.colors.value.length}`:`linearGradient${t.colors.length}`}static resolveDefaults(t){const i=t.colors??[4278190080,4294967295];let s=t.stops||[];if(s.length===0||s.length!==i.length){const n=i.length;let o=0;const a=s;for(;o<n;o++)s[o]?(a[o]=s[o],s[o-1]===void 0&&a[o-2]!==void 0&&(a[o-1]=a[o-2]+(s[o]-a[o-2])/2)):a[o]=o*(1/(i.length-1));s=a}return{colors:i,stops:s,angle:t.angle??0}}};d(Pt,"z$__type__Props"),d(Pt,"uniforms",{angle:{value:0,method:"uniform1f",type:"float"},colors:{value:4294967295,validator:t=>t.reduce((i,s)=>i.concat(is(s)),[]),updateProgramValue:Ia,size:t=>t.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],size:t=>t.colors.length,method:"uniform1fv",type:"float"}}),d(Pt,"methods",{fromLinear:`
      vec4 function(vec4 linearRGB) {
        vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);
        vec4 lower = linearRGB * vec4(12.92);
        return mix(higher, lower, 1.0);
      }
    `,toLinear:`
      vec4 function(vec4 sRGB) {
        vec4 higher = pow((sRGB + vec4(0.055))/vec4(1.055), vec4(2.4));
        vec4 lower = sRGB/vec4(12.92);
        return mix(higher, lower, 1.0);
      }
    `,calcPoint:`
      vec2 function(float d, float angle) {
        return d * vec2(cos(angle), sin(angle)) + (u_dimensions * 0.5);
      }
    `}),d(Pt,"ColorLoop",t=>{let i="";for(let s=2;s<t;s++)i+=`colorOut = mix(colorOut, colors[${s}], clamp((dist - stops[${s-1}]) / (stops[${s}] - stops[${s-1}]), 0.0, 1.0));`;return i}),d(Pt,"onColorize",t=>{const i=t.colors.length||1;return`
      float a = angle - (PI / 180.0 * 90.0);
      float lineDist = abs(u_dimensions.x * cos(a)) + abs(u_dimensions.y * sin(a));
      vec2 f = $calcPoint(lineDist * 0.5, a);
      vec2 t = $calcPoint(lineDist * 0.5, a + PI);
      vec2 gradVec = t - f;
      float dist = dot(v_textureCoordinate.xy * u_dimensions - f, gradVec) / dot(gradVec, gradVec);

      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);
      vec4 colorOut = $fromLinear(mix($toLinear(colors[0]), $toLinear(colors[1]), stopCalc));
      ${Pt.ColorLoop(i)}
      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));
    `});let Tn=Pt;class Sn extends _e{constructor(){super(...arguments);d(this,"name","grayscale")}static getEffectKey(){return"grayscale"}static resolveDefaults(t){return{amount:t.amount??1}}}d(Sn,"uniforms",{amount:{value:1,method:"uniform1f",type:"float"}}),d(Sn,"onColorize",`
    float grayness = 0.2 * maskColor.r + 0.6 * maskColor.g + 0.2 * maskColor.b;
    return vec4(amount * vec3(grayness) + (1.0 - amount) * maskColor.rgb, maskColor.a);
  `);class hi extends _e{constructor(){super(...arguments);d(this,"name","borderRight")}static getEffectKey(){return"borderRight"}static resolveDefaults(t){return{width:t.width??10,color:t.color??4294967295}}}d(hi,"z$__type__Props"),d(hi,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Fi,method:"uniform4fv",type:"vec4"}}),d(hi,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),d(hi,"onEffectMask",`
  vec2 pos = vec2(u_dimensions.x - width * 0.5, 0.0);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),d(hi,"onColorize",`
    return color;
  `);class ui extends _e{constructor(){super(...arguments);d(this,"name","borderTop")}static getEffectKey(){return"borderTop"}static resolveDefaults(t){return{width:t.width??10,color:t.color??4294967295}}}d(ui,"z$__type__Props"),d(ui,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Fi,method:"uniform4fv",type:"vec4"}}),d(ui,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),d(ui,"onEffectMask",`
  vec2 pos = vec2(0.0, width * 0.5);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),d(ui,"onColorize",`
    return color;
  `);class ci extends _e{constructor(){super(...arguments);d(this,"name","borderBottom")}static getEffectKey(){return"borderBottom"}static resolveDefaults(t){return{width:t.width??10,color:t.color??4294967295}}}d(ci,"z$__type__Props"),d(ci,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Fi,method:"uniform4fv",type:"vec4"}}),d(ci,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),d(ci,"onEffectMask",`
  vec2 pos = vec2(0.0, u_dimensions.y - width * 0.5);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),d(ci,"onColorize",`
    return color;
  `);class fi extends _e{constructor(){super(...arguments);d(this,"name","borderLeft")}static getEffectKey(){return"borderLeft"}static resolveDefaults(t){return{width:t.width??10,color:t.color??4294967295}}}d(fi,"z$__type__Props"),d(fi,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Fi,method:"uniform4fv",type:"vec4"}}),d(fi,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,rectDist:`
      float function(vec2 p, vec2 size) {
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
      }
    `}),d(fi,"onEffectMask",`
  vec2 pos = vec2(width * 0.5, 0.0);
  float mask = $rectDist(v_textureCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));
  return mix(shaderColor, maskColor, $fillMask(mask));
  `),d(fi,"onColorize",`
    return color;
  `);class ki extends _e{constructor(){super(...arguments);d(this,"name","glitch")}static getEffectKey(t){return"glitch"}static resolveDefaults(t){return{amplitude:t.amplitude??.2,narrowness:t.narrowness??4,blockiness:t.blockiness??2,minimizer:t.minimizer??8,time:t.time??Date.now()}}}d(ki,"z$__type__Props"),d(ki,"uniforms",{amplitude:{value:0,method:"uniform1f",type:"float"},narrowness:{value:0,method:"uniform1f",type:"float"},blockiness:{value:0,method:"uniform1f",type:"float"},minimizer:{value:0,method:"uniform1f",type:"float"},time:{value:0,method:"uniform1f",updateOnBind:!0,updateProgramValue:t=>{const i=t.value=(Date.now()-t.value)%1e3;t.programValue=i},type:"float"}}),d(ki,"methods",{rand:`
      float function(vec2 p, float time) {
        float t = floor(time * 20.) / 10.;
        return fract(sin(dot(p, vec2(t * 12.9898, t * 78.233))) * 43758.5453);
      }
    `,noise:`
      float function(vec2 uv, float blockiness, float time) {
        vec2 lv = fract(uv);
        vec2 id = floor(uv);

        float n1 = rand(id, time);
        float n2 = rand(id+vec2(1,0), time);
        float n3 = rand(id+vec2(0,1), time);
        float n4 = rand(id+vec2(1,1), time);
        vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);
        return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);
      }
    `,fbm:`
      float function(vec2 uv, int count, float blockiness, float complexity, float time) {
        float val = 0.0;
        float amp = 0.5;
        const int MAX_ITERATIONS = 10;

        for(int i = 0; i < MAX_ITERATIONS; i++) {
          if(i >= count) {break;}
          val += amp * noise(uv, blockiness, time);
          amp *= 0.5;
          uv *= complexity;
        }
        return val;
      }
    `}),d(ki,"onColorize",`
    vec2 uv = v_textureCoordinate.xy;
    float aspect = u_dimensions.x / u_dimensions.y;
    vec2 a = vec2(uv.x * aspect , uv.y);
    vec2 uv2 = vec2(a.x / u_dimensions.x, exp(a.y));

    float shift = amplitude * pow($fbm(uv2, 4, blockiness, narrowness, time), minimizer);
    float colR = texture2D(u_texture, vec2(uv.x + shift, uv.y)).r * (1. - shift);
    float colG = texture2D(u_texture, vec2(uv.x - shift, uv.y)).g * (1. - shift);
    float colB = texture2D(u_texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);

    vec3 f = vec3(colR, colG, colB);
    return vec4(f, texture2D(u_texture, vec2(uv.x - shift, uv.y)).a);
  `);class Ks extends _e{constructor(){super(...arguments);d(this,"name","fadeOut")}static getEffectKey(){return"fadeOut"}static resolveDefaults(t){return{fade:t.fade??10}}}d(Ks,"z$__type__Props"),d(Ks,"uniforms",{fade:{value:0,method:"uniform4fv",type:"vec4",validator:Xn,updateProgramValue:_u}}),d(Ks,"onColorize",`
  vec2 point = v_textureCoordinate.xy * u_dimensions.xy;
  vec2 pos1;
  vec2 pos2;
  vec2 d;
  float c;
  vec4 result = maskColor;


  if(fade[0] > 0.0) {
    pos1 = vec2(point.x, point.y);
    pos2 = vec2(point.x, point.y + fade[0]);
    d = pos2 - pos1;
    c = dot(pos1, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[1] > 0.0) {
    pos1 = vec2(point.x - u_dimensions.x - fade[1], v_textureCoordinate.y);
    pos2 = vec2(point.x - u_dimensions.x, v_textureCoordinate.y);
    d = pos1 - pos2;
    c = dot(pos2, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[2] > 0.0) {
    pos1 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y - fade[2]);
    pos2 = vec2(v_textureCoordinate.x, point.y - u_dimensions.y);
    d = pos1 - pos2;
    c = dot(pos2, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  if(fade[3] > 0.0) {
    pos1 = vec2(point.x, point.y);
    pos2 = vec2(point.x + fade[3], point.y);
    d = pos2 - pos1;
    c = dot(pos1, d) / dot(d, d);
    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));
  }

  return result;
  `);const Kt=class Kt extends _e{constructor(){super(...arguments);d(this,"name","radialGradient")}static getEffectKey(t){return t.colors.value?`radialGradient${t.colors.value.length}`:`radialGradient${t.colors.length}`}static resolveDefaults(t){const i=t.colors??[4278190080,4294967295];let s=t.stops||[];if(s.length===0||s.length!==i.length){const n=i.length;let o=0;const a=s;for(;o<n;o++)s[o]?(a[o]=s[o],s[o-1]===void 0&&a[o-2]!==void 0&&(a[o-1]=a[o-2]+(s[o]-a[o-2])/2)):a[o]=o*(1/(i.length-1));s=a}return{colors:i,stops:s,width:t.width??0,height:t.height??t.width??0,pivot:t.pivot??[.5,.5]}}};d(Kt,"z$__type__Props"),d(Kt,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},pivot:{value:[.5,.5],updateProgramValue:gu,method:"uniform2fv",type:"vec2"},colors:{value:4294967295,validator:t=>t.reduce((i,s)=>i.concat(is(s)),[]),updateProgramValue:Ia,size:t=>t.colors.length,method:"uniform4fv",type:"vec4"},stops:{value:[],size:t=>t.colors.length,method:"uniform1fv",type:"float"}}),d(Kt,"ColorLoop",t=>{let i="";for(let s=2;s<t;s++)i+=`colorOut = mix(colorOut, colors[${s}], clamp((dist - stops[${s-1}]) / (stops[${s}] - stops[${s-1}]), 0.0, 1.0));`;return i}),d(Kt,"onColorize",t=>{const i=t.colors.length||1;return`
      vec2 point = v_textureCoordinate.xy * u_dimensions;
      vec2 projection = vec2(pivot.x * u_dimensions.x, pivot.y * u_dimensions.y);

      float dist = length((point - projection) / vec2(width, height));

      float stopCalc = (dist - stops[0]) / (stops[1] - stops[0]);
      vec4 colorOut = mix(colors[0], colors[1], stopCalc);
      ${Kt.ColorLoop(i)}
      return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));
    `});let bn=Kt;class di extends _e{constructor(){super(...arguments);d(this,"name","radialProgress")}static getEffectKey(){return"radialProgress"}static resolveDefaults(t){return{width:t.width??10,progress:t.progress??.5,offset:t.offset??0,range:t.range??Math.PI*2,rounded:t.rounded??!1,radius:t.radius??1,color:t.color??4294967295}}}d(di,"z$__type__Props"),d(di,"uniforms",{width:{value:0,method:"uniform1f",type:"float"},progress:{value:.5,method:"uniform1f",type:"float"},offset:{value:0,method:"uniform1f",type:"float"},range:{value:0,method:"uniform1f",type:"float"},rounded:{value:0,method:"uniform1f",type:"float",validator:t=>t?1:0},radius:{value:1,method:"uniform1f",type:"float"},color:{value:4294967295,updateProgramValue:Fi,method:"uniform4fv",type:"vec4"}}),d(di,"methods",{rotateUV:`
    vec2 function(vec2 uv, float d) {
      float s = sin(d);
      float c = cos(d);
      mat2 rotMatrix = mat2(c, -s, s, c);
      return uv * rotMatrix;
    }
    `,drawDot:`
    float function(vec2 uv, vec2 p, float r) {
      uv += p;
      float circle = length(uv) - r;
      return clamp(-circle, 0.0, 1.0);
    }
    `}),d(di,"onEffectMask",`
    float outerRadius = radius * u_dimensions.y * 0.5;

    float endAngle = range * progress - 0.0005;

    vec2 uv = v_textureCoordinate.xy * u_dimensions.xy - u_dimensions * 0.5;

    uv = $rotateUV(uv, -(offset));
    float linewidth = width * u_pixelRatio;
    float circle = length(uv) - (outerRadius - linewidth) ;
    circle = abs(circle) - linewidth;
    circle = clamp(-circle, 0.0, 1.0);

    float angle = (atan(uv.x, -uv.y) / 3.14159265359 * 0.5);
    float p = endAngle / (PI * 2.);

    circle *= step(fract(angle), fract(p));

    circle = rounded < 1. ? circle : max(circle, $drawDot(uv, vec2(0, outerRadius - linewidth), linewidth));
    circle = rounded < 1. ? circle : max(circle, $drawDot($rotateUV(uv, -(endAngle)), vec2(0, outerRadius - linewidth), linewidth));

    return mix(shaderColor, maskColor, circle);
  `),d(di,"onColorize",`
    return color;
  `);class pi extends _e{constructor(){super(...arguments);d(this,"name","holePunch")}static getEffectKey(){return"holePunch"}static resolveDefaults(t){return{x:t.x||0,y:t.y||0,width:t.width||50,height:t.height||50,radius:t.radius??0}}}d(pi,"z$__type__Props"),d(pi,"uniforms",{x:{value:0,method:"uniform1f",type:"float"},y:{value:0,method:"uniform1f",type:"float"},width:{value:0,method:"uniform1f",type:"float"},height:{value:0,method:"uniform1f",type:"float"},radius:{value:0,method:"uniform4fv",type:"vec4",updateOnBind:!0,validator:Xn,updateProgramValue:Ma}}),d(pi,"methods",{fillMask:`
      float function(float dist) {
        return clamp(-dist, 0.0, 1.0);
      }
    `,boxDist:`
      float function(vec2 p, vec2 size, float radius) {
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
      }
    `}),d(pi,"onShaderMask",`
  vec2 halfDimensions = u_dimensions * 0.5;
  vec2 size = vec2(width, height) * 0.5;
  vec2 basePos = v_textureCoordinate.xy * u_dimensions.xy - vec2(x, y);
  vec2 pos = basePos - size;
  float r = radius[0] * step(pos.x, 0.5) * step(pos.y, 0.5);
  r = r + radius[1] * step(0.5, pos.x) * step(pos.y, 0.5);
  r = r + radius[2] * step(0.5, pos.x) * step(0.5, pos.y);
  r = r + radius[3] * step(pos.x, 0.5) * step(0.5, pos.y);
  return $boxDist(pos, size, r);
  `),d(pi,"onEffectMask",`
  return mix(maskColor, vec4(0.0), $fillMask(shaderMask));
  `);const mu="RoundedRectangle";class Pr extends La{constructor(t){super();d(this,"shType");this.shType=t}bindRenderOp(){}bindProps(){}attach(){}detach(){}}class xu{constructor(e,t,i,s){d(this,"type");d(this,"shader");d(this,"resolvedProps");d(this,"props");this.type=e,this.shader=t,this.resolvedProps=i;const n=Object.keys(i),o=n.length,a={};for(let l=0;l<o;l++){const h=n[l];Object.defineProperty(a,h,{get:()=>this.resolvedProps[h],set:u=>{this.resolvedProps[h]=u,s.requestRender()}})}this.props=a}getResolvedProps(){return this.resolvedProps}}class yu{constructor(e,t,i){d(this,"shader");d(this,"resolvedProps");d(this,"props");d(this,"type");this.shader=e,this.type="DynamicShader",this.resolvedProps=t;const s=i.getRegisteredEffects(),n={},o=t.effects,a=o.length;for(let l=0;l<a;l++){const{name:h,props:u,type:f}=o[l];if(h===void 0)continue;const c={},p=Object.keys(u),_=p.length;for(let g=0;g<_;g++){const x=p[g];Object.defineProperty(c,x,{get:()=>this.resolvedProps.effects[l].props[x].value,set:m=>{var b,S;const T=this.resolvedProps.effects[l].props[x];T.value=m,T.hasValidator&&(m=T.validatedValue=(b=s[f].uniforms[x])==null?void 0:b.validator(m,u)),T.hasProgramValueUpdater?(S=s[f].uniforms[x])==null||S.updateProgramValue(T):T.programValue=m,i.renderer.stage.requestRender()}})}Object.defineProperty(n,h,{get:()=>c})}this.props=n}getResolvedProps(){return this.resolvedProps}}class Tu{constructor(){d(this,"shCache",new Map);d(this,"shConstructors",{});d(this,"attachedShader",null);d(this,"effectConstructors",{});d(this,"renderer");this.registerShaderType("DefaultShader",fu),this.registerShaderType("DefaultShaderBatched",Pa),this.registerShaderType("RoundedRectangle",xn),this.registerShaderType("DynamicShader",Ti),this.registerShaderType("SdfShader",yn),this.registerEffectType("border",Bi),this.registerEffectType("borderBottom",ci),this.registerEffectType("borderLeft",fi),this.registerEffectType("borderRight",hi),this.registerEffectType("borderTop",ui),this.registerEffectType("fadeOut",Ks),this.registerEffectType("linearGradient",Tn),this.registerEffectType("radialGradient",bn),this.registerEffectType("grayscale",Sn),this.registerEffectType("glitch",ki),this.registerEffectType("radius",li),this.registerEffectType("radialProgress",di),this.registerEffectType("holePunch",pi)}registerShaderType(e,t){this.shConstructors[e]=t}registerEffectType(e,t){this.effectConstructors[e]=t}getRegisteredEffects(){return this.effectConstructors}getRegisteredShaders(){return this.shConstructors}loadShader(e,t){if(!this.renderer)throw new Error("Renderer is not been defined");const i=this.shConstructors[e];if(!i)throw new Error(`Shader type "${e}" is not registered`);if(this.renderer.mode==="canvas"&&i.prototype instanceof ti)return this._createShaderCtr(e,new Pr(e),t);if(e==="DynamicShader")return this.loadDynamicShader(t);const s=i.resolveDefaults(t),n=i.makeCacheKey(s)||i.name;if(n&&this.shCache.has(n))return this._createShaderCtr(e,this.shCache.get(n),s);const o=new i(this.renderer,t);return n&&this.shCache.set(n,o),this._createShaderCtr(e,o,s)}loadDynamicShader(e){if(!this.renderer)throw new Error("Renderer is not been defined");const t=Ti.resolveDefaults(e,this.effectConstructors),i=Ti.makeCacheKey(t,this.effectConstructors);if(i&&this.shCache.has(i))return this._createDynShaderCtr(this.shCache.get(i),t);const s=new Ti(this.renderer,e,this.effectConstructors);return i&&this.shCache.set(i,s),this._createDynShaderCtr(s,t)}_createShaderCtr(e,t,i){return new xu(e,t,i,this.renderer.stage)}_createDynShaderCtr(e,t){return e.bindUniformMethods(t),new yu(e,t,this)}useShader(e){this.attachedShader!==e&&(this.attachedShader&&this.attachedShader.detach(),e.attach(),this.attachedShader=e)}}const Su={x:(r,e)=>{r.props.x=e},y:(r,e)=>{r.props.y=e},width:(r,e)=>{r.props.width=e},height:(r,e)=>{r.props.height=e},color:(r,e)=>{r.props.color=e},zIndex:(r,e)=>{r.props.zIndex=e},fontFamily:(r,e)=>{r.props.fontFamily=e},fontWeight:(r,e)=>{r.props.fontWeight=e},fontStyle:(r,e)=>{r.props.fontStyle=e},fontStretch:(r,e)=>{r.props.fontStretch=e},fontSize:(r,e)=>{r.props.fontSize=e},text:(r,e)=>{r.props.text=e},textAlign:(r,e)=>{r.props.textAlign=e},contain:(r,e)=>{r.props.contain=e},offsetY:(r,e)=>{r.props.offsetY=e},scrollable:(r,e)=>{r.props.scrollable=e},scrollY:(r,e)=>{r.props.scrollY=e},letterSpacing:(r,e)=>{r.props.letterSpacing=e},lineHeight:(r,e)=>{r.props.lineHeight=e},maxLines:(r,e)=>{r.props.maxLines=e},textBaseline:(r,e)=>{r.props.textBaseline=e},verticalAlign:(r,e)=>{r.props.verticalAlign=e},overflowSuffix:(r,e)=>{r.props.overflowSuffix=e},debug:(r,e)=>{r.props.debug=e}};class Gn{constructor(e){d(this,"stage");d(this,"set");this.stage=e;const t={...Su,...this.getPropertySetters()},i={};Object.keys(t).forEach(s=>{Object.defineProperty(i,s,{value:(n,o)=>{n.props[s]!==o&&(t[s](n,o),this.stage.requestRender())},writable:!1,configurable:!1})}),this.set=i}setStatus(e,t,i){e.status!==t&&(e.status=t,e.emitter.emit(t,i))}setIsRenderable(e,t){e.isRenderable=t}destroyState(e){this.setStatus(e,"destroyed"),e.emitter.removeAllListeners()}scheduleUpdateState(e){e.updateScheduled||(e.updateScheduled=!0,queueMicrotask(()=>{e.status!=="destroyed"&&(e.updateScheduled=!1,this.updateState(e))}))}}class bu{constructor(){d(this,"data",{})}reset(){this.data={}}increment(e){this.data[e]||(this.data[e]=0),this.data[e]++}getData(){return{...this.data}}}class vu{constructor(e,t){d(this,"stage");d(this,"memUsed",0);d(this,"loadedTextures",new Map);d(this,"orphanedTextures",[]);d(this,"criticalThreshold");d(this,"targetThreshold");d(this,"cleanupInterval");d(this,"debugLogging");d(this,"lastCleanupTime",0);d(this,"baselineMemoryAllocation");d(this,"criticalCleanupRequested",!1);d(this,"doNotExceedCriticalThreshold");d(this,"frameTime",0);this.stage=e;const{criticalThreshold:i,doNotExceedCriticalThreshold:s}=t;this.doNotExceedCriticalThreshold=s||!1,this.criticalThreshold=Math.round(i);const n=Math.max(0,Math.min(1,t.targetThresholdLevel));if(this.cleanupInterval=t.cleanupInterval,this.debugLogging=t.debugLogging,this.baselineMemoryAllocation=Math.round(t.baselineMemoryAllocation),this.targetThreshold=Math.max(Math.round(i*n),this.baselineMemoryAllocation),this.memUsed=Math.round(t.baselineMemoryAllocation),t.debugLogging){let o=0;setInterval(()=>{o!==this.memUsed&&(o=this.memUsed,console.log(`[TextureMemoryManager] Memory used: ${Fo(this.memUsed)} mb / ${Fo(this.criticalThreshold)} mb (${(this.memUsed/this.criticalThreshold*100).toFixed(1)}%)`))},1e3)}i===0&&(this.setTextureMemUse=()=>{})}addToOrphanedTextures(e){this.orphanedTextures.includes(e)&&this.removeFromOrphanedTextures(e),e.preventCleanup===!1&&this.orphanedTextures.push(e)}removeFromOrphanedTextures(e){const t=this.orphanedTextures.indexOf(e);t!==-1&&this.orphanedTextures.splice(t,1)}setTextureMemUse(e,t){if(this.loadedTextures.has(e)&&(this.memUsed-=this.loadedTextures.get(e)),t===0){this.loadedTextures.delete(e);return}else this.memUsed+=t,this.loadedTextures.set(e,t);this.memUsed>this.criticalThreshold&&(this.criticalCleanupRequested=!0)}checkCleanup(){return this.criticalCleanupRequested||this.memUsed>this.targetThreshold&&this.frameTime-this.lastCleanupTime>=this.cleanupInterval}checkCriticalCleanup(){return this.memUsed>this.criticalThreshold}cleanupQuick(e){const t=this.targetThreshold,i=this.stage.txManager,s=qt();for(;this.memUsed>=t&&this.orphanedTextures.length>0&&(e||qt()-s<10);){const n=this.orphanedTextures.shift();n!==void 0&&n.renderable!==!0&&(n.free(),i.removeTextureFromCache(n))}}cleanupDeep(e){const t=e?this.criticalThreshold:this.targetThreshold,i=this.stage.txManager,s=[],n=[...this.loadedTextures.keys()];for(let o=0;o<n.length;o++){const a=n[o];a!==void 0&&(a.type===ie.image||a.type===ie.noise||a.type===ie.renderToTexture)&&(a.renderable===!0?s.push(a):s.unshift(a))}for(;this.memUsed>=t&&s.length>0;){const o=s.shift();if(o!==void 0&&o.preventCleanup!==!0){if(o.renderable===!0)break;o.free(),this.removeFromOrphanedTextures(o),i.removeTextureFromCache(o),i.removeTextureFromQueue(o)}}}cleanup(e=!1){const t=this.criticalCleanupRequested;this.lastCleanupTime=this.frameTime,t===!0&&this.stage.queueFrameEvent("criticalCleanup",{memUsed:this.memUsed,criticalThreshold:this.criticalThreshold}),this.debugLogging===!0&&console.log(`[TextureMemoryManager] Cleaning up textures. Critical: ${t}. Aggressive: ${e}`),this.cleanupQuick(t),e===!0&&this.memUsed>=this.criticalThreshold&&this.cleanupDeep(t),this.memUsed>=this.criticalThreshold?(this.stage.queueFrameEvent("criticalCleanupFailed",{memUsed:this.memUsed,criticalThreshold:this.criticalThreshold}),(this.debugLogging===!0||Pi()===!1)&&console.warn(`[TextureMemoryManager] Memory usage above critical threshold after cleanup: ${this.memUsed}`)):this.criticalCleanupRequested=!1}getMemoryInfo(){let e=0;const t=[...this.loadedTextures.keys()].reduce((i,s)=>(e+=s.renderable?1:0,i+(s.renderable?this.loadedTextures.get(s):0)),this.baselineMemoryAllocation);return{criticalThreshold:this.criticalThreshold,targetThreshold:this.targetThreshold,renderableMemUsed:t,memUsed:this.memUsed,renderableTexturesLoaded:e,loadedTextures:this.loadedTextures.size,baselineMemoryAllocation:this.baselineMemoryAllocation}}}class Fa{constructor(e,t){d(this,"textureSource");d(this,"memManager");d(this,"state","freed");this.memManager=e,this.textureSource=t}setTextureMemUse(e){this.memManager.setTextureMemUse(this.textureSource,e)}get renderable(){return this.textureSource.renderable}}class Oa{constructor(e){d(this,"options");d(this,"mode");d(this,"stage");d(this,"txManager");d(this,"txMemManager");d(this,"shManager");d(this,"rttNodes",[]);this.options=e,this.stage=e.stage,this.txManager=e.txManager,this.txMemManager=e.txMemManager,this.shManager=e.shManager}}class wu extends _n{constructor(t,i,s){super(t,i);d(this,"textRenderer");d(this,"trState");d(this,"_textRendererOverride",null);d(this,"onTextLoaded",()=>{const{contain:t}=this,i=this.trState.props.width,s=this.trState.props.height,n=this.trState.textW||0,o=this.trState.textH||0;t==="both"?(this.props.width=i,this.props.height=s):t==="width"?(this.props.width=i,this.props.height=o):t==="none"&&(this.props.width=n,this.props.height=o),this.updateLocalTransform(),this.stage.requestRender(),this.emit("loaded",{type:"text",dimensions:{width:this.trState.textW||0,height:this.trState.textH||0}})});d(this,"onTextFailed",(t,i)=>{this.emit("failed",{type:"text",error:i})});this._textRendererOverride=i.textRendererOverride,this.textRenderer=s;const n=this.createState({x:this.absX,y:this.absY,width:i.width,height:i.height,textAlign:i.textAlign,color:i.color,zIndex:i.zIndex,contain:i.contain,scrollable:i.scrollable,scrollY:i.scrollY,offsetY:i.offsetY,letterSpacing:i.letterSpacing,debug:i.debug,fontFamily:i.fontFamily,fontSize:i.fontSize,fontStretch:i.fontStretch,fontStyle:i.fontStyle,fontWeight:i.fontWeight,text:i.text,lineHeight:i.lineHeight,maxLines:i.maxLines,textBaseline:i.textBaseline,verticalAlign:i.verticalAlign,overflowSuffix:i.overflowSuffix});this.trState=n}get width(){return this.props.width}set width(t){this.props.width=t,this.textRenderer.set.width(this.trState,t),this.contain==="none"&&this.setUpdateType(v.Local)}get height(){return this.props.height}set height(t){this.props.height=t,this.textRenderer.set.height(this.trState,t),this.contain!=="both"&&this.setUpdateType(v.Local)}get color(){return this.trState.props.color}set color(t){this.textRenderer.set.color(this.trState,t)}get text(){return this.trState.props.text}set text(t){this.textRenderer.set.text(this.trState,t)}get textRendererOverride(){return this._textRendererOverride}set textRendererOverride(t){this._textRendererOverride=t,this.textRenderer.destroyState(this.trState);const i=this.stage.resolveTextRenderer(this.trState.props,this._textRendererOverride);if(!i){console.warn("Text Renderer not found for font",this.trState.props.fontFamily);return}this.textRenderer=i,this.trState=this.createState(this.trState.props)}get fontSize(){return this.trState.props.fontSize}set fontSize(t){this.textRenderer.set.fontSize(this.trState,t)}get fontFamily(){return this.trState.props.fontFamily}set fontFamily(t){this.textRenderer.set.fontFamily(this.trState,t)}get fontStretch(){return this.trState.props.fontStretch}set fontStretch(t){this.textRenderer.set.fontStretch(this.trState,t)}get fontStyle(){return this.trState.props.fontStyle}set fontStyle(t){this.textRenderer.set.fontStyle(this.trState,t)}get fontWeight(){return this.trState.props.fontWeight}set fontWeight(t){this.textRenderer.set.fontWeight(this.trState,t)}get textAlign(){return this.trState.props.textAlign}set textAlign(t){this.textRenderer.set.textAlign(this.trState,t)}get contain(){return this.trState.props.contain}set contain(t){this.textRenderer.set.contain(this.trState,t)}get scrollable(){return this.trState.props.scrollable}set scrollable(t){this.textRenderer.set.scrollable(this.trState,t)}get scrollY(){return this.trState.props.scrollY}set scrollY(t){this.textRenderer.set.scrollY(this.trState,t)}get offsetY(){return this.trState.props.offsetY}set offsetY(t){this.textRenderer.set.offsetY(this.trState,t)}get letterSpacing(){return this.trState.props.letterSpacing}set letterSpacing(t){this.textRenderer.set.letterSpacing(this.trState,t)}get lineHeight(){return this.trState.props.lineHeight}set lineHeight(t){this.textRenderer.set.lineHeight(this.trState,t)}get maxLines(){return this.trState.props.maxLines}set maxLines(t){this.textRenderer.set.maxLines(this.trState,t)}get textBaseline(){return this.trState.props.textBaseline}set textBaseline(t){this.textRenderer.set.textBaseline(this.trState,t)}get verticalAlign(){return this.trState.props.verticalAlign}set verticalAlign(t){this.textRenderer.set.verticalAlign(this.trState,t)}get overflowSuffix(){return this.trState.props.overflowSuffix}set overflowSuffix(t){this.textRenderer.set.overflowSuffix(this.trState,t)}get debug(){return this.trState.props.debug}set debug(t){this.textRenderer.set.debug(this.trState,t)}update(t,i){super.update(t,i),I(this.globalTransform),this.textRenderer.set.x(this.trState,this.globalTransform.tx),this.textRenderer.set.y(this.trState,this.globalTransform.ty)}checkBasicRenderability(){return this.worldAlpha===0||this.isOutOfBounds()===!0?!1:!!(this.trState&&this.trState.props.text!=="")}setRenderable(t){super.setRenderable(t),this.textRenderer.setIsRenderable(this.trState,t)}renderQuads(t){var i;if(I(this.globalTransform),!this.textRenderer.renderQuads){super.renderQuads(t);return}this.parentHasRenderTexture&&(!t.renderToTextureActive||this.parentRenderTexture!==t.activeRttNode)||(this.parentHasRenderTexture&&((i=this.props.parent)!=null&&i.rtt)&&(this.globalTransform=de.identity(),this.localTransform&&this.globalTransform.multiply(this.localTransform)),I(this.globalTransform),this.textRenderer.renderQuads(this.trState,this.globalTransform,this.clippingRect,this.worldAlpha,this.parentHasRenderTexture,this.framebufferDimensions))}destroy(){super.destroy(),this.textRenderer.destroyState(this.trState)}createState(t){const i=this.textRenderer.createState(t,this);return i.emitter.on("loaded",this.onTextLoaded),i.emitter.on("failed",this.onTextFailed),this.textRenderer.scheduleUpdateState(i),i}}function Cu(r){const e={boolean:!0,string:!0,number:!0,undefined:!0},t=Object.keys(r);for(let i=0;i<t.length;i++){const s=t[i];if(!s)continue;const n=r[s],o=typeof n;o==="string"&&n.length>2048&&(console.warn(`Custom Data value for ${s} is too long, it will be truncated to 2048 characters`),r[s]=n.substring(0,2048)),e[o]||(console.warn(`Custom Data value for ${s} is not a boolean, string, or number, it will be ignored`),delete r[s])}return r}const Ru=2e6;let Au=class{constructor(e){d(this,"options");d(this,"animationManager");d(this,"txManager");d(this,"txMemManager");d(this,"fontManager");d(this,"textRenderers");d(this,"shManager");d(this,"renderer");d(this,"root");d(this,"boundsMargin");d(this,"defShaderCtr");d(this,"strictBound");d(this,"preloadBound");d(this,"strictBounds");d(this,"defaultTexture",null);d(this,"eventBus");d(this,"deltaTime",0);d(this,"lastFrameTime",0);d(this,"currentFrameTime",0);d(this,"fpsNumFrames",0);d(this,"fpsElapsedTime",0);d(this,"numQuadsRendered",0);d(this,"renderRequested",!1);d(this,"frameEventQueue",[]);d(this,"fontResolveMap",{});d(this,"contextSpy",null);this.options=e;const{canvas:t,clearColor:i,appWidth:s,appHeight:n,boundsMargin:o,enableContextSpy:a,forceWebGL2:l,numImageWorkers:h,textureMemory:u,renderEngine:f,fontEngines:c,createImageBitmapSupport:p}=e;this.eventBus=e.eventBus,this.txManager=new au(this,{numImageWorkers:h,createImageBitmapSupport:p}),this.txManager.on("initialized",()=>{this.requestRender()}),this.txMemManager=new vu(this,u),this.shManager=new Tu,this.animationManager=new Qh,this.contextSpy=a?new bu:null,this.strictBounds=e.strictBounds;let _=[0,0,0,0];o&&(_=Array.isArray(o)?o:[o,o,o,o]),this.boundsMargin=_,this.strictBound=xi(0,0,s,n),this.preloadBound=gn(this.strictBound,_);const g={stage:this,canvas:t,pixelRatio:e.devicePhysicalPixelRatio*e.deviceLogicalPixelRatio,clearColor:i??4278190080,bufferMemory:Ru,txManager:this.txManager,txMemManager:this.txMemManager,shManager:this.shManager,contextSpy:this.contextSpy,forceWebGL2:l};this.renderer=new f(g);const x=this.renderer.mode||"webgl";this.createDefaultTexture(),this.defShaderCtr=this.renderer.getDefShaderCtr(),zh(x),this.txManager.renderer=this.renderer,this.textRenderers={},c.forEach(T=>{const b=new T(this),S=b.type;if(S==="sdf"&&x==="canvas"){console.warn("SdfTextRenderer is not compatible with Canvas renderer. Skipping...");return}b instanceof Gn&&(S==="canvas"?this.textRenderers.canvas=b:S==="sdf"&&(this.textRenderers.sdf=b))}),Object.keys(this.textRenderers).length===0&&console.warn("No text renderers available. Your text will not render."),this.fontManager=new uu(this.textRenderers);const m=new _n(this,{x:0,y:0,width:s,height:n,alpha:1,autosize:!1,boundsMargin:null,clipping:!1,color:0,colorTop:0,colorBottom:0,colorLeft:0,colorRight:0,colorTl:0,colorTr:0,colorBl:0,colorBr:0,zIndex:0,zIndexLocked:0,scaleX:1,scaleY:1,mountX:0,mountY:0,mount:0,pivot:.5,pivotX:.5,pivotY:.5,rotation:0,parent:null,texture:null,textureOptions:{},shader:this.defShaderCtr,rtt:!1,src:null,scale:1,preventCleanup:!1,strictBounds:this.strictBounds});this.root=m,Zh(this)}setClearColor(e){this.renderer.updateClearColor(e),this.renderRequested=!0}updateFrameTime(){const e=qt();this.lastFrameTime=this.currentFrameTime,this.currentFrameTime=e,this.deltaTime=this.lastFrameTime?e-this.lastFrameTime:100/6,this.txManager.frameTime=e,this.txMemManager.frameTime=e,this.eventBus.emit("frameTick",{time:this.currentFrameTime,delta:this.deltaTime})}createDefaultTexture(){console.log("Creating default texture"),this.defaultTexture=this.txManager.createTexture("ColorTexture",{color:4294967295}),I(this.defaultTexture instanceof ur),this.txManager.loadTexture(this.defaultTexture,!0),this.defaultTexture.setRenderableOwner(this,!0),this.defaultTexture.once("loaded",()=>{this.requestRender()})}updateAnimations(){const{animationManager:e}=this;this.root&&e.update(this.deltaTime)}hasSceneUpdates(){return!!this.root.updateType||this.renderRequested||this.txManager.hasUpdates()}drawFrame(){const{renderer:e,renderRequested:t}=this;I(e),this.root.updateType!==0&&this.root.update(this.deltaTime,this.root.clippingRect),this.txManager.processSome(this.options.textureProcessingTimeLimit),e.reset(),this.txMemManager.criticalCleanupRequested===!0&&(this.txMemManager.cleanup(!1),this.txMemManager.criticalCleanupRequested===!0&&this.txMemManager.cleanup(!0)),e.rttNodes.length>0&&e.renderRTTNodes(),this.addQuads(this.root),e==null||e.render(),this.calculateFps(),this.calculateQuads(),t&&(this.renderRequested=!1)}queueFrameEvent(e,t){this.frameEventQueue.push([e,t])}flushFrameEvents(){for(const[e,t]of this.frameEventQueue)this.eventBus.emit(e,t);this.frameEventQueue=[]}calculateFps(){var t,i;const{fpsUpdateInterval:e}=this.options;if(e&&(this.fpsNumFrames++,this.fpsElapsedTime+=this.deltaTime,this.fpsElapsedTime>=e)){const s=Math.round(this.fpsNumFrames*1e3/this.fpsElapsedTime);this.fpsNumFrames=0,this.fpsElapsedTime=0,this.queueFrameEvent("fpsUpdate",{fps:s,contextSpyData:((t=this.contextSpy)==null?void 0:t.getData())??null}),(i=this.contextSpy)==null||i.reset()}}calculateQuads(){const e=this.renderer.getQuadCount();e&&e!==this.numQuadsRendered&&(this.numQuadsRendered=e,this.queueFrameEvent("quadsUpdate",{quads:e}))}addQuads(e){I(this.renderer),e.isRenderable===!0&&e.renderQuads(this.renderer);for(let t=0;t<e.children.length;t++){const i=e.children[t];i!==void 0&&(i.worldAlpha===0||i.strictBounds===!0&&i.renderState===ge.OutOfBounds||this.addQuads(i))}}requestRender(){this.renderRequested=!0}resolveTextRenderer(e,t=null){const i=`${e.fontFamily}${e.fontStyle}${e.fontWeight}${e.fontStretch}${t||""}`;if(this.fontResolveMap[i]!==void 0)return this.fontResolveMap[i];let s=t,n=!1;if(s){const a=this.textRenderers[s];a?a.canRenderFont(e)||(console.warn(`Cannot use override text renderer '${s}' for font`,e),s=null,n=!0):(console.warn(`Text renderer override '${s}' not found.`),s=null,n=!0)}if(!s){for(const[a,l]of Object.entries(this.textRenderers))if(l.canRenderFont(e)){s=a;break}!s&&this.textRenderers.canvas!==void 0&&(s="canvas")}if(n&&console.warn(`Falling back to text renderer ${String(s)}`),!s)return null;const o=this.textRenderers[s];return I(o,"resolvedTextRenderer undefined"),this.fontResolveMap[i]=o,o}createShaderCtr(e,t){return this.shManager.loadShader(e,t)}createNode(e){const t=this.resolveNodeDefaults(e);return new _n(this,t)}createTextNode(e){const t=e.fontSize??16,i={...this.resolveNodeDefaults(e),text:e.text??"",textRendererOverride:e.textRendererOverride??null,fontSize:t,fontFamily:e.fontFamily??"sans-serif",fontStyle:e.fontStyle??"normal",fontWeight:e.fontWeight??"normal",fontStretch:e.fontStretch??"normal",textAlign:e.textAlign??"left",contain:e.contain??"none",scrollable:e.scrollable??!1,scrollY:e.scrollY??0,offsetY:e.offsetY??0,letterSpacing:e.letterSpacing??0,lineHeight:e.lineHeight,maxLines:e.maxLines??0,textBaseline:e.textBaseline??"alphabetic",verticalAlign:e.verticalAlign??"middle",overflowSuffix:e.overflowSuffix??"...",debug:e.debug??{},shaderProps:null},s=this.resolveTextRenderer(i,e.textRendererOverride);if(!s)throw new Error(`No compatible text renderer found for ${i.fontFamily}`);return new wu(this,i,s)}setBoundsMargin(e){this.boundsMargin=Array.isArray(e)?e:[e,e,e,e],this.root.setUpdateType(v.RenderBounds)}resolveNodeDefaults(e){const t=e.color??4294967295,i=e.colorTl??e.colorTop??e.colorLeft??t,s=e.colorTr??e.colorTop??e.colorRight??t,n=e.colorBl??e.colorBottom??e.colorLeft??t,o=e.colorBr??e.colorBottom??e.colorRight??t;let a={};return this.options.inspector===!0&&(a=Cu(e.data??{})),{x:e.x??0,y:e.y??0,width:e.width??0,height:e.height??0,alpha:e.alpha??1,autosize:e.autosize??!1,boundsMargin:e.boundsMargin??null,clipping:e.clipping??!1,color:t,colorTop:e.colorTop??t,colorBottom:e.colorBottom??t,colorLeft:e.colorLeft??t,colorRight:e.colorRight??t,colorBl:n,colorBr:o,colorTl:i,colorTr:s,zIndex:e.zIndex??0,zIndexLocked:e.zIndexLocked??0,parent:e.parent??null,texture:e.texture??null,textureOptions:e.textureOptions??{},shader:e.shader??this.defShaderCtr,src:e.src??null,srcHeight:e.srcHeight,srcWidth:e.srcWidth,srcX:e.srcX,srcY:e.srcY,scale:e.scale??null,scaleX:e.scaleX??e.scale??1,scaleY:e.scaleY??e.scale??1,mount:e.mount??0,mountX:e.mountX??e.mount??0,mountY:e.mountY??e.mount??0,pivot:e.pivot??.5,pivotX:e.pivotX??e.pivot??.5,pivotY:e.pivotY??e.pivot??.5,rotation:e.rotation??0,rtt:e.rtt??!1,data:a,preventCleanup:e.preventCleanup??!1,imageType:e.imageType,strictBounds:e.strictBounds??this.strictBounds}}cleanup(e){this.txMemManager.cleanup(e)}};class Eu extends ht{constructor(t,i){var g,x,m,T,b,S;super();d(this,"root");d(this,"canvas");d(this,"settings");d(this,"stage");d(this,"inspector",null);const s={criticalThreshold:((g=t.textureMemory)==null?void 0:g.criticalThreshold)||124e6,targetThresholdLevel:((x=t.textureMemory)==null?void 0:x.targetThresholdLevel)||.5,cleanupInterval:((m=t.textureMemory)==null?void 0:m.cleanupInterval)||5e3,debugLogging:((T=t.textureMemory)==null?void 0:T.debugLogging)||!1,baselineMemoryAllocation:((b=t.textureMemory)==null?void 0:b.baselineMemoryAllocation)||26e6,doNotExceedCriticalThreshold:((S=t.textureMemory)==null?void 0:S.doNotExceedCriticalThreshold)||!1},n={appWidth:t.appWidth||1920,appHeight:t.appHeight||1080,textureMemory:s,boundsMargin:t.boundsMargin||0,deviceLogicalPixelRatio:t.deviceLogicalPixelRatio||1,devicePhysicalPixelRatio:t.devicePhysicalPixelRatio||window.devicePixelRatio,clearColor:t.clearColor??0,fpsUpdateInterval:t.fpsUpdateInterval||0,numImageWorkers:t.numImageWorkers!==void 0?t.numImageWorkers:2,enableContextSpy:t.enableContextSpy??!1,forceWebGL2:t.forceWebGL2??!1,inspector:t.inspector??!1,renderEngine:t.renderEngine,quadBufferSize:t.quadBufferSize??4*1024*1024,fontEngines:t.fontEngines,strictBounds:t.strictBounds??!0,textureProcessingTimeLimit:t.textureProcessingTimeLimit||10,canvas:t.canvas||document.createElement("canvas"),createImageBitmapSupport:t.createImageBitmapSupport||"full"};this.settings=n;const{appWidth:o,appHeight:a,deviceLogicalPixelRatio:l,devicePhysicalPixelRatio:h,inspector:u,canvas:f}=n,c=o*l,p=a*l;this.canvas=f,f.width=c*h,f.height=p*h,f.style.width=`${c}px`,f.style.height=`${p}px`,this.stage=new Au({appWidth:this.settings.appWidth,appHeight:this.settings.appHeight,boundsMargin:this.settings.boundsMargin,clearColor:this.settings.clearColor,canvas:this.canvas,deviceLogicalPixelRatio:this.settings.deviceLogicalPixelRatio,devicePhysicalPixelRatio:this.settings.devicePhysicalPixelRatio,enableContextSpy:this.settings.enableContextSpy,forceWebGL2:this.settings.forceWebGL2,fpsUpdateInterval:this.settings.fpsUpdateInterval,numImageWorkers:this.settings.numImageWorkers,renderEngine:this.settings.renderEngine,textureMemory:s,eventBus:this,quadBufferSize:this.settings.quadBufferSize,fontEngines:this.settings.fontEngines,inspector:this.settings.inspector!==null,strictBounds:this.settings.strictBounds,textureProcessingTimeLimit:this.settings.textureProcessingTimeLimit,createImageBitmapSupport:this.settings.createImageBitmapSupport}),this.root=this.stage.root;let _;if(typeof i=="string"?_=document.getElementById(i):_=i,!_)throw new Error("Could not find target element");_.appendChild(f),u&&!Pi()&&(this.inspector=new u(f,n))}createNode(t){const i=this.stage.createNode(t);return this.inspector?this.inspector.createNode(i):i}createTextNode(t){const i=this.stage.createTextNode(t);return this.inspector?this.inspector.createTextNode(i):i}destroyNode(t){return this.inspector&&this.inspector.destroyNode(t.id),t.destroy()}createTexture(t,i){return this.stage.txManager.createTexture(t,i)}createShader(t,i){return this.stage.shManager.loadShader(t,i)}createDynamicShader(t){return this.stage.shManager.loadDynamicShader({effects:t})}createEffect(t,i,s){return{name:s,type:t,props:i}}getNodeById(t){var n;const i=(n=this.stage)==null?void 0:n.root;if(!i)return null;const s=o=>{if(o.id===t)return o;for(const a of o.children){const l=s(a);if(l)return l}return null};return s(i)}toggleFreeze(){throw new Error("Not implemented")}advanceFrame(){throw new Error("Not implemented")}getBufferInfo(){return this.stage.renderer.getBufferInfo()}rerender(){this.stage.requestRender()}cleanup(t=!1){this.stage.cleanup(t)}setClearColor(t){this.stage.setClearColor(t)}}class za extends ht{constructor(t){super();d(this,"fontFamily");d(this,"descriptors");d(this,"loaded",!1);d(this,"metrics",null);const{fontFamily:i,descriptors:s,metrics:n}=t;n&&(this.metrics={ascender:n.ascender/n.unitsPerEm,descender:n.descender/n.unitsPerEm,lineGap:n.lineGap/n.unitsPerEm}),this.fontFamily=i,this.descriptors={style:"normal",weight:"normal",stretch:"normal",...s}}static convertToCssFontFaceDescriptors(t){return{style:t.style,weight:typeof t.weight=="number"?`${t.weight}`:t.weight,stretch:t.stretch,unicodeRange:t.unicodeRange,featureSettings:t.featureSettings,display:t.display}}}class qs extends za{constructor(t){super(t);d(this,"fontFace");d(this,"fontUrl");const{fontFamily:i,fontUrl:s}=t,n=s.replace(/\(|\)/g,""),o=this.descriptors;let a={style:o.style,weight:typeof o.weight=="number"?`${o.weight}`:o.weight,stretch:o.stretch,unicodeRange:o.unicodeRange,featureSettings:o.featureSettings,display:o.display};for(const h in a){const u=h;a[u]===void 0&&delete a[u]}const l=new FontFace(i,`url(${n})`,a);n.length>0?l.load().then(()=>{this.loaded=!0,this.emit("loaded")}).catch(console.error):(this.loaded=!0,this.emit("loaded")),this.fontFace=l,this.fontUrl=s}}class Lu{}class Ua extends Lu{constructor(t,i,s,n,o,a,l,h,u,f,c,p,_){super();d(this,"glw");d(this,"options");d(this,"buffers");d(this,"shader");d(this,"shaderProps");d(this,"alpha");d(this,"clippingRect");d(this,"dimensions");d(this,"bufferIdx");d(this,"zIndex");d(this,"renderToTexture");d(this,"parentHasRenderTexture");d(this,"framebufferDimensions");d(this,"length",0);d(this,"numQuads",0);d(this,"textures",[]);d(this,"maxTextures");this.glw=t,this.options=i,this.buffers=s,this.shader=n,this.shaderProps=o,this.alpha=a,this.clippingRect=l,this.dimensions=h,this.bufferIdx=u,this.zIndex=f,this.renderToTexture=c,this.parentHasRenderTexture=p,this.framebufferDimensions=_,this.maxTextures=n.supportsIndexedTextures?t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS):1}addTexture(t){const{textures:i,maxTextures:s}=this;let n=-1;const o=i.length;for(let a=0;a<o;a++)if(i[a]===t){n=a;break}return n!==-1?n:o>=s?4294967295:(this.textures.push(t),o)}draw(){const{glw:t,shader:i,shaderProps:s,options:n}=this,{shManager:o}=n;o.useShader(i),i.bindRenderOp(this,s);const a=this.bufferIdx/24*6*2;if(this.clippingRect.valid){const{x:l,y:h,width:u,height:f}=this.clippingRect,c=this.parentHasRenderTexture?1:n.pixelRatio,p=n.canvas.height,_=Math.round(l*c),g=Math.round(u*c),x=Math.round(f*c);let m=Math.round(p-x-h*c);this.parentHasRenderTexture&&(m=this.framebufferDimensions?this.framebufferDimensions.height-this.dimensions.height:0),t.setScissorTest(!0),t.scissor(_,m,g,x)}else t.setScissorTest(!1);t.drawElements(t.TRIANGLES,6*this.numQuads,t.UNSIGNED_SHORT,a)}}function Pu(r){const e={MAX_RENDERBUFFER_SIZE:0,MAX_TEXTURE_SIZE:0,MAX_VIEWPORT_DIMS:0,MAX_VERTEX_TEXTURE_IMAGE_UNITS:0,MAX_TEXTURE_IMAGE_UNITS:0,MAX_COMBINED_TEXTURE_IMAGE_UNITS:0,MAX_VERTEX_ATTRIBS:0,MAX_VARYING_VECTORS:0,MAX_VERTEX_UNIFORM_VECTORS:0,MAX_FRAGMENT_UNIFORM_VECTORS:0};return Object.keys(e).forEach(i=>{e[i]=r.getParameter(r[i])}),e}function Iu(r){const e={ANGLE_instanced_arrays:null,WEBGL_compressed_texture_s3tc:null,WEBGL_compressed_texture_astc:null,WEBGL_compressed_texture_etc:null,WEBGL_compressed_texture_etc1:null,WEBGL_compressed_texture_pvrtc:null,WEBKIT_WEBGL_compressed_texture_pvrtc:null,WEBGL_compressed_texture_s3tc_srgb:null,OES_vertex_array_object:null};return Object.keys(e).forEach(i=>{e[i]=r.getExtension(i)}),e}function Mu(r,e){const t=~~(e/80),i=new Uint16Array(t*6);for(let n=0,o=0;n<t;n+=6,o+=4)i[n]=o,i[n+1]=o+1,i[n+2]=o+2,i[n+3]=o+2,i[n+4]=o+1,i[n+5]=o+3;const s=r.createBuffer();r.elementArrayBufferData(s,i,r.STATIC_DRAW)}function Fu(r){return r!==null&&(typeof r=="object"&&r.constructor&&r.constructor.name==="HTMLImageElement"||typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)}const en=new Uint8Array([0,0,0,0]);class fr extends Fa{constructor(t,i,s){super(i,s);d(this,"glw");d(this,"_nativeCtxTexture",null);d(this,"_w",0);d(this,"_h",0);this.glw=t}get ctxTexture(){return this.state==="freed"?(this.load(),null):(I(this._nativeCtxTexture),this._nativeCtxTexture)}get w(){return this._w}get h(){return this._h}load(){if(!(this.state==="loading"||this.state==="loaded")){if(this.state="loading",this.textureSource.setState("loading"),this._nativeCtxTexture=this.createNativeCtxTexture(),this._nativeCtxTexture===null){this.state="failed",this.textureSource.setState("failed",new Error("Could not create WebGL Texture")),console.error("Could not create WebGL Texture");return}this.onLoadRequest().then(({width:t,height:i})=>{this.state!=="freed"&&(this.state="loaded",this._w=t,this._h=i,this.textureSource.setState("loaded",{width:t,height:i}),this.textureSource.freeTextureData())}).catch(t=>{this.state!=="freed"&&(this.state="failed",this.textureSource.setState("failed",t),this.textureSource.freeTextureData(),console.error(t))})}}async onLoadRequest(){const{glw:t}=this,i=this.textureSource.textureData;if(i===null||this._nativeCtxTexture===null)throw new Error("Texture data or native texture is null "+this.textureSource.type);t.texImage2D(0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null),this.setTextureMemUse(en.byteLength);let s=0,n=0;t.activeTexture(0);const o=i.data,a=t.RGBA,l=4,h=1.1;if(typeof ImageBitmap<"u"&&o instanceof ImageBitmap||o instanceof ImageData||Fu(o))s=o.width,n=o.height,t.bindTexture(this._nativeCtxTexture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!i.premultiplyAlpha),t.texImage2D(0,a,a,t.UNSIGNED_BYTE,o),this.setTextureMemUse(n*s*l*h);else if(o===null)s=0,n=0,t.bindTexture(this._nativeCtxTexture),t.texImage2D(0,a,1,1,0,a,t.UNSIGNED_BYTE,en),this.setTextureMemUse(en.byteLength);else if("mipmaps"in o&&o.mipmaps){const{mipmaps:u,width:f=0,height:c=0,type:p,glInternalFormat:_}=o,g=p==="ktx"?new DataView(u[0]??new ArrayBuffer(0)):u[0];t.bindTexture(this._nativeCtxTexture),t.compressedTexImage2D(0,_,f,c,0,g),t.texParameteri(t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_MIN_FILTER,t.LINEAR),this.setTextureMemUse(g.byteLength)}else o&&o instanceof Uint8Array?(s=1,n=1,t.bindTexture(this._nativeCtxTexture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!i.premultiplyAlpha),t.texImage2D(0,a,s,n,0,a,t.UNSIGNED_BYTE,o),this.setTextureMemUse(s*n*l)):console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned",i);return{width:s,height:n}}free(){this.state!=="freed"&&(this.state="freed",this.textureSource.setState("freed"),this._w=0,this._h=0,this._nativeCtxTexture!==null&&(this.glw.deleteTexture(this._nativeCtxTexture),this.setTextureMemUse(0),this._nativeCtxTexture=null),this.textureSource.freeTextureData())}createNativeCtxTexture(){const{glw:t}=this,i=t.createTexture();return i?(t.activeTexture(0),t.bindTexture(i),t.texParameteri(t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i):null}}class Ou extends fr{constructor(e,t,i){super(e,t,i)}async onLoadRequest(){var t,i;const e=this.textureSource.textureData;return I(e,"SubTexture must have texture data"),e.data instanceof Uint8Array?{width:1,height:1}:{width:((t=e.data)==null?void 0:t.width)||0,height:((i=e.data)==null?void 0:i.height)||0}}}class Ba{constructor(e){d(this,"config");this.config=e}getBuffer(e){var t;return(t=this.config.find(i=>i.attributes[e]))==null?void 0:t.buffer}getAttributeInfo(e){var t;return(t=this.config.find(i=>i.attributes[e]))==null?void 0:t.attributes[e]}}function zu(r){return self.WebGL2RenderingContext&&r instanceof self.WebGL2RenderingContext}class Uu{constructor(e){d(this,"gl");d(this,"activeTextureUnit",0);d(this,"texture2dUnits");d(this,"texture2dParams",new WeakMap);d(this,"scissorEnabled");d(this,"scissorX");d(this,"scissorY");d(this,"scissorWidth");d(this,"scissorHeight");d(this,"blendEnabled");d(this,"blendSrcRgb");d(this,"blendDstRgb");d(this,"blendSrcAlpha");d(this,"blendDstAlpha");d(this,"boundArrayBuffer");d(this,"boundElementArrayBuffer");d(this,"curProgram");d(this,"canvas");d(this,"MAX_RENDERBUFFER_SIZE");d(this,"MAX_TEXTURE_SIZE");d(this,"MAX_VIEWPORT_DIMS");d(this,"MAX_VERTEX_TEXTURE_IMAGE_UNITS");d(this,"MAX_TEXTURE_IMAGE_UNITS");d(this,"MAX_COMBINED_TEXTURE_IMAGE_UNITS");d(this,"MAX_VERTEX_ATTRIBS");d(this,"MAX_VARYING_VECTORS");d(this,"MAX_VERTEX_UNIFORM_VECTORS");d(this,"MAX_FRAGMENT_UNIFORM_VECTORS");d(this,"TEXTURE_MAG_FILTER");d(this,"TEXTURE_MIN_FILTER");d(this,"TEXTURE_WRAP_S");d(this,"TEXTURE_WRAP_T");d(this,"LINEAR");d(this,"CLAMP_TO_EDGE");d(this,"RGB");d(this,"RGBA");d(this,"UNSIGNED_BYTE");d(this,"UNPACK_PREMULTIPLY_ALPHA_WEBGL");d(this,"UNPACK_FLIP_Y_WEBGL");d(this,"FLOAT");d(this,"TRIANGLES");d(this,"UNSIGNED_SHORT");d(this,"ONE");d(this,"ONE_MINUS_SRC_ALPHA");d(this,"VERTEX_SHADER");d(this,"FRAGMENT_SHADER");d(this,"STATIC_DRAW");d(this,"COMPILE_STATUS");d(this,"LINK_STATUS");d(this,"DYNAMIC_DRAW");d(this,"COLOR_ATTACHMENT0");d(this,"INVALID_ENUM");d(this,"INVALID_OPERATION");this.gl=e,this.activeTextureUnit=e.getParameter(e.ACTIVE_TEXTURE)-e.TEXTURE0;const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.texture2dUnits=new Array(t).fill(void 0).map((s,n)=>(this.activeTexture(n),e.getParameter(e.TEXTURE_BINDING_2D))),this.activeTexture(this.activeTextureUnit),this.scissorEnabled=e.isEnabled(e.SCISSOR_TEST);const i=e.getParameter(e.SCISSOR_BOX);this.scissorX=i[0],this.scissorY=i[1],this.scissorWidth=i[2],this.scissorHeight=i[3],this.blendEnabled=e.isEnabled(e.BLEND),this.blendSrcRgb=e.getParameter(e.BLEND_SRC_RGB),this.blendDstRgb=e.getParameter(e.BLEND_DST_RGB),this.blendSrcAlpha=e.getParameter(e.BLEND_SRC_ALPHA),this.blendDstAlpha=e.getParameter(e.BLEND_DST_ALPHA),this.boundArrayBuffer=e.getParameter(e.ARRAY_BUFFER_BINDING),this.boundElementArrayBuffer=e.getParameter(e.ELEMENT_ARRAY_BUFFER_BINDING),this.curProgram=e.getParameter(e.CURRENT_PROGRAM),this.canvas=e.canvas,this.MAX_RENDERBUFFER_SIZE=e.MAX_RENDERBUFFER_SIZE,this.MAX_TEXTURE_SIZE=e.MAX_TEXTURE_SIZE,this.MAX_VIEWPORT_DIMS=e.MAX_VIEWPORT_DIMS,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=e.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.MAX_TEXTURE_IMAGE_UNITS=e.MAX_TEXTURE_IMAGE_UNITS,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS,this.MAX_VERTEX_ATTRIBS=e.MAX_VERTEX_ATTRIBS,this.MAX_VARYING_VECTORS=e.MAX_VARYING_VECTORS,this.MAX_VERTEX_UNIFORM_VECTORS=e.MAX_VERTEX_UNIFORM_VECTORS,this.MAX_FRAGMENT_UNIFORM_VECTORS=e.MAX_FRAGMENT_UNIFORM_VECTORS,this.TEXTURE_MAG_FILTER=e.TEXTURE_MAG_FILTER,this.TEXTURE_MIN_FILTER=e.TEXTURE_MIN_FILTER,this.TEXTURE_WRAP_S=e.TEXTURE_WRAP_S,this.TEXTURE_WRAP_T=e.TEXTURE_WRAP_T,this.LINEAR=e.LINEAR,this.CLAMP_TO_EDGE=e.CLAMP_TO_EDGE,this.RGB=e.RGB,this.RGBA=e.RGBA,this.UNSIGNED_BYTE=e.UNSIGNED_BYTE,this.UNPACK_PREMULTIPLY_ALPHA_WEBGL=e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.UNPACK_FLIP_Y_WEBGL=e.UNPACK_FLIP_Y_WEBGL,this.FLOAT=e.FLOAT,this.TRIANGLES=e.TRIANGLES,this.UNSIGNED_SHORT=e.UNSIGNED_SHORT,this.ONE=e.ONE,this.ONE_MINUS_SRC_ALPHA=e.ONE_MINUS_SRC_ALPHA,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=e.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.TRIANGLES=e.TRIANGLES,this.UNSIGNED_SHORT=e.UNSIGNED_SHORT,this.VERTEX_SHADER=e.VERTEX_SHADER,this.FRAGMENT_SHADER=e.FRAGMENT_SHADER,this.STATIC_DRAW=e.STATIC_DRAW,this.COMPILE_STATUS=e.COMPILE_STATUS,this.LINK_STATUS=e.LINK_STATUS,this.DYNAMIC_DRAW=e.DYNAMIC_DRAW,this.COLOR_ATTACHMENT0=e.COLOR_ATTACHMENT0,this.INVALID_ENUM=e.INVALID_ENUM,this.INVALID_OPERATION=e.INVALID_OPERATION}isWebGl2(){return zu(this.gl)}activeTexture(e){const{gl:t}=this;this.activeTextureUnit!==e&&(t.activeTexture(e+t.TEXTURE0),this.activeTextureUnit=e)}bindTexture(e){const{gl:t,activeTextureUnit:i,texture2dUnits:s}=this;s[i]!==e&&(s[i]=e,t.bindTexture(this.gl.TEXTURE_2D,e))}_getActiveTexture(){const{activeTextureUnit:e,texture2dUnits:t}=this;return t[e]}texParameteri(e,t){const{gl:i,texture2dParams:s}=this,n=this._getActiveTexture();if(!n)throw new Error("No active texture");let o=s.get(n);o||(o={},s.set(n,o)),o[e]!==t&&(o[e]=t,i.texParameteri(i.TEXTURE_2D,e,t))}texImage2D(e,t,i,s,n,o,a,l){const{gl:h}=this;o?h.texImage2D(h.TEXTURE_2D,e,t,i,s,n,o,a,l):h.texImage2D(h.TEXTURE_2D,e,t,i,s,n)}compressedTexImage2D(e,t,i,s,n,o){const{gl:a}=this;a.compressedTexImage2D(a.TEXTURE_2D,e,t,i,s,n,o)}pixelStorei(e,t){const{gl:i}=this;i.pixelStorei(e,t)}generateMipmap(){const{gl:e}=this;e.generateMipmap(e.TEXTURE_2D)}createTexture(){const{gl:e}=this;return e.createTexture()}deleteTexture(e){const{gl:t}=this;e&&this.texture2dParams.delete(e),t.deleteTexture(e)}deleteFramebuffer(e){this.gl.deleteFramebuffer(e)}viewport(e,t,i,s){const{gl:n}=this;n.viewport(e,t,i,s)}clearColor(e,t,i,s){const{gl:n}=this;n.clearColor(e,t,i,s)}setScissorTest(e){const{gl:t,scissorEnabled:i}=this;e!==i&&(e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.scissorEnabled=e)}scissor(e,t,i,s){const{gl:n,scissorX:o,scissorY:a,scissorWidth:l,scissorHeight:h}=this;(e!==o||t!==a||i!==l||s!==h)&&(n.scissor(e,t,i,s),this.scissorX=e,this.scissorY=t,this.scissorWidth=i,this.scissorHeight=s)}setBlend(e){const{gl:t,blendEnabled:i}=this;e!==i&&(e?t.enable(t.BLEND):t.disable(t.BLEND),this.blendEnabled=e)}blendFunc(e,t){const{gl:i,blendSrcRgb:s,blendDstRgb:n,blendSrcAlpha:o,blendDstAlpha:a}=this;(e!==s||t!==n||e!==o||t!==a)&&(i.blendFunc(e,t),this.blendSrcRgb=e,this.blendDstRgb=t,this.blendSrcAlpha=e,this.blendDstAlpha=t)}createBuffer(){const{gl:e}=this;return e.createBuffer()}createFramebuffer(){const{gl:e}=this;return e.createFramebuffer()}bindFramebuffer(e){const{gl:t}=this;t.bindFramebuffer(t.FRAMEBUFFER,e)}framebufferTexture2D(e,t,i){const{gl:s}=this;s.framebufferTexture2D(s.FRAMEBUFFER,e,s.TEXTURE_2D,t,i)}clear(){const{gl:e}=this;e.clear(e.COLOR_BUFFER_BIT)}arrayBufferData(e,t,i){const{gl:s,boundArrayBuffer:n}=this;n!==e&&(s.bindBuffer(s.ARRAY_BUFFER,e),this.boundArrayBuffer=e),s.bufferData(s.ARRAY_BUFFER,t,i)}elementArrayBufferData(e,t,i){const{gl:s,boundElementArrayBuffer:n}=this;n!==e&&(s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.boundElementArrayBuffer=e),s.bufferData(s.ELEMENT_ARRAY_BUFFER,t,i)}vertexAttribPointer(e,t,i,s,n,o,a){const{gl:l,boundArrayBuffer:h}=this;h!==e&&(l.bindBuffer(l.ARRAY_BUFFER,e),this.boundArrayBuffer=e),l.vertexAttribPointer(t,i,s,n,o,a)}useProgram(e){const{gl:t,curProgram:i}=this;i!==e&&(t.useProgram(e),this.curProgram=e)}uniform1f(e,t){const{gl:i}=this;i.uniform1f(e,t)}uniform1fv(e,t){const{gl:i}=this;i.uniform1fv(e,t)}uniform1i(e,t){const{gl:i}=this;i.uniform1i(e,t)}uniform1iv(e,t){const{gl:i}=this;i.uniform1iv(e,t)}uniform2f(e,t,i){const{gl:s}=this;s.uniform2f(e,t,i)}uniform2fv(e,t){const{gl:i}=this;i.uniform2fv(e,t)}uniform2i(e,t,i){const{gl:s}=this;s.uniform2i(e,t,i)}uniform2iv(e,t){const{gl:i}=this;i.uniform2iv(e,t)}uniform3f(e,t,i,s){const{gl:n}=this;n.uniform3f(e,t,i,s)}uniform3fv(e,t){const{gl:i}=this;i.uniform3fv(e,t)}uniform3i(e,t,i,s){const{gl:n}=this;n.uniform3i(e,t,i,s)}uniform3iv(e,t){const{gl:i}=this;i.uniform3iv(e,t)}uniform4f(e,t,i,s,n){const{gl:o}=this;o.uniform4f(e,t,i,s,n)}uniform4fv(e,t){const{gl:i}=this;i.uniform4fv(e,t)}uniform4i(e,t,i,s,n){const{gl:o}=this;o.uniform4i(e,t,i,s,n)}uniform4iv(e,t){const{gl:i}=this;i.uniform4iv(e,t)}uniformMatrix2fv(e,t){const{gl:i}=this;i.uniformMatrix2fv(e,!1,t)}uniformMatrix3fv(e,t){const{gl:i}=this;i.uniformMatrix3fv(e,!1,t)}uniformMatrix4fv(e,t){const{gl:i}=this;i.uniformMatrix4fv(e,!1,t)}getParameter(e){const{gl:t}=this;return t.getParameter(e)}drawElements(e,t,i,s){const{gl:n}=this;n.drawElements(e,t,i,s)}getExtension(e){const{gl:t}=this;return t.getExtension(e)}getError(){const{gl:e}=this;return e.getError()}createVertexArray(){const{gl:e}=this;return I(e instanceof WebGL2RenderingContext),e.createVertexArray()}bindVertexArray(e){const{gl:t}=this;I(t instanceof WebGL2RenderingContext),t.bindVertexArray(e)}getAttribLocation(e,t){const{gl:i}=this;return i.getAttribLocation(e,t)}getUniformLocation(e,t){const{gl:i}=this;return i.getUniformLocation(e,t)}enableVertexAttribArray(e){const{gl:t}=this;t.enableVertexAttribArray(e)}disableVertexAttribArray(e){const{gl:t}=this;t.disableVertexAttribArray(e)}createShader(e){const{gl:t}=this;return t.createShader(e)}compileShader(e){const{gl:t}=this;t.compileShader(e)}attachShader(e,t){const{gl:i}=this;i.attachShader(e,t)}linkProgram(e){const{gl:t}=this;t.linkProgram(e)}deleteProgram(e){const{gl:t}=this;t.deleteProgram(e)}getShaderParameter(e,t){const{gl:i}=this;return i.getShaderParameter(e,t)}getShaderInfoLog(e){const{gl:t}=this;return t.getShaderInfoLog(e)}createProgram(){const{gl:e}=this;return e.createProgram()}getProgramParameter(e,t){const{gl:i}=this;return i.getProgramParameter(e,t)}getProgramInfoLog(e){const{gl:t}=this;return t.getProgramInfoLog(e)}shaderSource(e,t){const{gl:i}=this;i.shaderSource(e,t)}deleteShader(e){const{gl:t}=this;t.deleteShader(e)}}class ko extends fr{constructor(t,i,s){super(t,i,s);d(this,"framebuffer",null)}async onLoadRequest(){const{glw:t}=this,i=this._nativeCtxTexture=this.createNativeCtxTexture(),{width:s,height:n}=this.textureSource;return this.framebuffer=t.createFramebuffer(),t.texImage2D(0,t.RGBA,s,n,0,t.RGBA,t.UNSIGNED_BYTE,null),this.setTextureMemUse(s*n*4),t.bindFramebuffer(this.framebuffer),t.framebufferTexture2D(t.COLOR_ATTACHMENT0,i,0),t.bindFramebuffer(null),{width:s,height:n}}free(){super.free(),this.glw.deleteFramebuffer(this.framebuffer),this.framebuffer=null}}const Bu=24;class Yn extends Oa{constructor(t){super(t);d(this,"glw");d(this,"system");d(this,"quadBuffer");d(this,"fQuadBuffer");d(this,"uiQuadBuffer");d(this,"renderOps",[]);d(this,"curBufferIdx",0);d(this,"curRenderOp",null);d(this,"rttNodes",[]);d(this,"activeRttNode",null);d(this,"defShaderCtrl");d(this,"defaultShader");d(this,"quadBufferCollection");d(this,"clearColor",{raw:0,normalized:[0,0,0,0]});d(this,"quadBufferUsage",0);d(this,"numQuadsRendered",0);d(this,"renderToTextureActive",!1);this.quadBuffer=new ArrayBuffer(this.stage.options.quadBufferSize),this.fQuadBuffer=new Float32Array(this.quadBuffer),this.uiQuadBuffer=new Uint32Array(this.quadBuffer),this.mode="webgl";const{canvas:i,clearColor:s,bufferMemory:n}=t,o=Fh(i,t.forceWebGL2,t.contextSpy),a=this.glw=new Uu(o);a.viewport(0,0,i.width,i.height),this.updateClearColor(s),a.setBlend(!0),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),Mu(a,n),this.system={parameters:Pu(this.glw),extensions:Iu(this.glw)},this.shManager.renderer=this,this.defShaderCtrl=this.shManager.loadShader("DefaultShader"),this.defaultShader=this.defShaderCtrl.shader;const l=a.createBuffer();I(l);const h=6*Float32Array.BYTES_PER_ELEMENT;this.quadBufferCollection=new Ba([{buffer:l,attributes:{a_position:{name:"a_position",size:2,type:a.FLOAT,normalized:!1,stride:h,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:a.FLOAT,normalized:!1,stride:h,offset:2*Float32Array.BYTES_PER_ELEMENT},a_color:{name:"a_color",size:4,type:a.UNSIGNED_BYTE,normalized:!0,stride:h,offset:4*Float32Array.BYTES_PER_ELEMENT},a_textureIndex:{name:"a_textureIndex",size:1,type:a.FLOAT,normalized:!1,stride:h,offset:5*Float32Array.BYTES_PER_ELEMENT}}}])}reset(){const{glw:t}=this;this.curBufferIdx=0,this.curRenderOp=null,this.renderOps.length=0,t.setScissorTest(!1),t.clear()}getShaderManager(){return this.shManager}createCtxTexture(t){return t instanceof Zi?new Ou(this.glw,this.txMemManager,t):t instanceof cr?new ko(this.glw,this.txMemManager,t):new fr(this.glw,this.txMemManager,t)}addQuad(t){const{fQuadBuffer:i,uiQuadBuffer:s}=this;let n=t.texture;if(I(n!==null,"Texture is required"),t.shaderProps!==null){if(hr(t.shaderProps,"$dimensions")==!0){const m=t.shaderProps.$dimensions;m.width=t.width,m.height=t.height}hr(t.shaderProps,"$alpha")===!0&&(t.shaderProps.$alpha=t.alpha)}let{curBufferIdx:o,curRenderOp:a}=this;const l={width:-1,height:-1};l.width=t.width,l.height=t.height;const h=t.shader||this.defaultShader;I(h.getUniformLocation!==void 0,"Invalid WebGL shader"),this.reuseRenderOp(t)===!1&&(this.newRenderOp(h,t.shaderProps,t.alpha,l,t.clippingRect,o,t.rtt,t.parentHasRenderTexture,t.framebufferDimensions),a=this.curRenderOp,I(a));let u=0,f=0,c=1,p=1;if(n.type===ie.subTexture){const{x:m,y:T,width:b,height:S}=n.props,{width:R=0,height:A=0}=n.parentTexture.dimensions||{width:0,height:0};u=m/R,c=u+b/R,f=T/A,p=f+S/A,n=n.parentTexture}if(n.type===ie.image&&t.textureOptions!==null&&t.textureOptions.resizeMode!==void 0&&n.dimensions!==null){const m=t.textureOptions.resizeMode,{width:T,height:b}=n.dimensions;if(m.type==="cover"){const S=t.width/T,R=t.height/b,A=Math.max(S,R),L=1/A;if(A&&S&&S<A){const E=L*t.width;u=(1-E/T)*(m.clipX??.5),c=u+E/T}if(A&&R&&R<A){const E=L*t.height;f=(1-E/b)*(m.clipY??.5),p=f+E/b}}}let _=0;t.textureOptions!==null&&(t.textureOptions.flipX===!0&&([u,c]=[c,u]),_=+(t.textureOptions.flipY||!1)),_^+(n.type===ie.renderToTexture)&&([f,p]=[p,f]);const g=n.ctxTexture;I(g instanceof fr);const x=this.addTexture(g,o);if(I(this.curRenderOp!==null),t.renderCoords)i[o++]=t.renderCoords.x1,i[o++]=t.renderCoords.y1,i[o++]=u,i[o++]=f,s[o++]=t.colorTl,i[o++]=x,i[o++]=t.renderCoords.x2,i[o++]=t.renderCoords.y2,i[o++]=c,i[o++]=f,s[o++]=t.colorTr,i[o++]=x,i[o++]=t.renderCoords.x4,i[o++]=t.renderCoords.y4,i[o++]=u,i[o++]=p,s[o++]=t.colorBl,i[o++]=x,i[o++]=t.renderCoords.x3,i[o++]=t.renderCoords.y3,i[o++]=c,i[o++]=p,s[o++]=t.colorBr,i[o++]=x;else if(t.tb!==0||t.tc!==0)i[o++]=t.tx,i[o++]=t.ty,i[o++]=u,i[o++]=f,s[o++]=t.colorTl,i[o++]=x,i[o++]=t.tx+t.width*t.ta,i[o++]=t.ty+t.width*t.tc,i[o++]=c,i[o++]=f,s[o++]=t.colorTr,i[o++]=x,i[o++]=t.tx+t.height*t.tb,i[o++]=t.ty+t.height*t.td,i[o++]=u,i[o++]=p,s[o++]=t.colorBl,i[o++]=x,i[o++]=t.tx+t.width*t.ta+t.height*t.tb,i[o++]=t.ty+t.width*t.tc+t.height*t.td,i[o++]=c,i[o++]=p,s[o++]=t.colorBr,i[o++]=x;else{const m=t.tx+t.width*t.ta,T=t.ty+t.height*t.td;i[o++]=t.tx,i[o++]=t.ty,i[o++]=u,i[o++]=f,s[o++]=t.colorTl,i[o++]=x,i[o++]=m,i[o++]=t.ty,i[o++]=c,i[o++]=f,s[o++]=t.colorTr,i[o++]=x,i[o++]=t.tx,i[o++]=T,i[o++]=u,i[o++]=p,s[o++]=t.colorBl,i[o++]=x,i[o++]=m,i[o++]=T,i[o++]=c,i[o++]=p,s[o++]=t.colorBr,i[o++]=x}this.curRenderOp.length+=Bu,this.curRenderOp.numQuads++,this.curBufferIdx=o}newRenderOp(t,i,s,n,o,a,l,h,u){const f=new Ua(this.glw,this.options,this.quadBufferCollection,t,i,s,o,n,a,0,l,h,u);this.curRenderOp=f,this.renderOps.push(f)}addTexture(t,i,s){const{curRenderOp:n}=this;I(n);const o=n.addTexture(t);if(o===4294967295){if(s)throw new Error("Unable to add texture to render op");return this.newRenderOp(n.shader,n.shaderProps,n.alpha,n.dimensions,n.clippingRect,i),this.addTexture(t,i,!0)}return o}reuseRenderOp(t){var h;const{shader:i,shaderProps:s,parentHasRenderTexture:n,rtt:o,clippingRect:a}=t,l=i||this.defaultShader;return!(((h=this.curRenderOp)==null?void 0:h.shader)!==l||Nh(this.curRenderOp.clippingRect,a)===!1||n!==void 0||o!==void 0||this.curRenderOp.shader!==this.defaultShader&&(s===null||this.curRenderOp.shader.canBatchShaderProps(this.curRenderOp.shaderProps,s)===!1))}addRenderOp(t){this.renderOps.push(t),this.curRenderOp=null}render(t="screen"){const{glw:i,quadBuffer:s}=this,n=new Float32Array(s,0,this.curBufferIdx),o=this.quadBufferCollection.getBuffer("a_position")||null;i.arrayBufferData(o,n,i.STATIC_DRAW);for(let l=0,h=this.renderOps.length;l<h;l++)this.renderOps[l].draw();this.quadBufferUsage=this.curBufferIdx*n.BYTES_PER_ELEMENT;const a=4*(6*n.BYTES_PER_ELEMENT);this.numQuadsRendered=this.quadBufferUsage/a}getQuadCount(){return this.numQuadsRendered}renderToTexture(t){for(let i=0;i<this.rttNodes.length;i++)if(this.rttNodes[i]===t)return;this.insertRTTNodeInOrder(t)}insertRTTNodeInOrder(t){let i=this.rttNodes.length,s=t;for(;s&&s.parent;){const o=this.rttNodes.indexOf(s.parent);if(o!==-1){i=o;break}s=s.parent}const n=this.findMaxChildRTTIndex(t);n!==-1&&(i=Math.max(i,n+1)),this.rttNodes.splice(i,0,t)}findMaxChildRTTIndex(t){let i=-1;const s=n=>{const o=this.rttNodes.indexOf(n);o!==-1&&(i=Math.max(i,o));for(const a of n.children)s(a)};return s(t),i}renderRTTNodes(){const{glw:t}=this,{txManager:i}=this.stage;for(let n=0;n<this.rttNodes.length;n++){const o=this.rttNodes[n];if(o===void 0||o.hasRTTupdates===!1||o.worldAlpha===0||o.strictBounds===!0&&o.renderState===ge.OutOfBounds||o.texture===null||o.texture.state!=="loaded")continue;this.activeRttNode=o,I(o.texture,"RTT node missing texture");const a=o.texture.ctxTexture;I(a instanceof ko),this.renderToTextureActive=!0,t.bindFramebuffer(a.framebuffer),t.viewport(0,0,a.w,a.h),t.clearColor(0,0,0,0),t.clear();for(let l=0;l<o.children.length;l++){const h=o.children[l];h!==void 0&&(this.stage.addQuads(h),h.hasRTTupdates=!1)}this.render(),this.renderOps.length=0,o.hasRTTupdates=!1}const s=this.clearColor.normalized;t.clearColor(s[0],s[1],s[2],s[3]),t.bindFramebuffer(null),t.viewport(0,0,this.glw.canvas.width,this.glw.canvas.height),this.renderToTextureActive=!1}removeRTTNode(t){const i=this.rttNodes.indexOf(t);i!==-1&&this.rttNodes.splice(i,1)}getBufferInfo(){return{totalAvailable:this.stage.options.quadBufferSize,totalUsed:this.quadBufferUsage}}getDefShaderCtr(){return this.defShaderCtrl}updateClearColor(t){if(this.clearColor.raw===t)return;const i=this.glw,s=is(t);i.clearColor(s[0],s[1],s[2],s[3]),this.clearColor={raw:t,normalized:s},i.clear()}}const ku={LINE_FEED:10};class Du{}class Nu extends Du{constructor(t,i){super();d(this,"data");d(this,"glyphMap");d(this,"kernings");this.data=t,this.glyphMap=i;const s=this.kernings={};t.kernings.forEach(n=>{const o=n.second,a=s[o]=s[o]||{};a[n.first]=n.amount}),this.kernings=s}*shapeText(t,i){var o;let s,n;for(;(s=i.peek())&&!s.done;){const a=s.value,l=this.glyphMap.get(a);if(i.next(),l!==void 0){const h=n!==void 0?(((o=this.kernings[l.id])==null?void 0:o[n])||0)+t.letterSpacing:0;n=l.id,yield{mapped:!0,glyphId:l.id,codepoint:a,cluster:i.lastIndex,xAdvance:l.xadvance+h,yAdvance:0,xOffset:l.xoffset+h,yOffset:l.yoffset,xBearing:0,yBearing:0,width:l.width,height:l.height}}else a===ku.LINE_FEED&&(n=void 0),yield{mapped:!1,codepoint:a,cluster:i.lastIndex}}}}class vn extends za{constructor(t,i){super(i);d(this,"type");d(this,"texture");d(this,"maxCharHeight",0);d(this,"shaper");d(this,"glyphMap",new Map);d(this,"data");const{atlasUrl:s,atlasDataUrl:n,stage:o}=i;this.type=t;const a=o.renderer;I(a instanceof Yn,"SDF Font Faces can only be used with the WebGL Renderer"),this.texture=o.txManager.createTexture("ImageTexture",{src:s,premultiplyAlpha:!1}),o.txManager.loadTexture(this.texture,!0),this.texture.preventCleanup=!0,this.texture.on("loaded",()=>{this.checkLoaded(),o.requestRender()}),Ea(n).then(l=>{var u;this.data=JSON.parse(l),I(this.data);let h=0;if(this.data.chars.forEach(f=>{this.glyphMap.set(f.id,f);const c=f.yoffset+f.height;c>h&&(h=c)}),this.maxCharHeight=h,this.shaper=new Nu(this.data,this.glyphMap),!this.metrics)if((u=this.data)!=null&&u.lightningMetrics){const{ascender:f,descender:c,lineGap:p,unitsPerEm:_}=this.data.lightningMetrics;this.metrics={ascender:f/_,descender:c/_,lineGap:p/_}}else throw new Error(`Font metrics not found in ${this.type} font ${this.fontFamily}. Make sure you are using the latest version of the Lightning 3 \`msdf-generator\` tool to generate your SDF fonts.`);this.checkLoaded()}).catch(console.error)}getAtlasEntry(t){const i=this.glyphMap.get(t);if(i===void 0)throw new Error(`Glyph ${t} not found in font ${this.fontFamily}`);return{x:i.x,y:i.y,width:i.width,height:i.height}}checkLoaded(){this.loaded||this.texture.state==="loaded"&&this.data&&(this.loaded=!0,this.emit("loaded"))}}const $u=24;function Hu(r,e,t,i,s,n,o,a,l){const h=Math.min(Math.max(o.firstLineIdx,0),a.length),u=0,{metrics:f}=t;I(f,"Font metrics not loaded"),I(t.data,"Font data not loaded");const c=(f.ascender-f.descender)*r;let p=0;i==="middle"?p=(e-c)/2:i==="bottom"&&(p=e-c);const _=s/n,g=t.data.common.base,m=f.ascender*r-g,T=_+m+h*e+p;if(!(l&&T>=l/n))return{sdfX:u,sdfY:T,lineIndex:h}}class Di{constructor(e,t=0){d(this,"iterator");d(this,"peekBuffer",[]);d(this,"_lastIndex");this.iterator=e,this.iterator=e,this._lastIndex=t-1,this.peekBuffer=[]}next(){const e=this.peekBuffer.length>0?this.peekBuffer.pop():this.iterator.next();return e.done?this._lastIndex=-1:this._lastIndex++,e}peek(){if(this.peekBuffer.length>0)return this.peekBuffer[0];const e=this.iterator.next();return this.peekBuffer.push(e),e}get lastIndex(){return this._lastIndex}}function*Ni(r,e=0){let t=e;for(;t<r.length;){const i=r.codePointAt(t);if(i===void 0)throw new Error("Invalid Unicode code point");yield i,t+=i<=65535?1:2}}function Wu(r,e,t){const i=t.shapeText(e,new Di(Ni(r,0),0));let s=0;for(const n of i)n.mapped&&n.codepoint!==8203&&(s+=n.xAdvance);return s}function Vu(r,e,t,i,s,n,o,a,l,h,u,f,c,p,_,g,x,m,T){I(_,"Font face must be loaded"),I(_.loaded,"Font face must be loaded"),I(_.data,"Font face must be loaded"),I(_.shaper,"Font face must be loaded");const b=a/_.data.info.size,S=l/b,R=n/b,A=h/b,L=c[r],E=(L==null?void 0:L.codepointIndex)||0,U=(L==null?void 0:L.maxX)||0,z=(L==null?void 0:L.maxY)||0;let k=U,O=z,B=e,$=t,P=0;const C={codepointIndex:-1,bufferOffset:-1,xStart:-1},M=_.shaper,j={letterSpacing:A};i.endsWith(" ")&&(i+=" ");let q=M.shapeText(j,new Di(Ni(i,E),E)),K,Q=-1;const Y=[],oe=o/b,Se=Wu(m,j,M);let ve=!0;for(;ve;){const ne=(T===0||r+1<T)&&(f!=="both"||x||$+S+_.maxCharHeight<=oe),be=ne?R:R-Se;let fe=0;const Ge=$+_.maxCharHeight>=p.y1,we=$<=p.y2,De=Ge&&we;for(;(K=q.next())&&!K.done;){const te=K.value;if(r===c.length)c.push({codepointIndex:te.cluster,maxY:O,maxX:k});else if(r>c.length)throw new Error("Unexpected lineCache length");if(te.codepoint===32||te.codepoint===10||te.codepoint===8203?C.codepointIndex!==-1&&(C.codepointIndex=-1,fe=B):C.codepointIndex===-1&&(C.codepointIndex=te.cluster,C.bufferOffset=P,C.xStart=fe),te.mapped){const si=B+te.xOffset+te.width;if(f!=="none"&&si>=be&&C.codepointIndex!==-1&&C.xStart>0)if(ne){q=M.shapeText(j,new Di(Ni(i,C.codepointIndex),C.codepointIndex)),P=C.bufferOffset;break}else q=M.shapeText(j,new Di(Ni(m,0),0)),B=C.xStart,P=C.bufferOffset,f="none";else{const Ye=B+te.xOffset,Ce=$+te.yOffset;if(De){Q===-1&&(Q=P);const ri=_.getAtlasEntry(te.glyphId),Le=ri.x/_.data.common.scaleW,Qe=ri.y/_.data.common.scaleH,Nt=ri.width/_.data.common.scaleW,Ne=ri.height/_.data.common.scaleH;u[P++]=Ye,u[P++]=Ce,u[P++]=Le,u[P++]=Qe,u[P++]=Ye+te.width,u[P++]=Ce,u[P++]=Le+Nt,u[P++]=Qe,u[P++]=Ye,u[P++]=Ce+te.height,u[P++]=Le,u[P++]=Qe+Ne,u[P++]=Ye+te.width,u[P++]=Ce+te.height,u[P++]=Le+Nt,u[P++]=Qe+Ne}O=Math.max(O,Ce+te.height),k=Math.max(k,Ye+te.width),B+=te.xAdvance}}else if(te.codepoint===10){if(ne)break;q=M.shapeText(j,new Di(Ni(m,0),0)),f="none"}}Q!==-1&&(Y.push({bufferStart:Q,bufferEnd:P}),Q=-1),B=0,$+=S,r++,C.codepointIndex=-1,fe=0,!g&&f==="both"&&$>p.y2||K&&K.done?ve=!1:ne||(ve=!1)}if(s==="center"){const ne=f==="none"?k:R;for(let be=0;be<Y.length;be++){const fe=Y[be],Ge=u[fe.bufferEnd-4]-u[fe.bufferStart],we=(ne-Ge)/2;for(let De=fe.bufferStart;De<fe.bufferEnd;De+=4)u[De]+=we}}else if(s==="right"){const ne=f==="none"?k:R;for(let be=0;be<Y.length;be++){const fe=Y[be],Ge=fe.bufferEnd===fe.bufferStart?0:u[fe.bufferEnd-4]-u[fe.bufferStart],we=ne-Ge;for(let De=fe.bufferStart;De<fe.bufferEnd;De+=4)u[De]+=we}}return I(K),{bufferNumFloats:P,bufferNumQuads:P/16,layoutNumCharacters:K.done?i.length-E:K.value.cluster-E+1,fullyProcessed:!!K.done,maxX:k,maxY:O,numLines:c.length}}function Xu(r,e){return Math.ceil(r/e)*e}function Gu(r,e){return Math.floor(r/e)*e}function Yu(r,e,t,i,s,n,o,a){const{screen:l,sdf:h}=r;if(!Hh(o))l.x1=0,l.y1=0,l.x2=0,l.y2=0,h.x1=0,h.y1=0,h.x2=0,h.y2=0,r.numLines=0,r.firstLineIdx=0;else{const u=o.x1-e,f=u+(o.x2-o.x1),c=o.y1-t+i,p=Gu(c-n,s||1),_=Xu(c+(o.y2-o.y1)+n,s||1);l.x1=u,l.y1=p,l.x2=f,l.y2=_,h.x1=u/a,h.y1=p/a,h.x2=f/a,h.y2=_/a,r.numLines=Math.ceil((_-p)/s),r.firstLineIdx=s?Math.floor(p/s):0}r.valid=!0}function ka(r,e){return e*(r.ascender-r.descender+r.lineGap)}const ju={x:0,y:0,width:0,height:0};class Ku extends Gn{constructor(t){super(t);d(this,"ssdfFontFamilies",{});d(this,"msdfFontFamilies",{});d(this,"fontFamilyArray",[this.ssdfFontFamilies,this.msdfFontFamilies]);d(this,"sdfShader");d(this,"rendererBounds");d(this,"type","sdf");this.sdfShader=this.stage.shManager.loadShader("SdfShader",{transform:new Float32Array,color:0,size:0,scrollY:0,distanceRange:0,debug:!1}).shader,this.rendererBounds={x1:0,y1:0,x2:this.stage.options.appWidth,y2:this.stage.options.appHeight}}getPropertySetters(){return{fontFamily:(t,i)=>{t.props.fontFamily=i,this.releaseFontFace(t),this.invalidateLayoutCache(t)},fontWeight:(t,i)=>{t.props.fontWeight=i,this.releaseFontFace(t),this.invalidateLayoutCache(t)},fontStyle:(t,i)=>{t.props.fontStyle=i,this.releaseFontFace(t),this.invalidateLayoutCache(t)},fontStretch:(t,i)=>{t.props.fontStretch=i,this.releaseFontFace(t),this.invalidateLayoutCache(t)},fontSize:(t,i)=>{t.props.fontSize=i,this.invalidateLayoutCache(t)},text:(t,i)=>{t.props.text=i,this.invalidateLayoutCache(t)},textAlign:(t,i)=>{t.props.textAlign=i,this.invalidateLayoutCache(t)},color:(t,i)=>{t.props.color=i},x:(t,i)=>{t.props.x=i,t.elementBounds.valid&&(this.setElementBoundsX(t),!t.renderWindow.valid&&qr(t.elementBounds,this.rendererBounds)&&this.scheduleUpdateState(t))},y:(t,i)=>{t.props.y=i,t.elementBounds.valid&&(this.setElementBoundsY(t),!t.renderWindow.valid&&qr(t.elementBounds,this.rendererBounds)&&this.scheduleUpdateState(t))},contain:(t,i)=>{t.props.contain=i,this.invalidateLayoutCache(t)},width:(t,i)=>{t.props.width=i,t.props.contain!=="none"&&this.invalidateLayoutCache(t)},height:(t,i)=>{t.props.height=i,t.props.contain==="both"&&this.invalidateLayoutCache(t)},offsetY:(t,i)=>{t.props.offsetY=i,this.invalidateLayoutCache(t)},scrollable:(t,i)=>{t.props.scrollable=i,this.invalidateLayoutCache(t)},scrollY:(t,i)=>{t.props.scrollY=i,this.scheduleUpdateState(t)},letterSpacing:(t,i)=>{t.props.letterSpacing=i,this.invalidateLayoutCache(t)},lineHeight:(t,i)=>{t.props.lineHeight=i,t.resLineHeight=void 0,this.invalidateLayoutCache(t)},maxLines:(t,i)=>{t.props.maxLines=i,this.invalidateLayoutCache(t)},textBaseline:(t,i)=>{t.props.textBaseline=i,this.invalidateLayoutCache(t)},verticalAlign:(t,i)=>{t.props.verticalAlign=i,this.invalidateLayoutCache(t)},overflowSuffix:(t,i)=>{t.props.overflowSuffix=i,this.invalidateLayoutCache(t)},debug:(t,i)=>{t.props.debug=i}}}canRenderFont(t){const{fontFamily:i}=t;return i in this.ssdfFontFamilies||i in this.msdfFontFamilies||i==="$$SDF_FAILURE_TEST$$"}isFontFaceSupported(t){return t instanceof vn}addFontFace(t){I(t instanceof vn);const i=t.fontFamily,s=t.type==="ssdf"?this.ssdfFontFamilies:t.type==="msdf"?this.msdfFontFamilies:void 0;if(!s){console.warn(`Invalid font face type: ${t.type}`);return}let n=s[i];n||(n=new Set,s[i]=n),n.add(t)}createState(t){return{props:t,status:"initialState",updateScheduled:!1,emitter:new ht,lineCache:[],forceFullLayoutCalc:!1,renderWindow:{screen:{x1:0,y1:0,x2:0,y2:0},sdf:{x1:0,y1:0,x2:0,y2:0},firstLineIdx:0,numLines:0,valid:!1},elementBounds:{x1:0,y1:0,x2:0,y2:0,valid:!1},clippingRect:{x:0,y:0,width:0,height:0,valid:!1},bufferNumFloats:0,bufferNumQuads:0,vertexBuffer:void 0,webGlBuffers:null,bufferUploaded:!1,textH:void 0,textW:void 0,distanceRange:0,trFontFace:void 0,isRenderable:!1,resLineHeight:void 0,debugData:{updateCount:0,layoutCount:0,lastLayoutNumCharacters:0,layoutSum:0,drawSum:0,drawCount:0,bufferSize:0}}}updateState(t){let{trFontFace:i}=t;const{textH:s,lineCache:n,debugData:o,forceFullLayoutCalc:a}=t;if(o.updateCount++,t.status==="initialState"&&this.setStatus(t,"loading"),i===void 0){if(i=this.resolveFontFace(t.props),t.trFontFace=i,i===void 0){const M=`SdfTextRenderer: Could not resolve font face for family: '${t.props.fontFamily}'`;console.error(M),this.setStatus(t,"failed",new Error(M));return}i.texture.setRenderableOwner(t,!0)}if(i.loaded===!1){i.once("loaded",()=>{this.scheduleUpdateState(t)});return}I(i.data,"Font face data should be loaded"),I(i.metrics,"Font face metrics should be loaded");const{text:l,fontSize:h,x:u,y:f,contain:c,width:p,height:_,verticalAlign:g,scrollable:x,overflowSuffix:m,maxLines:T}=t.props,b=c==="both"&&x?t.props.scrollY:0,{renderWindow:S}=t,R=i.data.info.size,A=h/R;let L=t.resLineHeight;if(L===void 0){const M=t.props.lineHeight;M===void 0?L=ka(i.metrics,h):L=M,t.resLineHeight=L}const E=L/A;t.distanceRange=A*i.data.distanceField.distanceRange;const U=l.length*$u;let z=t.vertexBuffer;(!z||z.length<U)&&(z=new Float32Array(U*2));const k=t.elementBounds;if(k.valid||(this.setElementBoundsX(t),this.setElementBoundsY(t),k.valid=!0),!a&&S.valid){const M=S.screen;if(u+M.x1<=k.x1&&u+M.x2>=k.x2&&f-b+M.y1<=k.y1&&f-b+M.y2>=k.y2){this.setStatus(t,"loaded");return}S.valid=!1,this.setStatus(t,"loading")}const{offsetY:O,textAlign:B}=t.props;if(!S.valid){if(!qr(k,this.rendererBounds))return;Yu(S,u,f,b,L,c==="both"?k.y2-k.y1:0,k,A)}const $=Hu(R,E,i,g,O,A,S,n,s);if(!$){this.setStatus(t,"loaded");return}const{letterSpacing:P}=t.props,C=Vu($.lineIndex,$.sdfX,$.sdfY,l,B,p,_,h,L,P,z,c,n,S.sdf,i,a,x,m,T);t.bufferUploaded=!1,t.bufferNumFloats=C.bufferNumFloats,t.bufferNumQuads=C.bufferNumQuads,t.vertexBuffer=z,t.renderWindow=S,o.lastLayoutNumCharacters=C.layoutNumCharacters,o.bufferSize=z.byteLength,C.fullyProcessed&&(t.textW=C.maxX*A,t.textH=C.numLines*E*A),this.setStatus(t,"loaded")}renderQuads(t,i,s,n,o,a){var k,O;if(!t.vertexBuffer)return;const l=this.stage.renderer;I(l instanceof Yn);const{fontSize:h,color:u,contain:f,scrollable:c,zIndex:p,debug:_}=t.props,g=f==="both"&&c?t.props.scrollY:0,{textW:x=0,textH:m=0,distanceRange:T,vertexBuffer:b,bufferUploaded:S,trFontFace:R,elementBounds:A}=t;let{webGlBuffers:L}=t;if(!L){const B=l.glw,$=4*Float32Array.BYTES_PER_ELEMENT,P=B.createBuffer();I(P),t.webGlBuffers=new Ba([{buffer:P,attributes:{a_position:{name:"a_position",size:2,type:B.FLOAT,normalized:!1,stride:$,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:B.FLOAT,normalized:!1,stride:$,offset:2*Float32Array.BYTES_PER_ELEMENT}}}]),t.bufferUploaded=!1,I(t.webGlBuffers),L=t.webGlBuffers}if(!S){const B=l.glw,$=(L==null?void 0:L.getBuffer("a_textureCoordinate"))??null;B.arrayBufferData($,b,B.STATIC_DRAW),t.bufferUploaded=!0}if(I(R),c&&f==="both"){I(A.valid);const B=Dh(A,ju);s.valid?(t.clippingRect.valid=!0,s=Ca(s,B,t.clippingRect)):(t.clippingRect.valid=!0,s=Ra(B,t.clippingRect))}const E=new Ua(l.glw,l.options,L,this.sdfShader,{transform:i.getFloatArr(),color:Oh(u,n),size:h/(((k=R.data)==null?void 0:k.info.size)||0),scrollY:g,distanceRange:T,debug:_.sdfShaderDebug},n,s,{height:m,width:x},0,p,!1,o,a),U=(O=t.trFontFace)==null?void 0:O.texture;I(U);const z=U.ctxTexture;E.addTexture(z),E.length=t.bufferNumFloats,E.numQuads=t.bufferNumQuads,l.addRenderOp(E)}setIsRenderable(t,i){var s;super.setIsRenderable(t,i),(s=t.trFontFace)==null||s.texture.setRenderableOwner(t,i)}destroyState(t){var i;super.destroyState(t),(i=t.trFontFace)==null||i.texture.setRenderableOwner(t,!1)}resolveFontFace(t){return this.stage.fontManager.resolveFontFace(this.fontFamilyArray,t,"sdf")}releaseFontFace(t){t.resLineHeight=void 0,t.trFontFace&&(t.trFontFace.texture.setRenderableOwner(t,!1),t.trFontFace=void 0)}invalidateLayoutCache(t){t.renderWindow.valid=!1,t.elementBounds.valid=!1,t.textH=void 0,t.textW=void 0,t.lineCache=[],this.setStatus(t,"loading"),this.scheduleUpdateState(t)}setElementBoundsX(t){const{x:i,contain:s,width:n}=t.props,{elementBounds:o}=t;o.x1=i,o.x2=s!=="none"?i+n:1/0}setElementBoundsY(t){const{y:i,contain:s,height:n}=t.props,{elementBounds:o}=t;o.y1=i,o.y2=s==="both"?i+n:1/0}}function Do(r){return r===""||r==="​"}function qu(r,e,t){if(e.metrics)return e.metrics;const i=r.measureText("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz");console.warn(`Font metrics not provided for Canvas Web font ${e.fontFamily}. Using fallback values. It is HIGHLY recommended you use the latest version of the Lightning 3 \`msdf-generator\` tool to extract the default metrics for the font and provide them in the Canvas Web font definition.`);let s;return i.actualBoundingBoxDescent&&i.actualBoundingBoxAscent?s={ascender:i.actualBoundingBoxAscent/t,descender:-i.actualBoundingBoxDescent/t,lineGap:.2}:s={ascender:.8,descender:-.2,lineGap:.2},e.metrics=s,s}const No=2048;function $o(r,e,t,i,s){const n=r!=="bottom"?.5*e:0;return t*(i-1)+n+Math.max(t,e)+(s||0)}class Zu{constructor(e,t){d(this,"_canvas");d(this,"_context");d(this,"_settings");this._canvas=e,this._context=t,this._settings=this.mergeDefaults({})}set settings(e){this._settings=this.mergeDefaults(e)}get settings(){return this._settings}getPrecision(){return this._settings.precision}setFontProperties(){this._context.font=this._getFontSetting(),this._context.textBaseline=this._settings.textBaseline}_getFontSetting(){const e=[this._settings.fontFamily],t=[];for(let i=0,s=e.length;i<s;i++)e[i]==="serif"||e[i]==="sans-serif"?t.push(e[i]):t.push(`"${e[i]}"`);return`${this._settings.fontStyle} ${this._settings.fontSize*this.getPrecision()}px ${t.join(",")}`}_load(){if(document.fonts){const e=this._getFontSetting();try{if(!document.fonts.check(e,this._settings.text))return document.fonts.load(e,this._settings.text).catch(t=>{console.warn("[Lightning] Font load error",t,e)}).then(()=>{document.fonts.check(e,this._settings.text)||console.warn("[Lightning] Font not found",e)})}catch{console.warn("[Lightning] Can't check font loading for "+e)}}}calculateRenderInfo(){const e={},t=this.getPrecision(),i=this._settings.paddingLeft*t,s=this._settings.paddingRight*t,n=this._settings.fontSize*t;let o=this._settings.offsetY===null?null:this._settings.offsetY*t;const a=this._settings.w*t,l=this._settings.h*t;let h=this._settings.wordWrapWidth*t;const u=this._settings.cutSx*t,f=this._settings.cutEx*t,c=this._settings.cutSy*t,p=this._settings.cutEy*t,_=(this._settings.letterSpacing||0)*t,g=this._settings.textIndent*t,x=this._settings.trFontFace;this.setFontProperties(),I(x);const m=qu(this._context,x,n),T=ka(m,n)*t,b=this._settings.lineHeight!==null?this._settings.lineHeight*t:T,S=this._settings.maxHeight,R=S!==null&&b>0?Math.floor(S/b):0,A=this._settings.maxLines,L=R>0&&A>0?Math.min(R,A):Math.max(R,A);let E=a||2048/this.getPrecision(),U=E-i;if(U<10&&(E+=10-U,U=10),h||(h=U),this._settings.textOverflow&&!this._settings.wordWrap){let P;switch(this._settings.textOverflow){case"clip":P="";break;case"ellipsis":P=this._settings.overflowSuffix;break;default:P=this._settings.textOverflow}this._settings.text=this.wrapWord(this._settings.text,h-g,P)}let z;if(this._settings.wordWrap)z=this.wrapText(this._settings.text,h,_,g);else{z={l:this._settings.text.split(/(?:\r\n|\r|\n)/),n:[]};const P=z.l.length;for(let C=0;C<P-1;C++)z.n.push(C)}let k=z.l;if(L&&k.length>L){const P=k.slice(0,L);let C=null;if(this._settings.overflowSuffix){const Q=this._settings.overflowSuffix?this.measureText(this._settings.overflowSuffix):0,Y=this.wrapText(P[P.length-1],h-Q,_,g);P[P.length-1]=`${Y.l[0]}${this._settings.overflowSuffix}`,C=[Y.l.length>1?Y.l[1]:""]}else C=[""];let M;const j=k.length;let q=0;const K=z.n.length;for(M=L;M<j;M++)C[q]+=`${C[q]?" ":""}${k[M]}`,M+1<K&&z.n[M+1]&&q++;e.remainingText=C.join(`
`),e.moreTextLines=!0,k=P}else e.moreTextLines=!1,e.remainingText="";let O=0;const B=[];for(let P=0;P<k.length;P++){const C=this.measureText(k[P],_)+(P===0?g:0);B.push(C),O=Math.max(O,C)}e.lineWidths=B,a||(E=O+i+s,U=O),this._settings.wordWrap&&a>O&&this._settings.textAlign==="left"&&k.length===1&&(E=O+i+s);let $;return l?$=l:$=$o(this._settings.textBaseline,n,b,k.length,o),o===null&&(o=n),e.w=E,e.h=$,e.lines=k,e.precision=t,E||(E=1),$||($=1),(u||f)&&(E=Math.min(E,f-u)),(c||p)&&($=Math.min($,p-c)),e.width=E,e.innerWidth=U,e.height=$,e.fontSize=n,e.cutSx=u,e.cutSy=c,e.cutEx=f,e.cutEy=p,e.lineHeight=b,e.defLineHeight=T,e.lineWidths=B,e.offsetY=o,e.paddingLeft=i,e.paddingRight=s,e.letterSpacing=_,e.textIndent=g,e.metrics=m,e}draw(e,t){const i=this.getPrecision(),s=(t==null?void 0:t.lines)||e.lines,n=(t==null?void 0:t.lineWidths)||e.lineWidths,o=t?$o(this._settings.textBaseline,e.fontSize,e.lineHeight,t.lines.length,this._settings.offsetY===null?null:this._settings.offsetY*i):e.height;this._canvas.width=Math.min(Math.ceil(e.width+this._settings.textRenderIssueMargin),No),this._canvas.height=Math.min(Math.ceil(o),No),this.setFontProperties(),e.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(e.cutSx||e.cutSy)&&this._context.translate(-e.cutSx,-e.cutSy);let a,l;const h=[],{metrics:u}=e,f=u?u.ascender*e.fontSize:e.fontSize,c=(u.ascender-u.descender)*e.fontSize;for(let _=0,g=s.length;_<g;_++)a=_===0?e.textIndent:0,l=_*e.lineHeight+f,this._settings.verticalAlign=="middle"?l+=(e.lineHeight-c)/2:this._settings.verticalAlign=="bottom"&&(l+=e.lineHeight-c),this._settings.textAlign==="right"?a+=e.innerWidth-n[_]:this._settings.textAlign==="center"&&(a+=(e.innerWidth-n[_])/2),a+=e.paddingLeft,h.push({text:s[_],x:a,y:l,w:n[_]});if(this._settings.highlight){const _=this._settings.highlightColor,g=this._settings.highlightHeight*i||e.fontSize*1.5,x=this._settings.highlightOffset*i,m=this._settings.highlightPaddingLeft!==null?this._settings.highlightPaddingLeft*i:e.paddingLeft,T=this._settings.highlightPaddingRight!==null?this._settings.highlightPaddingRight*i:e.paddingRight;this._context.fillStyle=Kr(_);for(let b=0;b<h.length;b++){const S=h[b];this._context.fillRect(S.x-m,S.y-e.offsetY+x,S.w+T+m,g)}}let p=null;this._settings.shadow&&(p=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=Kr(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*i,this._context.shadowOffsetY=this._settings.shadowOffsetY*i,this._context.shadowBlur=this._settings.shadowBlur*i),this._context.fillStyle=Kr(this._settings.textColor);for(let _=0,g=h.length;_<g;_++){const x=h[_];if(e.letterSpacing===0)this._context.fillText(x.text,x.x,x.y);else{const m=x.text.split("");let T=x.x;for(let b=0,S=m.length;b<S;b++)this._context.fillText(m[b],T,x.y),T+=this.measureText(m[b],e.letterSpacing)}}p&&(this._context.shadowColor=p[0],this._context.shadowOffsetX=p[1],this._context.shadowOffsetY=p[2],this._context.shadowBlur=p[3]),(e.cutSx||e.cutSy)&&this._context.translate(e.cutSx,e.cutSy)}wrapWord(e,t,i){const s=this._context.measureText(i).width,n=e.length,o=this._context.measureText(e).width;if(o<=t)return e;let a=Math.floor(t*n/o),l=this._context.measureText(e.substring(0,a)).width+s;if(l>t)for(;a>0&&(l=this._context.measureText(e.substring(0,a)).width+s,l>t);)a-=1;else for(;a<n;)if(l=this._context.measureText(e.substring(0,a)).width+s,l<t)a+=1;else{a-=1;break}return e.substring(0,a)+(t>=s?i:"")}wrapText(e,t,i,s=0){const n=/ |\u200B/g,o=e.split(/\r?\n/g);let a=[];const l=[];for(let h=0;h<o.length;h++){const u=[];let f="",c=t-s;const p=o[h].split(n),_=o[h].match(n)||[];for(let g=0;g<p.length;g++){const x=_[g-1]||"",m=p[g],T=this.measureText(m,i),b=Do(x)?T:T+this.measureText(x,i);g===0||b>c?(g>0&&(u.push(f),f=""),f+=m,c=t-T-(g===0?s:0)):(c-=b,f+=x+m)}u.push(f),f="",a=a.concat(u),h<o.length-1&&l.push(a.length)}return{l:a,n:l}}measureText(e,t=0){return t?e.split("").reduce((i,s)=>Do(s)?i:i+this._context.measureText(s).width+t,0):this._context.measureText(e).width}mergeDefaults(e){return{text:"",w:0,h:0,fontStyle:"normal",fontSize:40,fontFamily:null,trFontFace:null,wordWrap:!0,wordWrapWidth:0,wordBreak:!1,textOverflow:"",lineHeight:null,textBaseline:"alphabetic",textAlign:"left",verticalAlign:"top",offsetY:null,maxLines:0,maxHeight:null,overflowSuffix:"...",textColor:[1,1,1,1],paddingLeft:0,paddingRight:0,shadow:!1,shadowColor:[0,0,0,1],shadowOffsetX:0,shadowOffsetY:0,shadowBlur:5,highlight:!1,highlightHeight:0,highlightColor:[0,0,0,1],highlightOffset:0,highlightPaddingLeft:0,highlightPaddingRight:0,letterSpacing:0,textIndent:0,cutSx:0,cutEx:0,cutSy:0,cutEy:0,advancedRenderer:!1,fontBaselineRatio:0,precision:1,textRenderIssueMargin:0,...e}}}const Ho=typeof self>"u"?globalThis:self;var xa;const Wo=((xa=Ho.document)==null?void 0:xa.fonts)||Ho.fonts;function Qu(r){const{fontFamily:e,fontStyle:t,fontWeight:i,fontStretch:s,fontSize:n}=r;return[t,i,s,`${n}px`,e].join(" ")}class Vo extends Gn{constructor(t){super(t);d(this,"canvas");d(this,"context");d(this,"fontFamilies",{});d(this,"fontFamilyArray",[this.fontFamilies]);d(this,"type","canvas");d(this,"loadFont",t=>{const i=Qu(t.props),s=this.stage.fontManager.resolveFontFace(this.fontFamilyArray,t.props,"canvas");if(I(s,`Could not resolve font face for ${i}`),t.fontInfo={fontFace:s,cssString:i,loaded:!1},!t.fontInfo.loaded){Wo.load(i).then(this.onFontLoaded.bind(this,t,i)).catch(this.onFontLoadError.bind(this,t,i));return}});typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(0,0):this.canvas=document.createElement("canvas");let i=this.canvas.getContext("2d",{willReadFrequently:!0});i||(this.canvas=document.createElement("canvas"),i=this.canvas.getContext("2d",{willReadFrequently:!0})),I(i),this.context=i,this.addFontFace(new qs({fontFamily:"sans-serif",descriptors:{},fontUrl:""}))}getPropertySetters(){return{fontFamily:(t,i)=>{t.props.fontFamily=i,t.fontInfo=void 0,this.invalidateLayoutCache(t)},fontWeight:(t,i)=>{t.props.fontWeight=i,t.fontInfo=void 0,this.invalidateLayoutCache(t)},fontStyle:(t,i)=>{t.props.fontStyle=i,t.fontInfo=void 0,this.invalidateLayoutCache(t)},fontStretch:(t,i)=>{t.props.fontStretch=i,t.fontInfo=void 0,this.invalidateLayoutCache(t)},fontSize:(t,i)=>{t.props.fontSize=i,t.fontInfo=void 0,this.invalidateLayoutCache(t)},text:(t,i)=>{t.props.text=i,this.invalidateLayoutCache(t)},textAlign:(t,i)=>{t.props.textAlign=i,this.invalidateLayoutCache(t)},color:(t,i)=>{t.props.color=i,this.invalidateLayoutCache(t)},x:(t,i)=>{t.props.x=i},y:(t,i)=>{t.props.y=i},contain:(t,i)=>{t.props.contain=i,this.invalidateLayoutCache(t)},width:(t,i)=>{t.props.width=i,t.props.contain!=="none"&&this.invalidateLayoutCache(t)},height:(t,i)=>{t.props.height=i,t.props.contain==="both"&&this.invalidateLayoutCache(t)},offsetY:(t,i)=>{t.props.offsetY=i,this.invalidateLayoutCache(t)},scrollY:(t,i)=>{t.props.scrollY=i},letterSpacing:(t,i)=>{t.props.letterSpacing=i,this.invalidateLayoutCache(t)},lineHeight:(t,i)=>{t.props.lineHeight=i,this.invalidateLayoutCache(t)},maxLines:(t,i)=>{t.props.maxLines=i,this.invalidateLayoutCache(t)},textBaseline:(t,i)=>{t.props.textBaseline=i,this.invalidateLayoutCache(t)},verticalAlign:(t,i)=>{t.props.verticalAlign=i,this.invalidateLayoutCache(t)},overflowSuffix:(t,i)=>{t.props.overflowSuffix=i,this.invalidateLayoutCache(t)}}}canRenderFont(t){return!0}isFontFaceSupported(t){return t instanceof qs}addFontFace(t){I(t instanceof qs);const i=t.fontFamily;i!=="sans-serif"&&Wo.add(t.fontFace);let s=this.fontFamilies[i];s||(s=new Set,this.fontFamilies[i]=s),s.add(t)}createState(t,i){return{node:i,props:t,status:"initialState",updateScheduled:!1,emitter:new ht,textureNode:void 0,lightning2TextRenderer:new Zu(this.canvas,this.context),renderInfo:void 0,forceFullLayoutCalc:!1,textW:0,textH:0,fontInfo:void 0,isRenderable:!1,debugData:{updateCount:0,layoutCount:0,drawCount:0,lastLayoutNumCharacters:0,layoutSum:0,drawSum:0,bufferSize:0}}}updateState(t){if(t.status==="initialState"&&this.setStatus(t,"loading"),t.status!=="loaded"){if(!t.fontInfo)return this.loadFont(t);t.fontInfo.loaded&&(t.renderInfo||(t.renderInfo=this.calculateRenderInfo(t),t.textH=t.renderInfo.lineHeight*t.renderInfo.lines.length,t.textW=t.renderInfo.width,this.renderSingleCanvasPage(t)))}}renderSingleCanvasPage(t){I(t.renderInfo);const i=t.node,s=this.stage.txManager.createTexture("ImageTexture",{premultiplyAlpha:!0,src:(function(n,o){return I(o),n.draw(o,{lines:o.lines,lineWidths:o.lineWidths}),this.canvas.width===0||this.canvas.height===0?null:this.context.getImageData(0,0,this.canvas.width,this.canvas.height)}).bind(this,t.lightning2TextRenderer,t.renderInfo)});if(t.textureNode)t.textureNode.texture=s,t.textureNode.alpha=Mo(t.props.color);else{const n=this.stage.createNode({parent:i,texture:s,autosize:!0,alpha:Mo(t.props.color)});t.textureNode=n}this.setStatus(t,"loaded")}calculateRenderInfo(t){var i;return t.lightning2TextRenderer.settings={text:t.props.text,textAlign:t.props.textAlign,fontFamily:t.props.fontFamily,trFontFace:(i=t.fontInfo)==null?void 0:i.fontFace,fontSize:t.props.fontSize,fontStyle:[t.props.fontStretch,t.props.fontStyle,t.props.fontWeight].join(" "),textColor:is(t.props.color),offsetY:t.props.offsetY,wordWrap:t.props.contain!=="none",wordWrapWidth:t.props.contain==="none"?void 0:t.props.width,letterSpacing:t.props.letterSpacing,lineHeight:t.props.lineHeight??null,maxLines:t.props.maxLines,maxHeight:t.props.contain==="both"?t.props.height-t.props.offsetY:null,textBaseline:t.props.textBaseline,verticalAlign:t.props.verticalAlign,overflowSuffix:t.props.overflowSuffix,w:t.props.contain!=="none"?t.props.width:void 0},t.renderInfo=t.lightning2TextRenderer.calculateRenderInfo(),t.renderInfo}renderQuads(){}destroyState(t){t.status!=="destroyed"&&(super.destroyState(t),t.textureNode&&(t.textureNode.destroy(),delete t.textureNode),delete t.renderInfo)}invalidateLayoutCache(t){t.renderInfo=void 0,this.setStatus(t,"loading"),this.scheduleUpdateState(t)}onFontLoaded(t,i){var s;i!==((s=t.fontInfo)==null?void 0:s.cssString)||!t.fontInfo||(t.fontInfo.loaded=!0,this.scheduleUpdateState(t))}onFontLoadError(t,i,s){var n;i!==((n=t.fontInfo)==null?void 0:n.cssString)||!t.fontInfo||(t.fontInfo.loaded=!0,console.error(`CanvasTextRenderer: Error loading font '${t.fontInfo.cssString}'`,s),this.scheduleUpdateState(t))}}const Da={isWhite:!0,a:1,r:255,g:255,b:255};function tn(r){if(r===4294967295)return Da;const e=(r>>>24&255)/255,t=r>>>16&255&255,i=r>>>8&255&255,s=r&255&255;return{isWhite:!1,a:e,r:s,g:i,b:t}}function Na(r){if(r===4294967295)return Da;const e=r>>>24&255,t=r>>>16&255&255,i=r>>>8&255&255,s=(r&255&255)/255;return{isWhite:!1,r:e,g:t,b:i,a:s}}function Si({a:r,r:e,g:t,b:i}){return`rgba(${e},${t},${i},${r})`}class Ju extends Fa{constructor(){super(...arguments);d(this,"image");d(this,"tintCache")}load(){this.textureSource.setState("loading"),this.onLoadRequest().then(t=>{this.textureSource.setState("loaded",t),this.textureSource.freeTextureData(),this.updateMemSize()}).catch(t=>{this.textureSource.setState("failed",t),this.textureSource.freeTextureData()})}free(){this.image=void 0,this.tintCache=void 0,this.textureSource.setState("freed"),this.setTextureMemUse(0),this.textureSource.freeTextureData()}updateMemSize(){const t=this.tintCache?8:4;if(this.textureSource.dimensions){const{width:i,height:s}=this.textureSource.dimensions;this.setTextureMemUse(i*s*t)}}hasImage(){return this.image!==void 0}getImage(t){var o;const i=this.image;if(I(i,"Attempt to get unloaded image texture"),t.isWhite)return this.tintCache&&(this.tintCache=void 0,this.updateMemSize()),i;const s=Si(t);if(((o=this.tintCache)==null?void 0:o.key)===s)return this.tintCache.image;const n=this.tintTexture(i,s);return this.tintCache={key:s,image:n},this.updateMemSize(),n}tintTexture(t,i){const{width:s,height:n}=t,o=document.createElement("canvas");o.width=s,o.height=n;const a=o.getContext("2d");return a&&(a.fillStyle=i,a.globalCompositeOperation="copy",a.fillRect(0,0,s,n),a.globalCompositeOperation="multiply",a.drawImage(t,0,0,s,n,0,0,s,n),a.globalCompositeOperation="destination-in",a.drawImage(t,0,0,s,n,0,0,s,n)),o}async onLoadRequest(){var i,s;I((s=(i=this.textureSource)==null?void 0:i.textureData)==null?void 0:s.data,"Texture data is null");const{data:t}=this.textureSource.textureData;if(t instanceof ImageData){const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const o=n.getContext("2d");return o&&o.putImageData(t,0,0),this.image=n,{width:t.width,height:t.height}}else if(typeof ImageBitmap<"u"&&t instanceof ImageBitmap||t instanceof HTMLImageElement)return this.image=t,{width:t.width,height:t.height};return{width:0,height:0}}}function ec(r){var e,t;if(r.shader instanceof Pr){const i=r.shader.shType;if(i===mu)return((e=r.shaderProps)==null?void 0:e.radius)??0;if(i==="DynamicShader"){const s=(t=r.shaderProps)==null?void 0:t.effects;if(s){const n=s.find(o=>{var a;return o.type==="radius"&&((a=o==null?void 0:o.props)==null?void 0:a.radius)});return n&&n.type==="radius"&&n.props.radius||0}}}return 0}function Ui(r,e=""){var t;if(r.shader instanceof Pr&&r.shader.shType==="DynamicShader"){const s=(t=r.shaderProps)==null?void 0:t.effects;if(s&&s.length){const n=s.find(o=>o.type===`border${e}`&&o.props&&o.props.width);return n&&n.props}}}function Xo(r,e,t,i,s){if(Object.getPrototypeOf(this).roundRect)this.roundRect(r,e,t,i,s);else{const o=l=>{const h=Math.min(t/2,i/2),u=l.topLeft+l.topRight+l.bottomRight+l.bottomLeft;if(u>t||u>i){const f=h/Math.max(l.topLeft,l.topRight,l.bottomRight,l.bottomLeft);l.topLeft*=f,l.topRight*=f,l.bottomRight*=f,l.bottomLeft*=f}},a=typeof s=="number"?{topLeft:s,topRight:s,bottomRight:s,bottomLeft:s}:{topLeft:0,topRight:0,bottomRight:0,bottomLeft:0,...s};o(a),this.moveTo(r+a.topLeft,e),this.lineTo(r+t-a.topRight,e),this.ellipse(r+t-a.topRight,e+a.topRight,a.topRight,a.topRight,0,1.5*Math.PI,2*Math.PI),this.lineTo(r+t,e+i-a.bottomRight),this.ellipse(r+t-a.bottomRight,e+i-a.bottomRight,a.bottomRight,a.bottomRight,0,0,.5*Math.PI),this.lineTo(r+a.bottomLeft,e+i),this.ellipse(r+a.bottomLeft,e+i-a.bottomLeft,a.bottomLeft,a.bottomLeft,0,.5*Math.PI,Math.PI),this.lineTo(r,e+a.topLeft),this.ellipse(r+a.topLeft,e+a.topLeft,a.topLeft,a.topLeft,0,Math.PI,1.5*Math.PI)}}function ks(r,e,t,i,s,n=0,o,a){if(!n)return;let l,h=0,u,f=0;switch(a){case"Top":l=e,h=t,u=i+e,f=t;break;case"Right":l=e+i,h=t,u=e+i,f=t+s;break;case"Bottom":l=e,h=t+s,u=e+i,f=t+s;break;case"Left":l=e,h=t,u=e,f=t+s;break}r.beginPath(),r.lineWidth=n,r.strokeStyle=Si(Na(o??0)),r.moveTo(l,h),r.lineTo(u,f),r.stroke()}class tc extends Oa{constructor(t){super(t);d(this,"context");d(this,"canvas");d(this,"pixelRatio");d(this,"clearColor");d(this,"renderToTextureActive",!1);d(this,"activeRttNode",null);d(this,"defShaderCtr");this.mode="canvas",this.shManager.renderer=this;const{canvas:i,pixelRatio:s,clearColor:n}=t;this.canvas=i,this.context=i.getContext("2d"),this.pixelRatio=s,this.clearColor=n?Io(n):void 0,this.defShaderCtr={type:"DefaultShader",props:{},shader:new Pr("DefaultShader"),getResolvedProps:()=>()=>({})}}reset(){this.canvas.width=this.canvas.width;const t=this.context;if(this.clearColor){const[i,s,n,o]=this.clearColor;t.fillStyle=`rgba(${i}, ${s}, ${n}, ${o/255})`,t.fillRect(0,0,this.canvas.width,this.canvas.height)}t.scale(this.pixelRatio,this.pixelRatio)}render(){}addQuad(t){const i=this.context,{tx:s,ty:n,width:o,height:a,alpha:l,colorTl:h,colorTr:u,colorBr:f,ta:c,tb:p,tc:_,td:g,clippingRect:x}=t;let m=t.texture,T,b;const S=m==null?void 0:m.type;if(I(S,"Texture type is not defined"),S!==ie.image&&S!==ie.color&&S!==ie.subTexture&&S!==ie.noise||m&&(m instanceof Zi&&(b=m.props,m=m.parentTexture),T=m.ctxTexture,m.state==="freed"||m.state!=="loaded"))return;const R=tn(h),A=c!==1,L=x.width!==0&&x.height!==0,E=h!==u||h!==f,U=!!t.shader,z=U?ec(t):0,k=U?Ui(t):void 0;if((A||L||z)&&i.save(),L){const O=new Path2D,{x:B,y:$,width:P,height:C}=x;O.rect(B,$,P,C),i.clip(O)}if(A){const O=this.pixelRatio;i.setTransform(c,_,p,g,s*O,n*O),i.scale(O,O),i.translate(-s,-n)}if(z){const O=new Path2D;Xo.call(O,s,n,o,a,z),i.clip(O)}if((S===ie.image||S===ie.subTexture||S===ie.noise)&&T){const O=T.getImage(R);if(i.globalAlpha=R.a??l,b)i.drawImage(O,b.x,b.y,b.width,b.height,s,n,o,a);else try{i.drawImage(O,s,n,o,a)}catch{}i.globalAlpha=1}else if(S===ie.color&&E){let O=s,B=n,$;h===u?(O=s,B=n+a,$=tn(f)):(O=s+o,B=n,$=tn(u));const P=i.createLinearGradient(s,n,O,B);P.addColorStop(0,Si(R)),P.addColorStop(1,Si($)),i.fillStyle=P,i.fillRect(s,n,o,a)}else S===ie.color&&(i.fillStyle=Si(R),i.fillRect(s,n,o,a));if(k&&k.width){const O=k.width,B=k.width/2,$=Si(Na(k.color??0));i.beginPath(),i.lineWidth=O,i.strokeStyle=$,i.globalAlpha=l,z?(Xo.call(i,s+B,n+B,o-O,a-O,z),i.stroke()):i.strokeRect(s+B,n+B,o-O,a-O),i.globalAlpha=1}else if(U){const O=Ui(t,"Top"),B=Ui(t,"Right"),$=Ui(t,"Bottom"),P=Ui(t,"Left");O&&ks(i,s,n,o,a,O.width,O.color,"Top"),B&&ks(i,s,n,o,a,B.width,B.color,"Right"),$&&ks(i,s,n,o,a,$.width,$.color,"Bottom"),P&&ks(i,s,n,o,a,P.width,P.color,"Left")}(A||L||z)&&i.restore()}createCtxTexture(t){return new Ju(this.txMemManager,t)}getShaderManager(){return this.shManager}getDefShaderCtr(){return this.defShaderCtr}renderRTTNodes(){}removeRTTNode(t){}renderToTexture(t){}getBufferInfo(){return null}getQuadCount(){return null}updateClearColor(t){this.clearColor=t?Io(t):void 0}}const $i={alpha:r=>r===1?null:{prop:"opacity",value:`${r}`},x:r=>({prop:"left",value:`${r}px`}),y:r=>({prop:"top",value:`${r}px`}),width:r=>r===0?null:{prop:"width",value:`${r}px`},height:r=>r===0?null:{prop:"height",value:`${r}px`},fontSize:r=>r===0?null:{prop:"font-size",value:`${r}px`},lineHeight:r=>r===0?null:{prop:"line-height",value:`${r}px`},zIndex:()=>"z-index",fontFamily:()=>"font-family",fontStyle:()=>"font-style",fontWeight:()=>"font-weight",fontStretch:()=>"font-stretch",letterSpacing:()=>"letter-spacing",textAlign:()=>"text-align",overflowSuffix:()=>"overflow-suffix",maxLines:()=>"max-lines",contain:()=>"contain",verticalAlign:()=>"vertical-align",clipping:r=>r===!1?null:{prop:"overflow",value:r?"hidden":"visible"},rotation:r=>r===0?null:{prop:"transform",value:`rotate(${r}rad)`},scale:r=>r===1?null:{prop:"transform",value:`scale(${r})`},scaleX:r=>r===1?null:{prop:"transform",value:`scaleX(${r})`},scaleY:r=>r===1?null:{prop:"transform",value:`scaleY(${r})`},color:r=>r===0?null:{prop:"color",value:$a(r)}},$a=r=>{const e=(r&255)/255,t=r>>8&255,i=r>>16&255;return`rgba(${r>>24&255},${i},${t},${e})`},wn={id:"test-id"},ic=new Set([...Object.keys($i),...Object.keys(wn),"src","parent","data"]);class sc{constructor(e,t){d(this,"root",null);d(this,"canvas",null);d(this,"height",1080);d(this,"width",1920);d(this,"scaleX",1);d(this,"scaleY",1);if(Pi())return;if(!t)throw new Error("settings is required");this.height=Math.ceil(t.appHeight??1080/(t.deviceLogicalPixelRatio??1)),this.width=Math.ceil(t.appWidth??1920/(t.deviceLogicalPixelRatio??1)),this.scaleX=t.deviceLogicalPixelRatio??1,this.scaleY=t.deviceLogicalPixelRatio??1,this.canvas=e,this.root=document.createElement("div"),this.setRootPosition(),document.body.appendChild(this.root),new MutationObserver(this.setRootPosition.bind(this)).observe(e,{attributes:!0,childList:!1,subtree:!1}),new ResizeObserver(this.setRootPosition.bind(this)).observe(e),window.addEventListener("resize",this.setRootPosition.bind(this)),console.warn("Inspector is enabled, this will impact performance")}setRootPosition(){if(this.root===null||this.canvas===null)return;const e=this.canvas.getBoundingClientRect(),t=document.documentElement.scrollTop+e.top,i=document.documentElement.scrollLeft+e.left;this.root.id="root",this.root.style.left=`${i}px`,this.root.style.top=`${t}px`,this.root.style.width=`${this.width}px`,this.root.style.height=`${this.height}px`,this.root.style.position="absolute",this.root.style.transformOrigin="0 0 0",this.root.style.transform=`scale(${this.scaleX}, ${this.scaleY})`,this.root.style.overflow="hidden",this.root.style.zIndex="65534"}createDiv(e,t){const i=document.createElement("div");i.style.position="absolute",i.id=e.toString();for(const s in t)this.updateNodeProperty(i,s,t[s],t);return i}createNode(e){const t=this.createDiv(e.id,e.props);return t.node=e,e.div=t,e.on("inViewport",()=>t.setAttribute("state","inViewport")),e.on("inBounds",()=>t.setAttribute("state","inBounds")),e.on("outOfBounds",()=>t.setAttribute("state","outOfBounds")),this.createProxy(e,t)}createTextNode(e){const t=this.createDiv(e.id,e.props);return t.node=e,e.div=t,this.createProxy(e,t)}createProxy(e,t){ic.forEach(n=>{let o=Object.getOwnPropertyDescriptor(e,n);if(o===void 0){const a=Object.getPrototypeOf(e);o=Object.getOwnPropertyDescriptor(a,n)}o!==void 0&&Object.defineProperty(e,n,{get(){var a;return(a=o==null?void 0:o.get)==null?void 0:a.call(e)},set:a=>{var l;(l=o==null?void 0:o.set)==null||l.call(e,a),this.updateNodeProperty(t,n,a,e.props)},configurable:!0,enumerable:!0})});const i=e.destroy;Object.defineProperty(e,"destroy",{value:()=>{this.destroyNode(e.id),i.call(e)}});const s=e.animate;return Object.defineProperty(e,"animate",{value:(n,o)=>{const a=s.call(e,n,o),l=a.start.bind(a);return a.start=()=>(this.animateNode(t,n,o),l()),a}}),e}destroyNode(e){const t=document.getElementById(e.toString());t==null||t.remove()}updateNodeProperty(e,t,i,s){var n;if(!(this.root===null||i===void 0||i===null)){if(t==="parent"){const o=i.id;if(o===1){this.root.appendChild(e);return}const a=document.getElementById(o.toString());a==null||a.appendChild(e);return}if(t==="text"){e.innerHTML=String(i),e.style.visibility="hidden";return}if(t==="src"&&i){e.setAttribute("data-src",String(i));return}if(t==="rtt"&&i){e.setAttribute("data-rtt",String(i));return}if($i[t]){const o=(n=$i[t])==null?void 0:n.call($i,i);if(o===null)return;if(typeof o=="string"){e.style.setProperty(o,String(i));return}if(typeof o=="object"){let a=o.value;if(t==="x"){const l=s.mountX,h=s.width;l&&(a=`${parseInt(a)-h*l}px`)}else if(t==="y"){const l=s.mountY,h=s.height;l&&(a=`${parseInt(a)-h*l}px`)}e.style.setProperty(o.prop,a)}return}if(wn[t]){const o=wn[t];if(!o)return;e.setAttribute(String(o),String(i));return}if(t==="data"){for(const o in i){const a=i[o];a===void 0?e.removeAttribute(`data-${o}`):e.setAttribute(`data-${o}`,String(a))}return}}}animateNode(e,t,i){const{duration:s=1e3,delay:n=0}=i,{x:o,y:a,width:l,height:h,alpha:u=1,rotation:f=0,scale:c=1,color:p,mountX:_,mountY:g}=t;function x(){setTimeout(()=>{e.style.top=`${a-h*g}px`,e.style.left=`${o-l*_}px`,e.style.width=`${l}px`,e.style.height=`${h}px`,e.style.opacity=`${u}`,e.style.rotate=`${f}rad`,e.style.scale=`${c}`,e.style.color=$a(p)},s)}setTimeout(x,n)}}const Ha=50,Go={hd:.66666667,"720p":.66666667,720:.66666667,fhd:1,fullhd:1,"1080p":1,1080:1,"4k":2,"2160p":2,2160:2},rc={low:.66666667,medium:.85,high:1,retina:2},nc=()=>{const r=Be.stage;Me.get("fonts",[]).forEach(e=>{e.type==="sdf"||e.type==="msdf"?(!e.png&&e.file&&(e.png=e.file.replace(/\.[^.]+$/,`.${e.type}.png`)),!e.json&&e.file&&(e.json=e.file.replace(/\.[^.]+$/,`.${e.type}.json`)),r.fontManager.addFontFace(new vn(e.type,{fontFamily:e.family,descriptors:{},atlasUrl:e.png,atlasDataUrl:e.json,stage:r,metrics:e.metrics}))):e.type==="web"&&r.fontManager.addFontFace(new qs({fontFamily:e.family,fontUrl:e.file,descriptors:{},metrics:e.metrics}))})},oc=()=>{const r=Be.stage;Me.get("shaders",[]).forEach(e=>{r.shManager.registerShaderType(e.name,e.type)}),Me.get("effects",[]).forEach(e=>{r.shManager.registerShaderType(e.name,e.type)})};let Be=null;const ac=r=>{const e="renderMode"in r?r.renderMode:"webgl";if(e==="webgl")return Yn;if(e==="canvas")return tc},lc=r=>{const e="renderMode"in r?r.renderMode:"webgl";if(e==="webgl")return[Ku,Vo];if(e==="canvas")return[Vo]},hc=r=>{const e={max:200,target:.8,cleanupInterval:5e3,baseline:25,strict:!1,..."gpuMemory"in r?r.gpuMemory:{}};return{criticalThreshold:e.max*1024*1024,targetThresholdLevel:e.target,cleanupInterval:e.cleanupInterval,baselineMemoryAllocation:e.baseline*1024*1024,doNotExceedCriticalThreshold:e.strict}},uc=(r,e,t={})=>{Be=new Eu({appWidth:t.w||1920,appHeight:t.h||1080,fpsUpdateInterval:t.fpsInterval||1e3,devicePhysicalPixelRatio:rc[t.renderQuality]||t.renderQuality||1,deviceLogicalPixelRatio:t.pixelRatio||Go[t.screenResolution]||Go[window.innerHeight]||1,numImageWorkers:"webWorkersLimit"in t?t.webWorkersLimit:window.navigator.hardwareConcurrency||2,clearColor:t.canvasColor&&wi.normalize(t.canvasColor)||0,inspector:t.inspector===!0?sc:void 0,boundsMargin:t.viewportMargin||0,renderEngine:ac(t),fontEngines:lc(t),canvas:t.canvas,textureProcessingTimeLimit:t.textureProcessingTimeLimit,textureMemory:hc(t),createImageBitmapSupport:"auto",...t.advanced||{}},e);const i=()=>{let s=r();s.quit=()=>{J.info("Closing App"),s.destroy(),s=null,Be=null}};return oc(),nc(),i(),Be};let cc=0;const fc=(r,e)=>{if(r===void 0)return{start:0,end:0,oppositeStart:0,oppositeEnd:0};if(typeof r=="number")return{start:r,end:r,oppositeStart:r,oppositeEnd:r};if(Ct(r)===!0&&(r=Rt(r)),typeof r=="object"){const{top:t=void 0,right:i=void 0,bottom:s=void 0,left:n=void 0,x:o=0,y:a=0}=r;return e==="vertical"?{start:t!==void 0?t:a,end:s!==void 0?s:a,oppositeStart:n!==void 0?n:o,oppositeEnd:i!==void 0?i:o}:{start:n!==void 0?n:o,end:i!==void 0?i:o,oppositeStart:t!==void 0?t:a,oppositeEnd:s!==void 0?s:a}}return{start:0,end:0,oppositeStart:0,oppositeEnd:0}},dc=function(r){const e=r.direction==="vertical"?"y":"x",t=r.direction==="vertical"?"x":"y",i=r.direction==="vertical"?"mountX":"mountY",s=r.direction==="vertical"?"height":"width",n=r.direction==="vertical"?"width":"height",o=fc(r.padding,r.direction);let a=o.start;const l=this.node.children,h=l.length;let u=0;const f=r.gap||0;for(let p=0;p<h;p++){if(this.children[p]!==void 0&&this.children[p].props.raw.show===!1)continue;const _=l[p];_[e]=a,_[t]=o.oppositeStart,s==="width"?a+=_.width+(_.width!==("text"in _?1:0)?f:0):a+="text"in _?_.width>1?_.height+f:0:_.height!==0?_.height+f:0,u=Math.max(u,_[n]+o.oppositeStart+o.oppositeEnd)}this.node[s]=a-f+o.end,this.node[n]=u;const c={start:0,end:1,center:.5}[r["align-items"]||"start"];if(c!==0)for(let p=0;p<h;p++){const _=l[p];_[t]=u*c,_[i]=c}r["@updated"]!==void 0&&r["@updated"]({w:this.node.width,h:this.node.height},this),this.config.parent&&this.config.parent.props.__layout===!0&&this.config.parent.triggerLayout(this.config.parent.props)},Yo=r=>r!==null&&typeof r=="object"&&"transition"in r,Ct=r=>typeof r=="string"&&r.startsWith("{")&&r.endsWith("}"),Rt=r=>JSON.parse(r.replace(/'/g,'"').replace(/([\w-_]+)\s*:/g,'"$1":')),ni=function(r,e){return typeof r!="string"?r:r.indexOf("%")===r.length-1?this.element.config.parent&&(this.element.config.parent.node[e]||0)*(parseFloat(r)/100)||0:r},Cn=r=>{if(typeof r!="object"||r===null)return r;if(r.constructor===Object){if("value"in r)return r.value;if("transition"in r)return Cn(r.transition)}return r},pc={top:"colorTop",bottom:"colorBottom",left:"colorLeft",right:"colorRight"};let Rn=null;const gc={set parent(r){this.props.parent=r==="root"?Be.root:r.node},set rotation(r){this.props.rotation=r*(Math.PI/180)},set w(r){this.props.width=ni.call(this,r,"width")},set width(r){this.props.width=ni.call(this,r,"width")},set h(r){this.props.height=ni.call(this,r,"height")},set height(r){this.props.height=ni.call(this,r,"height")},set x(r){this.props.x=ni.call(this,r,"width")},set y(r){this.props.y=ni.call(this,r,"height")},set z(r){this.props.zIndex=r},set zIndex(r){this.props.zIndex=r},set color(r){typeof r=="string"&&r.startsWith("{")===!1?this.props.color=wi.normalize(r):(typeof r=="object"||Ct(r)===!0&&(r=Rt(r)))&&(this.props.color=0,Object.entries(r).forEach(e=>{this.props[pc[e[0]]]=wi.normalize(e[1])}))},set src(r){this.props.src=r,this.raw.color===void 0&&(this.props.color=this.props.src?4294967295:0),!("w"in this.raw)&&!("w"in this.raw)&&!("h"in this.raw)&&!("height"in this.raw)&&(this.props.autosize=!0)},set texture(r){this.props.texture=r,this.raw.color===void 0&&r==null?this.props.color=0:this.raw.color===void 0&&(this.props.color=4294967295)},set fit(r){const e={};if(r==="cover"||r==="contain"){this.props.textureOptions={resizeMode:{type:r}};return}(typeof r=="object"||Ct(r)===!0&&(r=Rt(r)))&&(e.type=r.type||"cover",typeof r.position=="number"&&(e.clipY=e.clipX=r.position),typeof r.position=="object"&&(e.clipX="x"in r.position?r.position.x:null,e.clipY="y"in r.position?r.position.y:null),this.props.textureOptions={resizeMode:e})},set rtt(r){this.props.rtt=r,this.raw.color===void 0&&(this.props.color=r===!0?4294967295:0)},set mount(r){typeof r=="object"||Ct(r)===!0&&(r=Rt(r))?("x"in r&&(this.props.mountX=r.x),"y"in r&&(this.props.mountY=r.y)):(this.props.mountX=r,this.props.mountY=r)},set pivot(r){typeof r=="object"||Ct(r)===!0&&(r=Rt(r))?("x"in r&&(this.props.pivotX=r.x),"y"in r&&(this.props.pivotY=r.y)):(this.props.pivotX=r,this.props.pivotY=r)},set scale(r){typeof r=="object"||Ct(r)===!0&&(r=Rt(r))?("x"in r&&(this.props.scaleX=r.x),"y"in r&&(this.props.scaleY=r.y)):this.props.scale=r},set show(r){r?this.props.alpha=this.raw.alpha!==void 0?this.raw.alpha:1:this.props.alpha=0},set alpha(r){(this.raw.show===void 0||this.raw.show==!0)&&(this.props.alpha=r)},set shader(r){r!==null?this.props.shader=Be.createShader(r.type,r.props):this.props.shader=Be.createShader("DefaultShader")},set effects(r){for(let e=0;e<r.length;e++)r[e].props&&r[e].props.color&&(r[e].props.color=wi.normalize(r[e].props.color));this.element.node===void 0&&(this.props.shader=Be.createShader("DynamicShader",{effects:r.map(e=>Be.createEffect(e.type,e.props))}))},set clipping(r){this.props.clipping=r},set overflow(r){this.props.clipping=!r},set font(r){this.props.fontFamily=r},set size(r){this.props.fontSize=r},set wordwrap(r){J.warn("The wordwrap attribute is deprecated, use maxwidth instead"),this.props.width=r,this.props.contain="width"},set maxwidth(r){this.props.width=r,this.props.contain="width"},set maxheight(r){this.props.height=r,this.props.contain="both"},set contain(r){this.props.contain=r},set maxlines(r){this.props.maxLines=r},set textoverflow(r){this.props.overflowSuffix=r===!1?" ":r===!0?void 0:r},set letterspacing(r){this.props.letterSpacing=r||1},set lineheight(r){this.props.lineHeight=r},set align(r){this.props.textAlign=r},set content(r){this.props.text=""+r},set placement(r){let e,t;typeof r=="object"||Ct(r)===!0&&(r=Rt(r))?("x"in r&&(e=r.x),"y"in r&&(t=r.y)):r==="center"||r==="right"?e=r:t=r,e==="center"?(this.x="50%",this.props.mountX=.5):e==="right"&&(this.x="100%",this.props.mountX=1),t==="middle"?(this.y="50%",this.props.mountY=.5):t==="bottom"&&(this.y="100%",this.props.mountY=1)},set"inspector-data"(r){(typeof r=="object"||Ct(r)===!0&&(r=Rt(r)))&&(this.props.data=r)}},_c={populate(r){const e=r;e.node=this.config.node,e[y.isSlot]===!0&&(this[y.isSlot]=!0),this.props.element=this,this.props.parent=e.parent||this.config.parent,delete e.parent,this.props.raw=r;const t=Object.keys(e),i=t.length;for(let s=0;s<i;s++){const n=t[s],o=e[n];o!==void 0&&(this.props[n]=Cn(o))}this.props.props.color===void 0&&!("__textnode"in e)&&(this.props.props.color=0),this.node=e.__textnode?Be.createTextNode({...Rn,...this.props.props}):Be.createNode(this.props.props),e["@loaded"]!==void 0&&typeof e["@loaded"]=="function"&&this.node.on("loaded",(s,{type:n,dimensions:o})=>{e["@loaded"]({w:o.width,h:o.height,type:n},this)}),e["@error"]!==void 0&&typeof e["@error"]=="function"&&this.node.on("failed",(s,n)=>{e["@error"](n,this)}),e.__layout===!0&&(this.triggerLayout=dc.bind(this)),this.config.parent.props!==void 0&&this.config.parent.props.__layout===!0&&(this.config.parent.triggerLayout(this.config.parent.props),this.node.on("loaded",()=>{this.config.parent.triggerLayout(this.config.parent.props)}))},set(r,e){if(e===void 0||this.props.raw[r]===e)return;this.props.raw[r]=e,this.props.props={},this.props[r]=Cn(e);const t=Object.keys(this.props.props);if(t.length===1){if(Yo(e)===!0)return this.animate(t[0],this.props.props[t[0]],e.transition);this.node[t[0]]=this.props.props[t[0]]}else for(let i=0;i<t.length;i++){if(Yo(e)===!0)return this.animate(t[i],this.props.props[t[i]],e.transition);this.node[t[i]]=this.props.props[t[i]]}this.config.parent.props&&this.config.parent.props.__layout===!0&&this.config.parent.triggerLayout(this.config.parent.props)},animate(r,e,t){if(this.scheduledTransitions[r]!==void 0&&this.scheduledTransitions[r].f.state==="scheduled"&&this.scheduledTransitions[r].f.stop(),this.node[r]===e)return;const i={};i[r]=e;const s=this.node.animate(i,{duration:typeof t=="object"&&"duration"in t?t.duration:300,easing:typeof t=="object"&&"easing"in t?t.easing:"ease",delay:typeof t=="object"&&"delay"in t?t.delay:0}),n=this.node[r];if(this.scheduledTransitions[r]={v:i[r],f:s},t.start!==void 0&&typeof t.start=="function"&&s.once("animating",()=>{t.start.call(this.component,this,r,n)}),this.config.parent.props&&this.config.parent.props.__layout===!0&&s.on("tick",()=>{this.config.parent.triggerLayout(this.config.parent.props)}),t.progress!==void 0&&typeof t.progress=="function"){let o=0;s.on("tick",(a,{progress:l})=>{t.progress.call(this.component,this,r,l,o),o=l})}s.once("stopped",()=>{this.scheduledTransitions[r]!==void 0&&this.scheduledTransitions[r].canceled===!0||(this.node!==void 0&&t.end&&typeof t.end=="function"&&t.end.call(this.component,this,r,this.node[r]),delete this.scheduledTransitions[r])}),s.start()},destroy(){if(this.node===null)return;J.debug("Deleting Node",this.nodeId);const r=Object.keys(this.scheduledTransitions);for(let e=0;e<r.length;e++){const t=this.scheduledTransitions[r[e]];t!==void 0&&(t.canceled=!0,t.f!==void 0&&t.f.stop())}this.scheduledTransitions={},this.component=null,delete this.component,this.config=null,delete this.config,this.counter=null,delete this.counter,this.props.raw={},this.props.element=null,this.props.props=null,this.props={},delete this.props,this.triggerLayout=null,delete this.triggerLayout,this.forComponent=null,delete this.forComponent,this.node.destroy(),this.node=null},get nodeId(){return this.node&&this.node.id},get ref(){return this.props.ref||null},get parent(){return this.node&&this.node.parent},get children(){return this.component[y.getChildren]().filter(r=>r.parent===(this[y.isSlot]?this.node.children[0]:this.node))}},mc=(r,e)=>(Rn===null&&(Rn={fontSize:32,fontFamily:Me.get("defaultFont","sans-serif")}),Object.assign(Object.create(_c),{props:Object.assign(Object.create(gc),{props:{}}),scheduledTransitions:{},config:r,component:e,counter:cc++})),jo={Element:mc,Launch:uc},xc="1.29.4",yc={"@lightningjs/renderer":"^2.13.4"},Wa={version:xc,dependencies:yc};let dr={};const jn={};async function Tc(){let r;try{if(r=await Ih(()=>import("./package-swobjhv6.js"),[]),r!==void 0)return r.version}catch{return Wa.dependencies["@lightningjs/renderer"]}}const Sc=(r,e,t)=>{Me.set(t),lh(),Tc().then(i=>{J.info("Blits Version ",Wa.version),J.info("Renderer Version ",i)}),jn.element=jo.Element,dr=jo.Launch(r,e,t)},bc={before:{prop:"alpha",value:0},in:{prop:"alpha",value:1,duration:200},out:{prop:"alpha",value:0,duration:100}},Zt=window.speechSynthesis,vc=/android/i.test((window.navigator||{}).userAgent||"");let Va=!1,pr=null;const Xa=()=>pr&&clearTimeout(pr),An=r=>{if(!r||pr)return Xa();Zt.pause(),Zt.resume(),pr=setTimeout(()=>{An(r)},5e3)},gi={lang:"en-US",pitch:1,rate:1,voice:null,volume:1},wc=()=>{gi.voice=Zt.getVoices()[0],Va=!0},Cc=r=>{const e=new SpeechSynthesisUtterance(r.message);return e.lang=r.lang||gi.lang,e.pitch=r.pitch||gi.pitch,e.rate=r.rate||gi.rate,e.voice=r.voice||gi.voice,e.volume=r.volume||gi.volume,vc===!1&&(e.onstart=()=>{An(e)},e.onresume=()=>{An(e)}),new Promise((t,i)=>{e.onend=()=>{t()},e.onerror=s=>{i(s)},Zt.speak(e)})},Kn={speak(r){return Zt!==void 0?(Va===!1&&wc(),Cc(r)):(J.error("speechSynthesis web API not available"),Promise.reject({error:"unavailable"}))},cancel(){Zt!==void 0&&(Zt.cancel(),Xa())}};let rs=!1,Rc=0;const It=[];let _i=!1,Hi=null,Ds=null;const Ga={then(){},done(){},cancel(){},stop(){}},Ac=()=>{rs=!0},Ec=()=>{rs=!1},Lc=r=>{rs=!!r},qn=(r,e="off")=>rs===!1?Ga:Ya(r,e),Pc=r=>rs===!1?Ga:Ya(void 0,void 0,r),Ya=(r,e,t=!1)=>{const i=Rc++;let s;const n=new Promise(o=>{s=o});return n.cancel=()=>{const o=It.findIndex(a=>a.id===i);o!==-1&&It.splice(o,1),s("canceled")},n.stop=()=>{i===Hi&&(Kn.cancel(),_i=!1,s("interupted"))},t===!1?e==="assertive"?It.unshift({message:r,resolveFn:s,id:i}):It.push({message:r,resolveFn:s,id:i}):It.push({delay:t,resolveFn:s,id:i}),setTimeout(()=>{Zs()},100),n},Zs=async()=>{if(_i===!0||It.length===0)return;_i=!0;const{message:r,resolveFn:e,delay:t,id:i}=It.shift();Hi=i,t?setTimeout(()=>{_i=!1,Hi=null,e("finished"),Zs()},t):(Ds!==null&&clearTimeout(Ds),Ds=setTimeout(()=>{Kn.speak({message:r}).then(()=>{_i=!1,Hi=null,e("finished"),Zs()}).catch(s=>{_i=!1,Hi=null,e(s.error),Zs()}),Ds=null},200))},Ic=r=>qn(r,"polite"),Mc=r=>qn(r,"assertive"),Fc=()=>{Kn.cancel()},Oc=()=>{It.length=0},Qs={speak:qn,polite:Ic,assertive:Mc,stop:Fc,enable:Ac,disable:Ec,toggle:Lc,clear:Oc,pause:Pc};let Mt;const st=pn({path:"",navigating:!1,data:null,params:null,hash:""},Me.get("reactivityMode"),!0),En=new Map,ja=[];let Ka={},qa={},Ai=!1,Za;const zc=()=>{const r=(document.location.hash||"/").replace(/^#/,"").split("?");return{path:r[0],queryParams:new URLSearchParams(r[1]),hash:document.location.hash}},Ko=r=>r.replace(/^\/+|\/+$/g,"").toLowerCase(),qo=r=>typeof r=="object"&&r!==null,Zo=r=>typeof r=="string",Qa=(r,e=[])=>{const t=r.replace(/^\/+|\/+$/g,"");r=Ko(r);let i=!1,s=0;for(;!i&&s<e.length;){const n=e[s];if(n.path=Ko(n.path),n.path===r)n.params={},i=n;else if(n.path.indexOf(":")>-1){const o=[...n.path.matchAll(/:([^\s/]+)/gi)];let a=n.path;o.reverse().forEach(h=>{a=a.substring(0,h.index)+"([^\\s/]+)"+a.substring(h.index+h[0].length)}),a="^"+a;const l=t.match(new RegExp(`${a}`,"i"));l&&(n.params=o.reverse().reduce((h,u,f)=>(h[u[1]]=l[f+1],h),{}),i=n)}else if(n.path.endsWith("*")){const o=new RegExp(n.path.replace(/\/?\*/,"/?([^\\s]*)"),"i"),a=r.match(o);a&&(a[1]&&(n.params={path:a[1]}),i=n)}s++}return i&&(i.options={...i.options,...Ka},i.data||(i.data={})),i},Uc=async function(){if(Qs.stop(),Qs.clear(),st.navigating=!0,this.parent[y.routes]){let r=Mt;const{hash:e,path:t,queryParams:i}=zc();let s=Qa(t,this.parent[y.routes]);if(e!==null&&(s.hash=e),Mt=s,s){let n;if(this.parent[y.routerHooks]){const c=this.parent[y.routerHooks];if(c.beforeEach&&(n=await c.beforeEach(s,r),Zo(n))){Qi(n);return}}s=qo(n)?n:s;let o;if(s.hooks&&s.hooks.before&&(o=await s.hooks.before.call(this.parent,s,r),Zo(o))){Mt=r,Qi(o);return}s=qo(o)?o:s,Ai===!1&&r&&r.options.inHistory===!0&&ja.push(r),"transition"in s||(s.transition=bc),typeof s.transition=="function"&&(s.transition=s.transition(r,s));let a,l,{view:h,focus:u}=En.get(s.hash)||{};if(s.announce&&(typeof s.announce=="string"&&(s.announce={message:s.announce}),Qs.speak(s.announce.message,s.announce.politeness)),h){a=h[y.holder];let c=!1;if(s.transition.before)if(Array.isArray(s.transition.before)){for(let p=0;p<s.transition.before.length;p++)if(s.transition.before[p].prop==="alpha"){c=!0;break}}else s.transition.before.prop==="alpha"&&(c=!0);c===!1&&a.set("alpha",1)}else{a=jn.element({parent:this[y.children][0]}),a.populate({}),a.set("w","100%"),a.set("h","100%");const c={},p=[...i.entries()];for(let g=0;g<p.length;g++)c[p[g][0]]=p[g][1];l={...qa,...s.data,...c};const _={...this[y.props],...s.params,...l};h=await s.component({props:_},a,this),h[Symbol.toStringTag]==="Module"&&(h.default&&typeof h.default=="function"?h=h.default({props:_},a,this):J.error("Dynamic import doesn't have a default export or default is not a function")),typeof h=="function"&&(h=h({props:_},a,this))}if(this[y.children].push(h),Za=bi.get(),u?u.$focus():h.$focus(),s.transition.before)if(Array.isArray(s.transition.before))for(let c=0;c<s.transition.before.length;c++)a.set(s.transition.before[c].prop,s.transition.before[c].value);else a.set(s.transition.before.prop,s.transition.before.value);let f=!1;if(r){f=!0;const c=this[y.children].splice(1,1).pop();c&&Bc(r,c,s.transition.out)}if(st.path=s.path,st.params=s.params,st.hash=e,st.data=l,s.transition.in)if(Array.isArray(s.transition.in))for(let c=0;c<s.transition.in.length;c++)c===s.transition.length-1?await Ei(a,s.transition.in[c],f):Ei(a,s.transition.in[c],f);else await Ei(a,s.transition.in,f);this.activeView=this[y.children][this[y.children].length-1]}else J.error(`Route ${e} not found`)}Ai=!1,st.navigating=!1},Bc=async(r,e,t)=>{if(t)if(Array.isArray(t))for(let i=0;i<t.length;i++)i===t.length-1?await Ei(e[y.holder],t[i]):Ei(e[y.holder],t[i]);else await Ei(e[y.holder],t);Ai===!1&&r.options&&r.options.keepAlive===!0?En.set(r.hash,{view:e,focus:Za}):Ai===!0&&En.delete(r.hash),r.options&&(r.options.keepAlive!==!0||Ai===!0)&&(e.destroy(),e=null)},Ei=(r,e,t=!0)=>new Promise(i=>{if(t===!0){let s=e.end;e.end=(...n)=>{s&&s(n),s=null,i()},r.set(e.prop,{transition:e})}else r.set(e.prop,e.value),i()}),Qi=(r,e={},t={})=>{qa=e,Ka=t,window.location.hash=r},Ja=function(){const r=ja.pop();if(r&&Mt!==r)return Ai=!0,Qi(r.hash,r.data,r.options),!0;const e=Mt&&Mt.options.backtrack||!1;if(e===!1)return!1;const t=/(\/:?[\w%\s-]+)$/;let i=Mt.path,s=i.split("/").length;if(s<=1)return!1;for(;s--;){if(!t.test(i))return!1;i=i.replace(t,"");const n=Qa(i,this.parent[y.routes]);if(n&&e)return Qi(n.path),!0}return!1},sn={navigate:Uc,back:Ja};let Je=null,Ns=[],Qo;const Ln=new Map,bi={_hold:!1,set hold(r){this._hold=r},get hold(){return this._hold},get(){return Je},set(r,e){r!==Je&&(clearTimeout(Qo),Je&&Je!==r.parent&&Je.unfocus(),Ns.reverse().forEach(t=>t.unfocus()),r!==Je&&(Qo=setTimeout(()=>{Je=r,Je.lifecycle.state="focus",e instanceof KeyboardEvent?document.dispatchEvent(new KeyboardEvent("keydown",e)):Ns=[]},this.hold?Me.get("holdTimeout",Ha):0)))},input(r,e){if(st.navigating===!0)return;Ns=el([Je],r);const t=Ns.shift();if(t){let i;t[y.inputEvents][r]?i=t[y.inputEvents][r].call(t,e):t[y.inputEvents].any&&(i=t[y.inputEvents].any.call(t,e)),i!==void 0&&Ln.set(e.code,i)}}},el=(r,e)=>r[0][y.inputEvents]&&(typeof r[0][y.inputEvents][e]=="function"||typeof r[0][y.inputEvents].any=="function")?r:r[0].parent?(r.unshift(r[0].parent),el(r,e)):[],Wt=new Map,oi=new Map,Js={registerListener(r,e,t,i=0){let s=Wt.get(e);s===void 0&&(s=new Map,Wt.set(e,s));let n=s.get(r);n===void 0&&(n=new Set,s.set(r,n)),n.add({cb:t,priority:i}),oi.delete(e)},deregisterListener(r,e){let t=Wt.get(e);t!==void 0&&t.has(r)&&(t.delete(r),Wt.set(e,t),oi.delete(e))},executeListeners(r,e){const t=Wt.get(r);if(t===void 0||t.size===0)return!0;if(oi.has(r)===!1){const s=[];for(const[n,o]of t)for(const a of o)s.push({...a,component:n});s.sort((n,o)=>o.priority-n.priority),oi.set(r,s)}const i=oi.get(r);for(let s=0;s<i.length;s++){const{cb:n,component:o}=i[s];if(n.call(o,e)===!1)return!1}return!0},removeListeners(r){for(const[e,t]of Wt)t.has(r)&&(t.delete(r),oi.delete(e),t.size===0&&Wt.delete(e))}},kc={focus:{value:function(r){return J.warn("this.focus is deprecated, use this.$focus instead"),this.$focus(r)},writable:!1,enumerable:!0,configurable:!1},$focus:{value:function(r){this[y.state].hasFocus=!0,bi.set(this,r)},writable:!1,enumerable:!0,configurable:!1},unfocus:{value:function(){this[y.state].hasFocus=!1,this.lifecycle.state="unfocus"},writable:!1,enumerable:!0,configurable:!1},destroy:{value:function(){this.eol=!0,this.lifecycle.state="destroy",this.$clearTimeouts(),this.$clearIntervals(),Js.removeListeners(this),tl(this[y.children]),this[y.children].length=0,Ao(this[y.effects]),this[y.state]={},this[y.props]={},this[y.computed]=null,this.lifecycle={},this[y.effects].length=0,this.parent=null,this.rootParent=null,this[y.wrapper]=null,this[y.originalState]=null,this[y.slots].length=0,delete this[y.computed],delete this[y.effects],delete this.parent,delete this.rootParent,delete this[y.wrapper],delete this[y.originalState],delete this[y.children],delete this[y.slots],delete this.componentId,delete this[y.id],delete this.ref,this[y.holder].destroy(),this[y.holder]=null,delete this[y.holder],J.debug(`Destroyed component ${this.componentId}`)},writable:!1,enumerable:!0,configurable:!1},[y.removeGlobalEffects]:{value:function(r=[]){Ao(r)},writable:!1,enumerable:!1,configurable:!1},select:{value:function(r){return J.warn("this.select is deprecated, use this.$select instead"),this.$select(r)},writable:!1,enumerable:!0,configurable:!1},$select:{value:function(r){let e=null;return this[y.children].forEach(t=>{Array.isArray(t)?t.forEach(i=>{i.ref===r&&(e=i)}):Object.getPrototypeOf(t)===Object.prototype?Object.keys(t).forEach(i=>{t[i].ref===r&&(e=t[i])}):t.ref===r&&(e=t)}),e},writable:!1,enumerable:!0,configurable:!1},trigger:{value:function(r){return J.warn("this.trigger is deprecated, use this.$trigger instead"),this.$trigger(r)},writable:!1,enumerable:!0,configurable:!1},$trigger:{value:function(r){let e=this[y.originalState];if(r.indexOf(".")>-1){const t=r.split(".");r=t.pop(t);for(let i=0;i<t.length;i++)e=e[t[i]]}Ri(e,r,!0)},writable:!1,enumerable:!0,configurable:!1},shader:{value:function(r,e){return{type:r,props:e}},writable:!1,enumerable:!0,configurable:!1}},tl=function(r){for(let e=0;e<r.length;e++){if(!r[e])return;r[e].destroy&&typeof r[e].destroy=="function"?r[e].destroy():Object.getPrototypeOf(r[e])===Object.prototype&&tl(Object.values(r[e])),r[e]=null}r.length=0},Dc={$setTimeout:{value:function(r,e,...t){if(this.eol===!0)return;const i=setTimeout(()=>{this[y.timeouts]=this[y.timeouts].filter(s=>s!==i),r.apply(null,t)},e,t);return this[y.timeouts].push(i),i},writable:!1,enumerable:!0,configurable:!1},$clearTimeout:{value:function(r){this[y.timeouts].indexOf(r)>-1&&(this[y.timeouts]=this[y.timeouts].filter(e=>e!==r),clearTimeout(r))},writable:!1,enumerable:!0,configurable:!1},$clearTimeouts:{value:function(){for(let r=0;r<this[y.timeouts].length;r++)clearTimeout(this[y.timeouts][r]);this[y.timeouts]=[]},writable:!1,enumerable:!0,configurable:!1},$setInterval:{value:function(r,e,...t){if(this.eol===!0)return;const i=setInterval(()=>r.apply(null,t),e,t);return this[y.intervals].push(i),i},writable:!1,enumerable:!0,configurable:!1},$clearInterval:{value:function(r){this[y.intervals].indexOf(r)>-1&&(this[y.intervals]=this[y.intervals].filter(e=>e!==r),clearInterval(r))},writable:!1,enumerable:!0,configurable:!1},$clearIntervals:{value:function(){for(let r=0;r<this[y.intervals].length;r++)clearInterval(this[y.intervals][r]);this[y.intervals]=[]},writable:!1,enumerable:!0,configurable:!1}},Nc={$emit:{value:function(r,e){return Js.executeListeners(r,e)},writable:!1,enumerable:!0,configurable:!1},$listen:{value:function(r,e,t=0){this.eol!==!0&&Js.registerListener(this,r,e,t)},writable:!1,enumerable:!0,configurable:!1},$unlisten:{value:function(r){Js.deregisterListener(this,r)},writable:!1,enumerable:!0,configurable:!1}},$c={$router:{value:{to:Qi,back:Ja,get currentRoute(){return Mt},get routes(){return this[y.routes]},get navigating(){return st.navigating},state:st},writable:!1,enumerable:!0,configurable:!1}},Hc={$announcer:{value:Qs,writable:!1,enumerable:!0,configurable:!1}},Wc={$size:{value:function(r={w:0,h:0}){this[y.holder].set("w",r.w||0),this[y.holder].set("h",r.h||0)},writable:!1,enumerable:!0,configurable:!1},[y.renderer]:{value:()=>dr,writable:!1,enumerable:!0,configurable:!1},[y.getChildren]:{value(){const r=this.rootParent||this.parent;return(this[y.children]||[]).concat(r&&r[y.getChildren]().map(e=>Object.getPrototypeOf(e)===Object.prototype?Object.values(e).map(t=>(t.forComponent=t[Symbol.for("config")]&&t[Symbol.for("config")].parent.component,t)):e).flat().filter(e=>{if(e&&e.component)return e.component&&e.component.componentId===this.componentId||e.forComponent&&e.forComponent.componentId===this.componentId})||[])},writable:!1,enumerable:!0,configurable:!1}},il={...Nc,...$c,...Hc},Vt=Object.defineProperties({[y.launched]:!1},{...kc,...Dc,...il,...Wc}),Vc={cast:r=>r,required:!1},Xc=(r,e=[])=>{e.indexOf("ref")===-1&&e.push("ref"),r[y.propKeys]=[];const t=e.length;for(let i=0;i<t;i++){const s={...Vc,...typeof e[i]=="object"?e[i]:{key:e[i]}};r[y.propKeys].push(s.key),Object.defineProperty(r,s.key,{get(){const n=s.cast(this[y.props]!==void 0&&s.key in this[y.props]?this[y.props][s.key]:"default"in s?s.default:void 0);return s.required===!0&&n===void 0&&J.warn(`${s.key} is required`),n},set(n){J.warn(`Warning! Avoid mutating props directly (prop "${s.key}" in component "${this.componentId}")`),this[y.props][s.key]=n}})}},Gc=(r,e)=>{r[y.methodKeys]=[];for(let t in e)r[y.propKeys]&&r[y.propKeys].indexOf(t)>-1?J.error(`${t} already exists as a prop`):(typeof e[t]!="function"&&J.warn(`${t} is not a function`),r[y.methodKeys].push(t),r[t]=e[t])},Yc=(r,e=()=>{})=>{Object.defineProperty(r,y.stateKeys,{value:[],enumerable:!1,configurable:!1,writable:!1});const t=Object.keys(e.apply(r)||{});t.push(["hasFocus"]);const i=t.length;for(let s=0;s<i;s++){const n=t[s];r[y.propKeys]!==void 0&&r[y.propKeys].indexOf(n)>-1&&J.error(`State ${n} already exists as a prop`),r[y.methodKeys]!==void 0&&r[y.methodKeys].indexOf(n)>-1&&J.error(`State ${n} already exists as a method`),r[y.stateKeys].push(n),Object.defineProperty(r,n,{get(){return this[y.state][n]},set(o){this[y.state][n]=o}})}},jc=(r,e)=>{r[y.computedKeys]=[];for(let t in e)r[y.stateKeys]&&r[y.stateKeys].indexOf(t)>-1?J.error(`${t} already exists as a state variable`):r[y.propKeys]&&r[y.propKeys].indexOf(t)>-1?J.error(`${t} already exists as a prop`):r[y.methodKeys]&&r[y.methodKeys].indexOf(t)>-1?J.error(`${t} already exists as a method`):(typeof e[t]!="function"&&J.warn(`${t} is not a function`),r[y.computedKeys].push(t),Object.defineProperty(r,t,{get(){return e[t].apply(this)}}))},Kc=(r,e)=>{r[y.inputEvents]=[],Object.keys(e).forEach(t=>{typeof e[t]!="function"&&J.warn(`${e[t]} is not a function`),r[y.inputEvents][t]=e[t]})},qc=(r,e)=>{let t=e;Array.isArray(e)===!1&&(r[y.routerHooks]=e.hooks,t=e.routes),r[y.routes]=[],Object.keys(t).forEach(i=>{r[y.routes][i]={...t[i],options:{inHistory:!0,...t[i].options}}})},Zc=(r,e)=>{r[y.watchKeys]=[],r[y.watchers]={};for(let t in e)typeof e[t]!="function"&&console.warn(`${t} is not a function`),r[y.watchKeys].push(t),r[y.watchers][t]=function(i,s){e[t].call(this,i,s)}};let Qc=0;function Jc(r,e){r[y.identifier]=++Qc,vh(e.hooks,r[y.identifier]),Xc(r,e.props),e.methods&&Gc(r,e.methods),Yc(r,e.state),e.computed&&jc(r,e.computed),e.watch&&Zc(r,e.watch);const t=e.router!==void 0?e.router:e.routes;return t!==void 0&&qc(r,t),e.input&&Kc(r,e.input),r}const ef=()=>Oi("Circle",{code:{render:function(e,t,i,s,n,o,a){const l=[],h={};return l[0]=this.element({parent:e||"root"},t),h.color=t.color,h.w=t.size,h.h=t.size,h.effects=[t.shader("radius",{radius:t.radius})],l[0].populate(h),l},effects:[function(e,t,i,s,n,o){t[0].set("color",e.color)},function(e,t,i,s,n,o){t[0].set("w",e.size)},function(e,t,i,s,n,o){t[0].set("h",e.size)},function(e,t,i,s,n,o){t[0].set("effects",[e.shader("radius",{radius:e.radius})])}],context:{}},props:[{key:"size",default:40},"color"],computed:{radius(){return this.size/2}}});let rn=null;const tf=()=>Oi("RouterView",{code:{render:function(e,t,i,s,n,o,a){const l=[],h={};return l[0]=this.element({parent:e||"root"},t),h.w=e.node.width*(100/100),h.height=e.node.height*(100/100),l[0].populate(h),l},effects:[],context:{}},state(){return{activeView:null}},hooks:{ready(){rn=()=>sn.navigate.apply(this),sn.navigate.apply(this),window.addEventListener("hashchange",rn)},destroy(){window.removeEventListener("hashchange",rn,!1)},focus(){this.activeView&&this.activeView.$focus()}},input:{back(r){sn.back.call(this)===!1&&this.parent.$focus(r)}}}),sf=()=>Oi("Sprite",{code:{render:function(e,t,i,s,n,o,a){const l=[],h={};return l[0]=this.element({parent:e||"root"},t),h.w=e.node.width*(100/100),h.h=e.node.height*(100/100),h.texture=t.texture,h.color=t.color,l[0].populate(h),l},effects:[function(e,t,i,s,n,o){t[0].set("texture",e.texture)},function(e,t,i,s,n,o){t[0].set("color",e.color)}],context:{}},props:["image","map","frame","color"],state(){return{spriteTexture:null}},computed:{texture(){const r="frames"in this.map?Object.assign({},this.map.defaults||{},this.map.frames[this.frame]):this.map[this.frame];if(this.spriteTexture!==null&&r)return this[y.renderer]().createTexture("SubTexture",{texture:this.spriteTexture,x:r.x,y:r.y,width:r.w,height:r.h})}},hooks:{ready(){this.spriteTexture=this[y.renderer]().createTexture("ImageTexture",{src:this.image})}}}),rf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaMAAAAbCAYAAADRe+BYAAAAAXNSR0IArs4c6QAAGn9JREFUeF7tXQ1UVdWePxcWFg7ZA0sym5n0Tmk1z4+0YeVU4yo1h1jvPVBo1ETU8QvTdJlhsmKpi0he5jyXX0CKIWkpl3OlME3RGcdJixVEas+nJtq0sMwXN/kIgbxn1m+791n/ezifF0hr7lmrVV3O2Wfv/977//v//h/7uKTQFZJASAIhCYQkEJLADZaAy+j9iqIMkCRpliRJGeSeWkmSClwuV25X9VtRlOGSJI3m7wq6bd5Osqa/6OZSSZJKXC4X+h7UpSgKZABZQCbiKuHt4t+dvri8z5GG3E77rChKtCRJ9TY647ht0aaiKJAx5LCK/4Y5m23jneotiqJgvg84eCaYd6Cf4h/xqgo+ZwUO3h1wK5cx1oIYP/5eJUlSrsvl6tRakGUZbYr9tjQpKanL9lmw4w09F5LAzyUBXTDiih3KAspN76pwuVxjgu2koijYzGibbmg0tzQYoOPt5Zv0xydJ0hiXywWlYfviAAE5UBDSPu9YUep1QFEUvAdKWlyOAYPP26c2BhhM25ivXZo+4lWOxx8EGEHRw6iwdXHjQbu26LMwTlJsNUZusrEeHMuC9kGWZRgSYs/VJiUluZ32MXR/SAK/VAkYgREsdKaAKysr58fFxd0Di23Xrl1ScjKMTUl69913906cODHe6cDNFAVvcyAUHCxNO21rGIVv7969ufHx8djQGatWrZIyMq4bmj6frz4mJuYRSZJsMyQNQJS43e4/19bWThk+fPiA/Px8afhwkDpJKikpKUhJSXHEDujY9MDU7XZLtbWsq1BItvrMWQsAQxozZoxUUQEiYHrZapuzAYCcAOWSnJycv2RmZjZThiRJklMZGDIkyHfWLNgskkRkgXVh+g4N0NUuWLCgYN26dcMHDBiQjPUr5qyoqOjttLS0KVYC0syTui/q6+tX9O7duyU6OnoV2h09+rodEexakGUZG4vNnbiWL18uHT9+HCBsay84Gcv/13s9Hs/osLAwlZW7XK6KxMRES8Pa6/Ue4GuLic7v94+ZMGGC5Qb7OeXcXWMrLS3Nd7lcs+zKKtgxdwAjupnPnDlTNHDgwN9RhlRfXy9FR0dDuUsxMTGYDMuJ1GxooAO0eNWgQYNaX3jhhcfnzp2bhHuWLl0q5eayfWd7AyqKoro2uIJ5jr7vwIEDqqKIi4trqKysfJK7VUxlRl1ebW1tX99yyy3tlCFB+aBtroCklJQUS0Wp90L+Hii5ABYaJBhBtowRjBgxQqqqsiSCdsEISpJZIZcuXVp01113PaPHkKyAQmf8umCE9XXu3Dm2zgCoAFZ+YXGYMiS6HjZt2iSnp6eztYVLZ87gVrPFkCjQX758+d0+ffr8k1gP6Oenn34qDRgwgBkQbrfb8VqQZVnIGCyerYX9+/dLeXl5MERuSoYky7JiU/GoLE+r1A2eh4cEIKG7gD0ez4CwsDCsxwD2qygKmGlFUlKSobtUq7A5sLgnTJhgaPDx91EX+i8CjLpqbHSeXS7XCKN5sbkWDG/TAyNVuSckJHyzZ8+evvxpbNoSRVHgDmMmK1d4toFD0wumOGH9wgruBBip7q2YmBgGkiBCXDGiv6qCnj17tlRQUGBrc5PYgJSZmTk1JyfnAd5/LPTZBESowoTV7igeoSiKUEK1ly5dCo+Njf17vKezYERkAU0etAVHjZPm5uaiqKioxylD4uMNun0DgFbnbNq0aXveeustgB8TixVLpOuTsEPMeYqiKFgXTKkQkLM1ZxTkNPuCrf8rV678qVevXi+QfWGrXdxfXl4e3dbWxmJ933zzzbHz588/OnLkSKmpqUlKT0/Hv9U51CjGDq482hZk1aNHjxEJCQlsU3D2JYxB/MRiXTQG6Pf7TRUzna9uBCPxmg5xM1mW1bVhovxKkpKSdI0MPTAqLi6WvF6voWGt907OWtGFTu2vzipw+nx3jU0wo6+++qpu0aJF/bg+cURC7IxTD4xUK5goRNUipco9JSUFbgks9Bg7L9MBo+EbN24M7wwzIm3S4K+qCKgSIcpphB12xNumSQEqkFElDTYHVgewtmtp42ZqbX/99dfTzp07VzBq1KiIToCRaii4XOrUOhlrh2mk8nv66acr9u/fL+JatpWtk7VBmaLf778QHh5+O2cKtli4jvGB17O+0jkrKCiQYJzYnTMKcnpuQ+pqdWL0cJBQFeybb7557Nq1a4/OmTOHiS0vLw8MKYBpERYlaS1VjbsvNykpiS1MCyWOdc1csMGCUVKSSkDNprvW6/XWCncXUejqM2PHjpXE2PFjdXX10uzsbOYu0Shb39mzZ7MyMjL+BkYt5mTKlCnS4MGDWVunTp0qy8zM/IO2M3oKGyx8yZIlbNvpGTuyLMNFfd0nz69fChh18dgoE+6UXtFbJHpgpDINsulU9DfY7EF3jG7iYNx0ZFA0AQDg6KOK7erVqy2RkZGR/H4nihRgdD14cZ1xCaUGxT/A7/dfue+++27n8R1bCpMDEdoVcRgE1OH2SxaxhyCZEZMBxrpt27ZIEXPhfQdQMjeGQ3BgG7G9vb0pPj4+Cm2KuCFvJ6ikE6M+0PWgcbPZskDpnGNOYDBVVVWNURQFCheGFlMqRL625syAcdF9gTXCKD5Zx7b2hVB2iqL8MHXq1N+gjW3btjERcWWCdQdFyRiO1+udxfsjcateBSuakQcFi+fvvffeD9asWSPiu779+/e/lZeX9wRkAcUPABDX3Llz4Yo1VMx03igz6iowQvsUkI4fPy4tX76csU8Kwh6PZ/uOHTsm0/5ERUVJGzdulPBvXDNmzCjz+XwBgETBCOOMjY1l93JZdfDyeL3e4YqisKSgpqam+qioKGZ43+xg1E1jE8aurT3jRM/gXrtgpFoMBmDEXHhOX86Vst4mDtb1F9AFatVv3br18PTp0/+F32BLsdHGqDIiv1ekpqZuKy4uvq45rrs8bGV9kb75EhMTs3bv3r2OxreCBCM1wG4yFylOUpAVRWHWUEtLy9XIyMhbDdqtgoUezPxrn1EUhY0BivmOO+6Q6uvroZxtuVZFW8gqrKurK+vXrx9cCtqrdv369fnz588XSQG24jt03RNWRfeFyswJGFkaPVTZnT9//sTixYt/iw5v2LDhWN++fR8lilJti7riuLJWvRMiI6+xsVEFtldffbXsgQce+D3a2rdvn1xQUBBAY15//XUGzri6AIwMy0XQPo0ZGSl0Oj64KlNTU/FoCgdaxuBIP1WXPH7Pz88vvfPOO9n4Vq9eLR09ejRgT1Iw8nq9UmJiIhs3/ru4uBhuy4B1TMF93759344bN+4u3K/Xd85KA8oJYPwhlkXjWBp21sHVKsuyuo9RNpGYmGjL9d9dY6P9SUpKYvNL3cUYn6IoyHjNQKID2XCOyhO6CowsN52RoupCZhTwCtruTz/9VBMREYFYDNhIUG5FPTACW5gxY0ZzcXExzCu0i4VsmflG3UU8KwtZXQOqq6svDRs2jJlqQYIR3D0Zp0+fDp88eXKvqqoq9KkkIyNjFjILcTU3N7c9+eSTz1ZWVu62Ag9t7RMSItLT05EEMn7o0KGLNm/eHC+y04LNrqR9oG7L3bt3y4mJiUJpOlpfkK/f738zLCzsXu0YwWRnzpz5fWFhocgMtIxDoQ1togkHHGbUUKMH9zph+FTZbdiwofbgwYPol2/Lli0ro6Oj/8NIUVKWAGXd1NQ0AgpVWPFQnAUFBVCcPlmWsSYZI+T34j9VJU4B4mYAI3ROh3VV8PExNzF3XzKQ0jGEsc9pUhDzlHAlqmbTgVUOGTKEufbAJDB2vofVxAkB7j/88EPF+++/PxquQD0wEnEVkz0VoJg196t/o6wX4zKKfem9h4JRV47NCox4yAPrtkMpEIBq/PjxtrJsf5VgpEnv9Y0cOXLXsWPHhEA6y7ryR48ezZS7UMRz5sw5kZ+fD3eAJRBxxSYsHzAKUF6AiK+xsfHPUVFR/xwsGJEF2oEh0VRpriwt2SwFI7i8kLDiu54hwhYdssfgBsLFs8g6WJZWgKcBI9XVOnDgwK/PnDnzt1yJqC4qq/ZorVVTU9Op+Ph46ciRIw+gr5CBcIOmpqZeKi4uRualbbclBUudfqhxFx4zYrhklZYtlJ3f729IS0vrBSYAJVReXj5bJDUQdqC6/ajS4gxgqSzLeJZZHcJFB9esLMvMWqVsScTRONipacs3AxhRpUpiHj6v17tUuCcJIBkZE2r8lAKWVmE3NzerMSrOdlQmRe997733Prxy5crTemDk9XrB5JmLFvt50aJF2y9cuBDvdruTX3zxRdUVuGrVqvmVlZXrcR/YX0tLy/+Gh4dHYX7nzZt34Z133nm4ra1NgKjv+eefb7p48SL2AC5Lg6w7xob9oQEj1hmPx+MOCwtTMwyPHj0qFRYWFtXX168cMWLE6wsWLEgS7tL09PQV33777XKrvfurAyNt4eeMGTNyCgsLl3FBdEpZ8jbYIqeK+LPPPrv28MMPT7TjqqTunldeeSU9Ozt7I28XGw1WH7P8gmFGZLIZQ+LgiEVcpRO8D4hD6C0UCkaaFGvIkbXb0tJy4tZbb/1HPM8z+CwVsMG71DTv48ePVwwZMkQkSjhqj9aGpaamphYXF2MTMBZEU8YvXLjg79+//7/ZmTPa39OnT//hiy++2JmYmNgDv6N+LTo6+mVaxE3S6k37TpMNvvzyy7+89NJLg/i7mKFA2Y/W5URdWTwFvMrr9SJOOhqxjdTUVJFUBPcWq186ffp0w8svv9yLv0NlC13BjEwUTYAbyspNx2WCPcYMHsKAmK7XnFIhtbe3/xgREbHS7/eXmKVni/5pXVlgW1u2bGmJiIiI1KbSE/biS01NdT333HO/EfE16qaTZRl9ZWtsyZIlQ8+dO4d1xS64AQWA8bGoa4IaFHh3ZGTk3scff/xf8dwnn3wi5+bmCs+ArcSo7hibHTAirBJ6gTEkjFm4QPnatXSH282m040Z8Ww6W6httFi70k2nPTli/fr1GSQ2YNuNZoXg4u/Nzc0Xe/bsyVLfefaaKdtwcFyP2oUDBw6kjh07tthun0zkjEXCLJmSkhIW2Ley3Gl/CRiBAcBCZ24PnSwzR/Ed0V/aTkpKSnVJScnD/G+23GikHRbjunr1al1kZKSIGang2djY+D8a9mnJEHVk2qFAVRSEX7lyBSAXxksMTK1ZCjZW8wvLc/Xq1QEuZvG8SAEXSQ8ffPDBic2bNyP2xO4XLi+iNALm6EaBkdWYz58/v3Px4sXP8vtUQ3LatGn5Dz744CwR5yLtwNNQYBZjoQqbg4/0xhtvnOjfv/9vCQNl7lfBWuvq6vbMnz//GZrsYRDvUuPfnHGneL3eZE2yCbqrrumdO3f+V0REhIhls6EoinJh/PjxIovUtt7qrrFZMSMetxTTwEpfOBtnLJ0YFKoBpDf3pnVGBGwoGKmp38QCtKSQ3Q1G3IpH1guzqD766KOcxx57TDAi/GQrs4koNXFmHn4S7rSAYYhgOwEjU+alc/6c1X5Ehp0tMOLMR6Sf4rimgIJBg7RmS2uFxyCG8yJn9Dcgk4YyEVLbZLrotIOmcvnuu++qY2NjBRBZ9k+nLQZGFy9ebOnXr5/InqTrV5stGhR4kvMUkylLPnLkSOUTTzyBgljTNaepB7JcB7iBx3tU8KTMCjECYYFnZGQ0nD17FgyIyY+mJvM2AuawK8DIRjYdk7PNotdcj8fTtmPHjudJHEKrY5DOnYF4Dyxw4RLie7EiIiIiRdRXUeHqKewJEyaUTZo0iSV4CCtelmXIiDHKDRs27Dl48OAz8+bNa33qqaduwW96YJSVlfV2bGxsXN++ff9Bb0J55iP+pI6FJrCIZwoLCzeXl5f/O/9/256B7hqbAzBS9xItJbCI76miMj2BwSBriJ2fxY/XUV0BTt0dROl3OptOe2bY559/vm7o0KGIB4iAWjDZc1Ds4py3DmfxUQV64sSJ1sGDB7NFqpehqLMwdQ80NcimE4+bjkETz+hwRhplHiTAbkn/deq0VEWmiSn91e1238E765TNqP7911577ciyZctQWIsrmHlTa0K4q5PWhqmB7aampvbbbruN1XTZKaY1QwsKyMOGDfugpqYGadSmblC6WQmT6fAa6u7gykydMw5oLMYAqx4KuaGhoTYtLU0kZwgLX83044ohAIApWHVBzMhIVB3ASK/OyOBhoyxVcTDycIASAFHUGV2+fPnU7NmzH9S2p6eweVwNbUULBsrBCL/5ONBG5+Tk1A4aNIjJloJReXl5VVtbG4ycgFok7bsJGAUADJU/Ya943JGh1B1js+OmI8xI1Q0GYGRKWozOplM3NGdH4vQFlRWtXbv2xMKFC1kaqlPWQSeps2467blptbW1f3S73TNNLCozvRLwN8p8uMWbybOnsOigQNniW7hw4V/Xrl0rFLFpait/geoyoy/sDBihHdpfnt32Co8XqUWVyACMjY2N4m4kS+ZBs8jwzMSJE5s+/PDD2zgQqXU7mZmZp8gpFbaZEW2fH7skArZB1TLQmByy/yZNmoREiL/j71EPevV4PHXJycnCjecIPMWcaU9z52vvJf53U9lSBUSSDTqsTQAqUq9xkWC+Kl+tq+/QoUOH169fD7eP6tKjabgALQDS0aNHWRvaLDAKRvw5duaV3llsBnVGwaR2G+1JgBDWgVWSifBiZGzatCla1A5lZWVVnjx5cpxwKeMlVGETJYokD8iLHWQJGWzatIn1iRfPMta0devW6ttvv52xdgpGpaWlySKlGQkMa9asOYWkGbBnWjOlB0Z6ZxISJuHIGOuOsd0MYIQiR/gyr1ePdbzAFLAAYGk6Qm9tU10ARnaOB1Ff6yJHE1ihEmJQ165dOxQeHi6Cvh0eqaury7/nnntEpl6nEiSohR1MAgP629TUtCcqKup6JV/Hy5eQkPCfe/bsEYFRWy4Aq1O2OyMDCh55eXmVc+fOFS6uzrh+aSZVBym0trYevvvuu4fwGiZHqf4mspjtcrlgSYvEC0OAo66Z77//vm7mzJkCFHXnQwe41Pu0yoy46ALYhCZl2HDpUzAqLS1V60b0UnS7EIwsla5mnIYpz+vWrSvv168fOz6KK/UAo8ZIYXu9XtTKME8IQEowrJUrV1bU1NRgTpHNJxKBAsBIlmVWAI9n09LSahoaGoYKAdsAI5H56vvxxx979ezZM1xk1zU2Nva30lH0790xthsORhggLN+cnJz/XrZsGS0cFN8zAhBdP77bRvqqmUBvZjDicohesWLFl1OmTIlBbIBcBTt27KiZPHnyDELPg1ag/F16p184strBANDfBQsWxCB7jFxLR40aFXP48GFhuVtm09GHy8rKhp09e/bo4sWLaeFrRWVlZVlcXFxaMDKgrKgzRa566ys7O/vtuLi4ySKVm99TVV9fX967d2+kzwvQsGSHtH0NGDGr3e12R+I0d3JmnynIUzZSWlpat337drHHdOOa1OUhMudEcSZ11RHmhC53UPBZWVlTwsLCtglFC5der169cIIGTnRg8jBiRgZFnurxMCRmFAwzsgQjTYzN16NHD7deTIjGpHj8B8NS5WqgsBlg0dgIHmpvbz/57LPPskxRpOhzI4LJSZNNB8Yd3dra2jpx4kThrkebSLfH/SyQr2VGdF5ramq2f/zxx5PFUUh8nh3pk+4Y200BRnwCADqm3zVyemq3CTDRTBRbFrumLUcMyWZsR7zCSg5ssdo9fcEMnPnf6NFGjsCIzBs2iNF3mNj3nRyczye6bPVRvM7IgM5fMPOvJ1ZThiQynqgbx8bcWMnCiQKhcUk7rJqekaYFLno2oxnbo/uMjYWewECKYum6o3KkRw/9bGCEflLlDeA9dOjQsb17947E3wBWra2tq4S7rKGhgdVt8clS58RCYQfokLKysi+LiopEMgKKilfpnKsHEINMmXFOAAdZjAEfYaRg5PF4SkidTu3UqVPDGhsb783Ly/P36dMnDG1xlovCbXHQrehfLXebBtQ1dsfYuhqMPB5PBf+EB3RTQCGw3fiG9rh2xpCsCvocbGzcejODEfonzqjTfvEVckBQ2cqv7UQcnQUj2l8sYEqR2Jdv7Rbo6nRa7wvAGLuQg5NxintpxbwjxmbjZVi7mDP64UIofsigM98JosAs4hqQAVMcNi+q5O0AMFWWWkZH+9PBKOBuLgT5MW7ci7ZGI74i4iN1dXUN8+fPFwqcghFtW2UxP6ebTshz+/btf4qMjGSno5tcvqysrLMnT54ULl81A9FMYWs/FUGAmRkKRjVSvL7LyGhXi6H5kUPo9lKv1ztaABs9oikhIWHz9OnTWSYdZ7oU/E2PCeqOsXU1GPFTNMSHUANq0OyAkc19FbotJIGQBG5GCXAlK8oe6NEzOARUTcQpKir6qqysjH3ChJ/EbwqsNwKM0LGHHnoo9/77739Jm9INpt/Y2Fg+depU1P6JM9ICYtpmChttC8DR1M4wQ8GsYBcyrqqqOvDII48wb0R7ezsKaVf06NGjQJykITLlZs2aJY8bN47FbTWuQFbD5/V6dwmg4myKsWDBDFHUvGTJkphLly7hfhgHjCF119gcpHZbZtNRZrRz5876nTt3IpGGyTcERjej9gj1KSSBLpQAXFjt7e2qgtNruqGh4d20tDRxcoAdlyFthn5awK5OoezfMmak02fqljSSlpk7Wsts6fd5tNmu2uxQo76bufNVhqRx6dO2qIuX9k87H/S4Lz23cHeMjZE14voX80xlpZcBS9k87Sv1hDGDwe7C6cKtEWoqJIGQBG6EBHJzc5+vr69/Iy4ujh1lxK+S6urqquzsbLgzRZ2Mk7gXmrkRYIT3QhGKWiPqirbjhjVT2GhbgISegjUDUvQJCph+dgZuU7jb2AcUSQYyVch6BgB9D3XjqrEjyozInHbX2LoSjCAnjI/FjkLM6EZohNA7QxK4cRKAwlZrrQy64Si78MYNJfTmX5sEQszo1zajofGEJGAtAfHNHVGegSeQ2CD+sW4hdEdIAl0sgRAYdbFAQ82FJBCSQEgCIQk4l0AIjJzLLPRESAIhCYQkEJJAF0vg/wBMng85iZWBHAAAAABJRU5ErkJggg==",nf=()=>Oi("FPScounter",{code:{render:function(e,t,i,s,n,o,a){const l=[];let h,u,f,c=!1,p=0;const _={};l[0]=this.element({parent:e||"root"},c===!0?f:t),l[0].populate(_),c===!0&&(p-=1),e=l[0];const g={};l[1]=this.element({parent:e||"root"},c===!0?f:t),g.y=15,g.x=20,l[1].populate(g),c===!0&&(p-=1),e=l[1];const x={};l[2]=this.element({parent:e||"root"},c===!0?f:t),l[2].populate(x),c===!0&&(p-=1);const m=i.components&&i.components.Sprite||s.Sprite;e=l[2];const T={};l[3]=this.element({parent:e||"root"},c===!0?f:t),T.image=t.image,T.w=43,T.h=25,T.map=t.sprite,T.frame="fps";const b=[];if(typeof m<"u")for(let N in m[Symbol.for("config")].props)delete T[m[Symbol.for("config")].props[N]],b.push(m[Symbol.for("config")].props[N]);l[3].populate(T),c===!0&&(p-=1),e=l[3];const S={};S.image=t.image,S.w=43,S.h=25,S.map=t.sprite,S.frame="fps",h=S.is||"Sprite";let R;if(typeof h=="string"){if(R=i.components&&i.components[h]||s[h],!R)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(R=h);l[4]=R.call(null,{props:S},l[3],t),l[4][Symbol.for("slots")][0]?(e=l[4][Symbol.for("slots")][0],f=l[4],c=!0):e=l[4][Symbol.for("children")][0],c===!0&&p===0&&(c=!1),e=l[2];const A={};l[5]=this.element({parent:e||"root"},c===!0?f:t),A.x=58,A.y=2,l[5].populate(A),c===!0&&(p-=1);const L=i.components&&i.components.Sprite||s.Sprite;e=l[5];const E={};l[6]=this.element({parent:e||"root"},c===!0?f:t),E.image=t.image,E.x=0,E.h=20,E.w=20,E.map=t.sprite,E.frame=t.fps[0];const U=[];if(typeof L<"u")for(let N in L[Symbol.for("config")].props)delete E[L[Symbol.for("config")].props[N]],U.push(L[Symbol.for("config")].props[N]);l[6].populate(E),c===!0&&(p-=1),e=l[6];const z={};z.image=t.image,z.x=0,z.h=20,z.w=20,z.map=t.sprite,u=t.fps[0],Array.isArray(u)===!0&&(u=o(u).slice(0)),z.frame=u,h=z.is||"Sprite";let k;if(typeof h=="string"){if(k=i.components&&i.components[h]||s[h],!k)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(k=h);l[7]=k.call(null,{props:z},l[6],t),l[7][Symbol.for("slots")][0]?(e=l[7][Symbol.for("slots")][0],f=l[7],c=!0):e=l[7][Symbol.for("children")][0],c===!0&&p===0&&(c=!1);const O=i.components&&i.components.Sprite||s.Sprite;e=l[5];const B={};l[8]=this.element({parent:e||"root"},c===!0?f:t),B.image=t.image,B.x=18,B.h=20,B.w=20,B.map=t.sprite,B.frame=t.fps[1];const $=[];if(typeof O<"u")for(let N in O[Symbol.for("config")].props)delete B[O[Symbol.for("config")].props[N]],$.push(O[Symbol.for("config")].props[N]);l[8].populate(B),c===!0&&(p-=1),e=l[8];const P={};P.image=t.image,P.x=18,P.h=20,P.w=20,P.map=t.sprite,u=t.fps[1],Array.isArray(u)===!0&&(u=o(u).slice(0)),P.frame=u,h=P.is||"Sprite";let C;if(typeof h=="string"){if(C=i.components&&i.components[h]||s[h],!C)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(C=h);l[9]=C.call(null,{props:P},l[8],t),l[9][Symbol.for("slots")][0]?(e=l[9][Symbol.for("slots")][0],f=l[9],c=!0):e=l[9][Symbol.for("children")][0],c===!0&&p===0&&(c=!1);const M=i.components&&i.components.Sprite||s.Sprite;e=l[5];const j={};l[10]=this.element({parent:e||"root"},c===!0?f:t),j.image=t.image,j.x=36,j.h=20,j.w=20,j.map=t.sprite,j.frame=t.fps[2];const q=[];if(typeof M<"u")for(let N in M[Symbol.for("config")].props)delete j[M[Symbol.for("config")].props[N]],q.push(M[Symbol.for("config")].props[N]);l[10].populate(j),c===!0&&(p-=1),e=l[10];const K={};K.image=t.image,K.x=36,K.h=20,K.w=20,K.map=t.sprite,u=t.fps[2],Array.isArray(u)===!0&&(u=o(u).slice(0)),K.frame=u,h=K.is||"Sprite";let Q;if(typeof h=="string"){if(Q=i.components&&i.components[h]||s[h],!Q)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(Q=h);l[11]=Q.call(null,{props:K},l[10],t),l[11][Symbol.for("slots")][0]?(e=l[11][Symbol.for("slots")][0],f=l[11],c=!0):e=l[11][Symbol.for("children")][0],c===!0&&p===0&&(c=!1),e=l[1];const Y={};l[12]=this.element({parent:e||"root"},c===!0?f:t),Y.x=150,l[12].populate(Y),c===!0&&(p-=1);const oe=i.components&&i.components.Sprite||s.Sprite;e=l[12];const Se={};l[13]=this.element({parent:e||"root"},c===!0?f:t),Se.image=t.image,Se.y=2,Se.w=48,Se.h=25,Se.map=t.sprite,Se.frame="avg";const ve=[];if(typeof oe<"u")for(let N in oe[Symbol.for("config")].props)delete Se[oe[Symbol.for("config")].props[N]],ve.push(oe[Symbol.for("config")].props[N]);l[13].populate(Se),c===!0&&(p-=1),e=l[13];const ne={};ne.image=t.image,ne.y=2,ne.w=48,ne.h=25,ne.map=t.sprite,ne.frame="avg",h=ne.is||"Sprite";let be;if(typeof h=="string"){if(be=i.components&&i.components[h]||s[h],!be)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(be=h);l[14]=be.call(null,{props:ne},l[13],t),l[14][Symbol.for("slots")][0]?(e=l[14][Symbol.for("slots")][0],f=l[14],c=!0):e=l[14][Symbol.for("children")][0],c===!0&&p===0&&(c=!1),e=l[12];const fe={};l[15]=this.element({parent:e||"root"},c===!0?f:t),fe.x=63,fe.y=2,l[15].populate(fe),c===!0&&(p-=1);const Ge=i.components&&i.components.Sprite||s.Sprite;e=l[15];const we={};l[16]=this.element({parent:e||"root"},c===!0?f:t),we.image=t.image,we.x=0,we.h=20,we.w=20,we.map=t.sprite,we.frame=t.avgFps[0];const De=[];if(typeof Ge<"u")for(let N in Ge[Symbol.for("config")].props)delete we[Ge[Symbol.for("config")].props[N]],De.push(Ge[Symbol.for("config")].props[N]);l[16].populate(we),c===!0&&(p-=1),e=l[16];const te={};te.image=t.image,te.x=0,te.h=20,te.w=20,te.map=t.sprite,u=t.avgFps[0],Array.isArray(u)===!0&&(u=o(u).slice(0)),te.frame=u,h=te.is||"Sprite";let si;if(typeof h=="string"){if(si=i.components&&i.components[h]||s[h],!si)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(si=h);l[17]=si.call(null,{props:te},l[16],t),l[17][Symbol.for("slots")][0]?(e=l[17][Symbol.for("slots")][0],f=l[17],c=!0):e=l[17][Symbol.for("children")][0],c===!0&&p===0&&(c=!1);const Ye=i.components&&i.components.Sprite||s.Sprite;e=l[15];const Ce={};l[18]=this.element({parent:e||"root"},c===!0?f:t),Ce.image=t.image,Ce.x=18,Ce.h=20,Ce.w=20,Ce.map=t.sprite,Ce.frame=t.avgFps[1];const ri=[];if(typeof Ye<"u")for(let N in Ye[Symbol.for("config")].props)delete Ce[Ye[Symbol.for("config")].props[N]],ri.push(Ye[Symbol.for("config")].props[N]);l[18].populate(Ce),c===!0&&(p-=1),e=l[18];const Le={};Le.image=t.image,Le.x=18,Le.h=20,Le.w=20,Le.map=t.sprite,u=t.avgFps[1],Array.isArray(u)===!0&&(u=o(u).slice(0)),Le.frame=u,h=Le.is||"Sprite";let Qe;if(typeof h=="string"){if(Qe=i.components&&i.components[h]||s[h],!Qe)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(Qe=h);l[19]=Qe.call(null,{props:Le},l[18],t),l[19][Symbol.for("slots")][0]?(e=l[19][Symbol.for("slots")][0],f=l[19],c=!0):e=l[19][Symbol.for("children")][0],c===!0&&p===0&&(c=!1);const Nt=i.components&&i.components.Sprite||s.Sprite;e=l[15];const Ne={};l[20]=this.element({parent:e||"root"},c===!0?f:t),Ne.image=t.image,Ne.x=36,Ne.h=20,Ne.w=20,Ne.map=t.sprite,Ne.frame=t.avgFps[2];const Zl=[];if(typeof Nt<"u")for(let N in Nt[Symbol.for("config")].props)delete Ne[Nt[Symbol.for("config")].props[N]],Zl.push(Nt[Symbol.for("config")].props[N]);l[20].populate(Ne),c===!0&&(p-=1),e=l[20];const ut={};ut.image=t.image,ut.x=36,ut.h=20,ut.w=20,ut.map=t.sprite,u=t.avgFps[2],Array.isArray(u)===!0&&(u=o(u).slice(0)),ut.frame=u,h=ut.is||"Sprite";let ls;if(typeof h=="string"){if(ls=i.components&&i.components[h]||s[h],!ls)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(ls=h);l[21]=ls.call(null,{props:ut},l[20],t),l[21][Symbol.for("slots")][0]?(e=l[21][Symbol.for("slots")][0],f=l[21],c=!0):e=l[21][Symbol.for("children")][0],c===!0&&p===0&&(c=!1),e=l[1];const Wr={};l[22]=this.element({parent:e||"root"},c===!0?f:t),Wr.x=0,Wr.y=40,l[22].populate(Wr),c===!0&&(p-=1);const hs=i.components&&i.components.Sprite||s.Sprite;e=l[22];const ct={};l[23]=this.element({parent:e||"root"},c===!0?f:t),ct.image=t.image,ct.x="-2",ct.w=47,ct.h=25,ct.map=t.sprite,ct.frame="min";const Ql=[];if(typeof hs<"u")for(let N in hs[Symbol.for("config")].props)delete ct[hs[Symbol.for("config")].props[N]],Ql.push(hs[Symbol.for("config")].props[N]);l[23].populate(ct),c===!0&&(p-=1),e=l[23];const ft={};ft.image=t.image,ft.x="-2",ft.w=47,ft.h=25,ft.map=t.sprite,ft.frame="min",h=ft.is||"Sprite";let us;if(typeof h=="string"){if(us=i.components&&i.components[h]||s[h],!us)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(us=h);l[24]=us.call(null,{props:ft},l[23],t),l[24][Symbol.for("slots")][0]?(e=l[24][Symbol.for("slots")][0],f=l[24],c=!0):e=l[24][Symbol.for("children")][0],c===!0&&p===0&&(c=!1),e=l[22];const Vr={};l[25]=this.element({parent:e||"root"},c===!0?f:t),Vr.x=58,Vr.y=2,l[25].populate(Vr),c===!0&&(p-=1);const cs=i.components&&i.components.Sprite||s.Sprite;e=l[25];const dt={};l[26]=this.element({parent:e||"root"},c===!0?f:t),dt.image=t.image,dt.x=0,dt.h=20,dt.w=20,dt.map=t.sprite,dt.frame=t.minFps[0];const Jl=[];if(typeof cs<"u")for(let N in cs[Symbol.for("config")].props)delete dt[cs[Symbol.for("config")].props[N]],Jl.push(cs[Symbol.for("config")].props[N]);l[26].populate(dt),c===!0&&(p-=1),e=l[26];const pt={};pt.image=t.image,pt.x=0,pt.h=20,pt.w=20,pt.map=t.sprite,u=t.minFps[0],Array.isArray(u)===!0&&(u=o(u).slice(0)),pt.frame=u,h=pt.is||"Sprite";let fs;if(typeof h=="string"){if(fs=i.components&&i.components[h]||s[h],!fs)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(fs=h);l[27]=fs.call(null,{props:pt},l[26],t),l[27][Symbol.for("slots")][0]?(e=l[27][Symbol.for("slots")][0],f=l[27],c=!0):e=l[27][Symbol.for("children")][0],c===!0&&p===0&&(c=!1);const ds=i.components&&i.components.Sprite||s.Sprite;e=l[25];const gt={};l[28]=this.element({parent:e||"root"},c===!0?f:t),gt.image=t.image,gt.x=18,gt.h=20,gt.w=20,gt.map=t.sprite,gt.frame=t.minFps[1];const eh=[];if(typeof ds<"u")for(let N in ds[Symbol.for("config")].props)delete gt[ds[Symbol.for("config")].props[N]],eh.push(ds[Symbol.for("config")].props[N]);l[28].populate(gt),c===!0&&(p-=1),e=l[28];const _t={};_t.image=t.image,_t.x=18,_t.h=20,_t.w=20,_t.map=t.sprite,u=t.minFps[1],Array.isArray(u)===!0&&(u=o(u).slice(0)),_t.frame=u,h=_t.is||"Sprite";let ps;if(typeof h=="string"){if(ps=i.components&&i.components[h]||s[h],!ps)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(ps=h);l[29]=ps.call(null,{props:_t},l[28],t),l[29][Symbol.for("slots")][0]?(e=l[29][Symbol.for("slots")][0],f=l[29],c=!0):e=l[29][Symbol.for("children")][0],c===!0&&p===0&&(c=!1);const gs=i.components&&i.components.Sprite||s.Sprite;e=l[25];const mt={};l[30]=this.element({parent:e||"root"},c===!0?f:t),mt.image=t.image,mt.x=36,mt.h=20,mt.w=20,mt.map=t.sprite,mt.frame=t.minFps[2];const th=[];if(typeof gs<"u")for(let N in gs[Symbol.for("config")].props)delete mt[gs[Symbol.for("config")].props[N]],th.push(gs[Symbol.for("config")].props[N]);l[30].populate(mt),c===!0&&(p-=1),e=l[30];const xt={};xt.image=t.image,xt.x=36,xt.h=20,xt.w=20,xt.map=t.sprite,u=t.minFps[2],Array.isArray(u)===!0&&(u=o(u).slice(0)),xt.frame=u,h=xt.is||"Sprite";let _s;if(typeof h=="string"){if(_s=i.components&&i.components[h]||s[h],!_s)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(_s=h);l[31]=_s.call(null,{props:xt},l[30],t),l[31][Symbol.for("slots")][0]?(e=l[31][Symbol.for("slots")][0],f=l[31],c=!0):e=l[31][Symbol.for("children")][0],c===!0&&p===0&&(c=!1),e=l[1];const Xr={};l[32]=this.element({parent:e||"root"},c===!0?f:t),Xr.x=150,Xr.y=40,l[32].populate(Xr),c===!0&&(p-=1);const ms=i.components&&i.components.Sprite||s.Sprite;e=l[32];const $t={};l[33]=this.element({parent:e||"root"},c===!0?f:t),$t.image=t.image,$t.w=53,$t.h=25,$t.map=t.sprite,$t.frame="max";const ih=[];if(typeof ms<"u")for(let N in ms[Symbol.for("config")].props)delete $t[ms[Symbol.for("config")].props[N]],ih.push(ms[Symbol.for("config")].props[N]);l[33].populate($t),c===!0&&(p-=1),e=l[33];const Ht={};Ht.image=t.image,Ht.w=53,Ht.h=25,Ht.map=t.sprite,Ht.frame="max",h=Ht.is||"Sprite";let xs;if(typeof h=="string"){if(xs=i.components&&i.components[h]||s[h],!xs)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(xs=h);l[34]=xs.call(null,{props:Ht},l[33],t),l[34][Symbol.for("slots")][0]?(e=l[34][Symbol.for("slots")][0],f=l[34],c=!0):e=l[34][Symbol.for("children")][0],c===!0&&p===0&&(c=!1),e=l[32];const Gr={};l[35]=this.element({parent:e||"root"},c===!0?f:t),Gr.x=63,Gr.y=2,l[35].populate(Gr),c===!0&&(p-=1);const ys=i.components&&i.components.Sprite||s.Sprite;e=l[35];const yt={};l[36]=this.element({parent:e||"root"},c===!0?f:t),yt.image=t.image,yt.x=0,yt.h=20,yt.w=20,yt.map=t.sprite,yt.frame=t.maxFps[0];const sh=[];if(typeof ys<"u")for(let N in ys[Symbol.for("config")].props)delete yt[ys[Symbol.for("config")].props[N]],sh.push(ys[Symbol.for("config")].props[N]);l[36].populate(yt),c===!0&&(p-=1),e=l[36];const Tt={};Tt.image=t.image,Tt.x=0,Tt.h=20,Tt.w=20,Tt.map=t.sprite,u=t.maxFps[0],Array.isArray(u)===!0&&(u=o(u).slice(0)),Tt.frame=u,h=Tt.is||"Sprite";let Ts;if(typeof h=="string"){if(Ts=i.components&&i.components[h]||s[h],!Ts)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(Ts=h);l[37]=Ts.call(null,{props:Tt},l[36],t),l[37][Symbol.for("slots")][0]?(e=l[37][Symbol.for("slots")][0],f=l[37],c=!0):e=l[37][Symbol.for("children")][0],c===!0&&p===0&&(c=!1);const Ss=i.components&&i.components.Sprite||s.Sprite;e=l[35];const St={};l[38]=this.element({parent:e||"root"},c===!0?f:t),St.image=t.image,St.x=18,St.h=20,St.w=20,St.map=t.sprite,St.frame=t.maxFps[1];const rh=[];if(typeof Ss<"u")for(let N in Ss[Symbol.for("config")].props)delete St[Ss[Symbol.for("config")].props[N]],rh.push(Ss[Symbol.for("config")].props[N]);l[38].populate(St),c===!0&&(p-=1),e=l[38];const bt={};bt.image=t.image,bt.x=18,bt.h=20,bt.w=20,bt.map=t.sprite,u=t.maxFps[1],Array.isArray(u)===!0&&(u=o(u).slice(0)),bt.frame=u,h=bt.is||"Sprite";let bs;if(typeof h=="string"){if(bs=i.components&&i.components[h]||s[h],!bs)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(bs=h);l[39]=bs.call(null,{props:bt},l[38],t),l[39][Symbol.for("slots")][0]?(e=l[39][Symbol.for("slots")][0],f=l[39],c=!0):e=l[39][Symbol.for("children")][0],c===!0&&p===0&&(c=!1);const vs=i.components&&i.components.Sprite||s.Sprite;e=l[35];const vt={};l[40]=this.element({parent:e||"root"},c===!0?f:t),vt.image=t.image,vt.x=36,vt.h=20,vt.w=20,vt.map=t.sprite,vt.frame=t.maxFps[2];const nh=[];if(typeof vs<"u")for(let N in vs[Symbol.for("config")].props)delete vt[vs[Symbol.for("config")].props[N]],nh.push(vs[Symbol.for("config")].props[N]);l[40].populate(vt),c===!0&&(p-=1),e=l[40];const wt={};wt.image=t.image,wt.x=36,wt.h=20,wt.w=20,wt.map=t.sprite,u=t.maxFps[2],Array.isArray(u)===!0&&(u=o(u).slice(0)),wt.frame=u,h=wt.is||"Sprite";let ws;if(typeof h=="string"){if(ws=i.components&&i.components[h]||s[h],!ws)throw new Error('Component "Sprite" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(ws=h);return l[41]=ws.call(null,{props:wt},l[40],t),l[41][Symbol.for("slots")][0]?(e=l[41][Symbol.for("slots")][0],f=l[41],c=!0):e=l[41][Symbol.for("children")][0],c===!0&&p===0&&(c=!1),l},effects:[function(e,t,i,s,n,o){(typeof skip6>"u"||skip6.indexOf("frame")===-1)&&t[6].set("frame",e.fps[0])},function(e,t,i,s,n,o){t[7][Symbol.for("props")].frame=e.fps[0]},function(e,t,i,s,n,o){(typeof skip8>"u"||skip8.indexOf("frame")===-1)&&t[8].set("frame",e.fps[1])},function(e,t,i,s,n,o){t[9][Symbol.for("props")].frame=e.fps[1]},function(e,t,i,s,n,o){(typeof skip10>"u"||skip10.indexOf("frame")===-1)&&t[10].set("frame",e.fps[2])},function(e,t,i,s,n,o){t[11][Symbol.for("props")].frame=e.fps[2]},function(e,t,i,s,n,o){(typeof skip16>"u"||skip16.indexOf("frame")===-1)&&t[16].set("frame",e.avgFps[0])},function(e,t,i,s,n,o){t[17][Symbol.for("props")].frame=e.avgFps[0]},function(e,t,i,s,n,o){(typeof skip18>"u"||skip18.indexOf("frame")===-1)&&t[18].set("frame",e.avgFps[1])},function(e,t,i,s,n,o){t[19][Symbol.for("props")].frame=e.avgFps[1]},function(e,t,i,s,n,o){(typeof skip20>"u"||skip20.indexOf("frame")===-1)&&t[20].set("frame",e.avgFps[2])},function(e,t,i,s,n,o){t[21][Symbol.for("props")].frame=e.avgFps[2]},function(e,t,i,s,n,o){(typeof skip26>"u"||skip26.indexOf("frame")===-1)&&t[26].set("frame",e.minFps[0])},function(e,t,i,s,n,o){t[27][Symbol.for("props")].frame=e.minFps[0]},function(e,t,i,s,n,o){(typeof skip28>"u"||skip28.indexOf("frame")===-1)&&t[28].set("frame",e.minFps[1])},function(e,t,i,s,n,o){t[29][Symbol.for("props")].frame=e.minFps[1]},function(e,t,i,s,n,o){(typeof skip30>"u"||skip30.indexOf("frame")===-1)&&t[30].set("frame",e.minFps[2])},function(e,t,i,s,n,o){t[31][Symbol.for("props")].frame=e.minFps[2]},function(e,t,i,s,n,o){(typeof skip36>"u"||skip36.indexOf("frame")===-1)&&t[36].set("frame",e.maxFps[0])},function(e,t,i,s,n,o){t[37][Symbol.for("props")].frame=e.maxFps[0]},function(e,t,i,s,n,o){(typeof skip38>"u"||skip38.indexOf("frame")===-1)&&t[38].set("frame",e.maxFps[1])},function(e,t,i,s,n,o){t[39][Symbol.for("props")].frame=e.maxFps[1]},function(e,t,i,s,n,o){(typeof skip40>"u"||skip40.indexOf("frame")===-1)&&t[40].set("frame",e.maxFps[2])},function(e,t,i,s,n,o){t[41][Symbol.for("props")].frame=e.maxFps[2]}],context:{}},state(){return{image:rf,sprite:{defaults:{y:1,w:20,h:20},frames:{"-":{x:-1e3},0:{x:1},1:{x:23},2:{x:45},3:{x:67},4:{x:89},5:{x:111},6:{x:133},7:{x:155},8:{x:177},9:{x:199},avg:{x:221,w:48,h:25},fps:{x:271,w:43,h:25},max:{x:316,w:53,h:25},min:{x:371,w:47,h:25}}},fps:"---",avgFps:"---",minFps:"---",maxFps:"---"}},hooks:{ready(){}}}),of=()=>({Circle:ef(),RouterView:tf(),Sprite:sf(),FPScounter:nf()}),af={name:"log",plugin(){return ya("App")}},Pn={log:af},sl=(r,e="",t={})=>{let i;if(typeof e=="object"?t=e:i=e,typeof r=="function"){if(i===void 0)throw Error("Error registering plugin: name is required for plugin");Pn[i]={plugin:r,options:t}}else r.plugin&&sl(r.plugin,i||r.name,t)};let nn;const Jo=r=>{throw new Error(`Parameter ${r} is required`)},Oi=(r=Jo("name"),e=Jo("config"))=>{let t;const i=function(n,o,a,l){this.componentId=Th(r),this[y.effects]=[],this.lifecycle=Object.assign(Object.create(Eh),{component:this,previous:null,current:null}),this.parent=a,this.rootParent=l,this[y.holder]=o,this[y.id]=Sh(),this[y.props]=pn(n.props||{},Me.get("reactivityMode")),this[y.timeouts]=[],this[y.intervals]=[],this[y.originalState]=e.state&&typeof e.state=="function"&&e.state.apply(this)||{},this[y.originalState].hasFocus=!1,this[y.state]=pn(this[y.originalState],Me.get("reactivityMode")),this.lifecycle.state="init",this[y.children]=e.code.render.apply(jn,[o,this,e,nn,Es,Xt,J])||[],this[y.wrapper]=this[y.children][0],this[y.slots]=this[y.children].filter(u=>u[y.isSlot]),e.hooks&&(e.hooks.frameTick&&dr.on("frameTick",(u,f)=>cn("frameTick",this[y.identifier],this,[f])),e.hooks.idle&&dr.on("idle",()=>{cn("idle",this[y.identifier],this)}),e.hooks.attach&&this[y.wrapper].node.on("inBounds",()=>{this.lifecycle.state="attach"}),e.hooks.detach&&this[y.wrapper].node.on("outOfBounds",(u,{previous:f})=>{f>0&&(this.lifecycle.state="detach")}),e.hooks.enter&&this[y.wrapper].node.on("inViewport",()=>{this.lifecycle.state="enter"}),e.hooks.exit&&this[y.wrapper].node.on("outOfViewport",()=>{this.lifecycle.state="exit"}));const h=e.code.effects;for(let u=0;u<h.length;u++){const f=()=>{h[u](this,this[y.children],e,nn,l,Es)};this[y.effects].push(f),Es(f)}if(this[y.watchers]){const u=Object.keys(this[y.watchers]),f=u.length;for(let c=0;c<f;c++){let p=this,_=u[c];const g=_;if(_.indexOf(".")>-1){const T=_.split(".");_=T.pop();for(let b=0;b<T.length;b++)p=p[T[b]]}let x=this[_];const m=(T=!1)=>{const b=p[_];(x!==b||T===!0)&&(this[y.watchers][g].apply(this,[b,x]),x=b)};this[y.effects].push(m),Es(m)}}return setTimeout(()=>this.lifecycle.state="ready"),this},s=(n={},o,a,l)=>{if(Vt[y.launched]===!1){const h=Object.keys(Pn),u=h.length,f={};for(let c=0;c<u;c++){const p=h[c],_=`$${p}`;_ in Vt&&J.warn(`"${p}" (this.${_}) already exists as a property or plugin on the Base Component. You may be overwriting built-in functionality. Proceed with care!`);const g=Pn[p];f[_]={value:Object.defineProperties(g.plugin(g.options),il),writable:!1,enumerable:!0,configurable:!0}}Object.defineProperties(Vt,f);for(const c in f)Object.defineProperties(Vt[c],f),delete Vt[c][c];nn=of(),Vt[y.launched]=!0}return t===void 0&&(J.debug(`Setting up ${r} component`),t=Jc(Object.create(Vt),e)),e.code===void 0&&(J.debug(`Generating code for ${r} component`),e.code=dh.call(e,fh(e.template))),i.call(Object.create(t),n,o,a,l)};return s[Symbol.for("config")]=e,s[y.isComponent]=!0,s},lf=r=>{const e={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down",Enter:"enter"," ":"space",Backspace:"back",Escape:"escape",37:"left",39:"right",38:"up",40:"down",13:"enter",32:"space",8:"back",27:"escape"};r.hooks=r.hooks||{};let t,i,s;return r.hooks[y.destroy]=function(){document.removeEventListener("keydown",t),document.removeEventListener("keyup",i)},r.hooks[y.init]=function(){this.$announcer.toggle(Me.get("announcer",!1));const n={...e,...Me.get("keymap",{})};t=async o=>{const a=n[o.key]||n[o.keyCode]||o.key||o.keyCode;this[y.inputEvents]!==void 0&&this[y.inputEvents].intercept!==void 0&&(o=await this[y.inputEvents].intercept.call(this,o),!(o instanceof KeyboardEvent))||(bi.input(a,o),clearTimeout(s),s=setTimeout(()=>{bi.hold=!0},Me.get("holdTimeout",Ha)))},i=o=>{const a=Ln.get(o.code);a!==void 0&&typeof a=="function"&&(Ln.delete(o.code),a()),clearTimeout(s),bi.hold=!1},document.addEventListener("keydown",t),document.addEventListener("keyup",i),setTimeout(()=>bi.set(this))},Oi("App",r)},Zn={Component:Oi,Application:lf,Launch:Sc,Plugin:sl};function hf(r,e){let t;return(...i)=>{t===void 0&&r(...i),window.clearTimeout(t),t=window.setTimeout(()=>{r(...i),t=void 0},e)}}const uf=Zn.Component("Icon",{props:["stageW","stageH"],computed:{iconSize(){return this.stageW,this.stageH,Math.max(this.stageW,this.stageH)}},code:{render:function(e,t,i,s,n,o,a){const l=[],h={};return l[0]=this.element({parent:e||"root"},t),h.src="assets/icon.png",h.w=t.iconSize,h.h=t.iconSize,h.x=t.stageW/2,h.y=t.stageH/2,h.mount=.5,l[0].populate(h),l},effects:[function(e,t,i,s,n,o){t[0].set("w",e.iconSize)},function(e,t,i,s,n,o){t[0].set("h",e.iconSize)},function(e,t,i,s,n,o){t[0].set("x",e.stageW/2)},function(e,t,i,s,n,o){t[0].set("y",e.stageH/2)},function(e,t,i,s,n,o){t[0].set("mount",.5)}],context:{}}}),Xi={},ze={},cf=(r,e)=>{Xi.app=r,Xi.platform=e,Xi.user={}},ff=(r,e)=>{ze[r]&&ze[r].forEach(t=>t(e))},df=(r={},e)=>{if(r===null)return;const t=e.split(".");for(let i=0;i<t.length;i++)r=r[t[i]]=r[t[i]]!==void 0?r[t[i]]:{};return typeof r=="object"&&r!==null?Object.keys(r).length?r:void 0:r},We={get(r,e,t=void 0){const i=df(Xi[r],e);return i!==void 0?i:t},has(r,e){return!!this.get(r,e)},set(r,e){Xi.user[r]=e,ff(r,e)},subscribe(r,e){ze[r]=ze[r]||[],ze[r].push(e)},unsubscribe(r,e){if(e){const t=ze[r]&&ze[r].findIndex(i=>i===e);t>-1&&ze[r].splice(t,1)}else r in ze&&(ze[r]=[])},clearSubscribers(){for(const r of Object.getOwnPropertyNames(ze))delete ze[r]}},$s=(r,e)=>{const t={Info:"green",Debug:"gray",Warn:"orange",Error:"red"};return e=Array.from(e),["%c"+(e.length>1&&typeof e[0]=="string"?e.shift():r),"background-color: "+t[r]+"; color: white; padding: 2px 4px; border-radius: 2px",e]},Z={info(){We.get("platform","log")&&console.log.apply(console,$s("Info",arguments))},debug(){We.get("platform","log")&&console.debug.apply(console,$s("Debug",arguments))},error(){We.get("platform","log")&&console.error.apply(console,$s("Error",arguments))},warn(){We.get("platform","log")&&console.warn.apply(console,$s("Warn",arguments))}};class D{static mergeNumbers(e,t,i){return e*i+t*(1-i)}static rgb(e,t,i){return(e<<16)+(t<<8)+i+255*16777216}static rgba(e,t,i,s){return(e<<16)+(t<<8)+i+(s*255|0)*16777216}static getRgbString(e){let t=(e/65536|0)%256,i=(e/256|0)%256,s=e%256;return"rgb("+t+","+i+","+s+")"}static getRgbaString(e){let t=(e/65536|0)%256,i=(e/256|0)%256,s=e%256,n=(e/16777216|0)/255;return"rgba("+t+","+i+","+s+","+n.toFixed(4)+")"}static getRgbaStringFromArray(e){let t=Math.floor(e[0]*255),i=Math.floor(e[1]*255),s=Math.floor(e[2]*255),n=Math.floor(e[3]*255)/255;return"rgba("+t+","+i+","+s+","+n.toFixed(4)+")"}static getRgbaComponentsNormalized(e){let t=(e/65536|0)%256,i=(e/256|0)%256,s=e%256,n=e/16777216|0;return[t/255,i/255,s/255,n/255]}static getRgbComponentsNormalized(e){let t=(e/65536|0)%256,i=(e/256|0)%256,s=e%256;return[t/255,i/255,s/255]}static getRgbaComponents(e){let t=(e/65536|0)%256,i=(e/256|0)%256,s=e%256,n=e/16777216|0;return[t,i,s,n]}static getArgbNumber(e){e[0]=Math.max(0,Math.min(255,e[0])),e[1]=Math.max(0,Math.min(255,e[1])),e[2]=Math.max(0,Math.min(255,e[2])),e[3]=Math.max(0,Math.min(255,e[3]));let t=((e[3]|0)<<24)+((e[0]|0)<<16)+((e[1]|0)<<8)+(e[2]|0);return t<0&&(t=4294967295+t+1),t}static mergeColors(e,t,i){let s=(e/65536|0)%256,n=(e/256|0)%256,o=e%256,a=e/16777216|0,l=(t/65536|0)%256,h=(t/256|0)%256,u=t%256,f=t/16777216|0,c=s*i+l*(1-i),p=n*i+h*(1-i),_=o*i+u*(1-i),g=a*i+f*(1-i);return Math.round(g)*16777216+Math.round(c)*65536+Math.round(p)*256+Math.round(_)}static mergeMultiColors(e,t){let i=0,s=0,n=0,o=0,a=0,l=e.length;for(let h=0;h<l;h++){let u=(e[h]/65536|0)%256,f=(e[h]/256|0)%256,c=e[h]%256,p=e[h]/16777216|0;i+=u*t[h],s+=f*t[h],n+=c*t[h],o+=p*t[h],a+=t[h]}return a=1/a,Math.round(o*a)*16777216+Math.round(i*a)*65536+Math.round(s*a)*256+Math.round(n*a)}static mergeMultiColorsEqual(e){let t=0,i=0,s=0,n=0,o=0,a=e.length;for(let l=0;l<a;l++){let h=(e[l]/65536|0)%256,u=(e[l]/256|0)%256,f=e[l]%256,c=e[l]/16777216|0;t+=h,i+=u,s+=f,n+=c,o+=1}return o=1/o,Math.round(n*o)*16777216+Math.round(t*o)*65536+Math.round(i*o)*256+Math.round(s*o)}static mergeColorAlpha(e,t){let i=(e/16777216|0)*t|0;return((e>>16&255)*i/255&255)+((e&65280)*i/255&65280)+(((e&255)<<16)*i/255&16711680)+(i<<24)}static rad(e){return e*(Math.PI/180)}static getTimingBezier(e,t,i,s){let n=3*e,o=3*(i-e)-n,a=1-n-o,l=3*t,h=3*(s-t)-l,u=1-l-h;return function(f){if(f>=1)return 1;if(f<=0)return 0;let c=.5,p,_,g;for(let T=0;T<20;T++){if(p=c*(c*(c*a+o)+n),g=f-p,g>-1e-8&&g<1e-8)return c*(c*(c*u+h)+l);if(_=c*(c*(3*a)+2*o)+n,_>1e-10&&_<1e-10)break;c+=g/_}let x=0,m=1;for(let T=0;T<20;T++){if(c=.5*(x+m),p=c*(c*(c*a+o)+n),g=f-p,g>-1e-8&&g<1e-8)return c*(c*(c*u+h)+l);g<0?m=c:x=c}}}static getTimingFunction(e){switch(e){case"linear":return function(i){return i};case"ease":return D.getTimingBezier(.25,.1,.25,1);case"ease-in":return D.getTimingBezier(.42,0,1,1);case"ease-out":return D.getTimingBezier(0,0,.58,1);case"ease-in-out":return D.getTimingBezier(.42,0,.58,1);case"step-start":return function(){return 1};case"step-end":return function(i){return i===1?1:0};default:let t="cubic-bezier(";if(e&&e.indexOf(t)===0){let i=e.substr(t.length,e.length-t.length-1).split(",");if(i.length!==4)return console.warn("[Lightning] Unknown timing function: "+e),function(l){return l};let s=parseFloat(i[0]),n=parseFloat(i[1]),o=parseFloat(i[2]),a=parseFloat(i[3]);return isNaN(s)||isNaN(n)||isNaN(o)||isNaN(a)?(console.warn("[Lightning] Unknown timing function: "+e),function(l){return l}):D.getTimingBezier(s,n,o,a)}else return console.warn("[Lightning] Unknown timing function: "+e),function(i){return i}}}}let w=class Pe{static isFunction(e){return typeof e=="function"}static isNumber(e){return typeof e=="number"}static isInteger(e){return typeof e=="number"&&e%1===0}static isBoolean(e){return e===!0||e===!1}static isString(e){return typeof e=="string"}static clone(e){return Pe.isObjectLiteral(e)||Array.isArray(e)?Pe.getDeepClone(e):e}static cloneObjShallow(e){let t=Object.keys(e),i={};for(let s=0;s<t.length;s++)i[t[s]]=e[t[s]];return i}static merge(e,t){let i=Object.keys(t);for(let s=0;s<i.length;s++)e[i[s]]=t[i[s]];return e}static isObject(e){let t=typeof e;return!!e&&(t==="object"||t==="function")}static isPlainObject(e){return!!e&&typeof e==="object"}static isObjectLiteral(e){return typeof e=="object"&&e&&e.constructor===Object}static getArrayIndex(e,t){return Pe.getModuloIndex(e,t.length)}static getModuloIndex(e,t){if(t===0)return e;for(;e<0;)e+=Math.ceil(-e/t)*t;return e=e%t,e}static getDeepClone(e){let t,i;if(Pe.isFunction(e))return e;if(Array.isArray(e)){i=[];let s=Object.keys(e);for(t=0;t<s.length;t++)i[s[t]]=Pe.getDeepClone(e[s[t]]);return i}else if(Pe.isObject(e)){i={};let s=Object.keys(e);for(t=0;t<s.length;t++)i[s[t]]=Pe.getDeepClone(e[s[t]]);return i}else return e}static equalValues(e,t){return typeof e!=typeof t?!1:Pe.isObjectLiteral(e)?Pe.isObjectLiteral(t)&&Pe.equalObjectLiterals(e,t):Array.isArray(e)?Array.isArray(t)&&Pe.equalArrays(e,t):e===t}static equalObjectLiterals(e,t){let i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length)return!1;for(let n=0,o=i.length;n<o;n++){const a=i[n],l=s[n];if(a!==l)return!1;const h=e[a],u=t[l];if(!Pe.equalValues(h,u))return!1}return!0}static equalArrays(e,t){if(e.length!==t.length)return!1;for(let i=0,s=e.length;i<s;i++)if(!this.equalValues(e[i],t[i]))return!1;return!0}static setToArray(e){let t=[];return e.forEach(function(i){t.push(i)}),t}static iteratorToArray(e){let t=[],i=e.next();for(;!i.done;)t.push(i.value),i=e.next();return t}static isUcChar(e){return e>=65&&e<=90}};w.isWeb=typeof window<"u"&&typeof sparkscene>"u";w.isWPE=w.isWeb&&navigator.userAgent.indexOf("WPE")!==-1;w.isSpark=typeof sparkscene<"u";w.isNode=typeof window>"u"||w.isSpark;w.isPS4=w.isWeb&&navigator.userAgent.indexOf("PlayStation 4")!==-1;w.isZiggo=w.isWeb&&(navigator.userAgent.indexOf("EOSSTB")!==-1||navigator.userAgent.indexOf("HZNSTB")!==-1);class xe{static defaultSetter(e,t,i){e[t]=i}static patchObject(e,t){if(!w.isObjectLiteral(t))console.error("[Lightning] Settings must be object literal");else{let i=Object.keys(t);for(let s=0,n=i.length;s<n;s++){let o=i[s];this.patchObjectProperty(e,o,t[o])}}}static patchObjectProperty(e,t,i){let s=e.setSetting||xe.defaultSetter;t.charAt(0)==="_"?t!=="__create"&&console.error("[Lightning] Patch of private property '"+t+"' is not allowed"):t!=="type"&&(w.isFunction(i)&&i.__local&&(i=i.__local(e)),s(e,t,i))}static local(e){e.__local=!0}}class rl{static getSpacing(e,t,i){const s=t-1;let n,o,a;switch(e){case"flex-start":o=0,a=0;break;case"flex-end":o=i,a=0;break;case"center":o=i/2,a=0;break;case"space-between":o=0,a=Math.max(0,i)/s;break;case"space-around":if(i<0)return this.getSpacing("center",t,i);n=i/(s+1),o=.5*n,a=n;break;case"space-evenly":if(i<0)return this.getSpacing("center",t,i);n=i/(s+2),o=n,a=n;break;case"stretch":o=0,a=0;break;default:throw new Error("Unknown mode: "+e)}return{spacingBefore:o,spacingBetween:a}}}class pf{constructor(e){this._layout=e,this._totalCrossAxisSize=0}get _lines(){return this._layout._lines}init(){this._totalCrossAxisSize=this._getTotalCrossAxisSize()}align(){const t=this._layout.crossAxisSize-this._totalCrossAxisSize,{spacingBefore:i,spacingBetween:s}=this._getSpacing(t),n=this._lines,o=this._layout._flexContainer.alignContent;let a=0;o==="stretch"&&n.length&&t>0&&(a=t/n.length);let l=i;for(let h=0,u=n.length;h<u;h++){const f=l,c=n[h].createItemAligner();let p=n[h].crossAxisLayoutSize+a;c.setCrossAxisLayoutSize(p),c.setCrossAxisLayoutOffset(f),c.align(),c.recursiveResizeOccured&&n[h].setItemPositions(),l+=p,l+=s}}get totalCrossAxisSize(){return this._totalCrossAxisSize}_getTotalCrossAxisSize(){const e=this._lines;let t=0;for(let i=0,s=e.length;i<s;i++){const n=e[i];t+=n.crossAxisLayoutSize}return t}_getSpacing(e){const t=this._layout._flexContainer.alignContent,i=this._lines.length;return rl.getSpacing(t,i,e)}}class W{static getParentAxisSizeWithPadding(e,t){const s=e.target.getParent();if(s){const n=e.flexParent;return n?this.getAxisLayoutSize(n,t)+this.getTotalPadding(n,t):t?s.w:s.h}else return 0}static getRelAxisSize(e,t){return t?e.funcW?this._allowRelAxisSizeFunction(e,!0)?e.funcW(this.getParentAxisSizeWithPadding(e,!0)):0:e.originalWidth:e.funcH?this._allowRelAxisSizeFunction(e,!1)?e.funcH(this.getParentAxisSizeWithPadding(e,!1)):0:e.originalHeight}static _allowRelAxisSizeFunction(e,t){const i=e.flexParent;return!(i&&i._flex._layout.isAxisFitToContents(t))}static isZeroAxisSize(e,t){return t?!e.originalWidth&&!e.funcW:!e.originalHeight&&!e.funcH}static getAxisLayoutPos(e,t){return t?e.x:e.y}static getAxisLayoutSize(e,t){return t?e.w:e.h}static setAxisLayoutPos(e,t,i){t?e.x=i:e.y=i}static setAxisLayoutSize(e,t,i){t?e.w=i:e.h=i}static getAxisMinSize(e,t){let i=this.getPlainAxisMinSize(e,t),s=0;return e.isFlexItemEnabled()&&(s=e._flexItem._getMinSizeSetting(t)),s>0&&(i=Math.max(i,s)),i}static getPlainAxisMinSize(e,t){return e.isFlexEnabled()?e._flex._layout.getAxisMinSize(t):e.flexItem.shrink!==0?0:this.getRelAxisSize(e,t)}static resizeAxis(e,t,i){e.isFlexEnabled()?e._flex._horizontal===t?e._flex._layout.resizeMainAxis(i):e._flex._layout.resizeCrossAxis(i):this.setAxisLayoutSize(e,t,i)}static getPaddingOffset(e,t){if(e.isFlexEnabled()){const i=e._flex;return t?i.paddingLeft:i.paddingTop}else return 0}static getTotalPadding(e,t){if(e.isFlexEnabled()){const i=e._flex;return t?i.paddingRight+i.paddingLeft:i.paddingTop+i.paddingBottom}else return 0}static getMarginOffset(e,t){const i=e.flexItem;return i?t?i.marginLeft:i.marginTop:0}static getTotalMargin(e,t){const i=e.flexItem;return i?t?i.marginRight+i.marginLeft:i.marginTop+i.marginBottom:0}}class gf{constructor(e){this._line=e,this._amountRemaining=0,this._shrunkSize=0}shrink(e){this._shrunkSize=0,this._amountRemaining=e;let t=this._getTotalShrinkAmount();if(t){const i=this._line.items;do{let s=this._amountRemaining/t;for(let n=this._line.startIndex;n<=this._line.endIndex;n++){const a=i[n].flexItem,l=a.shrink;if(l>0){let u=l*s;const f=a._getMainAxisMinSize(),c=a._getMainAxisLayoutSize();if(c>f){const p=c-f;u>=p&&(u=p,t-=l);const g=c-u;if(a._resizeMainAxis(g),this._shrunkSize+=u,this._amountRemaining-=u,Math.abs(this._amountRemaining)<1e-5)return}}}}while(t&&Math.abs(this._amountRemaining)>1e-5)}}_getTotalShrinkAmount(){let e=0;const t=this._line.items;for(let i=this._line.startIndex;i<=this._line.endIndex;i++){const n=t[i].flexItem;if(n.shrink){const o=n._getMainAxisMinSize();n._getMainAxisLayoutSize()>o&&(e+=n.shrink)}}return e}getShrunkSize(){return this._shrunkSize}}class _f{constructor(e){this._line=e,this._amountRemaining=0,this._grownSize=0}grow(e){this._grownSize=0,this._amountRemaining=e;let t=this._getTotalGrowAmount();if(t){const i=this._line.items;do{let s=this._amountRemaining/t;for(let n=this._line.startIndex;n<=this._line.endIndex;n++){const a=i[n].flexItem,l=a.grow;if(l>0){let u=l*s;const f=a._getMainAxisMaxSizeSetting(),c=a._getMainAxisLayoutSize();if(f>0)if(c>=f)u=0;else{const p=f-c;u>=p&&(u=p,t-=l)}if(u>0){const p=c+u;if(a._resizeMainAxis(p),this._grownSize+=u,this._amountRemaining-=u,Math.abs(this._amountRemaining)<1e-5)return}}}}while(t&&Math.abs(this._amountRemaining)>1e-5)}}_getTotalGrowAmount(){let e=0;const t=this._line.items;for(let i=this._line.startIndex;i<=this._line.endIndex;i++){const n=t[i].flexItem;if(n.grow){const o=n._getMainAxisMaxSizeSetting(),a=n._getMainAxisLayoutSize();(o===0||a<o)&&(e+=n.grow)}}return e}getGrownSize(){return this._grownSize}}class mf{constructor(e){this._line=e}get _layout(){return this._line._layout}position(){const{spacingBefore:e,spacingBetween:t}=this._getSpacing();let i=e;const s=this._line.items;for(let n=this._line.startIndex;n<=this._line.endIndex;n++){const o=s[n];o.flexItem._setMainAxisLayoutPos(i),i+=o.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin(),i+=t}}_getSpacing(){const e=this._line._availableSpace;let t=this._layout._flexContainer.justifyContent;const i=this._line.numberOfItems;return rl.getSpacing(t,i,e)}}class xf{constructor(e){this._line=e,this._crossAxisLayoutSize=0,this._crossAxisLayoutOffset=0,this._alignItemsSetting=null,this._recursiveResizeOccured=!1,this._isCrossAxisFitToContents=!1}get _layout(){return this._line._layout}get _flexContainer(){return this._layout._flexContainer}setCrossAxisLayoutSize(e){this._crossAxisLayoutSize=e}setCrossAxisLayoutOffset(e){this._crossAxisLayoutOffset=e}align(){this._alignItemsSetting=this._flexContainer.alignItems,this._isCrossAxisFitToContents=this._layout.isAxisFitToContents(!this._flexContainer._horizontal),this._recursiveResizeOccured=!1;const e=this._line.items;for(let t=this._line.startIndex;t<=this._line.endIndex;t++){const i=e[t];this._alignItem(i)}}get recursiveResizeOccured(){return this._recursiveResizeOccured}_alignItem(e){const t=e.flexItem;let i=t.alignSelf||this._alignItemsSetting;switch(i==="stretch"&&this._preventStretch(t)&&(i="flex-start"),i!=="stretch"&&!this._isCrossAxisFitToContents&&t._hasRelCrossAxisSize()&&t._resetCrossAxisLayoutSize(),i){case"flex-start":this._alignItemFlexStart(t);break;case"flex-end":this._alignItemFlexEnd(t);break;case"center":this._alignItemFlexCenter(t);break;case"stretch":this._alignItemStretch(t);break}}_alignItemFlexStart(e){e._setCrossAxisLayoutPos(this._crossAxisLayoutOffset)}_alignItemFlexEnd(e){const t=e._getCrossAxisLayoutSizeWithPaddingAndMargin();e._setCrossAxisLayoutPos(this._crossAxisLayoutOffset+(this._crossAxisLayoutSize-t))}_alignItemFlexCenter(e){const t=e._getCrossAxisLayoutSizeWithPaddingAndMargin(),i=(this._crossAxisLayoutSize-t)/2;e._setCrossAxisLayoutPos(this._crossAxisLayoutOffset+i)}_alignItemStretch(e){e._setCrossAxisLayoutPos(this._crossAxisLayoutOffset);const t=e._getMainAxisLayoutSize();let i=this._crossAxisLayoutSize-e._getCrossAxisMargin()-e._getCrossAxisPadding();const s=e._getCrossAxisMinSizeSetting();s>0&&(i=Math.max(i,s));const n=e._getCrossAxisMaxSizeSetting();n>0&&(i=Math.min(i,n)),e._resizeCrossAxis(i),e._getMainAxisLayoutSize()!==t&&(this._recursiveResizeOccured=!0)}_preventStretch(e){const t=e._hasFixedCrossAxisSize(),i=e.alignSelf==="stretch";return t&&!i}}class yf{constructor(e,t,i,s){this._layout=e,this.items=e.items,this.startIndex=t,this.endIndex=i,this._availableSpace=s}performLayout(){this._setItemSizes(),this.setItemPositions(),this._calcLayoutInfo()}_setItemSizes(){this._availableSpace>0?this._growItemSizes(this._availableSpace):this._availableSpace<0&&this._shrinkItemSizes(-this._availableSpace)}_growItemSizes(e){const t=new _f(this);t.grow(e),this._availableSpace-=t.getGrownSize()}_shrinkItemSizes(e){const t=new gf(this);t.shrink(e),this._availableSpace+=t.getShrunkSize()}setItemPositions(){new mf(this).position()}createItemAligner(){return new xf(this)}_calcLayoutInfo(){this._calcCrossAxisMaxLayoutSize()}getMainAxisMinSize(){let e=0;for(let t=this.startIndex;t<=this.endIndex;t++){const i=this.items[t];e+=i.flexItem._getMainAxisMinSizeWithPaddingAndMargin()}return e}get numberOfItems(){return this.endIndex-this.startIndex+1}get crossAxisLayoutSize(){const e=this._layout.isCrossAxisFitToContents()&&!this._layout.resizingCrossAxis;return this._layout.isWrapping()||e?this._crossAxisMaxLayoutSize:this._layout.crossAxisSize}_calcCrossAxisMaxLayoutSize(){this._crossAxisMaxLayoutSize=this._getCrossAxisMaxLayoutSize()}_getCrossAxisMaxLayoutSize(){let e=0;for(let t=this.startIndex;t<=this.endIndex;t++){const i=this.items[t];e=Math.max(e,i.flexItem._getCrossAxisLayoutSizeWithPaddingAndMargin())}return e}}class Tf{constructor(e){this._layout=e,this._mainAxisMinSize=-1,this._crossAxisMinSize=-1,this._mainAxisContentSize=0}get lines(){return this._lines}get mainAxisMinSize(){return this._mainAxisMinSize===-1&&(this._mainAxisMinSize=this._getMainAxisMinSize()),this._mainAxisMinSize}get crossAxisMinSize(){return this._crossAxisMinSize===-1&&(this._crossAxisMinSize=this._getCrossAxisMinSize()),this._crossAxisMinSize}get mainAxisContentSize(){return this._mainAxisContentSize}layoutLines(){this._setup();const e=this._layout.items,t=this._layout.isWrapping();let i=0,s;const n=e.length;for(s=0;s<n;s++){const o=e[s];this._layoutFlexItem(o);const a=o.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin();t&&s>i&&this._curMainAxisPos+a>this._mainAxisSize&&(this._layoutLine(i,s-1),this._curMainAxisPos=0,i=s),this._addToMainAxisPos(a)}i<s&&this._layoutLine(i,s-1)}_layoutFlexItem(e){e.isFlexEnabled()?e.flexLayout.updateTreeLayout():e.flexItem._resetLayoutSize()}_setup(){this._mainAxisSize=this._layout.mainAxisSize,this._curMainAxisPos=0,this._maxMainAxisPos=0,this._lines=[],this._mainAxisMinSize=-1,this._crossAxisMinSize=-1,this._mainAxisContentSize=0}_addToMainAxisPos(e){this._curMainAxisPos+=e,this._curMainAxisPos>this._maxMainAxisPos&&(this._maxMainAxisPos=this._curMainAxisPos)}_layoutLine(e,t){const i=this._getAvailableMainAxisLayoutSpace(),s=new yf(this._layout,e,t,i);s.performLayout(),this._lines.push(s),(this._mainAxisContentSize===0||this._curMainAxisPos>this._mainAxisContentSize)&&(this._mainAxisContentSize=this._curMainAxisPos)}_getAvailableMainAxisLayoutSpace(){return!this._layout.resizingMainAxis&&this._layout.isMainAxisFitToContents()?0:this._mainAxisSize-this._curMainAxisPos}_getCrossAxisMinSize(){let e=0;const t=this._layout.items;for(let i=0,s=t.length;i<s;i++){const o=t[i].flexItem._getCrossAxisMinSizeWithPaddingAndMargin();e=Math.max(e,o)}return e}_getMainAxisMinSize(){return this._lines.length===1?this._lines[0].getMainAxisMinSize():this._layout.mainAxisSize}}class gr{constructor(e){this._layout=e,this._isReverse=this._flexContainer._reverse,this._horizontalPaddingOffset=this._layout._getHorizontalPaddingOffset(),this._verticalPaddingOffset=this._layout._getVerticalPaddingOffset()}get _flexContainer(){return this._layout._flexContainer}finalize(){const e=this._layout.getParentFlexContainer();e?new gr(e._layout)._finalizeItemAndChildren(this._flexContainer.item):(this._finalizeRoot(),this._finalizeItems())}_finalizeRoot(){const e=this._flexContainer.item;let t=W.getAxisLayoutPos(e,!0),i=W.getAxisLayoutPos(e,!1),s=W.getAxisLayoutSize(e,!0),n=W.getAxisLayoutSize(e,!1);s+=this._layout._getHorizontalPadding(),n+=this._layout._getVerticalPadding(),e.clearRecalcFlag(),e.setLayout(t,i,s,n)}_finalizeItems(){const e=this._layout.items;for(let t=0,i=e.length;t<i;t++){const s=e[t],n=this._validateItemCache(s);this._finalizeItem(s),n||this._finalizeItemChildren(s)}}_validateItemCache(e){if(e.recalc===0&&e.isFlexEnabled()){const t=e._flex._layout;if(e.w===e.target.w&&e.h===e.target.h)return!0;{const s=t.crossAxisSize;t.performResizeMainAxis(t.mainAxisSize),t.performResizeCrossAxis(s)}}return!1}_finalizeItemAndChildren(e){this._finalizeItem(e),this._finalizeItemChildren(e)}_finalizeItem(e){this._isReverse&&this._reverseMainAxisLayoutPos(e);let t=W.getAxisLayoutPos(e,!0),i=W.getAxisLayoutPos(e,!1),s=W.getAxisLayoutSize(e,!0),n=W.getAxisLayoutSize(e,!1);t+=this._horizontalPaddingOffset,i+=this._verticalPaddingOffset,e.flex&&(s+=e._flex._layout._getHorizontalPadding(),n+=e._flex._layout._getVerticalPadding());const a=e.flexItem;a&&(t+=a._getHorizontalMarginOffset(),i+=a._getVerticalMarginOffset()),e.clearRecalcFlag(),e.setLayout(t,i,s,n)}_finalizeItemChildren(e){const t=e._flex;t&&new gr(t._layout)._finalizeItems()}_reverseMainAxisLayoutPos(e){const t=e.flexItem._getMainAxisLayoutPos()+e.flexItem._getMainAxisLayoutSizeWithPaddingAndMargin(),i=this._layout.mainAxisSize-t;e.flexItem._setMainAxisLayoutPos(i)}}class Sf{constructor(e){this._flexContainer=e,this._lineLayouter=new Tf(this),this._resizingMainAxis=!1,this._resizingCrossAxis=!1,this._cachedMainAxisSizeAfterLayout=0,this._cachedCrossAxisSizeAfterLayout=0,this._shrunk=!1}get shrunk(){return this._shrunk}get recalc(){return this.item.recalc}layoutTree(){this.item.flexParent!==null?this._updateSubTreeLayout():this.updateTreeLayout(),this.updateItemCoords()}updateTreeLayout(){this.recalc?this._performUpdateLayoutTree():this._performUpdateLayoutTreeFromCache()}_performUpdateLayoutTree(){this._setInitialAxisSizes(),this._layoutAxes(),this._refreshLayoutCache()}_refreshLayoutCache(){this._cachedMainAxisSizeAfterLayout=this.mainAxisSize,this._cachedCrossAxisSizeAfterLayout=this.crossAxisSize}_performUpdateLayoutTreeFromCache(){this.item.funcW||this.item.funcH?(this.item.enableLocalRecalcFlag(),this._performUpdateLayoutTree()):(this.mainAxisSize=this._cachedMainAxisSizeAfterLayout,this.crossAxisSize=this._cachedCrossAxisSizeAfterLayout)}updateItemCoords(){new gr(this).finalize()}_updateSubTreeLayout(){const e=this.crossAxisSize;this._layoutMainAxis(),this.performResizeCrossAxis(e)}_setInitialAxisSizes(){this.item.isFlexItemEnabled()?this.item.flexItem._resetLayoutSize():(this.mainAxisSize=this._getMainAxisBasis(),this.crossAxisSize=this._getCrossAxisBasis()),this._resizingMainAxis=!1,this._resizingCrossAxis=!1,this._shrunk=!1}_layoutAxes(){this._layoutMainAxis(),this._layoutCrossAxis()}_layoutMainAxis(){this._layoutLines(),this._fitMainAxisSizeToContents()}_layoutLines(){this._lineLayouter.layoutLines()}get _lines(){return this._lineLayouter.lines}_fitMainAxisSizeToContents(){this._resizingMainAxis||this.isMainAxisFitToContents()&&(this.mainAxisSize=this._lineLayouter.mainAxisContentSize)}_layoutCrossAxis(){const e=new pf(this);e.init(),this._totalCrossAxisSize=e.totalCrossAxisSize,this._fitCrossAxisSizeToContents(),e.align()}_fitCrossAxisSizeToContents(){this._resizingCrossAxis||this.isCrossAxisFitToContents()&&(this.crossAxisSize=this._totalCrossAxisSize)}isWrapping(){return this._flexContainer.wrap}isAxisFitToContents(e){return this._horizontal===e?this.isMainAxisFitToContents():this.isCrossAxisFitToContents()}isMainAxisFitToContents(){return!this.isWrapping()&&!this._hasFixedMainAxisBasis()}isCrossAxisFitToContents(){return!this._hasFixedCrossAxisBasis()}_hasFixedMainAxisBasis(){return!W.isZeroAxisSize(this.item,this._horizontal)}_hasFixedCrossAxisBasis(){return!W.isZeroAxisSize(this.item,!this._horizontal)}getAxisMinSize(e){return this._horizontal===e?this._getMainAxisMinSize():this._getCrossAxisMinSize()}_getMainAxisMinSize(){return this._lineLayouter.mainAxisMinSize}_getCrossAxisMinSize(){return this._lineLayouter.crossAxisMinSize}resizeMainAxis(e){this.mainAxisSize!==e&&(this.recalc>0?this.performResizeMainAxis(e):this._checkValidCacheMainAxisResize()?(this.mainAxisSize=e,this._fitCrossAxisSizeToContents()):(this.item.enableLocalRecalcFlag(),this.performResizeMainAxis(e)))}_checkValidCacheMainAxisResize(e){return e===this.targetMainAxisSize||!this.isCrossAxisFitToContents()}performResizeMainAxis(e){const t=e<this.mainAxisSize;this._shrunk=t,this.mainAxisSize=e,this._resizingMainAxis=!0,this._layoutAxes(),this._resizingMainAxis=!1}resizeCrossAxis(e){this.crossAxisSize!==e&&(this.recalc>0?this.performResizeCrossAxis(e):this.crossAxisSize=e)}performResizeCrossAxis(e){this.crossAxisSize=e,this._resizingCrossAxis=!0,this._layoutCrossAxis(),this._resizingCrossAxis=!1}get targetMainAxisSize(){return this._horizontal?this.item.target.w:this.item.target.h}get targetCrossAxisSize(){return this._horizontal?this.item.target.h:this.item.target.w}getParentFlexContainer(){return this.item.isFlexItemEnabled()?this.item.flexItem.ctr:null}_getHorizontalPadding(){return W.getTotalPadding(this.item,!0)}_getVerticalPadding(){return W.getTotalPadding(this.item,!1)}_getHorizontalPaddingOffset(){return W.getPaddingOffset(this.item,!0)}_getVerticalPaddingOffset(){return W.getPaddingOffset(this.item,!1)}_getMainAxisBasis(){return W.getRelAxisSize(this.item,this._horizontal)}_getCrossAxisBasis(){return W.getRelAxisSize(this.item,!this._horizontal)}get _horizontal(){return this._flexContainer._horizontal}get _reverse(){return this._flexContainer._reverse}get item(){return this._flexContainer.item}get items(){return this.item.items}get resizingMainAxis(){return this._resizingMainAxis}get resizingCrossAxis(){return this._resizingCrossAxis}get numberOfItems(){return this.items.length}get mainAxisSize(){return W.getAxisLayoutSize(this.item,this._horizontal)}get crossAxisSize(){return W.getAxisLayoutSize(this.item,!this._horizontal)}set mainAxisSize(e){W.setAxisLayoutSize(this.item,this._horizontal,e)}set crossAxisSize(e){W.setAxisLayoutSize(this.item,!this._horizontal,e)}}class Ie{constructor(e){this._item=e,this._layout=new Sf(this),this._horizontal=!0,this._reverse=!1,this._wrap=!1,this._alignItems="stretch",this._justifyContent="flex-start",this._alignContent="flex-start",this._paddingLeft=0,this._paddingTop=0,this._paddingRight=0,this._paddingBottom=0}get item(){return this._item}_changedDimensions(){this._item.changedDimensions()}_changedContents(){this._item.changedContents()}get direction(){return(this._horizontal?"row":"column")+(this._reverse?"-reverse":"")}set direction(e){this.direction!==e&&(this._horizontal=e==="row"||e==="row-reverse",this._reverse=e==="row-reverse"||e==="column-reverse",this._changedContents())}set wrap(e){this._wrap=e,this._changedContents()}get wrap(){return this._wrap}get alignItems(){return this._alignItems}set alignItems(e){if(this._alignItems!==e){if(Ie.ALIGN_ITEMS.indexOf(e)===-1)throw new Error("Unknown alignItems, options: "+Ie.ALIGN_ITEMS.join(","));this._alignItems=e,this._changedContents()}}get alignContent(){return this._alignContent}set alignContent(e){if(this._alignContent!==e){if(Ie.ALIGN_CONTENT.indexOf(e)===-1)throw new Error("Unknown alignContent, options: "+Ie.ALIGN_CONTENT.join(","));this._alignContent=e,this._changedContents()}}get justifyContent(){return this._justifyContent}set justifyContent(e){if(this._justifyContent!==e){if(Ie.JUSTIFY_CONTENT.indexOf(e)===-1)throw new Error("Unknown justifyContent, options: "+Ie.JUSTIFY_CONTENT.join(","));this._justifyContent=e,this._changedContents()}}set padding(e){this.paddingLeft=e,this.paddingTop=e,this.paddingRight=e,this.paddingBottom=e}get padding(){return this.paddingLeft}set paddingLeft(e){this._paddingLeft=e,this._changedDimensions()}get paddingLeft(){return this._paddingLeft}set paddingTop(e){this._paddingTop=e,this._changedDimensions()}get paddingTop(){return this._paddingTop}set paddingRight(e){this._paddingRight=e,this._changedDimensions()}get paddingRight(){return this._paddingRight}set paddingBottom(e){this._paddingBottom=e,this._changedDimensions()}get paddingBottom(){return this._paddingBottom}patch(e){xe.patchObject(this,e)}}Ie.ALIGN_ITEMS=["flex-start","flex-end","center","stretch"];Ie.ALIGN_CONTENT=["flex-start","flex-end","center","space-between","space-around","space-evenly","stretch"];Ie.JUSTIFY_CONTENT=["flex-start","flex-end","center","space-between","space-around","space-evenly"];class Ji{constructor(e){this._ctr=null,this._item=e,this._grow=0,this._shrink=Ji.SHRINK_AUTO,this._alignSelf=void 0,this._minWidth=0,this._minHeight=0,this._maxWidth=0,this._maxHeight=0,this._marginLeft=0,this._marginTop=0,this._marginRight=0,this._marginBottom=0}get item(){return this._item}get grow(){return this._grow}set grow(e){this._grow!==e&&(this._grow=parseInt(e)||0,this._changed())}get shrink(){return this._shrink===Ji.SHRINK_AUTO?this._getDefaultShrink():this._shrink}_getDefaultShrink(){return this.item.isFlexEnabled()?1:0}set shrink(e){this._shrink!==e&&(this._shrink=parseInt(e)||0,this._changed())}get alignSelf(){return this._alignSelf}set alignSelf(e){if(this._alignSelf!==e){if(e===void 0)this._alignSelf=void 0;else{if(Ie.ALIGN_ITEMS.indexOf(e)===-1)throw new Error("Unknown alignSelf, options: "+Ie.ALIGN_ITEMS.join(","));this._alignSelf=e}this._changed()}}get minWidth(){return this._minWidth}set minWidth(e){this._minWidth=Math.max(0,e),this._item.changedDimensions(!0,!1)}get minHeight(){return this._minHeight}set minHeight(e){this._minHeight=Math.max(0,e),this._item.changedDimensions(!1,!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth=Math.max(0,e),this._item.changedDimensions(!0,!1)}get maxHeight(){return this._maxHeight}set maxHeight(e){this._maxHeight=Math.max(0,e),this._item.changedDimensions(!1,!0)}set margin(e){this.marginLeft=e,this.marginTop=e,this.marginRight=e,this.marginBottom=e}get margin(){return this.marginLeft}set marginLeft(e){this._marginLeft=e,this._changed()}get marginLeft(){return this._marginLeft}set marginTop(e){this._marginTop=e,this._changed()}get marginTop(){return this._marginTop}set marginRight(e){this._marginRight=e,this._changed()}get marginRight(){return this._marginRight}set marginBottom(e){this._marginBottom=e,this._changed()}get marginBottom(){return this._marginBottom}_changed(){this.ctr&&this.ctr._changedContents()}set ctr(e){this._ctr=e}get ctr(){return this._ctr}patch(e){xe.patchObject(this,e)}_resetLayoutSize(){this._resetHorizontalAxisLayoutSize(),this._resetVerticalAxisLayoutSize()}_resetCrossAxisLayoutSize(){this.ctr._horizontal?this._resetVerticalAxisLayoutSize():this._resetHorizontalAxisLayoutSize()}_resetHorizontalAxisLayoutSize(){let e=W.getRelAxisSize(this.item,!0);this._minWidth&&(e=Math.max(this._minWidth,e)),this._maxWidth&&(e=Math.min(this._maxWidth,e)),W.setAxisLayoutSize(this.item,!0,e)}_resetVerticalAxisLayoutSize(){let e=W.getRelAxisSize(this.item,!1);this._minHeight&&(e=Math.max(this._minHeight,e)),this._maxHeight&&(e=Math.min(this._maxHeight,e)),W.setAxisLayoutSize(this.item,!1,e)}_getCrossAxisMinSizeSetting(){return this._getMinSizeSetting(!this.ctr._horizontal)}_getCrossAxisMaxSizeSetting(){return this._getMaxSizeSetting(!this.ctr._horizontal)}_getMainAxisMaxSizeSetting(){return this._getMaxSizeSetting(this.ctr._horizontal)}_getMinSizeSetting(e){return e?this._minWidth:this._minHeight}_getMaxSizeSetting(e){return e?this._maxWidth:this._maxHeight}_getMainAxisMinSize(){return W.getAxisMinSize(this.item,this.ctr._horizontal)}_getCrossAxisMinSize(){return W.getAxisMinSize(this.item,!this.ctr._horizontal)}_getMainAxisLayoutSize(){return W.getAxisLayoutSize(this.item,this.ctr._horizontal)}_getMainAxisLayoutPos(){return W.getAxisLayoutPos(this.item,this.ctr._horizontal)}_setMainAxisLayoutPos(e){return W.setAxisLayoutPos(this.item,this.ctr._horizontal,e)}_setCrossAxisLayoutPos(e){return W.setAxisLayoutPos(this.item,!this.ctr._horizontal,e)}_getCrossAxisLayoutSize(){return W.getAxisLayoutSize(this.item,!this.ctr._horizontal)}_resizeCrossAxis(e){return W.resizeAxis(this.item,!this.ctr._horizontal,e)}_resizeMainAxis(e){return W.resizeAxis(this.item,this.ctr._horizontal,e)}_getMainAxisPadding(){return W.getTotalPadding(this.item,this.ctr._horizontal)}_getCrossAxisPadding(){return W.getTotalPadding(this.item,!this.ctr._horizontal)}_getMainAxisMargin(){return W.getTotalMargin(this.item,this.ctr._horizontal)}_getCrossAxisMargin(){return W.getTotalMargin(this.item,!this.ctr._horizontal)}_getHorizontalMarginOffset(){return W.getMarginOffset(this.item,!0)}_getVerticalMarginOffset(){return W.getMarginOffset(this.item,!1)}_getMainAxisMinSizeWithPaddingAndMargin(){return this._getMainAxisMinSize()+this._getMainAxisPadding()+this._getMainAxisMargin()}_getCrossAxisMinSizeWithPaddingAndMargin(){return this._getCrossAxisMinSize()+this._getCrossAxisPadding()+this._getCrossAxisMargin()}_getMainAxisLayoutSizeWithPaddingAndMargin(){return this._getMainAxisLayoutSize()+this._getMainAxisPadding()+this._getMainAxisMargin()}_getCrossAxisLayoutSizeWithPaddingAndMargin(){return this._getCrossAxisLayoutSize()+this._getCrossAxisPadding()+this._getCrossAxisMargin()}_hasFixedCrossAxisSize(){return!W.isZeroAxisSize(this.item,!this.ctr._horizontal)}_hasRelCrossAxisSize(){return!!(this.ctr._horizontal?this.item.funcH:this.item.funcW)}}Ji.SHRINK_AUTO=-1;class bf{constructor(e){this._target=e,this._recalc=0,this._enabled=!1,this.x=0,this.y=0,this.w=0,this.h=0,this._originalX=0,this._originalY=0,this._originalWidth=0,this._originalHeight=0,this._flex=null,this._flexItem=null,this._flexItemDisabled=!1,this._items=null}get flexLayout(){return this.flex?this.flex._layout:null}layoutFlexTree(){this.isFlexEnabled()&&this.isChanged()&&this.flexLayout.layoutTree()}get target(){return this._target}get flex(){return this._flex}set flex(e){e?(this.isFlexEnabled()||this._enableFlex(),this._flex.patch(e)):this.isFlexEnabled()&&this._disableFlex()}get flexItem(){return this._flexItemDisabled?!1:(this._ensureFlexItem(),this._flexItem)}set flexItem(e){if(e===!1){if(!this._flexItemDisabled){const t=this.flexParent;this._flexItemDisabled=!0,this._checkEnabled(),t&&(t._clearFlexItemsCache(),t.changedContents())}}else if(this._ensureFlexItem(),this._flexItem.patch(e),this._flexItemDisabled){this._flexItemDisabled=!1,this._checkEnabled();const t=this.flexParent;t&&(t._clearFlexItemsCache(),t.changedContents())}}_enableFlex(){this._flex=new Ie(this),this._checkEnabled(),this.changedDimensions(),this._enableChildrenAsFlexItems()}_disableFlex(){this.changedDimensions(),this._flex=null,this._checkEnabled(),this._disableChildrenAsFlexItems()}_enableChildrenAsFlexItems(){const e=this._target._children;if(e)for(let t=0,i=e.length;t<i;t++)e[t].layout._enableFlexItem()}_disableChildrenAsFlexItems(){const e=this._target._children;if(e)for(let t=0,i=e.length;t<i;t++)e[t].layout._disableFlexItem()}_enableFlexItem(){if(this._ensureFlexItem(),this._target._parent){const e=this._target._parent._layout;this._flexItem.ctr=e._flex,e.changedContents()}this._checkEnabled()}_disableFlexItem(){this._flexItem&&(this._flexItem.ctr=null),this._checkEnabled(),this._resetOffsets()}_resetOffsets(){this.x=0,this.y=0}_ensureFlexItem(){this._flexItem||(this._flexItem=new Ji(this))}_checkEnabled(){const e=this.isEnabled();this._enabled!==e&&(e?this._enable():this._disable(),this._enabled=e)}_enable(){this._setupTargetForFlex(),this._target.enableFlexLayout()}_disable(){this._restoreTargetToNonFlex(),this._target.disableFlexLayout()}isEnabled(){return this.isFlexEnabled()||this.isFlexItemEnabled()}isFlexEnabled(){return this._flex!==null}isFlexItemEnabled(){return this.flexParent!==null}_restoreTargetToNonFlex(){const e=this._target;e.x=this._originalX,e.y=this._originalY,e.setDimensions(this._originalWidth,this._originalHeight)}_setupTargetForFlex(){const e=this._target;this._originalX=e._x,this._originalY=e._y,this._originalWidth=e._w,this._originalHeight=e._h}setParent(e,t){e&&e.isFlexContainer()&&e._layout._changedChildren(),t&&t.isFlexContainer()&&(this._enableFlexItem(),t._layout._changedChildren()),this._checkEnabled()}get flexParent(){if(this._flexItemDisabled)return null;const e=this._target._parent;return e&&e.isFlexContainer()?e._layout:null}setVisible(e){const t=this.flexParent;t&&t._changedChildren()}get items(){return this._items||(this._items=this._getFlexItems()),this._items}_getFlexItems(){const e=[],t=this._target._children;if(t)for(let i=0,s=t.length;i<s;i++){const n=t[i];n.visible&&n.isFlexItem()&&e.push(n.layout)}return e}_changedChildren(){this._clearFlexItemsCache(),this.changedContents()}_clearFlexItemsCache(){this._items=null}setLayout(e,t,i,s){let n=this._originalX,o=this._originalY;this.funcX&&(n=this.funcX(W.getParentAxisSizeWithPadding(this,!0))),this.funcY&&(o=this.funcY(W.getParentAxisSizeWithPadding(this,!1))),this.isFlexItemEnabled()?this.target.setLayout(e+n,t+o,i,s):this.target.setLayout(n,o,i,s)}changedDimensions(e=!0,t=!0){this._updateRecalc(e,t)}changedContents(){this._updateRecalc()}forceLayout(){this._updateRecalc()}isChanged(){return this._recalc>0}_updateRecalc(e=!1,t=!1){if(this.isFlexEnabled()){const n=this._flex._layout;e=e||n.isAxisFitToContents(!0),t=t||n.isAxisFitToContents(!1)}const i=1+(e?2:0)+(t?4:0),s=this.getNewRecalcFlags(i);this._recalc|=i,s>1?this.flexParent?this.flexParent._updateRecalcBottomUp(i):this._target.triggerLayout():this._target.triggerLayout()}getNewRecalcFlags(e){return 7-this._recalc&e}_updateRecalcBottomUp(e){const t=this._getRecalcFromChangedChildRecalc(e),i=this.getNewRecalcFlags(t);if(this._recalc|=t,i>1){const s=this.flexParent;s?s._updateRecalcBottomUp(t):this._target.triggerLayout()}else this._target.triggerLayout()}_getRecalcFromChangedChildRecalc(e){const t=this._flex._layout,i=t._horizontal?1:2,s=t._horizontal?2:1;e&s||e&i&&t.isWrapping()&&t.isCrossAxisFitToContents()&&(e+=s);let o=t.isAxisFitToContents(!0),a=t.isAxisFitToContents(!1);t.shrunk&&(t._horizontal?o=!0:a=!0);const l=1+(o?2:0)+(a?4:0);return e&l}get recalc(){return this._recalc}clearRecalcFlag(){this._recalc=0}enableLocalRecalcFlag(){this._recalc=1}get originalX(){return this._originalX}setOriginalXWithoutUpdatingLayout(e){this._originalX=e}get originalY(){return this._originalY}setOriginalYWithoutUpdatingLayout(e){this._originalY=e}get originalWidth(){return this._originalWidth}set originalWidth(e){this._originalWidth!==e&&(this._originalWidth=e,this.changedDimensions(!0,!1))}get originalHeight(){return this._originalHeight}set originalHeight(e){this._originalHeight!==e&&(this._originalHeight=e,this.changedDimensions(!1,!0))}get funcX(){return this._target.funcX}get funcY(){return this._target.funcY}get funcW(){return this._target.funcW}get funcH(){return this._target.funcH}}class zi{constructor(e,t=null){this.id=zi.id++,this.manager=e,this.stage=e.stage,this.textures=new Set,this._activeTextureCount=0,this.loader=t,this.lookupId=null,this._cancelCb=null,this.loadingSince=0,this.w=0,this.h=0,this._nativeTexture=null,this.permanent=!1,this.renderInfo=null,this._isResultTexture=!this.loader,this._loadError=null,this._imageRef=null,this._hasAlpha=!1}get hasAlpha(){return this._hasAlpha}get loadError(){return this._loadError}addTexture(e){this.textures.has(e)||this.textures.add(e)}removeTexture(e){this.textures.delete(e)}incActiveTextureCount(){this._activeTextureCount++,this._activeTextureCount===1&&this.becomesUsed()}decActiveTextureCount(){this._activeTextureCount--,this._activeTextureCount===0&&this.becomesUnused()}get isResultTexture(){return this._isResultTexture}set isResultTexture(e){this._isResultTexture=e}forEachEnabledElement(e){this.textures.forEach(t=>{t.elements.forEach(e)})}hasEnabledElements(){return this.textures.size>0}forEachActiveElement(e){this.textures.forEach(t=>{t.elements.forEach(i=>{i.active&&e(i)})})}getRenderWidth(){return this.w}getRenderHeight(){return this.h}allowCleanup(){return!this.permanent&&!this.isUsed()}becomesUsed(){this.load()}becomesUnused(){this.cancel()}cancel(){this.isLoading()&&(this._cancelCb&&(this._cancelCb(this),this._cancelCb=null),this.loadingSince=0)}isLoaded(){return!!this._nativeTexture}isLoading(){return this.loadingSince>0}isError(){return!!this._loadError}reload(){this.free(),this.isUsed()&&this.load()}load(e=!1){this.isResultTexture||!this._nativeTexture&&!this.isLoading()&&(this.loadingSince=new Date().getTime(),this._cancelCb=this.loader((t,i)=>{if(this.isLoading()){if(this._cancelCb=null,this.manager.stage.destroyed)return;if(t)this.onError(t);else if(i&&i.source)if(!this.stage.isUpdatingFrame()&&!e&&i.throttle!==!1){const s=this.stage.textureThrottler;this._cancelCb=s.genericCancelCb,s.add(this,i)}else this.processLoadedSource(i)}},this))}processLoadedSource(e){this.loadingSince=0,this.setSource(e)}setSource(e){const t=e.source;this._hasAlpha=e&&e.hasAlpha||!1,this.w=t.width||e&&e.w||0,this.h=t.height||e&&e.h||0,e&&e.renderInfo&&(this.renderInfo=e.renderInfo),this.permanent=!!e.permanent,e&&e.imageRef&&(this._imageRef=e.imageRef),e&&e.flipTextureY?this._flipTextureY=e.flipTextureY:this._flipTextureY=!1,this._isNativeTexture(t)?(this._nativeTexture=t,this.w=this.w||t.w,this.h=this.h||t.h,this.permanent=e.hasOwnProperty("permanent")?e.permanent:!0):this.manager.uploadTextureSource(this,e),this._loadError=null,this.onLoad()}isUsed(){return this._activeTextureCount>0}onLoad(){this.isUsed()&&this.textures.forEach(e=>{e.onLoad()})}forceRenderUpdate(){this._nativeTexture&&(this._nativeTexture.update=this.stage.frameCounter),this.forEachActiveElement(function(e){e.forceRenderUpdate()})}forceUpdateRenderCoords(){this.forEachActiveElement(function(e){e._updateTextureCoords()})}get nativeTexture(){return this._nativeTexture}clearNativeTexture(){this._nativeTexture=null,this._imageRef=null}replaceNativeTexture(e,t,i){let s=this._nativeTexture;this._nativeTexture=e,this.w=t,this.h=i,!s&&this._nativeTexture&&this.forEachActiveElement(n=>n.onTextureSourceLoaded()),this._nativeTexture||this.forEachActiveElement(n=>n._setDisplayedTexture(null)),this.forEachEnabledElement(n=>n._updateDimensions())}onError(e){this._loadError=e,this.loadingSince=0,console.error("[Lightning] texture load error",e,this.lookupId),this.forEachActiveElement(t=>t.onTextureSourceLoadError(e))}free(){this.isLoaded()&&this.manager.freeTextureSource(this)}_isNativeTexture(e){return w.isNode?e.constructor.name==="WebGLTexture":"WebGLTexture"in window?e instanceof WebGLTexture:!1}}zi.prototype.isTextureSource=!0;zi.id=1;class nl{constructor(e){this._element=e.element,this._core=e,this.ctx=this._core.ctx,this._enabled=!1,this.lazy=!1,this._colorize=!1,this._renderTexture=null,this._renderTextureReused=!1,this._resultTextureSource=null,this._renderOffscreen=!1,this.empty=!1}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._core.updateRenderToTextureEnabled()}get renderOffscreen(){return this._renderOffscreen}set renderOffscreen(e){this._renderOffscreen=e,this._core.setHasRenderUpdates(1),this._core._setRecalc(6)}get colorize(){return this._colorize}set colorize(e){this._colorize!==e&&(this._colorize=e,this._core.setHasRenderUpdates(1))}_getTextureSource(){return this._resultTextureSource||(this._resultTextureSource=new zi(this._element.stage.textureManager),this.updateResultTexture()),this._resultTextureSource}hasResultTexture(){return!!this._resultTextureSource}resultTextureInUse(){return this._resultTextureSource&&this._resultTextureSource.hasEnabledElements()}updateResultTexture(){let e=this.getResultTexture();if(this._resultTextureSource){if(this._resultTextureSource.nativeTexture!==e){let t=e?e.w:0,i=e?e.h:0;this._resultTextureSource.replaceNativeTexture(e,t,i)}this._resultTextureSource.forEachEnabledElement(t=>{t._updateDimensions(),t.core.setHasRenderUpdates(3)})}}mustRenderToTexture(){return this._enabled&&!this.lazy?!0:!!(this._enabled&&this.lazy&&this._core._hasRenderUpdates<3)}deactivate(){this.release()}get renderTextureReused(){return this._renderTextureReused}release(){this.releaseRenderTexture()}releaseRenderTexture(){this._renderTexture&&(this._renderTextureReused||this.ctx.releaseRenderTexture(this._renderTexture),this._renderTexture=null,this._renderTextureReused=!1,this.updateResultTexture())}reuseTextureAsRenderTexture(e){this._renderTexture!==e&&(this.releaseRenderTexture(),this._renderTexture=e,this._renderTextureReused=!0)}hasRenderTexture(){return!!this._renderTexture}getRenderTexture(){return this._renderTexture||(this._renderTexture=this.ctx.allocateRenderTexture(this._core._w,this._core._h),this._renderTextureReused=!1),this._renderTexture}getResultTexture(){return this._renderTexture}}class Ft{constructor(e){this._element=e,this.ctx=e.stage.ctx,this._recalc=0,this._parent=null,this._onUpdate=null,this._pRecalc=0,this._worldContext=new Gt,this._hasUpdates=!1,this._localAlpha=1,this._onAfterCalcs=null,this._onAfterUpdate=null,this._localPx=0,this._localPy=0,this._localTa=1,this._localTb=0,this._localTc=0,this._localTd=1,this._isComplex=!1,this._dimsUnknown=!1,this._clipping=!1,this._zSort=!1,this._outOfBounds=0,this._displayedTextureSource=null,this._zContextUsage=0,this._children=null,this._hasRenderUpdates=0,this._zIndexedChildren=null,this._renderContext=this._worldContext,this.renderState=this.ctx.renderState,this._scissor=null,this._shaderOwner=null,this._updateTreeOrder=0,this._colorUl=this._colorUr=this._colorBl=this._colorBr=4294967295,this._x=0,this._y=0,this._w=0,this._h=0,this._optFlags=0,this._funcX=null,this._funcY=null,this._funcW=null,this._funcH=null,this._scaleX=1,this._scaleY=1,this._pivotX=.5,this._pivotY=.5,this._mountX=0,this._mountY=0,this._rotation=0,this._alpha=1,this._visible=!0,this._ulx=0,this._uly=0,this._brx=1,this._bry=1,this._zIndex=0,this._forceZIndexContext=!1,this._zParent=null,this._isRoot=!1,this._zIndexResort=!1,this._shader=null,this._renderToTextureEnabled=!1,this._texturizer=null,this._useRenderToTexture=!1,this._boundsMargin=null,this._recBoundsMargin=null,this._withinBoundsMargin=!1,this._viewport=null,this._clipbox=!0,this.render=this._renderSimple,this._layout=null}get offsetX(){return this._funcX?this._funcX:this.hasFlexLayout()?this._layout.originalX:this._x}set offsetX(e){w.isFunction(e)?this.funcX=e:(this._disableFuncX(),this.hasFlexLayout()?(this.x+=e-this._layout.originalX,this._layout.setOriginalXWithoutUpdatingLayout(e)):this.x=e)}get x(){return this._x}set x(e){e!==this._x&&(this._updateLocalTranslateDelta(e-this._x,0),this._x=e)}get funcX(){return this._optFlags&1?this._funcX:null}set funcX(e){this._funcX!==e&&(this._optFlags|=1,this._funcX=e,this.hasFlexLayout()?(this._layout.setOriginalXWithoutUpdatingLayout(0),this.layout.forceLayout()):(this._x=0,this._triggerRecalcTranslate()))}_disableFuncX(){this._optFlags=this._optFlags&65534,this._funcX=null}get offsetY(){return this._funcY?this._funcY:this.hasFlexLayout()?this._layout.originalY:this._y}set offsetY(e){w.isFunction(e)?this.funcY=e:(this._disableFuncY(),this.hasFlexLayout()?(this.y+=e-this._layout.originalY,this._layout.setOriginalYWithoutUpdatingLayout(e)):this.y=e)}get y(){return this._y}set y(e){e!==this._y&&(this._updateLocalTranslateDelta(0,e-this._y),this._y=e)}get funcY(){return this._optFlags&2?this._funcY:null}set funcY(e){this._funcY!==e&&(this._optFlags|=2,this._funcY=e,this.hasFlexLayout()?(this._layout.setOriginalYWithoutUpdatingLayout(0),this.layout.forceLayout()):(this._y=0,this._triggerRecalcTranslate()))}_disableFuncY(){this._optFlags=this._optFlags&65533,this._funcY=null}get funcW(){return this._optFlags&4?this._funcW:null}set funcW(e){this._funcW!==e&&(this._optFlags|=4,this._funcW=e,this.hasFlexLayout()?(this._layout._originalWidth=0,this.layout.changedDimensions(!0,!1)):(this._w=0,this._triggerRecalcTranslate()))}disableFuncW(){this._optFlags=this._optFlags&65531,this._funcW=null}get funcH(){return this._optFlags&8?this._funcH:null}set funcH(e){this._funcH!==e&&(this._optFlags|=8,this._funcH=e,this.hasFlexLayout()?(this._layout._originalHeight=0,this.layout.changedDimensions(!1,!0)):(this._h=0,this._triggerRecalcTranslate()))}disableFuncH(){this._optFlags=this._optFlags&65527,this._funcH=null}get w(){return this._w}getRenderWidth(){return this.hasFlexLayout()?this._layout.originalWidth:this._w}get h(){return this._h}getRenderHeight(){return this.hasFlexLayout()?this._layout.originalHeight:this._h}get scaleX(){return this._scaleX}set scaleX(e){this._scaleX!==e&&(this._scaleX=e,this._updateLocalTransform())}get scaleY(){return this._scaleY}set scaleY(e){this._scaleY!==e&&(this._scaleY=e,this._updateLocalTransform())}get scale(){return this.scaleX}set scale(e){(this._scaleX!==e||this._scaleY!==e)&&(this._scaleX=e,this._scaleY=e,this._updateLocalTransform())}get pivotX(){return this._pivotX}set pivotX(e){this._pivotX!==e&&(this._pivotX=e,this._updateLocalTranslate())}get pivotY(){return this._pivotY}set pivotY(e){this._pivotY!==e&&(this._pivotY=e,this._updateLocalTranslate())}get pivot(){return this._pivotX}set pivot(e){(this._pivotX!==e||this._pivotY!==e)&&(this._pivotX=e,this._pivotY=e,this._updateLocalTranslate())}get mountX(){return this._mountX}set mountX(e){this._mountX!==e&&(this._mountX=e,this._updateLocalTranslate())}get mountY(){return this._mountY}set mountY(e){this._mountY!==e&&(this._mountY=e,this._updateLocalTranslate())}get mount(){return this._mountX}set mount(e){(this._mountX!==e||this._mountY!==e)&&(this._mountX=e,this._mountY=e,this._updateLocalTranslate())}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._updateLocalTransform())}get alpha(){return this._alpha}set alpha(e){if(e=e>1?1:e<1e-14?0:e,this._alpha!==e){let t=this._alpha;this._alpha=e,this._updateLocalAlpha(),t===0!=(e===0)&&this._element._updateEnabledFlag()}}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this._updateLocalAlpha(),this._element._updateEnabledFlag(),this.hasFlexLayout()&&this.layout.setVisible(e))}_updateLocalTransform(){if(this._rotation!==0&&this._rotation%(2*Math.PI)){let e=Math.sin(this._rotation),t=Math.cos(this._rotation);this._setLocalTransform(t*this._scaleX,-e*this._scaleY,e*this._scaleX,t*this._scaleY)}else this._setLocalTransform(this._scaleX,0,0,this._scaleY);this._updateLocalTranslate()}_updateLocalTranslate(){this._recalcLocalTranslate(),this._triggerRecalcTranslate()}_recalcLocalTranslate(){let e=this._pivotX*this._w,t=this._pivotY*this._h,i=this._x-(e*this._localTa+t*this._localTb)+e,s=this._y-(e*this._localTc+t*this._localTd)+t;i-=this._mountX*this._w,s-=this._mountY*this._h,this._localPx=i,this._localPy=s}_updateLocalTranslateDelta(e,t){this._addLocalTranslate(e,t)}_updateLocalAlpha(){this._setLocalAlpha(this._visible?this._alpha:0)}setHasRenderUpdates(e){if(this._worldContext.alpha){let t=this;for(t._hasRenderUpdates=Math.max(e,t._hasRenderUpdates);(t=t._parent)&&t._hasRenderUpdates!==3;)t._hasRenderUpdates=3}}_setRecalc(e){this._recalc|=e,this._setHasUpdates(),this._parent&&this._parent.setHasRenderUpdates(3)}_setHasUpdates(){let e=this;for(;e&&!e._hasUpdates;)e._hasUpdates=!0,e=e._parent}getParent(){return this._parent}setParent(e){if(e!==this._parent){let t=this.isZContext(),i=this._parent;if(this._parent=e,(this._layout||e&&e.isFlexContainer())&&this.layout.setParent(i,e),i&&i.setHasRenderUpdates(3),this._setRecalc(7),this._parent&&this._parent._setHasUpdates(),this._zIndex===0?this.setZParent(e):this.setZParent(e?e.findZContext():null),t!==this.isZContext()&&(this.isZContext()?this.enableZContext(i.findZContext()):this.disableZContext()),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort(),!this._shader){let s=e&&!e._renderToTextureEnabled?e._shaderOwner:null;s!==this._shaderOwner&&(this.setHasRenderUpdates(1),this._setShaderOwnerRecursive(s))}}}enableZSort(e=!1){!this._zSort&&this._zContextUsage>0&&(this._zSort=!0,e&&this.ctx.forceZSort(this))}addChildAt(e,t){this._children||(this._children=[]),this._children.splice(e,0,t),t.setParent(this)}setChildAt(e,t){this._children||(this._children=[]),this._children[e].setParent(null),this._children[e]=t,t.setParent(this)}removeChildAt(e){let t=this._children[e];this._children.splice(e,1),t.setParent(null)}removeChildren(){if(this._children){for(let e=0,t=this._children.length;e<t;e++)this._children[e].setParent(null);this._children.splice(0),this._zIndexedChildren&&this._zIndexedChildren.splice(0)}}syncChildren(e,t,i){this._children=i;for(let s=0,n=e.length;s<n;s++)e[s].setParent(null);for(let s=0,n=t.length;s<n;s++)t[s].setParent(this)}moveChild(e,t){let i=this._children[e];this._children.splice(e,1),this._children.splice(t,0,i),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort()}_setLocalTransform(e,t,i,s){this._setRecalc(4),this._localTa=e,this._localTb=t,this._localTc=i,this._localTd=s,this._isComplex=t!==0||i!==0||e<0||s<0}_addLocalTranslate(e,t){this._localPx+=e,this._localPy+=t,this._triggerRecalcTranslate()}_setLocalAlpha(e){!this._worldContext.alpha&&this._parent&&this._parent._worldContext.alpha&&e?this._setRecalc(129):this._setRecalc(1),e<1e-14&&(e=0),this._localAlpha=e}setDimensions(e,t,i=this._dimsUnknown){if(this._dimsUnknown=i,this.hasFlexLayout())this._layout.originalWidth=e,this._layout.originalHeight=t;else if(this._w!==e||this._h!==t)return this._updateDimensions(e,t),!0;return!1}_updateDimensions(e,t){(this._w!==e||this._h!==t)&&(this._w=e,this._h=t,this._triggerRecalcTranslate(),this._texturizer&&(this._texturizer.releaseRenderTexture(),this._texturizer.updateResultTexture()),this._updateLocalTranslate())}setTextureCoords(e,t,i,s){this.setHasRenderUpdates(3),this._ulx=e,this._uly=t,this._brx=i,this._bry=s}get displayedTextureSource(){return this._displayedTextureSource}setDisplayedTextureSource(e){this.setHasRenderUpdates(3),this._displayedTextureSource=e}get isRoot(){return this._isRoot}setAsRoot(){this._parent=new Ft(this._element),this._parent._hasRenderUpdates=3,this._parent._hasUpdates=!0,this._isRoot=!0,this.ctx.root=this,this._parent._viewport=[0,0,this.ctx.stage.coordsWidth,this.ctx.stage.coordsHeight],this._parent._scissor=this._parent._viewport,this._parent._recBoundsMargin=null,this._setRecalc(7)}isAncestorOf(e){let t=e;for(;t=t._parent;)if(this===t)return!0;return!1}isZContext(){return this._forceZIndexContext||this._renderToTextureEnabled||this._zIndex!==0||this._isRoot||!this._parent}findZContext(){return this.isZContext()?this:this._parent.findZContext()}setZParent(e){if(this._zParent!==e){if(this._zParent!==null&&(this._zIndex!==0&&this._zParent.decZContextUsage(),this._zParent.enableZSort()),e!==null){let t=e._zContextUsage>0;this._zIndex!==0&&e.incZContextUsage(),e._zContextUsage>0&&(!t&&this._parent===e||e._zIndexedChildren.push(this),e.enableZSort())}this._zParent=e,this._zIndexResort=!0}}incZContextUsage(){if(this._zContextUsage++,this._zContextUsage===1&&(this._zIndexedChildren||(this._zIndexedChildren=[]),this._children)){for(let e=0,t=this._children.length;e<t;e++)this._zIndexedChildren.push(this._children[e]);this._zSort=!1}}decZContextUsage(){this._zContextUsage--,this._zContextUsage===0&&(this._zSort=!1,this._zIndexedChildren.splice(0))}get zIndex(){return this._zIndex}set zIndex(e){if(this._zIndex!==e){this.setHasRenderUpdates(1);let t=this._zParent,i=this.isZContext();e===0&&this._zIndex!==0?this._parent===this._zParent?this._zParent&&this._zParent.decZContextUsage():t=this._parent:e!==0&&this._zIndex===0?(t=this._parent?this._parent.findZContext():null,t===this._zParent&&this._zParent&&(this._zParent.incZContextUsage(),this._zParent.enableZSort())):e!==this._zIndex&&this._zParent&&this._zParent._zContextUsage&&this._zParent.enableZSort(),t!==this._zParent&&this.setZParent(null),this._zIndex=e,t!==this._zParent&&this.setZParent(t),i!==this.isZContext()&&(this.isZContext()?this.enableZContext(this._parent.findZContext()):this.disableZContext()),this._zIndexResort=!0,this._zParent&&this._zParent.enableZSort()}}get forceZIndexContext(){return this._forceZIndexContext}set forceZIndexContext(e){this.setHasRenderUpdates(1);let t=this.isZContext();this._forceZIndexContext=e,t!==this.isZContext()&&(this.isZContext()?this.enableZContext(this._parent.findZContext()):this.disableZContext())}enableZContext(e){e&&e._zContextUsage>0&&this._getZIndexedDescs().forEach(i=>{this.isAncestorOf(i)&&i._zIndex!==0&&i.setZParent(this)})}_getZIndexedDescs(){const e=[];if(this._children)for(let t=0,i=this._children.length;t<i;t++)this._children[t]._getZIndexedDescsRec(e);return e}_getZIndexedDescsRec(e){if(this._zIndex)e.push(this);else if(this._children&&!this.isZContext())for(let t=0,i=this._children.length;t<i;t++)this._children[t]._getZIndexedDescsRec(e)}disableZContext(){if(this._zContextUsage>0){let e=this._parent.findZContext();this._zSort&&this.sortZIndexedChildren(),this._zIndexedChildren.slice().forEach(function(t){t._zIndex!==0&&t.setZParent(e)})}}get colorUl(){return this._colorUl}set colorUl(e){this._colorUl!==e&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorUl=e)}get colorUr(){return this._colorUr}set colorUr(e){this._colorUr!==e&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorUr=e)}get colorBl(){return this._colorBl}set colorBl(e){this._colorBl!==e&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorBl=e)}get colorBr(){return this._colorBr}set colorBr(e){this._colorBr!==e&&(this.setHasRenderUpdates(this._displayedTextureSource?3:1),this._colorBr=e)}set onUpdate(e){this._onUpdate=e,this._setRecalc(7)}set onAfterUpdate(e){this._onAfterUpdate=e,this._setRecalc(7)}set onAfterCalcs(e){this._onAfterCalcs=e,this._setRecalc(7)}get shader(){return this._shader}set shader(e){this.setHasRenderUpdates(1);let t=this._shader;if(this._shader=e,!e&&t){let i=this._parent&&!this._parent._renderToTextureEnabled?this._parent._shaderOwner:null;this._setShaderOwnerRecursive(i)}else e&&this._setShaderOwnerRecursive(this)}get activeShader(){return this._shaderOwner?this._shaderOwner.shader:this.renderState.defaultShader}get activeShaderOwner(){return this._shaderOwner}get clipping(){return this._clipping}set clipping(e){this._clipping!==e&&(this._clipping=e,this._setRecalc(3))}get clipbox(){return this._clipbox}set clipbox(e){this._clipbox=e}_setShaderOwnerRecursive(e){if(this._shaderOwner=e,this._children&&!this._renderToTextureEnabled)for(let t=0,i=this._children.length;t<i;t++){let s=this._children[t];s._shader||(s._setShaderOwnerRecursive(e),s._hasRenderUpdates=3)}}_setShaderOwnerChildrenRecursive(e){if(this._children)for(let t=0,i=this._children.length;t<i;t++){let s=this._children[t];s._shader||(s._setShaderOwnerRecursive(e),s._hasRenderUpdates=3)}}_hasRenderContext(){return this._renderContext!==this._worldContext}get renderContext(){return this._renderContext}updateRenderToTextureEnabled(){this.texturizer._enabled?this._enableRenderToTexture():(this._disableRenderToTexture(),this._texturizer.releaseRenderTexture())}_enableRenderToTexture(){if(!this._renderToTextureEnabled){let e=this.isZContext();this._renderToTextureEnabled=!0,this._renderContext=new Gt,this._setShaderOwnerChildrenRecursive(null),e||this.enableZContext(this._parent?this._parent.findZContext():null),this.setHasRenderUpdates(3),this._setRecalc(7),this.render=this._renderAdvanced}}_disableRenderToTexture(){this._renderToTextureEnabled&&(this._renderToTextureEnabled=!1,this._setShaderOwnerChildrenRecursive(this._shaderOwner),this._renderContext=this._worldContext,this.isZContext()||this.disableZContext(),this._setRecalc(7),this.setHasRenderUpdates(3),this.render=this._renderSimple)}isWhite(){return this._colorUl===4294967295&&this._colorUr===4294967295&&this._colorBl===4294967295&&this._colorBr===4294967295}hasSimpleTexCoords(){return this._ulx===0&&this._uly===0&&this._brx===1&&this._bry===1}_stashTexCoords(){this._stashedTexCoords=[this._ulx,this._uly,this._brx,this._bry],this._ulx=0,this._uly=0,this._brx=1,this._bry=1}_unstashTexCoords(){this._ulx=this._stashedTexCoords[0],this._uly=this._stashedTexCoords[1],this._brx=this._stashedTexCoords[2],this._bry=this._stashedTexCoords[3],this._stashedTexCoords=null}_stashColors(){this._stashedColors=[this._colorUl,this._colorUr,this._colorBr,this._colorBl],this._colorUl=4294967295,this._colorUr=4294967295,this._colorBr=4294967295,this._colorBl=4294967295}_unstashColors(){this._colorUl=this._stashedColors[0],this._colorUr=this._stashedColors[1],this._colorBr=this._stashedColors[2],this._colorBl=this._stashedColors[3],this._stashedColors=null}isVisible(){return this._localAlpha>1e-14}get outOfBounds(){return this._outOfBounds}set boundsMargin(e){this._boundsMargin=e?e.slice():null,this._triggerRecalcTranslate()}get boundsMargin(){return this._boundsMargin}update(){this._recalc|=this._parent._pRecalc,this._layout&&this._layout.isEnabled()?this._recalc&256&&this._layout.layoutFlexTree():this._recalc&2&&this._optFlags&&this._applyRelativeDimFuncs(),this._onUpdate&&(this._hasUpdates=!0,this._onUpdate(this.element,this));const e=this._parent._worldContext;let t=this._worldContext;const i=e.alpha&&this._localAlpha;if(this._hasUpdates||this._recalc&&i||t.alpha&&!i){let s=this._recalc;s&1&&(!t.alpha&&i&&(this._hasRenderUpdates=3),t.alpha=e.alpha*this._localAlpha,t.alpha<1e-14&&(t.alpha=0)),s&6&&(t.px=e.px+this._localPx*e.ta,t.py=e.py+this._localPy*e.td,e.tb!==0&&(t.px+=this._localPy*e.tb),e.tc!==0&&(t.py+=this._localPx*e.tc)),s&4&&(t.ta=this._localTa*e.ta,t.tb=this._localTd*e.tb,t.tc=this._localTa*e.tc,t.td=this._localTd*e.td,this._isComplex&&(t.ta+=this._localTc*e.tb,t.tb+=this._localTb*e.ta,t.tc+=this._localTc*e.td,t.td+=this._localTb*e.tc));const n=this._parent._renderContext;if(this._parent._hasRenderContext()){const g=this._renderContext===this._worldContext;g&&(this._renderContext=new Gt);const x=this._renderContext;(g||s&1)&&(x.alpha=n.alpha*this._localAlpha,x.alpha<1e-14&&(x.alpha=0)),(g||s&6)&&(x.px=n.px+this._localPx*n.ta,x.py=n.py+this._localPy*n.td,n.tb!==0&&(x.px+=this._localPy*n.tb),n.tc!==0&&(x.py+=this._localPx*n.tc)),g&&(s|=2),(g||s&4)&&(x.ta=this._localTa*n.ta,x.tb=this._localTd*n.tb,x.tc=this._localTa*n.tc,x.td=this._localTd*n.td,this._isComplex&&(x.ta+=this._localTc*n.tb,x.tb+=this._localTb*n.ta,x.tc+=this._localTc*n.td,x.td+=this._localTb*n.tc))}else this._renderContext=this._worldContext;this.ctx.updateTreeOrder===-1?this.ctx.updateTreeOrder=this._updateTreeOrder+1:this._updateTreeOrder=this.ctx.updateTreeOrder++;const o=this._renderToTextureEnabled&&this._texturizer.mustRenderToTexture();this._useRenderToTexture!==o&&(this._recalc|=6,s|=2,this._useRenderToTexture||this._texturizer.release()),this._useRenderToTexture=o;const a=this._renderContext,l=this._dimsUnknown?2048:this._w,h=this._dimsUnknown?2048:this._h;let u,f,c,p;const _=a.tb!==0||a.tc!==0||a.ta<0||a.td<0;if(_?(u=Math.min(0,l*a.ta,l*a.ta+h*a.tb,h*a.tb)+a.px,c=Math.max(0,l*a.ta,l*a.ta+h*a.tb,h*a.tb)+a.px,f=Math.min(0,l*a.tc,l*a.tc+h*a.td,h*a.td)+a.py,p=Math.max(0,l*a.tc,l*a.tc+h*a.td,h*a.td)+a.py):(u=a.px,c=a.px+a.ta*l,f=a.py,p=a.py+a.td*h),this._dimsUnknown&&(_||this._localTa<1||this._localTb<1)){const g=this._x*n.ta+this._y*n.tb+n.px,x=this._x*n.tc+this._y*n.td+n.py;g<u&&(u=g),x<f&&(f=x),g>c&&(c=g),x>p&&(p=x)}if(s&6||!this._scissor)if(this._clipping&&a.isSquare()){const g=this._parent._useRenderToTexture?this._parent._viewport:this._parent._scissor;if(g){const x=Math.max(g[0],u),m=Math.max(g[1],f);this._scissor=[x,m,Math.min(g[2]+g[0],c)-x,Math.min(g[3]+g[1],p)-m]}else this._scissor=[u,f,c-u,p-f]}else this._scissor=this._parent._useRenderToTexture?this._parent._viewport:this._parent._scissor;if(this._boundsMargin?this._recBoundsMargin=this._boundsMargin:this._recBoundsMargin=this._parent._recBoundsMargin,this._onAfterCalcs&&this._onAfterCalcs(this.element)&&(_?(u=Math.min(0,l*a.ta,l*a.ta+h*a.tb,h*a.tb)+a.px,c=Math.max(0,l*a.ta,l*a.ta+h*a.tb,h*a.tb)+a.px,f=Math.min(0,l*a.tc,l*a.tc+h*a.td,h*a.td)+a.py,p=Math.max(0,l*a.tc,l*a.tc+h*a.td,h*a.td)+a.py):(u=a.px,c=a.px+a.ta*l,f=a.py,p=a.py+a.td*h),this._dimsUnknown&&(_||this._localTa<1||this._localTb<1))){const g=this._x*n.ta+this._y*n.tb+n.px,x=this._x*n.tc+this._y*n.td+n.py;g<u&&(u=g),x<f&&(f=x),g>c&&(c=g),x>p&&(p=x)}if(this._parent._outOfBounds===2)this._outOfBounds=2,this._withinBoundsMargin&&(this._withinBoundsMargin=!1,this.element._disableWithinBoundsMargin());else if(s&6){this._outOfBounds=0;let g=!0;if((!this._renderToTextureEnabled||!this._texturizer||!this._texturizer.renderOffscreen)&&(this._scissor&&(this._scissor[2]<=0||this._scissor[3]<=0)?this._outOfBounds=2:((this._scissor[0]>c||this._scissor[1]>p||u>this._scissor[0]+this._scissor[2]||f>this._scissor[1]+this._scissor[3])&&(this._outOfBounds=1),this._outOfBounds&&(this._clipping||this._useRenderToTexture||this._clipbox&&l&&h)&&(this._outOfBounds=2)),g=this._outOfBounds===0,g||(this._recBoundsMargin?g=!(c<this._scissor[0]-this._recBoundsMargin[2]||p<this._scissor[1]-this._recBoundsMargin[3]||u>this._scissor[0]+this._scissor[2]+this._recBoundsMargin[0]||f>this._scissor[1]+this._scissor[3]+this._recBoundsMargin[1]):g=!(c<this._scissor[0]-100||p<this._scissor[1]-100||u>this._scissor[0]+this._scissor[2]+100||f>this._scissor[1]+this._scissor[3]+100),g&&this._outOfBounds===2&&(this._outOfBounds=1))),this._withinBoundsMargin!==g)if(this._withinBoundsMargin=g,this._withinBoundsMargin){this._hasUpdates=!0;const x=this._recalc;if(this._recalc=0,this.element._enableWithinBoundsMargin(),this._recalc)return this.update();this._recalc=x}else this.element._disableWithinBoundsMargin()}if(this._useRenderToTexture&&(this._viewport?(this._viewport[2]=l,this._viewport[3]=h):this._viewport=[0,0,l,h]),this._pRecalc=this._recalc&135,this._recalc=0,this._hasUpdates=!1,this._outOfBounds<2){if(this._useRenderToTexture&&(this._worldContext.isIdentity()?this._renderContext=this._worldContext:this._renderContext=Gt.IDENTITY),this._children)for(let g=0,x=this._children.length;g<x;g++)this._children[g].update();this._useRenderToTexture&&(this._renderContext=a)}else if(this._children)for(let g=0,x=this._children.length;g<x;g++)this._children[g]._hasUpdates?this._children[g].update():(this._children[g]._recalc|=this._pRecalc,this._children[g].updateOutOfBounds());this._onAfterUpdate&&this._onAfterUpdate(this.element)}else this.ctx.updateTreeOrder===-1||this._updateTreeOrder>=this.ctx.updateTreeOrder?this.ctx.updateTreeOrder=-1:this.updateTreeOrder()}_applyRelativeDimFuncs(){if(this._optFlags&1){const t=this._funcX(this._parent.w);t!==this._x&&(this._localPx+=t-this._x,this._x=t)}if(this._optFlags&2){const t=this._funcY(this._parent.h);t!==this._y&&(this._localPy+=t-this._y,this._y=t)}let e=!1;if(this._optFlags&4){const t=this._funcW(this._parent.w);t!==this._w&&(this._w=t,e=!0)}if(this._optFlags&8){const t=this._funcH(this._parent.h);t!==this._h&&(this._h=t,e=!0)}e&&(this._recalcLocalTranslate(),this.element.onDimensionsChanged(this._w,this._h))}updateOutOfBounds(){if(this._outOfBounds!==2&&this._renderContext.alpha>0&&(this._outOfBounds=2,this._withinBoundsMargin&&(this._withinBoundsMargin=!1,this.element._disableWithinBoundsMargin()),this._children))for(let e=0,t=this._children.length;e<t;e++)this._children[e].updateOutOfBounds()}updateTreeOrder(){if(this._localAlpha&&this._outOfBounds!==2&&(this._updateTreeOrder=this.ctx.updateTreeOrder++,this._children))for(let e=0,t=this._children.length;e<t;e++)this._children[e].updateTreeOrder()}_renderSimple(){if(this._hasRenderUpdates=0,this._zSort&&this.sortZIndexedChildren(),this._outOfBounds<2&&this._renderContext.alpha){let e=this.renderState;if(this._outOfBounds===0&&this._displayedTextureSource&&(e.setShader(this.activeShader,this._shaderOwner),e.setScissor(this._scissor),this.renderState.addQuad(this)),this._children)if(this._zContextUsage)for(let t=0,i=this._zIndexedChildren.length;t<i;t++)this._zIndexedChildren[t].render();else for(let t=0,i=this._children.length;t<i;t++)this._children[t]._zIndex===0&&this._children[t].render()}}_renderAdvanced(){const e=this._hasRenderUpdates;if(this._hasRenderUpdates=0,this._zSort&&this.sortZIndexedChildren(),this._outOfBounds<2&&this._renderContext.alpha){let t=this.renderState,i=!0,s,n;if(this._useRenderToTexture){if(this._w===0||this._h===0)return;if(!this._texturizer.hasRenderTexture()||e>=3){if(this.ctx.renderToTextureCount++,t.setShader(t.defaultShader,this),n=t.renderTextureInfo,s={nativeTexture:null,offset:0,w:this._w,h:this._h,empty:!0,cleared:!1,ignore:!1,cache:!1},(this._texturizer.hasResultTexture()||!t.isCachingTexturizer&&e<3)&&(s.cache=!0,t.isCachingTexturizer=!0),this._texturizer.hasResultTexture()||this._texturizer.releaseRenderTexture(),t.setRenderTextureInfo(s),t.setScissor(null),this._displayedTextureSource){let o=this._renderContext;this._renderContext=Gt.IDENTITY,this.renderState.addQuad(this),this._renderContext=o}}else i=!1}else this._outOfBounds===0&&this._displayedTextureSource&&(t.setShader(this.activeShader,this._shaderOwner),t.setScissor(this._scissor),this.renderState.addQuad(this));if(i&&this._children)if(this._zContextUsage)for(let o=0,a=this._zIndexedChildren.length;o<a;o++)this._zIndexedChildren[o].render();else for(let o=0,a=this._children.length;o<a;o++)this._children[o]._zIndex===0&&this._children[o].render();if(this._useRenderToTexture){let o=!1;if(i&&(t.finishedRenderTexture(),this._texturizer.empty=s.empty,s.empty?this._texturizer.releaseRenderTexture():s.nativeTexture?(this._texturizer.reuseTextureAsRenderTexture(s.nativeTexture),s.ignore=!0):(this._texturizer.renderTextureReused&&this._texturizer.releaseRenderTexture(),s.nativeTexture=this._texturizer.getRenderTexture()),t.setRenderTextureInfo(n),o=!0),!this._texturizer.empty){let a=this._texturizer.getResultTexture();if(o&&(a&&(a.update=t.stage.frameCounter),this._texturizer.updateResultTexture()),!this._texturizer.renderOffscreen){t.setShader(this.activeShader,this._shaderOwner),t.setScissor(this._scissor);const l=!s||s.cache;t.setTexturizer(this._texturizer,l),this._stashTexCoords(),this._texturizer.colorize||this._stashColors(),this.renderState.addQuad(this,!0),this._texturizer.colorize||this._unstashColors(),this._unstashTexCoords(),t.setTexturizer(null)}}}s&&s.cache&&(t.isCachingTexturizer=!1)}}get zSort(){return this._zSort}sortZIndexedChildren(){const e=this._zIndexedChildren.length;let t=0;const i=this._zIndexedChildren,s=[];for(let o=0;o<e;o++)i[o]._zParent===this&&(i[o]._zIndexResort?s.push(i[o]):(t!==o&&(i[t]=i[o]),t++));const n=s.length;if(n){for(let a=0;a<n;a++)s[a]._zIndexResort=!1;s.sort(Ft.sortZIndexedChildren);const o=t;if(o){i.splice(o),+ +i.sort(Ft.sortZIndexedChildren),t=0;let a=0,l=0;const h=[];do{const f=(i[a]._zIndex===s[l]._zIndex?i[a]._updateTreeOrder-s[l]._updateTreeOrder:i[a]._zIndex-s[l]._zIndex)>0?s[l++]:i[a++];if((t===0||h[t-1]!==f)&&(h[t++]=f),a>=o){do{const c=s[l++];(t===0||h[t-1]!==c)&&(h[t++]=c)}while(l<n);break}else if(l>=n){do{const c=i[a++];(t===0||h[t-1]!==c)&&(h[t++]=c)}while(a<o);break}}while(!0);this._zIndexedChildren=h}else{t=0;let a=0;do i[t++]=s[a++];while(a<n);i.length>t&&i.splice(t)}}else i.length>t&&i.splice(t);this._zSort=!1}get localTa(){return this._localTa}get localTb(){return this._localTb}get localTc(){return this._localTc}get localTd(){return this._localTd}get element(){return this._element}get renderUpdates(){return this._hasRenderUpdates}get texturizer(){return this._texturizer||(this._texturizer=new nl(this)),this._texturizer}getCornerPoints(){let e=this._worldContext;return[e.px,e.py,e.px+this._w*e.ta,e.py+this._w*e.tc,e.px+this._w*e.ta+this._h*e.tb,e.py+this._w*e.tc+this._h*e.td,e.px+this._h*e.tb,e.py+this._h*e.td]}getRenderTextureCoords(e,t){let i=this._renderContext;return[i.px+i.ta*e+i.tb*t,i.py+i.tc*e+i.td*t]}getAbsoluteCoords(e,t){let i=this._renderContext;return[i.px+i.ta*e+i.tb*t,i.py+i.tc*e+i.td*t]}collectAtCoord(e,t,i){if(this._renderContext.alpha!==0){if(this.inBound(e,t)&&(this._scissor?this.inScissor()&&i.push(this):i.push(this)),this._children){const s=this._children.length;for(let n=0;n<s;n++)this._children[n].collectAtCoord(e,t,i)}return i.sort(Ft.sortZIndexedChildren)}}inBound(e,t){const i=this.getCornerPoints();return e>i[0]&&e<i[2]&&t>i[1]&&t<i[7]}inScissor(){const e=this._scissor,t=this.getCornerPoints();return t[2]>=e[0]&&t[0]<=e[0]+e[2]&&t[7]>=e[1]&&t[1]<=e[1]+e[3]}get layout(){return this._ensureLayout(),this._layout}get flex(){return this._layout?this._layout.flex:null}set flex(e){this.layout.flex=e}get flexItem(){return this._layout?this._layout.flexItem:null}set flexItem(e){this.layout.flexItem=e}isFlexItem(){return!!this._layout&&this._layout.isFlexItemEnabled()}isFlexContainer(){return!!this._layout&&this._layout.isFlexEnabled()}enableFlexLayout(){this._ensureLayout()}_ensureLayout(){this._layout||(this._layout=new bf(this))}disableFlexLayout(){this._triggerRecalcTranslate()}hasFlexLayout(){return this._layout&&this._layout.isEnabled()}setLayout(e,t,i,s){this.x=e,this.y=t,this._updateDimensions(i,s)}triggerLayout(){this._setRecalc(256)}_triggerRecalcTranslate(){this._setRecalc(2)}}class Gt{constructor(){this.alpha=1,this.px=0,this.py=0,this.ta=1,this.tb=0,this.tc=0,this.td=1}isIdentity(){return this.alpha===1&&this.px===0&&this.py===0&&this.ta===1&&this.tb===0&&this.tc===0&&this.td===1}isSquare(){return this.tb===0&&this.tc===0}}Gt.IDENTITY=new Gt;Ft.sortZIndexedChildren=function(r,e){return r._zIndex===e._zIndex?r._updateTreeOrder-e._updateTreeOrder:r._zIndex-e._zIndex};class ae{constructor(){this._hasEventListeners=!1}on(e,t){this._hasEventListeners||(this._eventFunction={},this._eventListeners={},this._hasEventListeners=!0),this._eventFunction[e]?this._eventFunction[e]!==ae.combiner?(this._eventListeners[e]=[this._eventFunction[e],t],this._eventFunction[e]=ae.combiner):this._eventListeners[e].push(t):this._eventFunction[e]=t}once(e,t){const i=(s,n,o)=>{t(s,n,o),this.off(e,i)};i.__originalFunc=t,this.on(e,i)}has(e,t){if(this._hasEventListeners){const i=this._eventFunction[e];if(i){if(i===ae.combiner){const s=this._eventListeners[e];for(const n of s)if(n===t||n.__originalFunc==t)return!0}else if(this._eventFunction[e]===t||this._eventFunction[e].__originalFunc===t)return!0}}return!1}off(e,t){if(this._hasEventListeners){const i=this._eventFunction[e];if(i)if(i===ae.combiner){const s=this._eventListeners[e];let n=s.indexOf(t);n>=0&&s.splice(n,1),n=s.map(o=>o.__originalFunc).indexOf(t),n>=0&&s.splice(n,1),s.length===1&&(this._eventFunction[e]=s[0],this._eventListeners[e]=void 0)}else(this._eventFunction[e]===t||this._eventFunction[e].__originalFunc===t)&&(this._eventFunction[e]=void 0)}}removeListener(e,t){this.off(e,t)}emit(e,t,i,s){if(this._hasEventListeners){const n=this._eventFunction[e];n&&(n===ae.combiner?n(this,e,t,i,s):n(t,i,s))}}listenerCount(e){if(this._hasEventListeners){const t=this._eventFunction[e];if(t)return t===ae.combiner?this._eventListeners[e].length:1}return 0}removeAllListeners(e){this._hasEventListeners&&(delete this._eventFunction[e],delete this._eventListeners[e])}}ae.combiner=function(r,e,t,i,s){const n=r._eventListeners[e];if(n)for(const o of[...n])o(t,i,s)};ae.addAsMixin=function(r){r.prototype.on=ae.prototype.on,r.prototype.once=ae.prototype.once,r.prototype.has=ae.prototype.has,r.prototype.off=ae.prototype.off,r.prototype.removeListener=ae.prototype.removeListener,r.prototype.emit=ae.prototype.emit,r.prototype.listenerCount=ae.prototype.listenerCount,r.prototype.removeAllListeners=ae.prototype.removeAllListeners};class ns{constructor(e){this._initialized=!1,this.ctx=e,this._elements=new Set}static create(e,t){let i;if(w.isObjectLiteral(t))t.type?i=e.renderer.createShader(e.ctx,t):i=this.shader,i&&xe.patchObject(i,t);else if(t===null)i=e.ctx.renderState.defaultShader;else if(t===void 0)i=null;else if(t.isShader)e.renderer.isValidShaderType(t.constructor)||(console.error("[Lightning] Invalid shader type"),t=null),i=t;else{console.error("[Lightning] Please specify a shader type.");return}return i}static getWebGL(){}static getC2d(){}addElement(e){this._elements.add(e)}removeElement(e){this._elements.delete(e),this._elements||this.cleanup()}redraw(){this._elements.forEach(e=>{e.setHasRenderUpdates(2)})}patch(e){xe.patchObject(this,e)}useDefault(){return!1}addEmpty(){return!1}cleanup(){}get isShader(){return!0}}class Oe{constructor(e){this.stage=e,this.manager=this.stage.textureManager,this.id=Oe.id++,this.elements=new Set,this._activeCount=0,this._source=null,this._resizeMode=null,this._x=0,this._y=0,this._w=0,this._h=0,this._precision=1,this.mw=0,this.mh=0,this.clipping=!1,this._mustUpdate=!0}get source(){return(this._mustUpdate||this.stage.hasUpdateSourceTexture(this))&&(this._performUpdateSource(!0),this.stage.removeUpdateSourceTexture(this)),this._source}addElement(e){this.elements.has(e)||(this.elements.add(e),this.elements.size===1&&this._source&&this._source.addTexture(this),e.active&&this.incActiveCount())}removeElement(e){this.elements.delete(e)&&(this.elements.size===0&&this._source&&this._source.removeTexture(this),e.active&&this.decActiveCount())}incActiveCount(){this.source&&this._checkForNewerReusableTextureSource(),this._activeCount++,this._activeCount===1&&this.becomesUsed()}decActiveCount(){this.source,this._activeCount--,this._activeCount||this.becomesUnused()}becomesUsed(){this.source&&this.source.incActiveTextureCount()}onLoad(){this._resizeMode&&this._applyResizeMode(),this.elements.forEach(e=>{e.active&&e.onTextureSourceLoaded()})}_checkForNewerReusableTextureSource(){const e=this.source;if(e.isLoaded())this._resizeMode&&this._applyResizeMode();else{const t=this._getReusableTextureSource();t&&t.isLoaded()&&t!==e&&this._replaceTextureSource(t)}}becomesUnused(){this.source&&this.source.decActiveTextureCount()}isUsed(){return this._activeCount>0}_getLookupId(){return null}_getSourceLoader(){throw new Error("Texture.generate must be implemented.")}get isValid(){return this._getIsValid()}_getIsValid(){return!0}_changed(){this.isUsed()?this._updateSource():this._mustUpdate=!0}_updateSource(){this.stage.addUpdateSourceTexture(this)}_performUpdateSource(e=!1){if(e||this.isUsed()){this._mustUpdate=!1;let t=this._getTextureSource();this._replaceTextureSource(t)}}_getTextureSource(){let e=null;if(this._getIsValid()){const t=this._getLookupId();e=this._getReusableTextureSource(t),e||(e=this.manager.getTextureSource(this._getSourceLoader(),t))}return e}_getReusableTextureSource(e=this._getLookupId()){return this._getIsValid()&&e?this.manager.getReusableTextureSource(e):null}_replaceTextureSource(e=null){let t=this._source;if(this._source=e,this.elements.size&&(t&&(this._activeCount&&t.decActiveTextureCount(),t.removeTexture(this),this.text&&!t.isUsed()&&this.manager.freeTextureSource(t)),e&&(e.addTexture(this),this._activeCount&&e.incActiveTextureCount())),this.isUsed())if(e)if(e.isLoaded())this._resizeMode&&this._applyResizeMode(),this.elements.forEach(i=>{i.active&&i._setDisplayedTexture(this)});else{const i=e.loadError;i&&this.elements.forEach(s=>{s.active&&s.onTextureSourceLoadError(i)})}else this.elements.forEach(i=>{i.active&&i._setDisplayedTexture(null)})}load(){this.source&&(this.isLoaded()||this.source.load(!0))}isLoaded(){return this._source&&this._source.isLoaded()}get loadError(){return this._source&&this._source.loadError}free(){this._source&&this._source.free()}set resizeMode({type:e="cover",w:t=0,h:i=0,clipX:s=.5,clipY:n=.5}){this._resizeMode={type:e,w:t,h:i,clipX:s,clipY:n},this.isLoaded()&&this._applyResizeMode()}get resizeMode(){return this._resizeMode}_clearResizeMode(){this._resizeMode=null}_applyResizeMode(){this._resizeMode.type==="cover"?this._applyResizeCover():this._resizeMode.type==="contain"&&this._applyResizeContain(),this._updatePrecision(),this._updateClipping()}_applyResizeCover(){const e=this._resizeMode.w/this._source.w,t=this._resizeMode.h/this._source.h;let i=Math.max(e,t);if(i){if(this._precision=1/i,e&&e<i){const s=this._precision*this._resizeMode.w,n=this._source.w-s;this._x=n*this._resizeMode.clipX,this._w=this._source.w-n}if(t&&t<i){const s=this._precision*this._resizeMode.h,n=this._source.h-s;this._y=n*this._resizeMode.clipY,this._h=this._source.h-n}}}_applyResizeContain(){const e=this._resizeMode.w/this._source.w,t=this._resizeMode.h/this._source.h;let i=e;(!i||t<i)&&(i=t),i&&(this._precision=1/i)}enableClipping(e,t,i,s){this._clearResizeMode(),e*=this._precision,t*=this._precision,i*=this._precision,s*=this._precision,(this._x!==e||this._y!==t||this._w!==i||this._h!==s)&&(this._x=e,this._y=t,this._w=i,this._h=s,this._updateClipping(!0))}disableClipping(){this._clearResizeMode(),(this._x||this._y||this._w||this._h)&&(this._x=0,this._y=0,this._w=0,this._h=0,this._updateClipping())}_updateClipping(){this.clipping=!!(this._x||this._y||this._w||this._h);let e=this;this.elements.forEach(function(t){t.displayedTexture===e&&t.onDisplayedTextureClippingChanged()})}_updatePrecision(){let e=this;this.elements.forEach(function(t){t.displayedTexture===e&&t.onPrecisionChanged()})}getNonDefaults(){let e={};return e.type=this.constructor.name,this.x!==0&&(e.x=this.x),this.y!==0&&(e.y=this.y),this.w!==0&&(e.w=this.w),this.h!==0&&(e.h=this.h),this.precision!==1&&(e.precision=this.precision),e}get px(){return this._x}get py(){return this._y}get pw(){return this._w}get ph(){return this._h}get x(){return this._x/this._precision}set x(e){this._clearResizeMode(),e=e*this._precision,this._x!==e&&(this._x=e,this._updateClipping())}get y(){return this._y/this._precision}set y(e){this._clearResizeMode(),e=e*this._precision,this._y!==e&&(this._y=e,this._updateClipping())}get w(){return this._w/this._precision}set w(e){this._clearResizeMode(),e=e*this._precision,this._w!==e&&(this._w=e,this._updateClipping())}get h(){return this._h/this._precision}set h(e){this._clearResizeMode(),e=e*this._precision,this._h!==e&&(this._h=e,this._updateClipping())}get precision(){return this._precision}set precision(e){this._clearResizeMode(),this._precision!==e&&(this._precision=e,this._updatePrecision())}isAutosizeTexture(){return!0}getRenderWidth(){return this.isAutosizeTexture()?(this._w||(this._source?this._source.getRenderWidth()-this._x:0))/this._precision:0}getRenderHeight(){return this.isAutosizeTexture()?(this._h||(this._source?this._source.getRenderHeight()-this._y:0))/this._precision:0}patch(e){xe.patchObject(this,e)}}Oe.prototype.isTexture=!0;Oe.id=0;class In extends Oe{constructor(e){super(e),this._src=void 0,this._hasAlpha=!1}get src(){return this._src}set src(e){this._src!==e&&(this._src=e,this._changed())}get hasAlpha(){return this._hasAlpha}set hasAlpha(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._changed())}_getIsValid(){return!!this._src}_getLookupId(){return this._src}_getSourceLoader(){let e=this._src,t=this._hasAlpha;if(this.stage.getOption("srcBasePath")){var i=e.charCodeAt(0);e.indexOf("//")===-1&&(i>=65&&i<=90||i>=97&&i<=122||i==46)&&(e=this.stage.getOption("srcBasePath")+e)}return s=>this.stage.platform.loadSrcTexture({src:e,hasAlpha:t},s)}getNonDefaults(){const e=super.getNonDefaults();return this._src&&(e.src=this._src),e}}function _r(r,e,t,i,s){let n=r;Array.isArray(n)||(n=[n]);let o=[];for(let a=0,l=n.length;a<l;a++){let h=n[a];h==null&&(h=s),h.indexOf(" ")<0?o.push(h):o.push(`"${h}"`)}return`${e} ${t*i}px ${o.join(",")}`}function ol(r){return r===""||r==="​"}function ea(r){return ol(r)||r===" "}function vf(r,e){const t=e.match(r)||[],i=e.split(r)||[];let s=[];for(let n=0;n<i.length;n++)s.push(i[n],t[n]);return s.pop(),s.filter(n=>n!="")}function mr(r,e,t=0){return t?e.split("").reduce((i,s)=>ol(s)?i:i+r.measureText(s).width+t,0):r.measureText(e).width}function wf(r,e,t,i,s){const n=/ |\u200B/g;let o=e.split(/\r?\n/g),a=[],l=[];for(let h=0;h<o.length;h++){let u=[],f="",c=t-s,p=o[h].split(n),_=o[h].match(n)||[];for(let g=0;g<p.length;g++){const x=_[g-1]||"",m=p[g],T=mr(r,m,i),b=T+mr(r,x,i);g===0||b>c?(g>0&&(u.push(f),f=""),f+=m,c=t-T-(g===0?s:0)):(c-=b,f+=x+m)}u.push(f),f="",a=a.concat(u),h<o.length-1&&l.push(a.length)}return{l:a,n:l}}class Cf{constructor(e,t,i){this._stage=e,this._canvas=t,this._context=this._canvas.getContext("2d"),this._settings=i}getPrecision(){return this._settings.precision}setFontProperties(){this._context.font=_r(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace")),this._context.textBaseline=this._settings.textBaseline,this._context.direction=this._settings.rtl?"rtl":"ltr"}_load(){if(w.isWeb&&document.fonts){const e=_r(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace"));try{if(!document.fonts.check(e,this._settings.text))return document.fonts.load(e,this._settings.text).catch(t=>{console.warn("[Lightning] Font load error",t,e)}).then(()=>{document.fonts.check(e,this._settings.text)||console.warn("[Lightning] Font not found",e)})}catch{console.warn("[Lightning] Can't check font loading for "+e)}}}draw(){const e=this._load();return e?e.then(()=>w.isSpark?this._stage.platform.drawText(this):this._draw()):w.isSpark?this._stage.platform.drawText(this):this._draw()}_calculateRenderInfo(){let e={};const t=this.getPrecision(),i=this._settings.paddingLeft*t,s=this._settings.paddingRight*t,n=this._settings.fontSize*t;let o=this._settings.offsetY===null?null:this._settings.offsetY*t,a=this._settings.lineHeight*t;const l=this._settings.w*t,h=this._settings.h*t;let u=this._settings.wordWrapWidth*t;const f=this._settings.cutSx*t,c=this._settings.cutEx*t,p=this._settings.cutSy*t,_=this._settings.cutEy*t,g=(this._settings.letterSpacing||0)*t,x=this._settings.textIndent*t;this.setFontProperties();let m=l||this._stage.getOption("w"),T=m-i;if(T<10&&(m+=10-T,T=10),u||(u=T),this._settings.textOverflow&&!this._settings.wordWrap){let E;switch(this._settings.textOverflow){case"clip":E="";break;case"ellipsis":E=this._settings.maxLinesSuffix;break;default:E=this._settings.textOverflow}this._settings.text=this.wrapWord(this._settings.text,u-x,E)}let b;if(this._settings.wordWrap)b=this.wrapText(this._settings.text,u,g,x);else{b={l:this._settings.text.split(/(?:\r\n|\r|\n)/),n:[]};let E=b.l.length;for(let U=0;U<E-1;U++)b.n.push(U)}let S=b.l;if(this._settings.maxLines&&S.length>this._settings.maxLines){let E=S.slice(0,this._settings.maxLines),U=null;if(this._settings.maxLinesSuffix){let $=this._settings.maxLinesSuffix?this.measureText(this._settings.maxLinesSuffix):0,P=this.wrapText(E[E.length-1],u-$,g,x);E[E.length-1]=P.l[0]+this._settings.maxLinesSuffix,U=[P.l.length>1?P.l[1]:""]}else U=[""];let z,k=S.length,O=0,B=b.n.length;for(z=this._settings.maxLines;z<k;z++)U[O]+=(U[O]?" ":"")+S[z],z+1<B&&b.n[z+1]&&O++;e.remainingText=U.join(`
`),e.moreTextLines=!0,S=E}else e.moreTextLines=!1,e.remainingText="";let R=0,A=[];for(let E=0;E<S.length;E++){let U=this.measureText(S[E],g)+(E===0?x:0);A.push(U),R=Math.max(R,U)}e.lineWidths=A,l||(m=R+i+s,T=R),a=a||n;let L;if(h)L=h;else{const E=this._settings.textBaseline!="bottom"?.5*n:0;L=a*(S.length-1)+E+Math.max(a,n)+o}return o===null&&(o=n),e.w=m,e.h=L,e.lines=S,e.precision=t,m||(m=1),L||(L=1),(f||c)&&(m=Math.min(m,c-f)),(p||_)&&(L=Math.min(L,_-p)),e.width=m,e.innerWidth=T,e.height=L,e.fontSize=n,e.cutSx=f,e.cutSy=p,e.cutEx=c,e.cutEy=_,e.lineHeight=a,e.lineWidths=A,e.offsetY=o,e.paddingLeft=i,e.paddingRight=s,e.letterSpacing=g,e.textIndent=x,e}_draw(){const e=this._calculateRenderInfo(),t=this.getPrecision();this._canvas.width=Math.ceil(e.width+this._stage.getOption("textRenderIssueMargin")),this._canvas.height=Math.ceil(e.height),this.setFontProperties(),e.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(e.cutSx||e.cutSy)&&this._context.translate(-e.cutSx,-e.cutSy);let i,s,n=[];for(let a=0,l=e.lines.length;a<l;a++)i=a===0?e.textIndent:0,s=a*e.lineHeight+e.offsetY,this._settings.verticalAlign=="middle"?s+=(e.lineHeight-e.fontSize)/2:this._settings.verticalAlign=="bottom"&&(s+=e.lineHeight-e.fontSize),this._settings.textAlign==="right"?i+=e.innerWidth-e.lineWidths[a]:this._settings.textAlign==="center"&&(i+=(e.innerWidth-e.lineWidths[a])/2),i+=e.paddingLeft,this._settings.rtl&&(i+=e.lineWidths[a]),n.push({text:e.lines[a],x:i,y:s,w:e.lineWidths[a]});if(this._settings.highlight){let a=this._settings.highlightColor||0,l=this._settings.highlightHeight*t||e.fontSize*1.5;const h=this._settings.highlightOffset*t,u=this._settings.highlightPaddingLeft!==null?this._settings.highlightPaddingLeft*t:e.paddingLeft,f=this._settings.highlightPaddingRight!==null?this._settings.highlightPaddingRight*t:e.paddingRight;this._context.fillStyle=D.getRgbaString(a);for(let c=0;c<n.length;c++){let p=n[c];this._context.fillRect(p.x-u,p.y-e.offsetY+h,p.w+f+u,l)}}let o=null;this._settings.shadow&&(o=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=D.getRgbaString(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*t,this._context.shadowOffsetY=this._settings.shadowOffsetY*t,this._context.shadowBlur=this._settings.shadowBlur*t),this._context.fillStyle=D.getRgbaString(this._settings.textColor);for(let a=0,l=n.length;a<l;a++){let h=n[a];if(e.letterSpacing===0)this._context.fillText(h.text,h.x,h.y);else{const u=h.text.split("");let f=h.x;for(let c=0,p=u.length;c<p;c++)this._context.fillText(u[c],f,h.y),f+=this.measureText(u[c],e.letterSpacing)}}o&&(this._context.shadowColor=o[0],this._context.shadowOffsetX=o[1],this._context.shadowOffsetY=o[2],this._context.shadowBlur=o[3]),(e.cutSx||e.cutSy)&&this._context.translate(e.cutSx,e.cutSy),this.renderInfo=e}wrapWord(e,t,i){const s=this.measureText(i),n=e.length,o=this.measureText(e);if(o<=t)return e;let a=Math.floor(t*n/o),l=this.measureText(e.substring(0,a))+s;if(l>t)for(;a>0&&(l=this.measureText(e.substring(0,a))+s,l>t);)a-=1;else for(;a<n;)if(l=this.measureText(e.substring(0,a))+s,l<t)a+=1;else{a-=1;break}return e.substring(0,a)+(t>=s?i:"")}wrapText(e,t,i,s=0){return wf(this._context,e,t,i,s)}measureText(e,t=0){return mr(this._context,e,t)}}class Rf{constructor(e,t,i){this._stage=e,this._canvas=t,this._context=this._canvas.getContext("2d"),this._settings=i}getPrecision(){return this._settings.precision}setFontProperties(){const e=_r(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace"));return this._context.font=e,this._context.textBaseline=this._settings.textBaseline,e}_load(){if(w.isWeb&&document.fonts){const e=_r(this._settings.fontFace,this._settings.fontStyle,this._settings.fontSize,this.getPrecision(),this._stage.getOption("defaultFontFace"));try{if(!document.fonts.check(e,this._settings.text))return document.fonts.load(e,this._settings.text).catch(t=>{console.warn("Font load error",t,e)}).then(()=>{document.fonts.check(e,this._settings.text)||console.warn("Font not found",e)})}catch{console.warn("Can't check font loading for "+e)}}}draw(){const e=this._load();return e?e.then(()=>w.isSpark?this._stage.platform.drawText(this):this._draw()):w.isSpark?this._stage.platform.drawText(this):this._draw()}_calculateRenderInfo(){let e={};const t=this.getPrecision(),i=this._settings.paddingLeft*t,s=this._settings.paddingRight*t,n=this._settings.fontSize*t,o=this._settings.lineHeight*t||n,a=this._settings.w!=0?this._settings.w*t:this._stage.getOption("w"),l=this._settings.wordWrapWidth*t,h=this._settings.cutSx*t,u=this._settings.cutEx*t,f=this._settings.cutSy*t,c=this._settings.cutEy*t,p=this._settings.letterSpacing||0;e.baseFont=this.setFontProperties(),e.w=a,e.width=a,e.text=this._settings.text,e.precision=t,e.fontSize=n,e.fontBaselineRatio=this._settings.fontBaselineRatio,e.lineHeight=o,e.letterSpacing=p,e.textAlign=this._settings.textAlign,e.textColor=this._settings.textColor,e.verticalAlign=this._settings.verticalAlign,e.highlight=this._settings.highlight,e.highlightColor=this._settings.highlightColor,e.highlightHeight=this._settings.highlightHeight,e.highlightPaddingLeft=this._settings.highlightPaddingLeft,e.highlightPaddingRight=this._settings.highlightPaddingRight,e.highlightOffset=this._settings.highlightOffset,e.paddingLeft=this._settings.paddingLeft,e.paddingRight=this._settings.paddingRight,e.maxLines=this._settings.maxLines,e.maxLinesSuffix=this._settings.maxLinesSuffix,e.textOverflow=this._settings.textOverflow,e.wordWrap=this._settings.wordWrap,e.wordWrapWidth=l,e.shadow=this._settings.shadow,e.shadowColor=this._settings.shadowColor,e.shadowOffsetX=this._settings.shadowOffsetX,e.shadowOffsetY=this._settings.shadowOffsetY,e.shadowBlur=this._settings.shadowBlur,e.cutSx=h,e.cutEx=u,e.cutSy=f,e.cutEy=c,e.textIndent=this._settings.textIndent*t,e.wordBreak=this._settings.wordBreak;let _=e.text,g=e.wordWrap&&e.wordWrapWidth||e.width;if(e.textOverflow&&!e.wordWrap){let S;switch(this._settings.textOverflow){case"clip":S="";break;case"ellipsis":S=this._settings.maxLinesSuffix;break;default:S=this._settings.textOverflow}_=this.wrapWord(_,l||e.w,S)}_=this.tokenize(_),_=this.parse(_),_=this.measure(_,p,e.baseFont),e.textIndent&&(_=this.indent(_,e.textIndent)),e.wordBreak&&(_=_.reduce((S,R)=>S.concat(this.wordBreak(R,g,e.baseFont)),[]),this.resetFontStyle());let x=i,m=0;for(const S of _)(e.wordWrap&&x+S.width>g||S.text==`
`)&&(x=i,m+=1),S.lineNo=m,S.text!=`
`&&(S.x=x,x+=S.width);e.lineNum=m+1,this._settings.h?e.h=this._settings.h:e.maxLines&&e.maxLines<e.lineNum?e.h=e.maxLines*e.lineHeight+n/2:e.h=e.lineNum*e.lineHeight+n/2;const T=e.fontBaselineRatio*e.fontSize;let b=0;e.verticalAlign=="top"&&this._context.textBaseline=="alphabetic"?b=-T:e.verticalAlign=="middle"?b=(e.lineHeight-e.fontSize-T)/2:this._settings.verticalAlign=="bottom"&&(b=e.lineHeight-e.fontSize),e.lines=[];for(let S=0;S<e.lineNum;S++)e.lines[S]={width:0,x:0,y:e.lineHeight*S+b,text:[]};for(let S of _)e.lines[S.lineNo].text.push(S);for(const S of e.lines){if(S.text.length==0)continue;const R=S.text[0].text,A=S.text[S.text.length-1].text;R==`
`&&S.text.shift(),(ea(A)||A==`
`)&&S.text.pop()}for(let S of e.lines)S.width=S.text.reduce((R,A)=>R+A.width,0);if(e.width=this._settings.w!=0?this._settings.w*t:Math.max(...e.lines.map(S=>S.width))+s,e.w=e.width,e.maxLines&&e.lineNum>e.maxLines&&e.maxLinesSuffix){const S=e.maxLines-1;let R=_.filter(U=>U.lineNo==S),A=e.maxLinesSuffix;A=this.tokenize(A),A=this.parse(A),A=this.measure(A,e.letterSpacing,e.baseFont);for(const U of A)U.lineNo=S,U.x=0,R.push(U);const L=A.length+1;let E=R.reduce((U,z)=>U+z.width,0);for(;(E>e.width||ea(R[R.length-L].text))&&(R.splice(R.length-L,1),E=R.reduce((U,z)=>U+z.width,0),!(R.length<L)););this.alignLine(R,R[0].x),e.lines[S].text=R,e.lines[S].width=E}if(e.textAlign=="center")for(let S of e.lines)S.x=(e.width-S.width-i)/2;else if(e.textAlign=="right")for(let S of e.lines)S.x=e.width-S.width-i;return e}_draw(){const e=this._calculateRenderInfo(),t=this.getPrecision(),i=e.paddingLeft*t;let s=e.w||e.width;(e.cutSx||e.cutEx)&&(s=Math.min(e.w,e.cutEx-e.cutSx));let n=e.h;if((e.cutSy||e.cutEy)&&(n=Math.min(e.h,e.cutEy-e.cutSy)),this._canvas.width=Math.ceil(s+this._stage.getOption("textRenderIssueMargin")),this._canvas.height=Math.ceil(n),this.setFontProperties(),e.fontSize>=128&&(this._context.globalAlpha=.01,this._context.fillRect(0,0,.01,.01),this._context.globalAlpha=1),(e.cutSx||e.cutSy)&&this._context.translate(-e.cutSx,-e.cutSy),e.highlight){const h=e.highlightColor||0,u=e.highlightHeight?e.highlightHeight*t:e.fontSize*1.5,f=e.highlightOffset?e.highlightOffset*t:0,c=e.highlightPaddingLeft!==null?e.highlightPaddingLeft*t:e.paddingLeft,p=e.highlightPaddingRight!==null?e.highlightPaddingRight*t:e.paddingRight;this._context.fillStyle=D.getRgbaString(h);const _=e.maxLines?Math.min(e.maxLines,e.lineNum):e.lineNum;for(let g=0;g<_;g++){const x=e.lines[g];this._context.fillRect(x.x-c+i,x.y+f,x.width+c+p,u)}}let o=null;this._settings.shadow&&(o=[this._context.shadowColor,this._context.shadowOffsetX,this._context.shadowOffsetY,this._context.shadowBlur],this._context.shadowColor=D.getRgbaString(this._settings.shadowColor),this._context.shadowOffsetX=this._settings.shadowOffsetX*t,this._context.shadowOffsetY=this._settings.shadowOffsetY*t,this._context.shadowBlur=this._settings.shadowBlur*t);const a=D.getRgbaString(this._settings.textColor);let l=a;this._context.fillStyle=a;for(const h of e.lines)for(const u of h.text){let f=0;if(u.text!=`
`&&!(e.maxLines&&u.lineNo>=e.maxLines))if(u.color!=l&&(l=u.color,this._context.fillStyle=l),this._context.font=u.fontStyle,u.letters)for(let c of u.letters){const p=e.lines[u.lineNo].x+u.x+f;this._context.fillText(c.text,p,e.lines[u.lineNo].y+e.fontSize),f+=c.width}else{const c=e.lines[u.lineNo].x+u.x;this._context.fillText(u.text,c,e.lines[u.lineNo].y+e.fontSize)}}o&&(this._context.shadowColor=o[0],this._context.shadowOffsetX=o[1],this._context.shadowOffsetY=o[2],this._context.shadowBlur=o[3]),(e.cutSx||e.cutSy)&&this._context.translate(e.cutSx,e.cutSy),e.lines=e.lines.map(h=>h.text.reduce((u,f)=>u+f.text,"")),e.maxLines&&(e.lines=e.lines.slice(0,e.maxLines)),this.renderInfo=e}measureText(e,t=0){return mr(this._context,e,t)}tokenize(e){return vf(/ |\u200B|\n|<i>|<\/i>|<b>|<\/b>|<color=0[xX][0-9a-fA-F]{8}>|<\/color>/g,e)}parse(e){let t=0,i=0,s=[D.getRgbaString(this._settings.textColor)],n=0;const o=/<color=(0[xX][0-9a-fA-F]{8})>/;return e.map(a=>{if(a=="<i>")t+=1,a="";else if(a=="</i>"&&t>0)t-=1,a="";else if(a=="<b>")i+=1,a="";else if(a=="</b>"&&i>0)i-=1,a="";else if(a=="</color>")s.length>1&&(n-=1,s.pop()),a="";else if(o.test(a)){const l=o.exec(a);s.push(D.getRgbaString(parseInt(l[1]))),n+=1,a=""}return{text:a,italic:t,bold:i,color:s[n]}}).filter(a=>a.text!="")}applyFontStyle(e,t){let i=t;e.bold&&(i="bold "+i),e.italic&&(i="italic "+i),this._context.font=i,e.fontStyle=i}resetFontStyle(e){this._context.font=e}measure(e,t=0,i){for(const s of e)if(this.applyFontStyle(s,i),s.width=this.measureText(s.text,t),t>0){s.letters=s.text.split("").map(n=>({text:n}));for(let n of s.letters)n.width=this.measureText(n.text,t)}return this.resetFontStyle(i),e}indent(e,t){return e.splice(0,0,{text:"",width:t}),e}wrapWord(e,t,i){const s=this.measureText(i),n=e.length,o=this.measureText(e);if(o<=t)return e;let a=Math.floor(t*n/o),l=this.measureText(e.substring(0,a))+s;if(l>t)for(;a>0&&(l=this.measureText(e.substring(0,a))+s,l>t);)a-=1;else for(;a<n;)if(l=this.measureText(e.substring(0,a))+s,l<t)a+=1;else{a-=1;break}return e.substring(0,a)+(t>=s?i:"")}_getBreakIndex(e,t){const i=e.length,s=this.measureText(e);if(s<=t)return{breakIndex:e.length,truncWordWidth:s};let n=Math.floor(t*i/s),o=this.measureText(e.substring(0,n));if(o>t)for(;n>0&&(o=this.measureText(e.substring(0,n)),o>t);)n-=1;else for(;n<i;)if(o=this.measureText(e.substring(0,n)),o<t)n+=1;else{n-=1,o=this.measureText(e.substring(0,n));break}return{breakIndex:n,truncWordWidth:o}}wordBreak(e,t,i){if(!e.text)return e;this.applyFontStyle(e,i);const s=[];let n=e.text;if(e.letters){let o=0,a=[],l=0;for(const h of e.letters)o+h.width>=t?(s.push({...e}),s[s.length-1].text=n.slice(0,l),s[s.length-1].width=o,s[s.length-1].letters=a,n=n.slice(l),o=0,a=[],l=0):(l+=1,a.push(h),o+=h.width);o>0&&(s.push({...e}),s[s.length-1].text=n.slice(0,l),s[s.length-1].width=o,s[s.length-1].letters=a)}else for(;;){const{breakIndex:o,truncWordWidth:a}=this._getBreakIndex(n,t);if(s.push({...e}),s[s.length-1].text=n.slice(0,o),s[s.length-1].width=a,o===n.length)break;n=n.slice(o)}return s}alignLine(e,t=0){let i=0,s=t;for(const n of e)n.text!=`
`&&(n.x=s+i,s=n.x,i=n.width)}}class ot extends Oe{constructor(e){super(e),this._precision=this.stage.getOption("precision")}static renderer(e,t,i){return i.advancedRenderer?new Rf(e,t,i):new Cf(e,t,i)}get text(){return this._text}set text(e){this._text!==e&&(this._text=""+e,this._changed())}get w(){return this._w}set w(e){this._w!==e&&(this._w=e,this._changed())}get h(){return this._h}set h(e){this._h!==e&&(this._h=e,this._changed())}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this._changed())}get fontBaselineRatio(){return this._fontBaselineRatio}set fontBaselineRatio(e){this._fontBaselineRatio!==e&&(this._fontBaselineRatio=e,this._changed())}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this._changed())}get fontFace(){return this._fontFace}set fontFace(e){this._fontFace!==e&&(this._fontFace=e,this._changed())}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this._changed())}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this._changed())}get wordBreak(){return this._wordBreak}set wordBreak(e){this._wordBreak!==e&&(this._wordBreak=e,this._changed())}get textOverflow(){return this._textOverflow}set textOverflow(e){e!=this._textOverflow&&(this._textOverflow=e,this._changed())}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this._changed())}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this._changed())}get textAlign(){return this._textAlign}set textAlign(e){this._textAlign!==e&&(this._textAlign=e,this._changed())}get verticalAlign(){return this._verticalAlign}set verticalAlign(e){this._verticalAlign!==e&&(this._verticalAlign=e,this._changed())}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY!==e&&(this._offsetY=e,this._changed())}get maxLines(){return this._maxLines}set maxLines(e){this._maxLines!==e&&(this._maxLines=e,this._changed())}get maxLinesSuffix(){return this._maxLinesSuffix}set maxLinesSuffix(e){this._maxLinesSuffix!==e&&(this._maxLinesSuffix=e,this._changed())}get textColor(){return this._textColor}set textColor(e){this._textColor!==e&&(this._textColor=e,this._changed())}get paddingLeft(){return this._paddingLeft}set paddingLeft(e){this._paddingLeft!==e&&(this._paddingLeft=e,this._changed())}get paddingRight(){return this._paddingRight}set paddingRight(e){this._paddingRight!==e&&(this._paddingRight=e,this._changed())}get shadow(){return this._shadow}set shadow(e){this._shadow!==e&&(this._shadow=e,this._changed())}get shadowColor(){return this._shadowColor}set shadowColor(e){this._shadowColor!==e&&(this._shadowColor=e,this._changed())}get shadowOffsetX(){return this._shadowOffsetX}set shadowOffsetX(e){this._shadowOffsetX!==e&&(this._shadowOffsetX=e,this._changed())}get shadowOffsetY(){return this._shadowOffsetY}set shadowOffsetY(e){this._shadowOffsetY!==e&&(this._shadowOffsetY=e,this._changed())}get shadowBlur(){return this._shadowBlur}set shadowBlur(e){this._shadowBlur!==e&&(this._shadowBlur=e,this._changed())}get highlight(){return this._highlight}set highlight(e){this._highlight!==e&&(this._highlight=e,this._changed())}get highlightHeight(){return this._highlightHeight}set highlightHeight(e){this._highlightHeight!==e&&(this._highlightHeight=e,this._changed())}get highlightColor(){return this._highlightColor}set highlightColor(e){this._highlightColor!==e&&(this._highlightColor=e,this._changed())}get highlightOffset(){return this._highlightOffset}set highlightOffset(e){this._highlightOffset!==e&&(this._highlightOffset=e,this._changed())}get highlightPaddingLeft(){return this._highlightPaddingLeft}set highlightPaddingLeft(e){this._highlightPaddingLeft!==e&&(this._highlightPaddingLeft=e,this._changed())}get highlightPaddingRight(){return this._highlightPaddingRight}set highlightPaddingRight(e){this._highlightPaddingRight!==e&&(this._highlightPaddingRight=e,this._changed())}get cutSx(){return this._cutSx}set cutSx(e){this._cutSx!==e&&(this._cutSx=e,this._changed())}get cutEx(){return this._cutEx}set cutEx(e){this._cutEx!==e&&(this._cutEx=e,this._changed())}get cutSy(){return this._cutSy}set cutSy(e){this._cutSy!==e&&(this._cutSy=e,this._changed())}get cutEy(){return this._cutEy}set cutEy(e){this._cutEy!==e&&(this._cutEy=e,this._changed())}get advancedRenderer(){return this._advancedRenderer}set advancedRenderer(e){this._advancedRenderer!==e&&(this._advancedRenderer=e,this._changed())}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this._changed())}get letterSpacing(){return this._letterSpacing}set textIndent(e){this._textIndent!==e&&(this._textIndent=e,this._changed())}get textIndent(){return this._textIndent}set rtl(e){this._rtl!==e&&(this._rtl=e,this._changed())}get rtl(){return this._rtl}get precision(){return super.precision}set precision(e){this.precision!==e&&(super.precision=e,this._changed())}_getIsValid(){return!!this.text}_getLookupId(){let e=[];return this.w!==0&&e.push("w "+this.w),this.h!==0&&e.push("h "+this.h),this.fontStyle!=="normal"&&e.push("fS"+this.fontStyle),this.fontSize!==40&&e.push("fs"+this.fontSize),this.fontBaselineRatio!==0&&e.push("fb"+this.fontBaselineRatio),this.fontFace!==null&&e.push("ff"+(Array.isArray(this.fontFace)?this.fontFace.join(","):this.fontFace)),this.wordWrap!==!0&&e.push("wr"+(this.wordWrap?1:0)),this.wordWrapWidth!==0&&e.push("ww"+this.wordWrapWidth),this.wordBreak!==!1&&e.push("wb"+this.wordBreak?1:0),this.textOverflow!=""&&e.push("to"+this.textOverflow),this.lineHeight!==null&&e.push("lh"+this.lineHeight),this.textBaseline!=="alphabetic"&&e.push("tb"+this.textBaseline),this.textAlign!=="left"&&e.push("ta"+this.textAlign),this.verticalAlign!=="top"&&e.push("va"+this.verticalAlign),this.offsetY!==null&&e.push("oy"+this.offsetY),this.maxLines!==0&&e.push("ml"+this.maxLines),this.maxLinesSuffix!==".."&&e.push("ms"+this.maxLinesSuffix),e.push("pc"+this.precision),this.textColor!==4294967295&&e.push("co"+this.textColor.toString(16)),this.paddingLeft!==0&&e.push("pl"+this.paddingLeft),this.paddingRight!==0&&e.push("pr"+this.paddingRight),this.shadow!==!1&&e.push("sh"+(this.shadow?1:0)),this.shadowColor!==4278190080&&e.push("sc"+this.shadowColor.toString(16)),this.shadowOffsetX!==0&&e.push("sx"+this.shadowOffsetX),this.shadowOffsetY!==0&&e.push("sy"+this.shadowOffsetY),this.shadowBlur!==5&&e.push("sb"+this.shadowBlur),this.highlight!==!1&&e.push("hL"+(this.highlight?1:0)),this.highlightHeight!==0&&e.push("hh"+this.highlightHeight),this.highlightColor!==4278190080&&e.push("hc"+this.highlightColor.toString(16)),this.highlightOffset!==null&&e.push("ho"+this.highlightOffset),this.highlightPaddingLeft!==null&&e.push("hl"+this.highlightPaddingLeft),this.highlightPaddingRight!==null&&e.push("hr"+this.highlightPaddingRight),this.letterSpacing!==null&&e.push("ls"+this.letterSpacing),this.textIndent!==null&&e.push("ti"+this.textIndent),this.cutSx&&e.push("csx"+this.cutSx),this.cutEx&&e.push("cex"+this.cutEx),this.cutSy&&e.push("csy"+this.cutSy),this.cutEy&&e.push("cey"+this.cutEy),this.advancedRenderer&&e.push("aR"+this.advancedRenderer?1:0),"TX$"+e.join("|")+":"+this.text}_getSourceLoader(){const e=this.cloneArgs(),t=this.stage.gl;return function(i){const s=this.stage.platform.getDrawingCanvas(),n=ot.renderer(this.stage,s,e),o=n.draw(),a={},l=this.stage.getOption("fontSharp");let h=!1;w.isBoolean(l)?h=l:w.isObject(l)&&(h=this.stage.getRenderPrecision()<=l.precision&&e.fontSize<=l.fontSize),t&&h&&(a[t.TEXTURE_MAG_FILTER]=t.NEAREST),o?o.then(()=>{i(null,Object.assign({renderInfo:n.renderInfo,throttle:!1,texParams:a},this.stage.platform.getTextureOptionsForDrawingCanvas(s)))}).catch(u=>{i(u)}):i(null,Object.assign({renderInfo:n.renderInfo,throttle:!1,texParams:a},this.stage.platform.getTextureOptionsForDrawingCanvas(s)))}}getNonDefaults(){const e=super.getNonDefaults();return this.text!==""&&(e.text=this.text),this.w!==0&&(e.w=this.w),this.h!==0&&(e.h=this.h),this.fontStyle!=="normal"&&(e.fontStyle=this.fontStyle),this.fontSize!==40&&(e.fontSize=this.fontSize),this.fontBaselineRatio!==0&&(e.fontBaselineRatio=this.fontBaselineRatio),this.fontFace!==null&&(e.fontFace=this.fontFace),this.wordWrap!==!0&&(e.wordWrap=this.wordWrap),this.wordWrapWidth!==0&&(e.wordWrapWidth=this.wordWrapWidth),this.wordBreak!==!1&&(e.wordBreak=this.wordBreak),this.textOverflow!=""&&(e.textOverflow=this.textOverflow),this.lineHeight!==null&&(e.lineHeight=this.lineHeight),this.textBaseline!=="alphabetic"&&(e.textBaseline=this.textBaseline),this.textAlign!=="left"&&(e.textAlign=this.textAlign),this.verticalAlign!=="top"&&(e.verticalAlign=this.verticalAlign),this.offsetY!==null&&(e.offsetY=this.offsetY),this.maxLines!==0&&(e.maxLines=this.maxLines),this.maxLinesSuffix!==".."&&(e.maxLinesSuffix=this.maxLinesSuffix),this.precision!==this.stage.getOption("precision")&&(e.precision=this.precision),this.textColor!==4294967295&&(e.textColor=this.textColor),this.paddingLeft!==0&&(e.paddingLeft=this.paddingLeft),this.paddingRight!==0&&(e.paddingRight=this.paddingRight),this.shadow!==!1&&(e.shadow=this.shadow),this.shadowColor!==4278190080&&(e.shadowColor=this.shadowColor),this.shadowOffsetX!==0&&(e.shadowOffsetX=this.shadowOffsetX),this.shadowOffsetY!==0&&(e.shadowOffsetY=this.shadowOffsetY),this.shadowBlur!==5&&(e.shadowBlur=this.shadowBlur),this.highlight!==!1&&(e.highlight=this.highlight),this.highlightHeight!==0&&(e.highlightHeight=this.highlightHeight),this.highlightColor!==4278190080&&(e.highlightColor=this.highlightColor),this.highlightOffset!==0&&(e.highlightOffset=this.highlightOffset),this.highlightPaddingLeft!==0&&(e.highlightPaddingLeft=this.highlightPaddingLeft),this.highlightPaddingRight!==0&&(e.highlightPaddingRight=this.highlightPaddingRight),this.letterSpacing!==0&&(e.letterSpacing=this.letterSpacing),this.textIndent!==0&&(e.textIndent=this.textIndent),this.rtl!==0&&(e.rtl=this.rtl),this.cutSx&&(e.cutSx=this.cutSx),this.cutEx&&(e.cutEx=this.cutEx),this.cutSy&&(e.cutSy=this.cutSy),this.cutEy&&(e.cutEy=this.cutEy),this.advancedRenderer&&(e.renderer=this.advancedRenderer),e}cloneArgs(){let e={};return e.text=this._text,e.w=this._w,e.h=this._h,e.fontStyle=this._fontStyle,e.fontSize=this._fontSize,e.fontBaselineRatio=this._fontBaselineRatio,e.fontFace=this._fontFace,e.wordWrap=this._wordWrap,e.wordWrapWidth=this._wordWrapWidth,e.wordBreak=this._wordBreak,e.textOverflow=this._textOverflow,e.lineHeight=this._lineHeight,e.textBaseline=this._textBaseline,e.textAlign=this._textAlign,e.verticalAlign=this._verticalAlign,e.offsetY=this._offsetY,e.maxLines=this._maxLines,e.maxLinesSuffix=this._maxLinesSuffix,e.precision=this._precision,e.textColor=this._textColor,e.paddingLeft=this._paddingLeft,e.paddingRight=this._paddingRight,e.shadow=this._shadow,e.shadowColor=this._shadowColor,e.shadowOffsetX=this._shadowOffsetX,e.shadowOffsetY=this._shadowOffsetY,e.shadowBlur=this._shadowBlur,e.highlight=this._highlight,e.highlightHeight=this._highlightHeight,e.highlightColor=this._highlightColor,e.highlightOffset=this._highlightOffset,e.highlightPaddingLeft=this._highlightPaddingLeft,e.highlightPaddingRight=this._highlightPaddingRight,e.letterSpacing=this._letterSpacing,e.textIndent=this._textIndent,e.rtl=this._rtl,e.cutSx=this._cutSx,e.cutEx=this._cutEx,e.cutSy=this._cutSy,e.cutEy=this._cutEy,e.advancedRenderer=this._advancedRenderer,e}}let G=ot.prototype;G._text="";G._w=0;G._h=0;G._fontStyle="normal";G._fontSize=40;G._fontFace=null;G._wordWrap=!0;G._wordWrapWidth=0;G._wordBreak=!1;G._textOverflow="";G._lineHeight=null;G._textBaseline="alphabetic";G._textAlign="left";G._verticalAlign="top";G._offsetY=null;G._maxLines=0;G._maxLinesSuffix="..";G._textColor=4294967295;G._paddingLeft=0;G._paddingRight=0;G._shadow=!1;G._shadowColor=4278190080;G._shadowOffsetX=0;G._shadowOffsetY=0;G._shadowBlur=5;G._highlight=!1;G._highlightHeight=0;G._highlightColor=4278190080;G._highlightOffset=0;G._highlightPaddingLeft=0;G._highlightPaddingRight=0;G._letterSpacing=0;G._textIndent=0;G._rtl=0;G._cutSx=0;G._cutEx=0;G._cutSy=0;G._cutEy=0;G._advancedRenderer=!1;G._fontBaselineRatio=0;class al extends Oe{constructor(e){super(e),this._textureSource=void 0}get textureSource(){return this._textureSource}set textureSource(e){e!==this._textureSource&&(e.isResultTexture&&(this._precision=this.stage.getRenderPrecision()),this._textureSource=e,this._changed())}_getTextureSource(){return this._textureSource}}class Mn extends ae{constructor(e,t,i,s){super(),this.manager=e,this._settings=t,this._element=i,this._getter=i.constructor.getGetter(s),this._setter=i.constructor.getSetter(s),this._merger=t.merger,this._merger||(this._merger=i.constructor.getMerger(s)),this._startValue=this._getter(this._element),this._targetValue=this._startValue,this._p=1,this._delayLeft=0}start(e){this._startValue=this._getter(this._element),this.isAttached()?e===this._startValue?this.reset(e,1):(this._targetValue=e,this._p=0,this._delayLeft=this._settings.delay,this.emit("start"),this.add()):(this._targetValue=e,this._p=1,this._updateDrawValue())}finish(){this._p<1&&(this._p=1)}stop(){this.emit("stop"),this.manager.removeActive(this)}pause(){this.stop()}play(){this.manager.addActive(this)}reset(e,t){this.isAttached()?(this._startValue=this._getter(this._element),this._targetValue=e,this._p=t,this.add()):(this._startValue=this._getter(this._element),this._targetValue=e,this._p=1,this._updateDrawValue())}_updateDrawValue(){this._setter(this._element,this.getDrawValue())}add(){this.manager.addActive(this)}isAttached(){return this._element.attached}isRunning(){return this._p<1}progress(e){if(this.isAttached()||(this._p=1),this.p<1){if(this.delayLeft>0)if(this._delayLeft-=e,this.delayLeft<0)e=-this.delayLeft,this._delayLeft=0,this.emit("delayEnd");else return;this._settings.duration==0?this._p=1:this._p+=e/this._settings.duration,this._p>=1&&(this._p=1)}this._updateDrawValue(),this.invokeListeners()}invokeListeners(){this.emit("progress",this.p),this.p===1&&this.emit("finish")}updateTargetValue(e){let t=this._settings.timingFunctionImpl(this.p);t===1?this._targetValue=e:t===0?(this._startValue=this._targetValue,this._targetValue=e):(this._startValue=e-(e-this._targetValue)/(1-t),this._targetValue=e)}getDrawValue(){if(this.p>=1)return this.targetValue;{let e=this._settings._timingFunctionImpl(this.p);return this._merger(this.targetValue,this.startValue,e)}}skipDelay(){this._delayLeft=0}get startValue(){return this._startValue}get targetValue(){return this._targetValue}get p(){return this._p}get delayLeft(){return this._delayLeft}get element(){return this._element}get settings(){return this._settings}set settings(e){this._settings=e}}Mn.prototype.isTransition=!0;class ll{constructor(){this._items=[],this._refs={}}get(){return this._items}get first(){return this._items[0]}get last(){return this._items.length?this._items[this._items.length-1]:void 0}add(e){this.addAt(e,this._items.length)}addAt(e,t){if(t>=0&&t<=this._items.length){let i=this._items.indexOf(e);if(i===t)return e;if(w.isObjectLiteral(e)){const s=e;e=this.createItem(s),e.patch(s)}i!=-1?this.setAt(e,t):(e.ref&&(this._refs[e.ref]=e),this._items.splice(t,0,e),this.onAdd(e,t))}else throw new Error("addAt: The index "+t+" is out of bounds "+this._items.length)}replaceByRef(e){if(e.ref){const t=this.getByRef(e.ref);if(!t)throw new Error("replaceByRef: no item found with reference: "+e.ref);this.replace(e,t)}else throw new Error("replaceByRef: no ref specified in item");this.addAt(e,this._items.length)}replace(e,t){const i=this.getIndex(t);if(i===-1)throw new Error("replace: The previous item does not exist");this.setAt(e,i)}setAt(e,t){if(t>=0&&t<=this._items.length){if(w.isObjectLiteral(e)){const s=e;e=this.createItem(s),e.patch(s)}let i=this._items.indexOf(e);if(i!=-1){if(i!==t){const s=i;s!==t&&(this._items.splice(s,1),this._items.splice(t,0,e),this.onMove(e,s,t))}}else if(t<this._items.length){this._items[t].ref&&(this._refs[this._items[t].ref]=void 0);const s=this._items[t];this._items[t]=e,e.ref&&(this._refs[e.ref]=e),this.onSet(e,t,s)}else throw new Error("setAt: The index "+t+" is out of bounds "+this._items.length)}else throw new Error("setAt: The index "+t+" is out of bounds "+this._items.length)}getAt(e){return this._items[e]}getIndex(e){return this._items.indexOf(e)}remove(e){let t=this._items.indexOf(e);t!==-1&&this.removeAt(t)}removeAt(e){if(e>=0&&e<this._items.length){const t=this._items[e];return t.ref&&(this._refs[t.ref]=void 0),this._items.splice(e,1),this.onRemove(t,e),t}else throw new Error(`removeAt: The index ${e} is out of bounds ${this._items.length-1}`)}clear(){if(this._items.length){let t=this._items;this._items=[],this._refs={},this.onSync(t,[],[])}}a(e){if(w.isObjectLiteral(e)){let t=this.createItem(e);return t.patch(e),this.add(t),t}else if(Array.isArray(e)){for(let t=0,i=e.length;t<i;t++)this.a(e[t]);return null}else if(this.isItem(e))return this.add(e),e}get length(){return this._items.length}_getRefs(){return this._refs}getByRef(e){return this._refs[e]}clearRef(e){delete this._refs[e]}setRef(e,t){this._refs[e]=t}patch(e){w.isObjectLiteral(e)?this._setByObject(e):Array.isArray(e)&&this._setByArray(e)}_setByObject(e){let t=this._getRefs(),i=Object.keys(e);for(let s=0,n=i.length;s<n;s++){let o=i[s],a=e[o],l=t[o];if(!l)this.isItem(a)?(a.ref=o,this.add(a)):(l=this.createItem(a),l.ref=o,l.patch(a),this.add(l));else if(this.isItem(a)){if(l!==a){let h=this.getIndex(l);a.ref=o,this.setAt(a,h)}}else l.patch(a)}}_equalsArray(e){let t=!0;if(e.length===this._items.length)for(let i=0,s=this._items.length;i<s&&t;i++)t=t&&this._items[i]===e[i];else t=!1;return t}_setByArray(e){if(this._equalsArray(e))return;for(let s=0,n=this._items.length;s<n;s++)this._items[s].marker=!0;let t,i=[];for(let s=0,n=e.length;s<n;s++){let o=e[s];if(this.isItem(o))o.marker=!1,i.push(o);else{let a=o.ref,l;a&&(t||(t=this._getRefs()),l=t[a]),l?l.marker=!1:l=this.createItem(o),w.isObjectLiteral(o)&&l.patch(o),i.push(l)}}this._setItems(i)}_setItems(e){let t=this._items;this._items=e;let i=t.filter(n=>{let o=n.marker;return delete n.marker,o}),s=e.filter(n=>t.indexOf(n)===-1);if(i.length||s.length){this._refs={};for(let n=0,o=this._items.length;n<o;n++){let a=this._items[n].ref;a&&(this._refs[a]=this._items[n])}}this.onSync(i,s,e)}sort(e){const t=this._items.slice();t.sort(e),this._setByArray(t)}onAdd(e,t){}onRemove(e,t){}onSync(e,t,i){}onSet(e,t,i){}onMove(e,t,i){}createItem(e){throw new Error("ObjectList.createItem must create and return a new object")}isItem(e){return!1}forEach(e){this.get().forEach(e)}}class Af extends ll{constructor(e){super(),this._element=e}_connectParent(e){const t=e.parent;if(t&&t!==this._element){const i=e.parent.childList,s=i.getIndex(e);e.ref&&(i._refs[e.ref]=void 0),i._items.splice(s,1),t.core.removeChildAt(s)}e._setParent(this._element)}onAdd(e,t){this._connectParent(e),this._element.core.addChildAt(t,e.core)}onRemove(e,t){e._setParent(null),this._element.core.removeChildAt(t)}onSync(e,t,i){for(let n=0,o=e.length;n<o;n++)e[n]._setParent(null);for(let n=0,o=t.length;n<o;n++)this._connectParent(t[n]);let s=n=>n.core;this._element.core.syncChildren(e.map(s),t.map(s),i.map(s))}onSet(e,t,i){i._setParent(null),this._connectParent(e),this._element.core.setChildAt(t,e.core)}onMove(e,t,i){this._element.core.moveChild(t,i)}createItem(e){return e.type?new e.type(this._element.stage):this._element.stage.createElement()}isItem(e){return e.isElement}}class se{constructor(e){this.stage=e,this.__id=se.id++,this.__start(),this._hasEventListeners=!1,this.__core=new Ft(this),this.__ref=null,this.__attached=!1,this.__enabled=!1,this.__active=!1,this.__parent=null,this.__texture=null,this.__displayedTexture=null,this.__tags=null,this.__treeTags=null,this.__tagRoot=!1,this.__childList=null,this._w=0,this._h=0}__start(){}get id(){return this.__id}set ref(e){if(this.__ref!==e){const t=e.charCodeAt(0);w.isUcChar(t)||this._throwError("Ref must start with an upper case character: "+e),this.__ref!==null&&(this.removeTag(this.__ref),this.__parent&&this.__parent.__childList.clearRef(this.__ref)),this.__ref=e,this.__ref&&(this._addTag(this.__ref),this.__parent&&this.__parent.__childList.setRef(this.__ref,this))}}get ref(){return this.__ref}get core(){return this.__core}setAsRoot(){this.__core.setAsRoot(),this._updateAttachedFlag(),this._updateEnabledFlag()}get isRoot(){return this.__core.isRoot}_setParent(e){this.__parent!==e&&(this.__parent&&this._unsetTagsParent(),this.__parent=e,e&&this._setTagsParent(),this._updateAttachedFlag(),this._updateEnabledFlag(),this._updateCollision(),this.isRoot&&e&&this._throwError("Root should not be added as a child! Results are unspecified!"))}getDepth(){let e=0,t=this.__parent;for(;t;)e++,t=t.__parent;return e}getAncestor(e){let t=this;for(;e>0&&t.__parent;)t=t.__parent,e--;return t}getAncestors(){const e=[];let t=this;for(;t;)e.push(t),t=t.__parent;return e}getAncestorAtDepth(e){let t=this.getDepth()-e;return t<0?null:this.getAncestor(t)}isAncestorOf(e){let t=e;for(;t=t.parent;)if(this===t)return!0;return!1}getSharedAncestor(e){let t=this,i=e,s=t.getDepth(),n=i.getDepth();s>n?t=t.getAncestor(s-n):n>s&&(i=i.getAncestor(n-s));do{if(t===i)return t;t=t.__parent,i=i.__parent}while(t&&i);return null}get attached(){return this.__attached}get enabled(){return this.__enabled}get active(){return this.__active}_isAttached(){return this.__parent?this.__parent.__attached:this.stage.root===this}_isEnabled(){return this.__core.visible&&this.__core.alpha>0&&(this.__parent?this.__parent.__enabled:this.stage.root===this)}_isActive(){return this._isEnabled()&&this.withinBoundsMargin}_updateAttachedFlag(){let e=this._isAttached();if(this.__attached!==e){this.__attached=e,e&&this._onSetup();let t=this._children.get();if(t){let i=t.length;if(i>0)for(let s=0;s<i;s++)t[s]._updateAttachedFlag()}e?this._onAttach():this._onDetach()}}_updateEnabledFlag(){let e=this._isEnabled();if(this.__enabled!==e){e?(this._onEnabled(),this._setEnabledFlag()):(this._onDisabled(),this._unsetEnabledFlag());let t=this._children.get();if(t){let i=t.length;if(i>0)for(let s=0;s<i;s++)t[s]._updateEnabledFlag()}}}_setEnabledFlag(){this.__enabled=!0,this._updateDimensions(),this._updateTextureCoords(),this.__texture&&this.__texture.addElement(this),this.withinBoundsMargin&&this._setActiveFlag(),this.__core.shader&&this.__core.shader.addElement(this.__core)}_unsetEnabledFlag(){this.__active&&this._unsetActiveFlag(),this.__texture&&this.__texture.removeElement(this),this.__core.shader&&this.__core.shader.removeElement(this.__core),this._texturizer&&this.texturizer.filters.forEach(e=>e.removeElement(this.__core)),this.__enabled=!1}_setActiveFlag(){this.__active=!0,this.__texture&&this.__texture.incActiveCount(),this.__texture&&this._enableTexture(),this._onActive()}_unsetActiveFlag(){this.__texture&&this.__texture.decActiveCount(),this.__active=!1,this.__texture&&this._disableTexture(),this._hasTexturizer()&&this.texturizer.deactivate(),this._onInactive()}_onSetup(){}_onAttach(){}_onDetach(){}_onEnabled(){}_onDisabled(){}_onActive(){}_onInactive(){}_onResize(){}_getRenderWidth(){return this._w?this._w:this.__displayedTexture?this.__displayedTexture.getRenderWidth():this.__texture?this.__texture.getRenderWidth():0}_getRenderHeight(){return this._h?this._h:this.__displayedTexture?this.__displayedTexture.getRenderHeight():this.__texture?this.__texture.getRenderHeight():0}get renderWidth(){return this.__enabled?this.__core.getRenderWidth():this._getRenderWidth()}get renderHeight(){return this.__enabled?this.__core.getRenderHeight():this._getRenderHeight()}get finalX(){return this.__core.x}get finalY(){return this.__core.y}get finalW(){return this.__core.w}get finalH(){return this.__core.h}textureIsLoaded(){return this.__texture&&this.__texture.isLoaded()}loadTexture(){this.__texture&&(this.__texture.load(),(!this.__texture.isUsed()||!this._isEnabled())&&this._updateDimensions())}_enableTextureError(){const e=this.__texture.loadError;e&&this.emit("txError",e,this.__texture._source)}_enableTexture(){this.__texture.isLoaded()?this._setDisplayedTexture(this.__texture):(this._setDisplayedTexture(null),this._enableTextureError())}_disableTexture(){this._setDisplayedTexture(null)}get texture(){return this.__texture}set texture(e){let t;if(w.isObjectLiteral(e))e.type?t=new e.type(this.stage):t=this.texture,t&&xe.patchObject(t,e);else if(!e)t=null;else if(e.isTexture)t=e;else if(e.isTextureSource)t=new al(this.stage),t.textureSource=e;else{console.error("[Lightning] Please specify a texture type.");return}const i=this.__texture;t!==i&&(this.__texture=t,this.__texture?this.__enabled&&(this.__texture.addElement(this),this.withinBoundsMargin&&(this.__texture.isLoaded()?this._setDisplayedTexture(this.__texture):this._enableTextureError())):this._setDisplayedTexture(null),i&&i!==this.__displayedTexture&&i.removeElement(this),this._updateDimensions())}get displayedTexture(){return this.__displayedTexture}_setDisplayedTexture(e){let t=this.__displayedTexture;t&&e!==t&&this.__texture!==t&&t.removeElement(this);const i=this.__core.displayedTextureSource,s=(e?e._source:null)!==i;this.__displayedTexture=e,this._updateDimensions(),this.__displayedTexture?s&&(this._updateTextureCoords(),this.__core.setDisplayedTextureSource(this.__displayedTexture._source)):this.__core.setDisplayedTextureSource(null),s&&(this.__displayedTexture?(this.stage.removeUpdateSourceTexture(this.__displayedTexture),this.emit("txLoaded",this.__displayedTexture)):this.emit("txUnloaded",this.__displayedTexture))}onTextureSourceLoaded(){this.active&&this._setDisplayedTexture(this.__texture)}onTextureSourceLoadError(e){this.emit("txError",e,this.__texture._source)}forceRenderUpdate(){this.__core.setHasRenderUpdates(3)}onDisplayedTextureClippingChanged(){this._updateDimensions(),this._updateTextureCoords()}onPrecisionChanged(){this._updateDimensions()}onDimensionsChanged(e,t){this.texture instanceof ot&&(this.texture.w=e,this.texture.h=t,this.w=e,this.h=t)}_updateDimensions(){let e=this._getRenderWidth(),t=this._getRenderHeight(),i=!1;(!e||!t)&&!this.__displayedTexture&&this.__texture&&(e=e||this.__texture.mw,t=t||this.__texture.mh,(!e||!t)&&this.__texture.isAutosizeTexture()&&(i=!0)),this.__core.setDimensions(e,t,i)&&this._onResize()}_updateTextureCoords(){if(this.displayedTexture&&this.displayedTexture._source){let e=this.displayedTexture,t=this.displayedTexture._source,i=0,s=0,n=1,o=1;if(e.clipping){let a=t.getRenderWidth(),l=t.getRenderHeight(),h,u,f,c;h=1/a,u=1/l,e.pw?f=e.pw*h:f=(a-e.px)*h,e.ph?c=e.ph*u:c=(l-e.py)*u,h*=e.px,u*=e.py,i=h,s=u,n=n*f+h,o=o*c+u,i=Math.max(0,i),s=Math.max(0,s),n=Math.min(1,n),o=Math.min(1,o)}if(t._flipTextureY){let a=o;o=s,s=a}this.__core.setTextureCoords(i,s,n,o)}}getCornerPoints(){return this.__core.getCornerPoints()}_unsetTagsParent(){this.__tags&&this.__tags.forEach(i=>{let s=this;for(;(s=s.__parent)&&(s.__treeTags.get(i).delete(this),!s.__tagRoot););});let e=null,t=0;if(this.__treeTags&&!this.__tagRoot&&(e=w.iteratorToArray(this.__treeTags.keys()),t=e.length,t>0))for(let i=0;i<t;i++){let s=this.__treeTags.get(e[i]),n=this;for(;n=n.__parent;){let o=n.__treeTags.get(e[i]);if(s.forEach(function(a){o.delete(a)}),n.__tagRoot)break}}}_setTagsParent(){this.__tags&&this.__tags.forEach(e=>{let t=this;for(;t=t.__parent;){t.__treeTags||(t.__treeTags=new Map);let i=t.__treeTags.get(e);if(i||(i=new Set,t.__treeTags.set(e,i)),i.add(this),t.__tagRoot)break}}),this.__treeTags&&this.__treeTags.size&&(this.__tagRoot||this.__treeTags.forEach((e,t)=>{let i=this;for(;!i.__tagRoot&&(i=i.__parent);){i.__tagRoot,i.__treeTags||(i.__treeTags=new Map);let s=i.__treeTags.get(t);s||(s=new Set,i.__treeTags.set(t,s)),e.forEach(function(n){s.add(n)})}}))}_getByTag(e){if(!this.__treeTags)return[];let t=this.__treeTags.get(e);return t?w.setToArray(t):[]}getTags(){return this.__tags?this.__tags:[]}setTags(e){e=e.reduce((a,l)=>a.concat(l.split(" ")),[]),this.__ref&&e.push(this.__ref);let t,i=e.length,s=[],n=[];for(t=0;t<i;t++)this.hasTag(e[t])||n.push(e[t]);let o=this.tags||[];for(i=o.length,t=0;t<i;t++)e.indexOf(o[t])==-1&&s.push(o[t]);for(t=0;t<s.length;t++)this.removeTag(s[t]);for(t=0;t<n.length;t++)this.addTag(n[t])}addTag(e){if(e.indexOf(" ")===-1)w.isUcChar(e.charCodeAt(0))&&this._throwError("Tag may not start with an upper case character."),this._addTag(e);else{const t=e.split(" ");for(let i=0,s=t.length;i<s;i++){const n=t[i];w.isUcChar(n.charCodeAt(0))&&this._throwError("Tag may not start with an upper case character."),this._addTag(n)}}}_addTag(e){if(this.__tags||(this.__tags=[]),this.__tags.indexOf(e)===-1){this.__tags.push(e);let t=this.__parent;if(t)do{t.__treeTags||(t.__treeTags=new Map);let i=t.__treeTags.get(e);i||(i=new Set,t.__treeTags.set(e,i)),i.add(this)}while(!t.__tagRoot&&(t=t.__parent))}}removeTag(e){let t=this.__tags.indexOf(e);if(t!==-1){this.__tags.splice(t,1);let i=this.__parent;if(i)do{let s=i.__treeTags.get(e);s&&s.delete(this)}while(!i.__tagRoot&&(i=i.__parent))}}hasTag(e){return this.__tags&&this.__tags.indexOf(e)!==-1}_tag(e){if(e.indexOf(".")!==-1)return this.mtag(e)[0];if(this.__treeTags){let t=this.__treeTags.get(e);if(t){const i=t.values().next();return i?i.value:void 0}}}get tag(){return this._tag}set tag(e){this.tags=e}mtag(e){if(e.indexOf(".")>=0){let i=e.split("."),s=this._getByTag(i[0]),n=1,o=i.length;for(;s.length&&n<o;){let a=[];for(let l=0,h=s.length;l<h;l++)a=a.concat(s[l]._getByTag(i[n]));s=a,n++}return s}else return this._getByTag(e)}stag(e,t){let i=this.mtag(e),s=i.length;for(let n=0;n<s;n++)xe.patchObject(i[n],t)}get tagRoot(){return this.__tagRoot}set tagRoot(e){this.__tagRoot!==e&&(e?this._unsetTagsParent():this._setTagsParent(),this.__tagRoot=e)}sel(e){const t=this.select(e);if(t.length)return t[0]}select(e){if(e.indexOf(",")!==-1){let t=e.split(","),i=[];for(let s=0;s<t.length;s++)i=i.concat(this._select(t[s]));return i}else return this._select(e)}_select(e){if(e==="")return[this];let t=e.indexOf("."),i=e.indexOf(">");if(t===-1&&i===-1)return this.mtag(e);let s;return i===0?(s=!0,e=e.substr(1)):t===0?(s=!1,e=e.substr(1)):s=!1,this._selectChilds(e,s)}_selectChilds(e,t){const i=e.indexOf("."),s=e.indexOf(">");if(i===-1&&s===-1)if(t){const n=this.getByRef(e);return n?[n]:[]}else return this.mtag(e);if(s===-1||i!==-1&&i<s){let n;const o=e.substr(0,i);if(t){const h=this.getByRef(o);n=h?[h]:[]}else n=this.mtag(o);let a=[];const l=e.substr(i+1);for(let h=0,u=n.length;h<u;h++)a=a.concat(n[h]._selectChilds(l,!1));return a}else{let n;const o=e.substr(0,s);if(t){const h=this.getByRef(o);n=h?[h]:[]}else n=this.mtag(o);let a=[];const l=e.substr(s+1);for(let h=0,u=n.length;h<u;h++)a=a.concat(n[h]._selectChilds(l,!0));return a}}getByRef(e){return this.childList.getByRef(e)}getLocationString(){let e;e=this.__parent?this.__parent._children.getIndex(this):"R";let t=this.getTags(),i=this.__parent?this.__parent.getLocationString():"";return this.ref?i+=":["+e+"]"+this.ref:t.length?i+=":["+e+"]"+t.join(","):i+=":["+e+"]#"+this.id,i}toString(){let e=this.getSettings();return se.getPrettyString(e,"")}static getPrettyString(e,t){let i=e.children;delete e.children;let s=["color","colorUl","colorUr","colorBl","colorBr"],n=JSON.stringify(e,function(o,a){return s.indexOf(o)!==-1?"COLOR["+a.toString(16)+"]":a});if(n=n.replace(/"COLOR\[([a-f0-9]{1,8})\]"/g,"0x$1"),i){let o="";if(w.isObjectLiteral(i)){let a=Object.keys(i);o="";for(let h=0,u=a.length;h<u;h++)o+=`
${t}  "${a[h]}":`,delete i[a[h]].ref,o+=se.getPrettyString(i[a[h]],t+"  ")+(h<u-1?",":"");let l=n==="{}";n=n.substr(0,n.length-1)+(l?"":",")+o+`
`+t+"}"}else{let a=i.length;o="[";for(let h=0;h<a;h++)o+=se.getPrettyString(i[h],t+"  ")+(h<a-1?",":"")+`
`;o+=t+"]}";let l=n==="{}";n=n.substr(0,n.length-1)+(l?"":",")+`"children":
`+t+o+"}"}}return n}getSettings(){let e=this.getNonDefaults(),t=this._children.get();if(t){let i=t.length;if(i){const s=[];let n=!1;for(let o=0;o<i;o++)s.push(t[o].getSettings()),n=n||!t[o].ref;n?e.children=s:(e.children={},s.forEach(o=>{e.children[o.ref]=o}))}}return e.id=this.id,e}getNonDefaults(){let e={};if(this.constructor!==se&&(e.type=this.constructor.name),this.__ref&&(e.ref=this.__ref),this.__tags&&this.__tags.length&&(e.tags=this.__tags),this.x!==0&&(e.x=this.x),this.y!==0&&(e.y=this.y),this.w!==0&&(e.w=this.w),this.h!==0&&(e.h=this.h),this.scaleX===this.scaleY?this.scaleX!==1&&(e.scale=this.scaleX):(this.scaleX!==1&&(e.scaleX=this.scaleX),this.scaleY!==1&&(e.scaleY=this.scaleY)),this.pivotX===this.pivotY?this.pivotX!==.5&&(e.pivot=this.pivotX):(this.pivotX!==.5&&(e.pivotX=this.pivotX),this.pivotY!==.5&&(e.pivotY=this.pivotY)),this.mountX===this.mountY?this.mountX!==0&&(e.mount=this.mountX):(this.mountX!==0&&(e.mountX=this.mountX),this.mountY!==0&&(e.mountY=this.mountY)),this.alpha!==1&&(e.alpha=this.alpha),this.visible||(e.visible=!1),this.rotation!==0&&(e.rotation=this.rotation),this.colorUl===this.colorUr&&this.colorBl===this.colorBr&&this.colorUl===this.colorBl?this.colorUl!==4294967295&&(e.color=this.colorUl.toString(16)):(this.colorUl!==4294967295&&(e.colorUl=this.colorUl.toString(16)),this.colorUr!==4294967295&&(e.colorUr=this.colorUr.toString(16)),this.colorBl!==4294967295&&(e.colorBl=this.colorBl.toString(16)),this.colorBr!==4294967295&&(e.colorBr=this.colorBr.toString(16))),this.zIndex&&(e.zIndex=this.zIndex),this.forceZIndexContext&&(e.forceZIndexContext=!0),this.clipping&&(e.clipping=this.clipping),this.clipbox||(e.clipbox=this.clipbox),this.__texture){let t=this.__texture.getNonDefaults();Object.keys(t).length&&(e.texture=t)}if(this.shader&&w.isFunction(this.shader.getNonDefaults)){let t=this.shader.getNonDefaults();Object.keys(t).length&&(e.shader=t)}return this._hasTexturizer()&&(this.texturizer.enabled&&(e.renderToTexture=this.texturizer.enabled),this.texturizer.lazy&&(e.renderToTextureLazy=this.texturizer.lazy),this.texturizer.colorize&&(e.colorizeResultTexture=this.texturizer.colorize),this.texturizer.renderOffscreen&&(e.renderOffscreen=this.texturizer.renderOffscreen)),e}static getGetter(e){let t=se.PROP_GETTERS.get(e);return t||(t=new Function("obj","return obj."+e),se.PROP_GETTERS.set(e,t)),t}static getSetter(e){let t=se.PROP_SETTERS.get(e);return t||(t=new Function("obj","v","obj."+e+" = v"),se.PROP_SETTERS.set(e,t)),t}get withinBoundsMargin(){return this.__core._withinBoundsMargin}_enableWithinBoundsMargin(){this.__enabled&&this._setActiveFlag()}_disableWithinBoundsMargin(){this.__active&&this._unsetActiveFlag()}set boundsMargin(e){if(!Array.isArray(e)&&e!==null)throw new Error("boundsMargin should be an array of left-top-right-bottom values or null (inherit margin)");this.__core.boundsMargin=e}get boundsMargin(){return this.__core.boundsMargin}get x(){return this.__core.offsetX}set x(e){this.__core.offsetX=e}get y(){return this.__core.offsetY}set y(e){this.__core.offsetY=e}get w(){return this._w}set w(e){w.isFunction(e)?(this._w=0,this.__core.funcW=e):(e=Math.max(e,0),this._w!==e&&(this.__core.disableFuncW(),this._w=e,this._updateDimensions()))}get h(){return this._h}set h(e){w.isFunction(e)?(this._h=0,this.__core.funcH=e):(e=Math.max(e,0),this._h!==e&&(this.__core.disableFuncH(),this._h=e,this._updateDimensions()))}get collision(){return this._collision}set collision(e){this._collision=e}_updateCollision(){this.collision&&this.__parent&&this.__parent.collision===void 0&&(this.__parent.collision=2)}get scaleX(){return this.__core.scaleX}set scaleX(e){this.__core.scaleX=e}get scaleY(){return this.__core.scaleY}set scaleY(e){this.__core.scaleY=e}get scale(){return this.__core.scale}set scale(e){this.__core.scale=e}get pivotX(){return this.__core.pivotX}set pivotX(e){this.__core.pivotX=e}get pivotY(){return this.__core.pivotY}set pivotY(e){this.__core.pivotY=e}get pivot(){return this.__core.pivot}set pivot(e){this.__core.pivot=e}get mountX(){return this.__core.mountX}set mountX(e){this.__core.mountX=e}get mountY(){return this.__core.mountY}set mountY(e){this.__core.mountY=e}get mount(){return this.__core.mount}set mount(e){this.__core.mount=e}get rotation(){return this.__core.rotation}set rotation(e){this.__core.rotation=e}get alpha(){return this.__core.alpha}set alpha(e){this.__core.alpha=e}get visible(){return this.__core.visible}set visible(e){this.__core.visible=e}get colorUl(){return this.__core.colorUl}set colorUl(e){this.__core.colorUl=e}get colorUr(){return this.__core.colorUr}set colorUr(e){this.__core.colorUr=e}get colorBl(){return this.__core.colorBl}set colorBl(e){this.__core.colorBl=e}get colorBr(){return this.__core.colorBr}set colorBr(e){this.__core.colorBr=e}get color(){return this.__core.colorUl}set color(e){(this.colorUl!==e||this.colorUr!==e||this.colorBl!==e||this.colorBr!==e)&&(this.colorUl=e,this.colorUr=e,this.colorBl=e,this.colorBr=e)}get colorTop(){return this.colorUl}set colorTop(e){(this.colorUl!==e||this.colorUr!==e)&&(this.colorUl=e,this.colorUr=e)}get colorBottom(){return this.colorBl}set colorBottom(e){(this.colorBl!==e||this.colorBr!==e)&&(this.colorBl=e,this.colorBr=e)}get colorLeft(){return this.colorUl}set colorLeft(e){(this.colorUl!==e||this.colorBl!==e)&&(this.colorUl=e,this.colorBl=e)}get colorRight(){return this.colorUr}set colorRight(e){(this.colorUr!==e||this.colorBr!==e)&&(this.colorUr=e,this.colorBr=e)}get zIndex(){return this.__core.zIndex}set zIndex(e){this.__core.zIndex=e}get forceZIndexContext(){return this.__core.forceZIndexContext}set forceZIndexContext(e){this.__core.forceZIndexContext=e}get clipping(){return this.__core.clipping}set clipping(e){this.__core.clipping=e}get clipbox(){return this.__core.clipbox}set clipbox(e){this.__core.clipbox=e}get tags(){return this.getTags()}set tags(e){Array.isArray(e)||(e=[e]),this.setTags(e)}set t(e){this.tags=e}get _children(){return this.__childList||(this.__childList=new Af(this,!1)),this.__childList}get childList(){return this._allowChildrenAccess()||this._throwError("Direct access to children is not allowed in "+this.getLocationString()),this._children}hasChildren(){return this._allowChildrenAccess()&&this.__childList&&this.__childList.length>0}_allowChildrenAccess(){return!0}get children(){return this.childList.get()}set children(e){this.childList.patch(e)}add(e){return this.childList.a(e)}get p(){return this.__parent}get parent(){return this.__parent}get src(){if(this.texture&&this.texture instanceof In)return this.texture._src}set src(e){const t=new In(this.stage);t.src=e,this.texture=t}set mw(e){this.texture?(this.texture.mw=e,this._updateDimensions()):this._throwError("Please set mw after setting a texture.")}set mh(e){this.texture?(this.texture.mh=e,this._updateDimensions()):this._throwError("Please set mh after setting a texture.")}get rect(){return this.texture===this.stage.rectangleTexture}set rect(e){e?this.texture=this.stage.rectangleTexture:this.texture=null}enableTextTexture(){return(!this.texture||!(this.texture instanceof ot))&&(this.texture=new ot(this.stage),!this.texture.w&&!this.texture.h&&(this.texture.w=this.w,this.texture.h=this.h)),this.texture}get text(){return this.texture&&this.texture instanceof ot?this.texture:null}set text(e){(!this.texture||!(this.texture instanceof ot))&&this.enableTextTexture(),w.isString(e)?this.texture.text=e:this.texture.patch(e)}set onUpdate(e){this.__core.onUpdate=e}set onAfterCalcs(e){this.__core.onAfterCalcs=e}set onAfterUpdate(e){this.__core.onAfterUpdate=e}forceUpdate(){this.__core._setHasUpdates()}get shader(){return this.__core.shader}set shader(e){if(w.isObjectLiteral(e)&&!e.type)this.shader&&this.shader.patch(e);else{const t=ns.create(this.stage,e);this.__enabled&&this.__core.shader&&this.__core.shader.removeElement(this.__core),this.__core.shader=t,this.__enabled&&this.__core.shader&&this.__core.shader.addElement(this.__core)}}_hasTexturizer(){return!!this.__core._texturizer}get renderToTexture(){return this.rtt}set renderToTexture(e){this.rtt=e}get rtt(){return this._hasTexturizer()&&this.texturizer.enabled}set rtt(e){this.texturizer.enabled=e}get rttLazy(){return this._hasTexturizer()&&this.texturizer.lazy}set rttLazy(e){this.texturizer.lazy=e}get renderOffscreen(){return this._hasTexturizer()&&this.texturizer.renderOffscreen}set renderOffscreen(e){this.texturizer.renderOffscreen=e}get colorizeResultTexture(){return this._hasTexturizer()&&this.texturizer.colorize}set colorizeResultTexture(e){this.texturizer.colorize=e}getTexture(){return this.texturizer._getTextureSource()}get texturizer(){return this.__core.texturizer}patch(e){let t=Object.keys(e);for(let i=0,s=t.length;i<s;i++){let n=t[i];const o=e[n],a=n.charCodeAt(0);if(w.isUcChar(a)){const l=this.getByRef(n);if(l)o===void 0?l.parent&&l.parent.childList.remove(l):w.isObjectLiteral(o)?l.patch(o):o.isElement?(o.ref=n,this.childList.replace(o,l)):this._throwError("Unexpected value for path: "+n);else if(o!==void 0){let h;w.isObjectLiteral(o)?(h=this.childList.createItem(o),h.patch(o)):w.isObject(o)&&(h=o),h.isElement&&(h.ref=n),this.childList.a(h)}}else xe.patchObjectProperty(this,n,o)}}_throwError(e){throw new Error(this.constructor.name+" ("+this.getLocationString()+"): "+e)}animation(e){return this.stage.animations.createAnimation(this,e)}transition(e,t=null){return t===null?this._getTransition(e):(this._setTransition(e,t),null)}set transitions(e){Object.keys(e).forEach(i=>{this.transition(i,e[i])})}set smooth(e){Object.keys(e).forEach(i=>{let s=e[i];Array.isArray(s)?this.setSmooth(i,s[0],s[1]):this.setSmooth(i,s)})}fastForward(e){if(this._transitions){let t=this._transitions[e];t&&t.isTransition&&t.finish()}}_getTransition(e){this._transitions||(this._transitions={});let t=this._transitions[e];return t?t.isTransitionSettings&&(t=new Mn(this.stage.transitions,t,this,e)):t=new Mn(this.stage.transitions,this.stage.transitions.defaultTransitionSettings,this,e),this._transitions[e]=t,t}_setTransition(e,t){if(!t)this._removeTransition(e);else{w.isObjectLiteral(t)&&(t=this.stage.transitions.createSettings(t)),this._transitions||(this._transitions={});let i=this._transitions[e];if(i&&i.isTransition)return i.settings=t,i;this._transitions[e]=t}}_removeTransition(e){this._transitions&&delete this._transitions[e]}getSmooth(e,t){let i=this._getTransition(e);return i&&i.isAttached()?i.targetValue:t}setSmooth(e,t,i){i&&this._setTransition(e,i);let s=this._getTransition(e);return s.start(t),s}get flex(){return this.__core.flex}set flex(e){this.__core.flex=e}get flexItem(){return this.__core.flexItem}set flexItem(e){this.__core.flexItem=e}static isColorProperty(e){return e.toLowerCase().indexOf("color")>=0}static getMerger(e){return se.isColorProperty(e)?D.mergeColors:D.mergeNumbers}toJSON(){const e=[`${this.constructor.name}`],t={};return t[e]={},this.hasChildren()?se.collectChildren(t[e],this.__childList):t[e]={...se.getProperties(this)},t}static collectChildren(e,t){const i=t;for(let s=0,n=i.length;s<n;s++){const o=i.getAt(s),a=`${o.__ref||`Element-${o.id}`}`,l=this.getProperties(o);e[a]={...l},o.hasChildren()&&(e[a].children={},this.collectChildren(e[a].children,o.__childList))}}static getProperties(e){const t={},i=["alpha","active","attached","boundsMargin","color","clipping","enabled","h","id","isComponent","mount","mountY","mountX","pivot","pivotX","pivotY","ref","renderOffscreen","renderToTexture","scale","scaleX","scaleY","state","tag","visible","w","x","y","zIndex","!!flex","!!flexItem","hasFocus()","hasFinalFocus()"];let s=i.length;for(;s--;){let n=i[s];const o=/^!{2}/,a=/\(\)$/;o.test(n)?(n=n.substring(2,n.length),t[n]=!!e[n]):a.test(n)?(n=n.substring(0,n.length-2),typeof e[n]=="function"&&(t[n]=e[n]())):t[n]=e[n]}return{...t,...e.getNonDefaults()}}}ae.addAsMixin(se);se.prototype.isElement=1;se.id=1;se.PROP_GETTERS=new Map;se.PROP_SETTERS=new Map;class Ue{constructor(){Ue.setupStateMachine(this)}static setupStateMachine(e){const t=e.constructor,i=Ue.create(t);Object.setPrototypeOf(e,i.prototype),e.constructor=t,e._initStateMachine()}static create(e){if(!e.hasOwnProperty("_sm")){const t=new rt(e);e._sm=t}return e._sm.router}fire(e,...t){if(this._hasMethod(e))return this[e](...t)}_getState(){return this._state.__path}_inState(e,t=this._state.__path){const i=this._sm.getStateByPath(e),s=this._sm.getStateByPath(t),n=i.__level;return Ue._getStateAtLevel(s,n)===i}_hasMember(e){return!!this.constructor.prototype[e]}_hasMethod(e){const t=this.constructor.prototype[e];return!!t&&typeof t=="function"}_setState(e,t){const i=++this._setStateCounter;if(this._setStateId=i,this._state.__path!==e){let s=this._sm._stateMap[e];s||(s=this._sm.getStateByPath(e));const n=this._state,o=s.prototype.$enter!==this._state.prototype.$enter,a=s.prototype.$exit!==this._state.prototype.$exit;if(o||a){const l=Ue._getSharedState(this._state,s),h={newState:s.__path,prevState:n.__path,sharedState:l.__path},u=l.__level;if(a){const f=Ue._getStatesUntilLevel(this._state,u);for(let c=0,p=f.length;c<p;c++)if(this.__setState(f[c]),this._callExit(this._state,t,h),this._setStateId!==i)return}if(o){const f=Ue._getStatesUntilLevel(s,u).reverse();for(let c=0,p=f.length;c<p;c++)if(this.__setState(f[c]),this._callEnter(this._state,t,h),this._setStateId!==i)return}}if(this.__setState(s),this._changedState){const l={newState:s.__path,prevState:n.__path};t?this._changedState(l,...t):this._changedState(l)}if(this._onStateChange){const l={newState:s.__path,prevState:n.__path};this._onStateChange(l)}}}_callEnter(e,t=[],i){const s=!!e.__parent;e.prototype.$enter&&(!s||e.__parent.prototype.$enter!==e.prototype.$enter)&&e.prototype.$enter.apply(this,[i,...t])}_callExit(e,t=[],i){const s=!!e.__parent;e.prototype.$exit&&(!s||e.__parent.prototype.$exit!==e.prototype.$exit)&&e.prototype.$exit.apply(this,[i,...t])}__setState(e){this._state=e,this._stateIndex=e.__index,this.constructor=e}_initStateMachine(){this._state=null,this._stateIndex=0,this._setStateCounter=0,this._sm=this._routedType._sm,this.__setState(this._sm.getStateByPath(""));const e={newState:"",prevState:void 0,sharedState:void 0};this._callEnter(this._state,[],e),this._onStateChange=void 0}_getMostSpecificHandledMember(e){let t=this._state;do{for(let i=0,s=e.length;i<s;i++){const n=e[i];if(t.__parent){const o=rt.getStateMemberAlias(t.__path,n);if(this[o])return n}else if(t.prototype[n])return n}t=t.__parent}while(t)}static _getStatesUntilLevel(e,t){const i=[];for(;e.__level>t;)i.push(e),e=e.__parent;return i}static _getSharedState(e,t){const i=Ue._getAncestorStates(e),s=Ue._getAncestorStates(t),n=Math.min(i.length,s.length);for(let o=0;o<n;o++)if(i[o]!==s[o])return i[o-1];return i[n-1]}static _getAncestorStates(e){const t=[];do t.push(e);while(e=e.__parent);return t.reverse()}static _getStateAtLevel(e,t){if(!(t>e.__level)){for(;t<e.__level;)e=e.__parent;return e}}}class rt{constructor(e){this._type=e,this._router=null,this.init()}get router(){return this._router}init(){this._router=this._createRouter(),this._stateMap=this._getStateMap(),this._addStateMemberDelegatorsToRouter()}_createRouter(){const e=this._type,t=class extends e{constructor(){if(super(...arguments),!this.constructor.hasOwnProperty("_isRouter"))throw new Error(`You need to extend ${e.name}.original instead of ${e.name}.`)}};return t._isRouter=!0,t.prototype._routedType=e,t.original=e,this._mixinStateMachineMethods(t),t}_mixinStateMachineMethods(e){const t=Object.getOwnPropertyNames(Ue.prototype);for(let i=0,s=t.length;i<s;i++){const n=t[i];if(n!=="constructor"){const o=Object.getOwnPropertyDescriptor(Ue.prototype,n);Object.defineProperty(e.prototype,n,o)}}}_addStateMemberDelegatorsToRouter(){this._getAllMemberNames().forEach(t=>{this._addMemberRouter(t)})}_addMemberRouter(e){const t=Object.keys(this._stateMap),i=[],s=[];t.forEach((o,a)=>{const l=this._stateMap[o],h=this._getDescriptor(l,e);if(h){i[a]=h;const u=rt.getStateMemberAlias(h._source.__path,e);s[a]=u,this._router.prototype.hasOwnProperty(u)||Object.defineProperty(this._router.prototype,u,h)}else i[a]=null,s[a]=null});let n;switch(i.forEach(o=>{if(o){const a=this._getDescriptorType(o);if(n&&n!==a){console.warn(`[Lightning] Member ${e} in ${this._type.name} has inconsistent types.`);return}n=a}}),n){case"method":this._addMethodRouter(e,i,s);break;case"getter":this._addGetterSetterRouters(e);break;case"property":console.warn("[Lightning] Fixed properties are not supported; please use a getter instead!");break}}_getDescriptor(e,t,i=()=>!0){let s=e,n=e;do{const o=Object.getOwnPropertyDescriptor(s.prototype,t);if(o&&i(o))return o._source=n,o;s=Object.getPrototypeOf(s),s&&s.hasOwnProperty("__state")&&(n=s)}while(s&&s.prototype)}_getDescriptorType(e){return e.get||e.set?"getter":typeof e.value=="function"?"method":"property"}static _supportsSpread(){if(this.__supportsSpread===void 0){this.__supportsSpread=!1;try{new Function("return [].concat(...arguments);")(),this.__supportsSpread=!0}catch{}}return this.__supportsSpread}_addMethodRouter(e,t,i){const s=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"];let n=i[0];const o=rt._supportsSpread();for(let u=1,f=i.length;u<f;u++){const c=i[u];c!==n&&(n?o?s.push(`if (i < ${u}) return this["${n}"](...arguments); else`):s.push(`if (i < ${u}) return this["${n}"].apply(this, arguments); else`):s.push(`if (i < ${u}) return ; else`)),n=c}n?o?s.push(`return this["${n}"](...arguments);`):s.push(`return this["${n}"].apply(this, arguments);`):s.push(";");const a=s.join(`
`),h={value:new Function([],a)};Object.defineProperty(this._router.prototype,e,h)}_addGetterSetterRouters(e){const t=this._getGetterRouter(e),i=this._getSetterRouter(e),s={get:t,set:i};Object.defineProperty(this._router.prototype,e,s)}_getGetterRouter(e){const t=Object.keys(this._stateMap),i=[];t.forEach((l,h)=>{const u=this._stateMap[l],f=this._getDescriptor(u,e,c=>c.get);if(f){const c=rt.getStateMemberAlias(f._source.__path,e);i[h]=c,this._router.prototype.hasOwnProperty(c)||Object.defineProperty(this._router.prototype,c,f)}else i[h]=null});const s=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"];let n=i[0];for(let l=1,h=i.length;l<h;l++){const u=i[l];u!==n&&(n?s.push(`if (i < ${l}) return this["${n}"]; else`):s.push(`if (i < ${l}) return ; else`)),n=u}n?s.push(`return this["${n}"];`):s.push(";");const o=s.join(`
`);return new Function([],o)}_getSetterRouter(e){const t=Object.keys(this._stateMap),i=[];t.forEach((l,h)=>{const u=this._stateMap[l],f=this._getDescriptor(u,e,c=>c.set);if(f){const c=rt.getStateMemberAlias(f._source.__path,e);i[h]=c,this._router.prototype.hasOwnProperty(c)||Object.defineProperty(this._router.prototype,c,f)}else i[h]=null});const s=["//@ sourceURL=StateMachineRouter.js","var i = this._stateIndex;"];let n=i[0];for(let l=1,h=i.length;l<h;l++){const u=i[l];u!==n&&(n?s.push(`if (i < ${l}) this["${n}"] = arg; else`):s.push(`if (i < ${l}) ; else`)),n=u}n?s.push(`this["${n}"] = arg;`):s.push(";");const o=s.join(`
`);return new Function(["arg"],o)}static getStateMemberAlias(e,t){return"$"+(e?e+".":"")+t}_getAllMemberNames(){const e=this._stateMap,t=Object.keys(e);let i=new Set;return t.forEach(s=>{if(s==="")return;const n=e[s];this._getStateMemberNames(n).forEach(a=>{i.add(a)})}),[...i]}_getStateMemberNames(e){let t=e,i=new Set;const s=this._type===e;do this._getStateMemberNamesForType(t).forEach(o=>{i.add(o)}),t=Object.getPrototypeOf(t);while(t&&t.prototype&&(!t.hasOwnProperty("__state")||s));return i}_getStateMemberNamesForType(e){return Object.getOwnPropertyNames(e.prototype).filter(i=>i!=="constructor"&&!rt._isStateLocalMember(i))}static _isStateLocalMember(e){return e==="$enter"||e==="$exit"}getStateByPath(e){if(this._stateMap[e])return this._stateMap[e];const t=e.split(".");for(;t.pop();){const i=t.join(".");if(this._stateMap[i])return this._stateMap[i]}}_getStateMap(){return this._stateMap||(this._stateMap=this._createStateMap()),this._stateMap}_createStateMap(){const e={};return this._addState(this._type,null,"",e),e}_addState(e,t,i,s){e.__state=!0,e.__name=i,this._addStaticStateProperty(e,t);const n=t?t.__path:"";let o=(n?n+".":"")+i;e.__path=o,e.__level=t?t.__level+1:0,e.__parent=t,e.__index=Object.keys(s).length,s[o]=e;const a=e._states;a&&(t&&t._states===a||e._states().forEach(u=>{const f=rt._getStateName(u);this._addState(u,e,f,s)}))}static _getStateName(e){const t=e.name,i=t.indexOf("$");return i>0?t.substr(0,i):t}_addStaticStateProperty(e,t){t&&(t&&!t.__parent?this._router[e.__name]=e:t[e.__name]=e)}}class ue extends se{constructor(e,t){super(e),this.tagRoot=!0,w.isObjectLiteral(t)&&Object.assign(this,t),this.__initialized=!1,this.__firstActive=!1,this.__firstEnable=!1,this.__signals=void 0,this.__passSignals=void 0,this.__construct();const i=this.constructor.getTemplateFunc(this);i.f(this,i.a),this._build()}__start(){Ue.setupStateMachine(this),this._onStateChange=ue.prototype.__onStateChange}get state(){return this._getState()}__onStateChange(){this.application&&this.application.updateFocusPath()}_refocus(){this.application&&this.application.updateFocusPath()}static bindProp(e,t=null){return{__propertyBinding:!0,__name:e,__func:t}}__bindProperty(e,t,i){const s=t,n=i,o=Array.isArray(e.__name)?e.__name:[e.__name];for(let a=0;a<o.length;a++){const l=o[a],h=e.__func?e.__func:u=>u[l];this.hasOwnProperty(l)?this[`__prop_bindings_${l}`].push({__obj:s,__prop:n,__func:h}):(this[`__prop_bindings_${l}`]=[{__obj:s,__prop:n,__func:h}],Object.defineProperty(this,l,{set:u=>{this[`__prop_${l}`]=u;for(const{__obj:f,__prop:c,__func:p}of this[`__prop_bindings_${l}`])f[c]=p(this)},get:()=>this[`__prop_${l}`]}))}}static getTemplateFunc(e){const t="_templateFunc",i="__has"+t;return this[i]!==this&&(this[i]=this,this[t]=this.parseTemplate(this._template(e))),this[t]}static parseTemplate(e){const t={loc:[],store:[],rid:0};this.parseTemplateRec(e,t,"element");const i=t.loc.join(`;
`);return{f:new Function("element","store",i),a:t.store}}static parseTemplateRec(e,t,i){const s=t.store,n=t.loc;Object.keys(e).forEach(a=>{let l=e[a];if(w.isUcChar(a.charCodeAt(0)))if(w.isObjectLiteral(l)){const h=`r${a.replace(/[^a-z0-9]/gi,"")+t.rid}`;let u=l.type?l.type:se;u===se?n.push(`var ${h} = element.stage.createElement()`):(s.push(u),n.push(`var ${h} = new store[${s.length-1}](${i}.stage)`)),n.push(`${h}.ref = "${a}"`),t.rid++,this.parseTemplateRec(l,t,h),n.push(`${i}.childList.add(${h})`)}else w.isObject(l)&&(s.push(l),n.push(`${i}.childList.add(store[${s.length-1}])`));else if(a==="text"){const h=i+"__text";n.push(`var ${h} = ${i}.enableTextTexture()`),l.__propertyBinding===!0?(s.push(l),n.push(`element.__bindProperty(store[${s.length-1}], ${i}, "${a}")`)):this.parseTemplatePropRec(l,t,h)}else if(a==="shader"&&w.isObjectLiteral(l)){const h=`${i}["shader"]`;s.push(l),n.push(`${i}["${a}"] = store[${s.length-1}]`),this.parsePropertyBindings(l,t,h)}else if(a==="texture"&&w.isObjectLiteral(l)){const h=i+"__texture",u=l.type;u?(s.push(u),n.push(`var ${h} = new store[${s.length-1}](${i}.stage)`),this.parseTemplatePropRec(l,t,h),n.push(`${i}["${a}"] = ${h}`)):(n.push(`${h} = ${i}.texture`),this.parseTemplatePropRec(l,t,h))}else w.isObjectLiteral(l)&&l.__propertyBinding===!0?(s.push(l),n.push(`element.__bindProperty(store[${s.length-1}], ${i}, "${a}")`)):w.isNumber(l)?n.push(`${i}["${a}"] = ${l}`):w.isBoolean(l)?n.push(`${i}["${a}"] = ${l?"true":"false"}`):w.isObject(l)||Array.isArray(l)?(s.push(l),n.push(`${i}["${a}"] = store[${s.length-1}]`)):n.push(`${i}["${a}"] = ${JSON.stringify(l)}`)})}static parseTemplatePropRec(e,t,i){const s=t.store,n=t.loc;Object.keys(e).forEach(a=>{if(a!=="type"){const l=e[a];w.isNumber(l)?n.push(`${i}["${a}"] = ${l}`):w.isBoolean(l)?n.push(`${i}["${a}"] = ${l?"true":"false"}`):w.isObject(l)&&l.__propertyBinding===!0?(s.push(l),n.push(`element.__bindProperty(store[${s.length-1}], ${i}, "${a}")`)):w.isObject(l)||Array.isArray(l)?(s.push(l),n.push(`${i}["${a}"] = store[${s.length-1}]`)):n.push(`${i}["${a}"] = ${JSON.stringify(l)}`)}})}static parsePropertyBindings(e,t,i){const s=t.store,n=t.loc;Object.keys(e).forEach(a=>{if(a!=="type"){const l=e[a];w.isObjectLiteral(l)&&l.__propertyBinding===!0&&(s.push(l),n.push(`element.__bindProperty(store[${s.length-1}], ${i}, "${a}")`))}})}_onSetup(){this.__initialized||this._setup()}_setup(){}_onAttach(){this.__initialized||(this.__init(),this.__initialized=!0),this._attach()}_attach(){}_onDetach(){this._detach()}_detach(){}_onEnabled(){this.__firstEnable||(this._firstEnable(),this.__firstEnable=!0),this._enable()}_firstEnable(){}_enable(){}_onDisabled(){this._disable()}_disable(){}_onActive(){this.__firstActive||(this._firstActive(),this.__firstActive=!0),this._active()}_firstActive(){}_active(){}_onInactive(){this._inactive()}_inactive(){}get application(){return this.stage.application}__construct(){this._construct()}_construct(){}_build(){}__init(){this._init()}_init(){}_focus(e,t){}_unfocus(e){}_focusChange(e,t){}_getFocused(){return this}_setFocusSettings(e){}_handleFocusSettings(e){}static _template(){return{}}hasFinalFocus(){let e=this.application._focusPath;return e&&e.length&&e[e.length-1]===this}hasFocus(){let e=this.application._focusPath;return e&&e.indexOf(this)>=0}get cparent(){return ue.getParent(this)}seekAncestorByType(e){let t=this.cparent;for(;t;){if(t.constructor===e)return t;t=t.cparent}}getSharedAncestorComponent(e){let t=this.getSharedAncestor(e);for(;t&&!t.isComponent;)t=t.parent;return t}get signals(){return this.__signals}set signals(e){w.isObjectLiteral(e)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__signals=e}set alterSignals(e){w.isObjectLiteral(e)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__signals||(this.__signals={});for(let t in e)e[t]===void 0?delete this.__signals[t]:this.__signals[t]=e}get passSignals(){return this.__passSignals||{}}set passSignals(e){this.__passSignals=Object.assign(this.__passSignals||{},e)}set alterPassSignals(e){w.isObjectLiteral(e)||this._throwError("Signals: specify an object with signal-to-fire mappings"),this.__passSignals||(this.__passSignals={});for(let t in e)e[t]===void 0?delete this.__passSignals[t]:this.__passSignals[t]=e}signal(e,...t){return this._signal(e,t)}_signal(e,t){const i=this._getParentSignalHandler();if(i){if(this.__signals){let n=this.__signals[e];if(n===!1)return;if(n){if(n===!0&&(n=e),w.isFunction(n))return n(...t);if(i._hasMethod(n))return i[n](...t)}}let s=this.__passSignals&&this.__passSignals[e];if(s)return s&&s!==!0&&(e=s),i._signal(e,t)}}_getParentSignalHandler(){return this.cparent?this.cparent._getSignalHandler():null}_getSignalHandler(){return this._signalProxy?this.cparent?this.cparent._getSignalHandler():null:this}get _signalProxy(){return!1}fireAncestors(e,...t){if(!e.startsWith("$"))throw new Error("Ancestor event name must be prefixed by dollar sign.");const i=this._getParentSignalHandler();if(i)return i._doFireAncestors(e,t)}_doFireAncestors(e,t){if(this._hasMethod(e))return this.fire(e,...t);{const i=this._getParentSignalHandler();if(i)return i._doFireAncestors(e,t)}}static collectSubComponents(e,t){if(t.hasChildren()){const i=t.__childList;for(let s=0,n=i.length;s<n;s++){const o=i.getAt(s);o.isComponent?e.push(o):ue.collectSubComponents(e,o)}}}static getComponent(e){let t=e;for(;t&&!t.isComponent;)t=t.parent;return t}static getParent(e){return ue.getComponent(e.parent)}}ue.prototype.isComponent=!0;class hl{constructor(e){this.ctx=e,this.quadTextures=[],this.quadElements=[]}get length(){return this.quadTextures.length}reset(){this.quadTextures=[],this.quadElements=[],this.dataLength=0}getElement(e){return this.quadElements[e]._element}getElementCore(e){return this.quadElements[e]}getTexture(e){return this.quadTextures[e]}getTextureWidth(e){let t=this.quadTextures[e];return t.w?t.w:this.quadElements[e]._displayedTextureSource.w}getTextureHeight(e){let t=this.quadTextures[e];return t.h?t.h:this.quadElements[e]._displayedTextureSource.h}}class Ef extends hl{constructor(e){super(e);const t=e.stage.getOption("bufferMemory");this.dataLength=0,this.data=new ArrayBuffer(t),this.floats=new Float32Array(this.data),this.uints=new Uint32Array(this.data)}getAttribsDataByteOffset(e){return e*80}getQuadContents(){let e=this.floats,t=this.uints,i=[];for(let s=1;s<=this.length;s++){let n="entry "+s+": ";for(let o=0;o<4;o++){let a=s*20+o*4;n+=e[a]+","+e[a+1]+":"+e[a+2]+","+e[a+3]+"["+t[a+4].toString(16)+"] "}i.push(n)}return i}}class ul{constructor(e,t,i,s,n,o){this.ctx=e,this.shader=t,this.shaderOwner=i,this.renderTextureInfo=s,this.scissor=n,this.index=o,this.length=0}get quads(){return this.ctx.renderState.quads}getTexture(e){return this.quads.getTexture(this.index+e)}getElementCore(e){return this.quads.getElementCore(this.index+e)}getElement(e){return this.quads.getElement(this.index+e)}getElementWidth(e){return this.getElement(e).renderWidth}getElementHeight(e){return this.getElement(e).renderHeight}getTextureWidth(e){return this.quads.getTextureWidth(this.index+e)}getTextureHeight(e){return this.quads.getTextureHeight(this.index+e)}getRenderWidth(){return this.renderTextureInfo?this.renderTextureInfo.w:this.ctx.stage.w}getRenderHeight(){return this.renderTextureInfo?this.renderTextureInfo.h:this.ctx.stage.h}}class Lf extends ul{constructor(e,t,i,s,n,o){super(e,t,i,s,n,o),this.extraAttribsDataByteOffset=0}getAttribsDataByteOffset(e){return this.quads.getAttribsDataByteOffset(this.index+e)}getNormalRenderTextureCoords(e,t){let i=this.shaderOwner.getRenderTextureCoords(e,t);return i[0]/=this.getRenderWidth(),i[1]/=this.getRenderHeight(),i[0]=i[0]*2-1,i[1]=1-i[1]*2,i}getProjection(){return this.renderTextureInfo===null?this.ctx.renderExec._projection:this.renderTextureInfo.nativeTexture.projection}}class cl{constructor(e){this.ctx=e,this.renderState=e.renderState,this.gl=this.ctx.stage.gl}destroy(){this.ctx=null,this.renderState=null,this.gl=null,delete this.ctx,delete this.renderState,delete this.gl}_reset(){this._bindRenderTexture(null),this._setScissor(null),this._clearRenderTexture()}execute(){this._reset();let e=this.renderState.quadOperations,t=0,i=e.length;for(;t<i;)this._processQuadOperation(e[t]),t++}_processQuadOperation(e){e.renderTextureInfo&&e.renderTextureInfo.ignore||(this._setupQuadOperation(e),this._execQuadOperation(e))}_setupQuadOperation(e){}_execQuadOperation(e){let t=e.renderTextureInfo?e.renderTextureInfo.nativeTexture:null;this._renderTexture!==t&&this._bindRenderTexture(t),e.renderTextureInfo&&!e.renderTextureInfo.cleared?(this._setScissor(null),this._clearRenderTexture(),e.renderTextureInfo.cleared=!0,this._setScissor(e.scissor)):this._setScissor(e.scissor),this._renderQuadOperation(e)}_renderQuadOperation(e){}_bindRenderTexture(e){this._renderTexture=e}_clearRenderTexture(e){}_setScissor(e){}}class Pf extends cl{constructor(e){super(e),this.gl=this.ctx.stage.gl,this.init()}init(){let e=this.gl;this._attribsBuffer=e.createBuffer();let t=Math.floor(this.renderState.quads.data.byteLength/80),i=new Uint16Array(t*6);for(let s=0,n=0;s<t;s+=6,n+=4)i[s]=n,i[s+1]=n+1,i[s+2]=n+2,i[s+3]=n,i[s+4]=n+2,i[s+5]=n+3;this._quadsBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._quadsBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW),this._projection=new Float32Array([2/this.ctx.stage.coordsWidth,-2/this.ctx.stage.coordsHeight])}destroy(){super.destroy(),this.gl.deleteBuffer(this._attribsBuffer),this.gl.deleteBuffer(this._quadsBuffer),this.gl=null,delete this.gl}_reset(){super._reset();let e=this.gl;e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND),e.disable(e.DEPTH_TEST),this._stopShaderProgram(),this._setupBuffers()}_setupBuffers(){let e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._quadsBuffer);let t=new Float32Array(this.renderState.quads.data,0,this.renderState.quads.dataLength);e.bindBuffer(e.ARRAY_BUFFER,this._attribsBuffer),e.bufferData(e.ARRAY_BUFFER,t,e.DYNAMIC_DRAW)}_setupQuadOperation(e){super._setupQuadOperation(e),this._useShaderProgram(e.shader,e)}_renderQuadOperation(e){let t=e.shader;(e.length||e.shader.addEmpty())&&(t.beforeDraw(e),t.draw(e),t.afterDraw(e))}_useShaderProgram(e,t){e.hasSameProgram(this._currentShaderProgram)||(this._currentShaderProgram&&this._currentShaderProgram.stopProgram(),e.useProgram(),this._currentShaderProgram=e),e.setupUniforms(t)}_stopShaderProgram(){this._currentShaderProgram&&(this._currentShaderProgram.stopProgram(),this._currentShaderProgram=null)}_bindRenderTexture(e){super._bindRenderTexture(e);let t=this.gl;this._renderTexture?(t.bindFramebuffer(t.FRAMEBUFFER,this._renderTexture.framebuffer),t.viewport(0,0,this._renderTexture.w,this._renderTexture.h)):(t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,this.ctx.stage.w,this.ctx.stage.h))}_clearRenderTexture(){super._clearRenderTexture();let e=this.gl;if(this._renderTexture)e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT);else{let t=this.ctx.stage.getClearColor();t&&(e.clearColor(t[0]*t[3],t[1]*t[3],t[2]*t[3],t[3]),e.clear(e.COLOR_BUFFER_BIT))}}_setScissor(e){if(super._setScissor(e),this._scissor===e)return;this._scissor=e;let t=this.gl;if(!e)t.disable(t.SCISSOR_TEST);else{t.enable(t.SCISSOR_TEST);let i=this.ctx.stage.getRenderPrecision(),s=e[1];this._renderTexture===null&&(s=this.ctx.stage.h/i-(e[1]+e[3])),t.scissor(Math.round(e[0]*i),Math.round(s*i),Math.round(e[2]*i),Math.round(e[3]*i))}}}class fl{constructor(e){this.ctx=e,this.stage=e.stage,this.defaultShader=this.stage.renderer.getDefaultShader(e),this.renderer=e.stage.renderer,this.quads=this.renderer.createCoreQuadList(e)}reset(){this._renderTextureInfo=null,this._scissor=null,this._shader=null,this._shaderOwner=null,this._realShader=null,this._check=!1,this.quadOperations=[],this._texturizer=null,this._texturizerTemporary=!1,this._quadOperation=null,this.quads.reset(),this._temporaryTexturizers=[],this._isCachingTexturizer=!1}get length(){return this.quads.quadTextures.length}setShader(e,t){(this._shaderOwner!==t||this._realShader!==e)&&(this._realShader=e,e.useDefault()&&(e=this.defaultShader),(this._shader!==e||this._shaderOwner!==t)&&(this._shader=e,this._shaderOwner=t,this._check=!0))}get renderTextureInfo(){return this._renderTextureInfo}setScissor(e){this._scissor!==e&&(e?this._scissor=e:this._scissor=null,this._check=!0)}getScissor(){return this._scissor}setRenderTextureInfo(e){this._renderTextureInfo!==e&&(this._renderTextureInfo=e,this._scissor=null,this._check=!0)}setTexturizer(e,t=!1){this._texturizer=e,this._cacheTexturizer=t}set isCachingTexturizer(e){this._isCachingTexturizer=e}get isCachingTexturizer(){return this._isCachingTexturizer}addQuad(e){this._quadOperation?this._check&&this._hasChanges()&&(this._finishQuadOperation(),this._check=!1):this._createQuadOperation();let t=null;this._texturizer&&(t=this._texturizer.getResultTexture(),this._cacheTexturizer||this._temporaryTexturizers.push(this._texturizer)),t||(t=e._displayedTextureSource.nativeTexture),this._renderTextureInfo&&(this._shader===this.defaultShader&&this._renderTextureInfo.empty?(this._renderTextureInfo.nativeTexture=t,this._renderTextureInfo.offset=this.length):this._renderTextureInfo.nativeTexture=null,this._renderTextureInfo.empty=!1),this.quads.quadTextures.push(t),this.quads.quadElements.push(e),this._quadOperation.length++,this.renderer.addQuad(this,this.quads,this.length-1)}finishedRenderTexture(){this._renderTextureInfo.nativeTexture&&(this._isRenderTextureReusable()||(this._renderTextureInfo.nativeTexture=null))}_isRenderTextureReusable(){const e=this._renderTextureInfo.offset;return this.quads.quadTextures[e].w===this._renderTextureInfo.w&&this.quads.quadTextures[e].h===this._renderTextureInfo.h&&this.renderer.isRenderTextureReusable(this,this._renderTextureInfo)}_hasChanges(){let e=this._quadOperation;return this._shader!==e.shader||this._shaderOwner!==e.shaderOwner||this._renderTextureInfo!==e.renderTextureInfo||this._scissor!==e.scissor&&(this._scissor[0]!==e.scissor[0]||this._scissor[1]!==e.scissor[1]||this._scissor[2]!==e.scissor[2]||this._scissor[3]!==e.scissor[3])}_finishQuadOperation(e=!0){if(this._quadOperation){if((this._quadOperation.length||this._shader.addEmpty())&&(!this._quadOperation.scissor||this._quadOperation.scissor[2]>0&&this._quadOperation.scissor[3]>0)&&this.quadOperations.push(this._quadOperation),this._temporaryTexturizers.length){for(let t=0,i=this._temporaryTexturizers.length;t<i;t++)this._temporaryTexturizers[t].releaseRenderTexture();this._temporaryTexturizers=[]}this._quadOperation=null}e&&this._createQuadOperation()}_createQuadOperation(){this._quadOperation=this.renderer.createCoreQuadOperation(this.ctx,this._shader,this._shaderOwner,this._renderTextureInfo,this._scissor,this.length),this._check=!1}finish(){this._quadOperation&&this._finishQuadOperation(!1),this.renderer.finishRenderState(this)}}class If{constructor(e,t){this.vertexShaderSource=e,this.fragmentShaderSource=t,this._program=null,this.gl=null,this._uniformLocations=new Map,this._attributeLocations=new Map,this._currentUniformValues={}}compile(e){if(this._program)return;this.gl=e,this._program=e.createProgram();let t=this._glCompile(e.VERTEX_SHADER,this.vertexShaderSource),i=this._glCompile(e.FRAGMENT_SHADER,this.fragmentShaderSource);e.attachShader(this._program,t),e.attachShader(this._program,i),e.linkProgram(this._program),e.getProgramParameter(this._program,e.LINK_STATUS)||(console.error("[Lightning] Error: Could not initialize shader."),console.error("[Lightning] gl.VALIDATE_STATUS",e.getProgramParameter(this._program,e.VALIDATE_STATUS)),console.error("[Lightning] gl.getError()",e.getError()),e.getProgramInfoLog(this._program)!==""&&console.warn("[Lightning] Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(this._program)),e.deleteProgram(this._program),this._program=null),e.deleteShader(t),e.deleteShader(i)}_glCompile(e,t){let i=this.gl.createShader(e);if(this.gl.shaderSource(i,t),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)){console.error("[Lightning]",this.constructor.name,"Type: "+(e===this.gl.VERTEX_SHADER?"vertex shader":"fragment shader")),console.error("[Lightning]",this.gl.getShaderInfoLog(i));let s=0;return console.error("[Lightning]",`========== source ==========
`+t.split(`
`).map(n=>""+ ++s+": "+n).join(`
`)),null}return i}getUniformLocation(e){let t=this._uniformLocations.get(e);return t===void 0&&(t=this.gl.getUniformLocation(this._program,e),this._uniformLocations.set(e,t)),t}getAttribLocation(e){let t=this._attributeLocations.get(e);return t===void 0&&(t=this.gl.getAttribLocation(this._program,e),this._attributeLocations.set(e,t)),t}destroy(){this._program&&this.gl.deleteProgram(this._program),this._attributeLocations=null,this._currentUniformValues=null,this.fragmentShaderSource=null,this._program=null,this.gl=null,this._uniformLocations=null,this.vertexShaderSource=null,delete this.vertexShaderSource,delete this._program,delete this._currentUniformValues,delete this.fragmentShaderSource,delete this.gl,delete this._uniformLocations,delete this._attributeLocations}get glProgram(){return this._program}get compiled(){return!!this._program}_valueEquals(e,t){if(e.length&&t.length){for(let i=0,s=e.length;i<s;i++)if(e[i]!==t[i])return!1;return!0}else return e===t}_valueClone(e){return e.length?e.slice(0):e}setUniformValue(e,t,i){let s=this._currentUniformValues[e];if(s===void 0||!this._valueEquals(s,t)){let n=this._valueClone(t);this._currentUniformValues[e]=n;let o=this.getUniformLocation(e);o&&(i===this.gl.uniformMatrix2fv||i===this.gl.uniformMatrix3fv||i===this.gl.uniformMatrix4fv?i.call(this.gl,o,!1,n):i.call(this.gl,o,n))}}}class Ir extends ns{constructor(e){super(e);const t=e.stage;this._program=t.renderer.shaderPrograms.get(this.constructor),this._program||(this._program=new If(this.constructor.vertexShaderSource,this.constructor.fragmentShaderSource),t.renderer.shaderPrograms.set(this.constructor,this._program)),this.gl=t.gl}get glProgram(){return this._program.glProgram}_init(){this._initialized||(this.initialize(),this._initialized=!0)}initialize(){this._program.compile(this.gl)}get initialized(){return this._initialized}_uniform(e){return this._program.getUniformLocation(e)}_attrib(e){return this._program.getAttribLocation(e)}_setUniform(e,t,i){this._program.setUniformValue(e,t,i)}useProgram(){this._init(),this.gl.useProgram(this.glProgram),this.beforeUsage(),this.enableAttribs()}stopProgram(){this.afterUsage(),this.disableAttribs()}hasSameProgram(e){return e&&(e===this||e._program===this._program)}beforeUsage(){}afterUsage(){}enableAttribs(){}disableAttribs(){}getExtraAttribBytesPerVertex(){return 0}getVertexAttribPointerOffset(e){return e.extraAttribsDataByteOffset-e.index*4*this.getExtraAttribBytesPerVertex()}setExtraAttribsInBuffer(e){}setupUniforms(e){}_getProjection(e){return e.getProjection()}getFlipY(e){return this._getProjection(e)[1]<0}beforeDraw(e){}draw(e){}afterDraw(e){}cleanup(){this._initialized=!1}}let ee=class extends Ir{enableAttribs(){let e=this.gl;e.vertexAttribPointer(this._attrib("aVertexPosition"),2,e.FLOAT,!1,20,0),e.enableVertexAttribArray(this._attrib("aVertexPosition")),this._attrib("aTextureCoord")!==-1&&(e.vertexAttribPointer(this._attrib("aTextureCoord"),2,e.FLOAT,!1,20,2*4),e.enableVertexAttribArray(this._attrib("aTextureCoord"))),this._attrib("aColor")!==-1&&(e.vertexAttribPointer(this._attrib("aColor"),4,e.UNSIGNED_BYTE,!0,20,4*4),e.enableVertexAttribArray(this._attrib("aColor")))}disableAttribs(){let e=this.gl;e.disableVertexAttribArray(this._attrib("aVertexPosition")),this._attrib("aTextureCoord")!==-1&&e.disableVertexAttribArray(this._attrib("aTextureCoord")),this._attrib("aColor")!==-1&&e.disableVertexAttribArray(this._attrib("aColor"))}setupUniforms(e){this._setUniform("projection",this._getProjection(e),this.gl.uniform2fv,!1)}draw(e){let t=this.gl,i=e.length;if(i){let s=e.getTexture(0),n=0;for(let o=0;o<i;o++){let a=e.getTexture(o);s!==a&&(t.bindTexture(t.TEXTURE_2D,s),t.drawElements(t.TRIANGLES,6*(o-n),t.UNSIGNED_SHORT,(n+e.index)*6*2),s=a,n=o)}t.bindTexture(t.TEXTURE_2D,s),t.drawElements(t.TRIANGLES,6*(i-n),t.UNSIGNED_SHORT,(n+e.index)*6*2)}}};ee.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;ee.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    void main(void){
        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;
    }
`;class dl{constructor(e){this.stage=e,this._defaultShader=void 0}gc(e){}destroy(){}getDefaultShader(e=this.stage.ctx){return this._defaultShader||(this._defaultShader=this._createDefaultShader(e)),this._defaultShader}_createDefaultShader(e){}isValidShaderType(e){return e.prototype instanceof this._getShaderBaseType()}createShader(e,t){const i=t.type;if(this.isValidShaderType(i)){const s=new i(e);return xe.patchObject(this,t),s}else{const s=this._getShaderAlternative(i);return s?new s(e):(console.warn("[Lightning] Shader has no implementation for render target: "+i.name),this._createDefaultShader(e))}}_getShaderBaseType(){}_getShaderAlternative(e){return this.getDefaultShader()}copyRenderTexture(e,t,i){console.warn("[Lightning] copyRenderTexture not supported by renderer")}}class pl extends dl{constructor(e){super(e),this.shaderPrograms=new Map,this._compressedTextureExtensions={astc:e.gl.getExtension("WEBGL_compressed_texture_astc"),etc1:e.gl.getExtension("WEBGL_compressed_texture_etc1"),s3tc:e.gl.getExtension("WEBGL_compressed_texture_s3tc"),pvrtc:e.gl.getExtension("WEBGL_compressed_texture_pvrtc")}}getCompressedTextureExtensions(){return this._compressedTextureExtensions}destroy(){this.shaderPrograms.forEach(e=>e.destroy()),this.shaderPrograms=null,this._compressedTextureExtensions=null,delete this.shaderPrograms,delete this._compressedTextureExtensions}_createDefaultShader(e){return new ee(e)}_getShaderBaseType(){return Ir}_getShaderAlternative(e){return e.getWebGL&&e.getWebGL()}createCoreQuadList(e){return new Ef(e)}createCoreQuadOperation(e,t,i,s,n,o){return new Lf(e,t,i,s,n,o)}createCoreRenderExecutor(e){return new Pf(e)}createCoreRenderState(e){return new fl(e)}createRenderTexture(e,t,i,s){const n=this.stage.gl,o=n.createTexture();return n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,i,s,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),o.params={},o.params[n.TEXTURE_MAG_FILTER]=n.LINEAR,o.params[n.TEXTURE_MIN_FILTER]=n.LINEAR,o.params[n.TEXTURE_WRAP_S]=n.CLAMP_TO_EDGE,o.params[n.TEXTURE_WRAP_T]=n.CLAMP_TO_EDGE,o.options={format:n.RGBA,internalFormat:n.RGBA,type:n.UNSIGNED_BYTE},o.framebuffer=n.createFramebuffer(),o.projection=new Float32Array([2/e,2/t]),n.bindFramebuffer(n.FRAMEBUFFER,o.framebuffer),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,o,0),o}freeRenderTexture(e){let t=this.stage.gl;t.deleteFramebuffer(e.framebuffer),t.deleteTexture(e)}_getBytesPerPixel(e,t){const i=this.stage.gl;if(e===i.RGBA)switch(t){case i.UNSIGNED_BYTE:return 4;case i.UNSIGNED_SHORT_4_4_4_4:return 2;case i.UNSIGNED_SHORT_5_5_5_1:return 2;default:throw new Error("Invalid type specified for GL_RGBA format")}else if(e===i.RGB)switch(t){case i.UNSIGNED_BYTE:return 3;case i.UNSIGNED_BYTE_5_6_5:return 2;default:throw new Error("Invalid type specified for GL_RGB format")}else throw new Error("Invalid format specified in call to _getBytesPerPixel()")}uploadTextureSource(e,t){const i=this.stage.gl,s=t.source;let n=!1;t.renderInfo&&(n=t.renderInfo.compressed||!1);const o={premultiplyAlpha:!0,hasAlpha:!0};t&&t.hasOwnProperty("premultiplyAlpha")&&(o.premultiplyAlpha=t.premultiplyAlpha),t&&t.hasOwnProperty("flipBlueRed")&&(o.flipBlueRed=t.flipBlueRed),t&&t.hasOwnProperty("hasAlpha")&&(o.hasAlpha=t.hasAlpha),o.hasAlpha||(o.premultiplyAlpha=!1),o.texParams=t.texParams||{},o.texOptions=t.texOptions||{};let a=i.createTexture();i.bindTexture(i.TEXTURE_2D,a),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),w.isNode&&i.pixelStorei(i.UNPACK_FLIP_BLUE_RED,!!o.flipBlueRed);const l=o.texParams;if(l[i.TEXTURE_MAG_FILTER]||(l[i.TEXTURE_MAG_FILTER]=i.LINEAR),l[i.TEXTURE_MIN_FILTER]||(l[i.TEXTURE_MIN_FILTER]=i.LINEAR),l[i.TEXTURE_WRAP_S]||(l[i.TEXTURE_WRAP_S]=i.CLAMP_TO_EDGE),l[i.TEXTURE_WRAP_T]||(l[i.TEXTURE_WRAP_T]=i.CLAMP_TO_EDGE),Object.keys(l).forEach(u=>{const f=l[u];i.texParameteri(i.TEXTURE_2D,parseInt(u),f)}),n)return this.stage.platform.uploadCompressedGlTexture(i,e,s),a;const h=o.texOptions;return h.format=h.format||(o.hasAlpha?i.RGBA:i.RGB),h.type=h.type||i.UNSIGNED_BYTE,h.internalFormat=h.internalFormat||h.format,t&&t.imageRef&&(h.imageRef=t.imageRef),this.stage.platform.uploadGlTexture(i,e,s,h),a.params=w.cloneObjShallow(l),a.options=w.cloneObjShallow(h),a.bytesPerPixel=this._getBytesPerPixel(h.format,h.type),a}freeTextureSource(e){this.stage.gl.deleteTexture(e.nativeTexture)}addQuad(e,t,i){let s=i*20;const n=t.quadElements[i];let o=n._renderContext,a=e.quads.floats,l=e.quads.uints;const h=D.mergeColorAlpha;if(o.tb!==0||o.tc!==0)a[s++]=o.px,a[s++]=o.py,a[s++]=n._ulx,a[s++]=n._uly,l[s++]=h(n._colorUl,o.alpha),a[s++]=o.px+n._w*o.ta,a[s++]=o.py+n._w*o.tc,a[s++]=n._brx,a[s++]=n._uly,l[s++]=h(n._colorUr,o.alpha),a[s++]=o.px+n._w*o.ta+n._h*o.tb,a[s++]=o.py+n._w*o.tc+n._h*o.td,a[s++]=n._brx,a[s++]=n._bry,l[s++]=h(n._colorBr,o.alpha),a[s++]=o.px+n._h*o.tb,a[s++]=o.py+n._h*o.td,a[s++]=n._ulx,a[s++]=n._bry,l[s]=h(n._colorBl,o.alpha);else{let u=o.px+n._w*o.ta,f=o.py+n._h*o.td;a[s++]=o.px,a[s++]=o.py,a[s++]=n._ulx,a[s++]=n._uly,l[s++]=h(n._colorUl,o.alpha),a[s++]=u,a[s++]=o.py,a[s++]=n._brx,a[s++]=n._uly,l[s++]=h(n._colorUr,o.alpha),a[s++]=u,a[s++]=f,a[s++]=n._brx,a[s++]=n._bry,l[s++]=h(n._colorBr,o.alpha),a[s++]=o.px,a[s++]=f,a[s++]=n._ulx,a[s++]=n._bry,l[s]=h(n._colorBl,o.alpha)}}isRenderTextureReusable(e,t){let i=e._renderTextureInfo.offset*80/4,s=e.quads.floats,n=e.quads.uints;return s[i]===0&&s[i+1]===0&&s[i+2]===0&&s[i+3]===0&&n[i+4]===4294967295&&s[i+5]===t.w&&s[i+6]===0&&s[i+7]===1&&s[i+8]===0&&n[i+9]===4294967295&&s[i+10]===t.w&&s[i+11]===t.h&&s[i+12]===1&&s[i+13]===1&&n[i+14]===4294967295&&s[i+15]===0&&s[i+16]===t.h&&s[i+17]===0&&s[i+18]===1&&n[i+19]===4294967295}finishRenderState(e){let t=e.length*80;for(let i=0,s=e.quadOperations.length;i<s;i++){e.quadOperations[i].extraAttribsDataByteOffset=t;let n=e.quadOperations[i].shader.getExtraAttribBytesPerVertex()*4*e.quadOperations[i].length;t+=n,n&&e.quadOperations[i].shader.setExtraAttribsInBuffer(e.quadOperations[i],e.quads)}e.quads.dataLength=t}copyRenderTexture(e,t,i){const s=this.stage.gl;s.bindTexture(s.TEXTURE_2D,t),s.bindFramebuffer(s.FRAMEBUFFER,e.framebuffer);const n=e.precision;s.copyTexSubImage2D(s.TEXTURE_2D,0,n*(i.sx||0),n*(i.sy||0),n*(i.x||0),n*(i.y||0),n*(i.w||e.ow),n*(i.h||e.oh))}}class Mf extends hl{constructor(e){super(e),this.renderContexts=[],this.modes=[]}setRenderContext(e,t){this.renderContexts[e]=t}setSimpleTc(e,t){t?this.modes[e]|=1:this.modes[e]-=this.modes[e]&1}setWhite(e,t){t?this.modes[e]|=2:this.modes[e]-=this.modes[e]&2}getRenderContext(e){return this.renderContexts[e]}getSimpleTc(e){return this.modes[e]&1}getWhite(e){return this.modes[e]&2}}class Ff extends ul{getRenderContext(e){return this.quads.getRenderContext(this.index+e)}getSimpleTc(e){return this.quads.getSimpleTc(this.index+e)}getWhite(e){return this.quads.getWhite(this.index+e)}}class Qn extends cl{init(){this._mainRenderTexture=this.ctx.stage.getCanvas()}_renderQuadOperation(e){let t=e.shader;if(e.length||e.shader.addEmpty()){const i=this._renderTexture||this._mainRenderTexture;t.beforeDraw(e,i),t.draw(e,i),t.afterDraw(e,i)}}_clearRenderTexture(){const e=this._getContext();let t=[0,0,0,0];this._mainRenderTexture.ctx===e&&(t=this.ctx.stage.getClearColor());const i=e.canvas;e.setTransform(1,0,0,1,0,0),!t[0]&&!t[1]&&!t[2]&&!t[3]?e.clearRect(0,0,i.width,i.height):(e.fillStyle=D.getRgbaStringFromArray(t),e.globalCompositeOperation="copy",e.beginPath(),e.rect(0,0,i.width,i.height),e.closePath(),e.fill(),e.globalCompositeOperation="source-over")}_getContext(){return this._renderTexture?this._renderTexture.ctx:this._mainRenderTexture.ctx}_restoreContext(){const e=this._getContext();e.restore(),e.save(),e._scissor=null}_setScissor(e){const t=this._getContext();if(!Qn._equalScissorAreas(t.canvas,t._scissor,e)){this._restoreContext();let i=this.ctx.stage.getRenderPrecision();e&&(t.beginPath(),t.rect(Math.round(e[0]*i),Math.round(e[1]*i),Math.round(e[2]*i),Math.round(e[3]*i)),t.closePath(),t.clip()),t._scissor=e}}static _equalScissorAreas(e,t,i){return t||(t=[0,0,e.width,e.height]),i||(i=[0,0,e.width,e.height]),w.equalValues(t,i)}}class Jn extends ns{beforeDraw(e){}draw(e){}afterDraw(e){}}class Mr extends Jn{constructor(e){super(e),this._rectangleTexture=e.stage.rectangleTexture.source.nativeTexture,this._tintManager=this.ctx.stage.renderer.tintManager}draw(e,t){const i=t.ctx;let s=e.length;for(let n=0;n<s;n++){const o=e.getTexture(n);if(!o)continue;const a=e.getElementCore(n),l=e.getRenderContext(n),h=e.getWhite(n),u=e.getSimpleTc(n),f=this.ctx.stage.getRenderPrecision();i.setTransform(l.ta*f,l.tc*f,l.tb*f,l.td*f,l.px*f,l.py*f);const c=o===this._rectangleTexture,p={operation:e,target:t,index:n,rect:c};if(c)h?i.fillStyle="white":this._setColorGradient(i,a),i.globalAlpha=l.alpha,this._beforeDrawEl(p),i.fillRect(0,0,a.w,a.h),this._afterDrawEl(p),i.globalAlpha=1;else{i.globalAlpha=l.alpha,this._beforeDrawEl(p);const _=u?0:a._ulx*o.w,g=u?0:a._uly*o.h,x=(u?1:a._brx-a._ulx)*o.w,m=(u?1:a._bry-a._uly)*o.h;if(!h){let b=a._colorUl;(a._colorUl!==a._colorUr||a._colorUr!==a._colorBl||a._colorBr!==a._colorBl)&&(b=D.mergeMultiColorsEqual([a._colorUl,a._colorUr,a._colorBl,a._colorBr]));const S=(b/16777216|0)/255;i.globalAlpha*=S;const R=b&16777215,A=this._tintManager.getTintTexture(o,R);i.fillStyle="white",i.drawImage(A,_,g,x,m,0,0,a.w,a.h)}else i.fillStyle="white",i.drawImage(o,_,g,x,m,0,0,a.w,a.h);this._afterDrawEl(p),i.globalAlpha=1}}}_setColorGradient(e,t,i=t.w,s=t.h,n=!0){let o=t._colorUl,a;t._colorUl===t._colorUr?t._colorBl===t._colorBr&&(t._colorUl===t._colorBl||(a=e.createLinearGradient(0,0,0,s),n?(a.addColorStop(0,D.getRgbaString(t._colorUl)),a.addColorStop(1,D.getRgbaString(t._colorBl))):(a.addColorStop(0,D.getRgbString(t._colorUl)),a.addColorStop(1,D.getRgbString(t._colorBl))))):t._colorUl===t._colorBl&&t._colorUr===t._colorBr&&(a=e.createLinearGradient(0,0,i,0),n?(a.addColorStop(0,D.getRgbaString(t._colorUl)),a.addColorStop(1,D.getRgbaString(t._colorBr))):(a.addColorStop(0,D.getRgbString(t._colorUl)),a.addColorStop(1,D.getRgbString(t._colorBr)))),a?e.fillStyle=a:e.fillStyle=n?D.getRgbaString(o):D.getRgbString(o)}_beforeDrawEl(e){}_afterDrawEl(e){}}class Of{constructor(e){this.stage=e,this._usedMemory=0,this._cachedNativeTextures=new Set}destroy(){this.gc(!0),this.stage=null,delete this.stage}_addMemoryUsage(e){this._usedMemory+=e,this.stage.addMemoryUsage(e)}delete(e){if(this._hasCache(e)){const t=this._getCache(e),i=t.memoryUsage;t.clear(),this._cachedNativeTextures.delete(e),this._addMemoryUsage(t.memoryUsage-i)}}getTintTexture(e,t){const i=this.stage.frameCounter;this._cachedNativeTextures.add(e);const s=this._getCache(e),n=s.get(t);if(n.lf=i,n.tx)return e.update>n.u&&this._tintTexture(n.tx,e,t),n.tx;{const o=s.memoryUsage;let a=s.reuseTexture(i);a?a.ctx.clearRect(0,0,a.width,a.height):(a=document.createElement("canvas"),a.width=e.w,a.height=e.h,a.ctx=a.getContext("2d")),this._tintTexture(a,e,t),s.set(t,a,i);const l=s.memoryUsage;return l!==o&&this._addMemoryUsage(l-o),a}}_tintTexture(e,t,i){let s=i.toString(16);for(;s.length<6;)s="0"+s;e.ctx.fillStyle="#"+s,e.ctx.globalCompositeOperation="copy",e.ctx.fillRect(0,0,t.w,t.h),e.ctx.globalCompositeOperation="multiply",e.ctx.drawImage(t,0,0,t.w,t.h,0,0,e.width,e.height),e.ctx.globalCompositeOperation="destination-in",e.ctx.drawImage(t,0,0,t.w,t.h,0,0,e.width,e.height)}_hasCache(e){return!!e._tintCache}_getCache(e){return e._tintCache||(e._tintCache=new zf(e)),e._tintCache}gc(e=!1){const t=this.stage.frameCounter;let i=0;this._cachedNativeTextures.forEach(s=>{const n=this._getCache(s);if(e)i+=n.memoryUsage,n.clear();else{const o=n.memoryUsage;n.cleanup(t),n.releaseBlancoTextures(),i+=n.memoryUsage-o}}),e&&this._cachedNativeTextures.clear(),i&&this._addMemoryUsage(i)}}class zf{constructor(e){this._tx=e,this._colors=new Map,this._blancoTextures=null,this._lastCleanupFrame=0,this._memTextures=0}get memoryUsage(){return this._memTextures*this._tx.w*this._tx.h}releaseBlancoTextures(){this._memTextures-=this._blancoTextures.length,this._blancoTextures=[]}clear(){this._blancoTextures=null,this._colors.clear(),this._memTextures=0}get(e){let t=this._colors.get(e);return t||(t={lf:-1,tx:void 0,u:-1},this._colors.set(e,t)),t}set(e,t,i){const s=this.get(e);s.lf=i,s.tx=t,s.u=i,this._memTextures++}cleanup(e){this._lastCleanupFrame!==e&&(this._blancoTextures=[],this._colors.forEach((t,i)=>{t.lf<e-1&&(t.tx&&this._blancoTextures.push(t.tx),this._colors.delete(i))}),this._lastCleanupFrame=e)}reuseTexture(e){if(this.cleanup(e),this._blancoTextures&&this._blancoTextures.length)return this._memTextures--,this._blancoTextures.pop()}}class Uf extends dl{constructor(e){super(e),this.tintManager=new Of(e),this.setupC2d(this.stage.c2d.canvas)}destroy(){this.tintManager.destroy(),this.tintManager=null,delete this.tintManager}_createDefaultShader(e){return new Mr(e)}_getShaderBaseType(){return Jn}_getShaderAlternative(e){return e.getC2d&&e.getC2d()}createCoreQuadList(e){return new Mf(e)}createCoreQuadOperation(e,t,i,s,n,o){return new Ff(e,t,i,s,n,o)}createCoreRenderExecutor(e){return new Qn(e)}createCoreRenderState(e){return new fl(e)}createRenderTexture(e,t,i,s){const n=document.createElement("canvas");return n.width=i,n.height=s,this.setupC2d(n),n}freeRenderTexture(e){this.tintManager.delete(e)}gc(e){this.tintManager.gc(e)}uploadTextureSource(e,t){if(t.source.buffer){const i=document.createElement("canvas");i.width=t.w,i.height=t.h;const s=new ImageData(new Uint8ClampedArray(t.source.buffer),t.w,t.h);return i.getContext("2d").putImageData(s,0,0),i}return t.source}freeTextureSource(e){this.tintManager.delete(e.nativeTexture)}addQuad(e,t,i){const s=t.quadElements[i];t.setRenderContext(i,s._renderContext),t.setWhite(i,s.isWhite()),t.setSimpleTc(i,s.hasSimpleTexCoords())}isRenderTextureReusable(e,t){return!1}finishRenderState(e){}setupC2d(e){const t=e.getContext("2d");e.ctx=t,t._scissor=null,e.ctx.save()}}class eo extends Ir{enableAttribs(){let e=this.gl;e.vertexAttribPointer(this._attrib("aVertexPosition"),2,e.FLOAT,!1,20,0),e.enableVertexAttribArray(this._attrib("aVertexPosition")),this._attrib("aTextureCoord")!==-1&&(e.vertexAttribPointer(this._attrib("aTextureCoord"),2,e.FLOAT,!1,20,2*4),e.enableVertexAttribArray(this._attrib("aTextureCoord"))),this._attrib("aColor")!==-1&&(e.vertexAttribPointer(this._attrib("aColor"),4,e.UNSIGNED_BYTE,!0,20,4*4),e.enableVertexAttribArray(this._attrib("aColor")))}disableAttribs(){let e=this.gl;e.disableVertexAttribArray(this._attrib("aVertexPosition")),this._attrib("aTextureCoord")!==-1&&e.disableVertexAttribArray(this._attrib("aTextureCoord")),this._attrib("aColor")!==-1&&e.disableVertexAttribArray(this._attrib("aColor"))}setupUniforms(e){this._setUniform("projection",this._getProjection(e),this.gl.uniform2fv,!1)}draw(e){let t=this.gl,i=e.length;if(i){let s=e.getTexture(0),n=0;for(let o=0;o<i;o++){let a=e.getTexture(o);if(s!==a){if(s.options&&s.options.imageRef){let l=o>0?o-1:o;const h=this.ctx.stage.getOption("precision");let u=e.getElementCore(l);this.ctx.stage.platform.paint(t,s.options.imageRef,u._worldContext.px*h,u._worldContext.py*h,u._colorUl,u)}else t.bindTexture(t.TEXTURE_2D,s),t.drawElements(t.TRIANGLES,6*(o-n),t.UNSIGNED_SHORT,(n+e.index)*6*2);s=a,n=o}}if(n<i)if(s.options&&s.options.imageRef){const o=this.ctx.stage.getOption("precision");let a=e.getElementCore(n);this.ctx.stage.platform.paint(t,s.options.imageRef,a._worldContext.px*o,a._worldContext.py*o,a._colorUl,a)}else t.bindTexture(t.TEXTURE_2D,s),t.drawElements(t.TRIANGLES,6*(i-n),t.UNSIGNED_SHORT,(n+e.index)*6*2)}}}eo.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;eo.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    void main(void){
        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;
    }
`;class Bf extends pl{constructor(e){super(e)}_createDefaultShader(e){return new eo(e)}createCoreRenderExecutor(e){global.beginDrawing();let t=super.createCoreRenderExecutor(e);return global.endDrawing(),t}}class kf{constructor(e={}){this._items=new Map,this._id=0,this._initWorker()}destroy(){this._worker&&this._worker.terminate(),this._items=null,this._worker=null,delete this._items,delete this._worker}_initWorker(){const e=`(${Nf.toString()})()`,t=new Blob([e.replace('"use strict";',"")]),i=(window.URL?URL:webkitURL).createObjectURL(t,{type:"application/javascript; charset=utf-8"});this._worker=new Worker(i),this._worker.postMessage({type:"config",config:{path:window.location.href,protocol:window.location.protocol}}),this._worker.onmessage=s=>{if(s.data&&s.data.id){const n=s.data.id,o=this._items.get(n);o&&(s.data.type=="data"?this.finish(o,s.data.info):this.error(o,s.data.info))}}}create(e){const t=++this._id,i=new Df(this,t,e);return this._items.set(t,i),this._worker.postMessage({type:"add",id:t,src:e}),i}cancel(e){this._worker.postMessage({type:"cancel",id:e.id}),this._items.delete(e.id)}error(e,t){e.error(t),this._items.delete(e.id)}finish(e,t){e.load(t),this._items.delete(e.id)}}class Df{constructor(e,t,i){this._manager=e,this._id=t,this._src=i,this._onError=null,this._onLoad=null}get id(){return this._id}get src(){return this._src}set onError(e){this._onError=e}set onLoad(e){this._onLoad=e}cancel(){this._manager.cancel(this)}load(e){this._onLoad&&this._onLoad(e)}error(e){this._onError&&this._onError(e)}}const Nf=function(){function r(){this.items=new Map;var t=this;onmessage=function(i){t._receiveMessage(i)}}r.isPathAbsolute=function(t){return/^(?:\/|[a-z]+:\/\/)/.test(t)||t.substr(0,5)=="data:"},r.prototype._receiveMessage=function(t){if(t.data.type==="config"){this.config=t.data.config;var i=this.config.path,s=/#.*?\//;s.test(i)&&(i=i.replace(/#.*$/,""));var n=i.split("/");n.pop(),this._relativeBase=n.join("/")+"/"}else t.data.type==="add"?this.add(t.data.id,t.data.src):t.data.type==="cancel"&&this.cancel(t.data.id)},r.prototype.add=function(t,i){r.isPathAbsolute(i)||(i=this._relativeBase+i),i.substr(0,2)==="//"&&(i=this.config.protocol+i);var s=new e(t,i),n=this;s.onFinish=function(o){n.finish(s,o)},s.onError=function(o){n.error(s,o)},this.items.set(t,s),s.start()},r.prototype.cancel=function(t){var i=this.items.get(t);i&&(i.cancel(),this.items.delete(t))},r.prototype.finish=function(t,{imageBitmap:i,hasAlphaChannel:s}){postMessage({type:"data",id:t.id,info:{imageBitmap:i,hasAlphaChannel:s}},[i]),this.items.delete(t.id)},r.prototype.error=function(t,{type:i,message:s}){postMessage({type:"error",id:t.id,info:{type:i,message:s}}),this.items.delete(t.id)},r.isWPEBrowser=function(){return navigator.userAgent.indexOf("WPE")!==-1};function e(t,i){this._onError=void 0,this._onFinish=void 0,this._id=t,this._src=i,this._xhr=void 0,this._mimeType=void 0,this._canceled=!1}Object.defineProperty(e.prototype,"id",{get:function(){return this._id}}),Object.defineProperty(e.prototype,"onFinish",{get:function(){return this._onFinish},set:function(t){this._onFinish=t}}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t}}),e.prototype.start=function(){this._xhr=new XMLHttpRequest,this._xhr.open("GET",this._src,!0),this._xhr.responseType="blob";var t=this;this._xhr.onerror=function(i){t.error({type:"connection",message:"Connection error"})},this._xhr.onload=function(i){var s=t._xhr.response;t._mimeType=s.type,t._createImageBitmap(s)},this._xhr.send()},e.prototype._createImageBitmap=function(t){var i=this;createImageBitmap(t,{premultiplyAlpha:"premultiply",colorSpaceConversion:"none",imageOrientation:"none"}).then(function(s){i.finish({imageBitmap:s,hasAlphaChannel:i._hasAlphaChannel()})}).catch(function(s){i.error({type:"parse",message:"Error parsing image data"})})},e.prototype._hasAlphaChannel=function(){return r.isWPEBrowser()?!0:this._mimeType.indexOf("image/png")!==-1},e.prototype.cancel=function(){this._canceled||(this._xhr&&this._xhr.abort(),this._canceled=!0)},e.prototype.error=function(t,i){!this._canceled&&this._onError&&this._onError({type:t,message:i})},e.prototype.finish=function(t){!this._canceled&&this._onFinish&&this._onFinish(t)},new r};class $f{init(e){this.stage=e,this._looping=!1,this._awaitingLoop=!1,this._loopHandler=null,this._idleLoopCounter=0,this._idleLoopDelay=60,this._onIdle=!1,this.stage.getOption("useImageWorker")&&(!window.createImageBitmap||!window.Worker?console.warn("[Lightning] Can't use image worker because browser does not have createImageBitmap and Web Worker support"):this._imageWorker=new kf),this._registerVisibilityChangeHandler()}destroy(){this._imageWorker&&this._imageWorker.destroy(),clearInterval(this._loopHandler),this._removeKeyHandler(),this._removeClickHandler(),this._removeHoverHandler(),this._removeScrollWheelHandler(),this._removeVisibilityChangeHandler(),this.stage=null,delete this.stage}startLoop(){this._looping=!0,this._awaitingLoop||this.loop()}stopLoop(){this._looping=!1}switchLoop(){if(this._onIdle===!1&&(this._onIdle=!0,this.stage.onIdle()),this._idleLoopCounter<this._idleLoopDelay){this._idleLoopCounter++;return}this.stage.ctx.hasRenderUpdates()?this._idleLoopCounter=0:(this.stopLoop(),this._loopHandler=setInterval(()=>{this.stage.updateFrame(),this.stage.idleFrame(),this.stage.ctx.hasRenderUpdates()&&(clearInterval(this._loopHandler),this.startLoop())},1e3/60))}loop(){let e=this,t=function(){e._awaitingLoop=!1,e._onIdle=!1,e._looping&&(e.stage.updateFrame(),e.stage.getOption("pauseRafLoopOnIdle")&&e.switchLoop(),e.stage.renderFrame(),requestAnimationFrame(t),e._awaitingLoop=!0)};requestAnimationFrame(t)}uploadCompressedGlTexture(e,t,i,s){const n=i.pvr?i.mipmaps[0]:new DataView(i.mipmaps[0]);e.compressedTexImage2D(e.TEXTURE_2D,0,i.glInternalFormat,i.pixelWidth,i.pixelHeight,0,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)}uploadGlTexture(e,t,i,s){if(i instanceof ImageData||i instanceof HTMLImageElement||i instanceof HTMLVideoElement||window.ImageBitmap&&i instanceof ImageBitmap)e.texImage2D(e.TEXTURE_2D,0,s.internalFormat,s.format,s.type,i);else if(i instanceof HTMLCanvasElement){if(w.isZiggo||this.stage.getOption("forceTxCanvasSource"))e.texImage2D(e.TEXTURE_2D,0,s.internalFormat,s.format,s.type,i);else if(i.width>0&&i.height>0){const n=i.getContext("2d");e.texImage2D(e.TEXTURE_2D,0,s.internalFormat,s.format,s.type,n.getImageData(0,0,i.width,i.height))}}else e.texImage2D(e.TEXTURE_2D,0,s.internalFormat,t.w,t.h,0,s.format,s.type,i)}handleKtxLoad(e,t){var i=this;return function(){var s=this.response,n=new DataView(s),o=3632701469;o!==n.getUint32(0)+n.getUint32(4)+n.getUint32(8)&&e("Parsing failed: identifier ktx mismatch:",t);var a=n.getUint32(12)===16909060,l={glType:n.getUint32(16,a),glTypeSize:n.getUint32(20,a),glFormat:n.getUint32(24,a),glInternalFormat:n.getUint32(28,a),glBaseInternalFormat:n.getUint32(32,a),pixelWidth:n.getUint32(36,a),pixelHeight:n.getUint32(40,a),pixelDepth:n.getUint32(44,a),numberOfArrayElements:n.getUint32(48,a),numberOfFaces:n.getUint32(52,a),numberOfMipmapLevels:n.getUint32(56,a),bytesOfKeyValueData:n.getUint32(60,a),kvps:[],mipmaps:[],get width(){return this.pixelWidth},get height(){return this.pixelHeight}};const h=_=>{const g=[];for(let x in _)g.push(_[x]);return g};Object.values(i.stage.renderer.getCompressedTextureExtensions()).filter(_=>_!=null).map(_=>h(_)).reduce((_,g)=>_.concat(g)).includes(l.glInternalFormat)||console.warn("[Lightning] Unrecognized texture extension format:",t,l.glInternalFormat,i.stage.renderer.getCompressedTextureExtensions());var f=64;f+=l.bytesOfKeyValueData;for(var c=0;c<l.numberOfMipmapLevels;c++){var p=n.getUint32(f);f+=4,l.mipmaps.push(n.buffer.slice(f,p)),f+=p}e(null,{source:l,renderInfo:{src:t,compressed:!0}})}}handlePvrLoad(e,t){return function(){const h=this.response,u=new Int32Array(h,0,13),f=u[12]+52,c=new Uint8Array(h,f);var p={glInternalFormat:36196,pixelWidth:u[7],pixelHeight:u[6],numberOfMipmapLevels:u[11],mipmaps:[],pvr:!0,get width(){return this.pixelWidth},get height(){return this.pixelHeight}};let _=0,g=p.pixelWidth,x=p.pixelHeight;for(var m=0;m<p.numberOfMipmapLevels;m++){const T=(g+3>>2)*(x+3>>2)*8,b=new Uint8Array(h,c.byteOffset+_,T);p.mipmaps.push(b),_+=T,g=g>>1,x=x>>1}e(null,{source:p,renderInfo:{src:t,compressed:!0}})}}loadSrcTexture({src:e,hasAlpha:t},i){let s,n=e.toLowerCase().indexOf(".png")>=0||e.substr(0,21)=="data:image/png;base64",o=e.indexOf(".ktx")>=0,a=e.indexOf(".pvr")>=0;if(o||a){let l=new XMLHttpRequest;l.addEventListener("load",o?this.handleKtxLoad(i,e):this.handlePvrLoad(i,e)),l.open("GET",e),l.responseType="arraybuffer",l.send(),s=function(){l.abort()}}else if(this._imageWorker){if(typeof e!="string")return i("Invalid image URL");const l=e.indexOf("//");if(l!==0&&l!==5&&l!==6)return i("Invalid image URL");const h=this._imageWorker.create(e);h.onError=function(u){return i("Image load error")},h.onLoad=function({imageBitmap:u,hasAlphaChannel:f}){i(null,{source:u,renderInfo:{src:e,compressed:!1},hasAlpha:f,premultiplyAlpha:!0})},s=function(){h.cancel()}}else{let l=new Image;e.substr(0,5)!="data:"&&!w.isPS4&&(l.crossOrigin="Anonymous"),l.onerror=function(h){if(l.src)return i("Image load error")},l.onload=function(){i(null,{source:l,renderInfo:{src:e,compressed:!1},hasAlpha:n||t})},l.src=e,s=function(){l.onerror=null,l.onload=null,l.removeAttribute("src")}}return s}createWebGLContext(e,t){let i=this.stage.getOption("canvas")||document.createElement("canvas");e&&t&&(i.width=e,i.height=t);let s={alpha:!0,antialias:!1,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1},n=i.getContext("webgl",s)||i.getContext("experimental-webgl",s)||i.getContext("webgl2",s);if(!n)throw new Error("This browser does not support webGL.");return n}createCanvasContext(e,t){let i=this.stage.getOption("canvas")||document.createElement("canvas");e&&t&&(i.width=e,i.height=t);let s=i.getContext("2d");if(!s)throw new Error("This browser does not support 2d canvas.");return s}getHrTime(){return window.performance?window.performance.now():new Date().getTime()}getDrawingCanvas(){return document.createElement("canvas")}getTextureOptionsForDrawingCanvas(e){let t={};return t.source=e,t}nextFrame(e){}registerKeydownHandler(e){this._keydownListener=t=>{e(t)},window.addEventListener("keydown",this._keydownListener)}registerKeyupHandler(e){this._keyupListener=t=>{e(t)},window.addEventListener("keyup",this._keyupListener)}_removeKeyHandler(){this._keydownListener&&window.removeEventListener("keydown",this._keydownListener),this._keyupListener&&window.removeEventListener("keyup",this._keyupListener)}registerClickHandler(e){this._clickListener=t=>{e(t)},window.addEventListener("mousedown",this._clickListener)}_removeClickHandler(){this._clickListener&&window.removeEventListener("mousedown",this._clickListener)}registerHoverHandler(e){this._hoverListener=t=>{e(t)},window.addEventListener("mousemove",this._hoverListener)}_removeHoverHandler(){this._hoverListener&&window.removeEventListener("mousemove",this._hoverListener)}registerScrollWheelHandler(e){this._scrollWheelListener=t=>{e(t)},window.addEventListener("wheel",this._scrollWheelListener)}_removeScrollWheelHandler(){this._scrollWheelListener&&window.removeEventListener("wheel",this._scrollWheelListener)}_registerVisibilityChangeHandler(){this._visibilityChangeHandler=()=>{document.visibilityState==="visible"&&(this.stage.root.core.setHasRenderUpdates(2),this.stage.renderFrame())},document.addEventListener("visibilitychange",this._visibilityChangeHandler)}_removeVisibilityChangeHandler(){this._visibilityChangeHandler&&document.removeEventListener("visibilitychange",this._visibilityChangeHandler)}}class Hf{static load(e){return e.platform?e.platform:$f}}class He{static isFunction(e){return typeof e=="function"}static isNumber(e){return typeof e=="number"}static isInteger(e){return typeof e=="number"&&e%1===0}static isBoolean(e){return e===!0||e===!1}static isString(e){return typeof e=="string"}static isObject(e){let t=typeof e;return!!e&&(t=="object"||t=="function")}static isPlainObject(e){return!!e&&typeof e=="object"}static isObjectLiteral(e){return typeof e=="object"&&e&&e.constructor===Object}static getArrayIndex(e,t){return He.getModuloIndex(e,t.length)}static equalValues(e,t){return typeof e!=typeof t?!1:He.isObjectLiteral(e)?He.isObjectLiteral(t)&&He.equalObjectLiterals(e,t):Array.isArray(e)?Array.isArray(t)&&He.equalArrays(e,t):e===t}static equalObjectLiterals(e,t){let i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length)return!1;for(let n=0,o=i.length;n<o;n++){const a=i[n],l=s[n];if(a!==l)return!1;const h=e[a],u=t[l];if(!He.equalValues(h,u))return!1}return!0}static equalArrays(e,t){if(e.length!==t.length)return!1;for(let i=0,s=e.length;i<s;i++)if(!this.equalValues(e[i],t[i]))return!1;return!0}}class et{constructor(e,t){this._id=e,this._gl=t,this._program=void 0,this._buffers=new Map,this._framebuffers=new Map,this._renderbuffers=new Map,this._vertexAttribs=new Array(16),this._nonDefaultFlags=new Set,this._settings=new Map,this._textures=new Array(8),this._maxTexture=0,this._activeTexture=t.TEXTURE0,this._pixelStorei=new Array(5)}_getDefaultFlag(e){return e===this._gl.DITHER}setFlag(e,t){const i=this._getDefaultFlag(e);return t===i?this._nonDefaultFlags.delete(e):this._nonDefaultFlags.has(e)?!1:(this._nonDefaultFlags.add(e),!0)}setBuffer(e,t){const i=this._buffers.get(e)!==t;return this._buffers.set(e,t),i&&e===this._gl.ARRAY_BUFFER&&(this._vertexAttribs=[]),i}setFramebuffer(e,t){const i=this._framebuffers.get(e)!==t;return this._framebuffers.set(e,t),i}setRenderbuffer(e,t){const i=this._renderbuffers.get(e)!==t;return this._renderbuffers.set(e,t),i}setProgram(e){const t=this._program!==e;return this._program=e,t}setSetting(e,t){const i=this._settings.get(e),s=!i||!He.equalValues(i,t);return this._settings.set(e,t),s}disableVertexAttribArray(e){const t=this._vertexAttribs[e];return t&&t[5]?(t[5]=!1,!0):!1}enableVertexAttribArray(e){const t=this._vertexAttribs[e];if(t){if(!t[0])return t[0]=!0,!0}else return this._vertexAttribs[e]=[0,0,0,0,0,!0],!0;return!1}vertexAttribPointer(e,t){let i=this._vertexAttribs[e],s=!1;return i&&(s=i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]),s?!1:(t[5]=i?i[5]:!1,!0)}setActiveTexture(e){const t=this._activeTexture!==e;return this._activeTexture=e,t}bindTexture(e,t){const i=et._getTextureIndex(this._activeTexture);this._maxTexture=Math.max(this._maxTexture,i+1);const s=this._textures[i],n=et._getTextureTargetIndex(e);return s?s[n]===t?!1:(s[n]=t,!0):t?(this._textures[i]=[],this._textures[i][n]=t,!0):!1}setPixelStorei(e,t){const i=et._getPixelStoreiIndex(e),s=!He.equalValues(this._pixelStorei[i],t);return this._pixelStorei[i]=t,s}migrate(e){const t=this;this._migrateFlags(t,e),e._program!==t._program&&this._gl._useProgram(e._program),this._migrateFramebuffers(t,e),this._migrateRenderbuffers(t,e);const i=this._migrateBuffers(t,e);this._migrateAttributes(t,e,i),this._migrateFlags(t,e),this._migrateSettings(t,e),this._migratePixelStorei(t,e),this._migrateTextures(t,e)}_migratePixelStorei(e,t){for(let i=0,s=e._pixelStorei.length;i<s;i++)if(e._pixelStorei[i]!==t._pixelStorei[i]){const n=t._pixelStorei[i]!==void 0?t._pixelStorei[i]:et._getDefaultPixelStoreiByIndex(i);this._gl._pixelStorei(et._getPixelStoreiByIndex(i),n)}}_migrateTextures(e,t){const i=Math.max(e._maxTexture,t._maxTexture);let s=e._activeTexture;for(let n=0;n<i;n++){const o=t._textures[n],a=e._textures[n],l=et._getTextureByIndex(n),h=Math.max(a?a.length:0,o?o.length:0);for(let u=0,f=h;u<f;u++){const c=et._getTextureTargetByIndex(u);s!==l&&(this._gl._activeTexture(l),s=l);const p=o&&o[u]||null;this._gl._bindTexture(c,p)}}t._activeTexture!==s&&this._gl._activeTexture(t._activeTexture)}_migrateBuffers(e,t){return t._buffers.forEach((i,s)=>{e._buffers.get(s)!==i&&this._gl._bindBuffer(s,i)}),e._buffers.forEach((i,s)=>{t._buffers.get(s)===void 0&&this._gl._bindBuffer(s,null)}),t._buffers.get(this._gl.ARRAY_BUFFER)!==e._buffers.get(this._gl.ARRAY_BUFFER)}_migrateFramebuffers(e,t){t._framebuffers.forEach((i,s)=>{e._framebuffers.get(s)!==i&&this._gl._bindFramebuffer(s,i)}),e._framebuffers.forEach((i,s)=>{t._framebuffers.get(s)===void 0&&this._gl._bindFramebuffer(s,null)})}_migrateRenderbuffers(e,t){t._renderbuffers.forEach((i,s)=>{e._renderbuffers.get(s)!==i&&this._gl._bindRenderbuffer(s,i)}),e._renderbuffers.forEach((i,s)=>{t._renderbuffers.get(s)===void 0&&this._gl._bindRenderbuffer(s,null)})}_migrateAttributes(e,t,i){i?t._vertexAttribs.forEach((s,n)=>{s[0]&&this._gl._vertexAttribPointer(n,s[0],s[1],s[2],s[3],s[4]),s[5]&&this._gl._enableVertexAttribArray(n)}):(e._vertexAttribs.forEach((s,n)=>{t._vertexAttribs[n]||this._gl._disableVertexAttribArray(n)}),t._vertexAttribs.forEach((s,n)=>{this._gl._vertexAttribPointer(n,s[0],s[1],s[2],s[4]),s[5]?this._gl._enableVertexAttribArray(n):this._gl._disableVertexAttribArray(n)}))}_migrateSettings(e,t){const i=this.constructor.getDefaultSettings();e._settings.forEach((s,n)=>{const o=n.name||n.xname;if(!t._settings.has(n)){let a=i.get(o);He.isFunction(a)&&(a=a(this._gl)),t._settings.set(n,a),n.apply(this._gl,a)}}),t._settings.forEach((s,n)=>{const o=e._settings.get(n);(!o||!He.equalValues(o,s))&&n.apply(this._gl,s)})}_migrateFlags(e,t){e._nonDefaultFlags.forEach(i=>{t._nonDefaultFlags.has(i)||(this._getDefaultFlag(i)?this._gl._enable(i):this._gl._disable(i))}),t._nonDefaultFlags.forEach(i=>{e._nonDefaultFlags.has(i)||(this._getDefaultFlag(i)?this._gl._disable(i):this._gl._enable(i))})}static getDefaultSettings(){if(!this._defaultSettings){this._defaultSettings=new Map;const e=this._defaultSettings,t=WebGLRenderingContext.prototype;e.set("viewport",function(i){return[0,0,i.canvas.width,i.canvas.height]}),e.set("scissor",function(i){return[0,0,i.canvas.width,i.canvas.height]}),e.set("blendColor",[0,0,0,0]),e.set("blendEquation",[t.FUNC_ADD]),e.set("blendEquationSeparate",[t.FUNC_ADD,t.FUNC_ADD]),e.set("blendFunc",[t.ONE,t.ZERO]),e.set("blendFuncSeparate",[t.ONE,t.ZERO,t.ONE,t.ZERO]),e.set("clearColor",[0,0,0,0]),e.set("clearDepth",[1]),e.set("clearStencil",[0]),e.set("colorMask",[!0,!0,!0,!0]),e.set("cullFace",[t.BACK]),e.set("depthFunc",[t.LESS]),e.set("depthMask",[!0]),e.set("depthRange",[0,1]),e.set("frontFace",[t.CCW]),e.set("lineWidth",[1]),e.set("polygonOffset",[0,0]),e.set("sampleCoverage",[1,!1]),e.set("stencilFunc",[t.ALWAYS,0,1]),e.set("_stencilFuncSeparateFront",[t.ALWAYS,0,1]),e.set("_stencilFuncSeparateBack",[t.ALWAYS,0,1]),e.set("_stencilFuncSeparateFrontAndBack",[t.ALWAYS,0,1]),e.set("stencilMask",[1]),e.set("_stencilMaskSeparateFront",[1]),e.set("_stencilMaskSeparateBack",[1]),e.set("_stencilMaskSeparateFrontAndBack",[1]),e.set("stencilOp",[t.KEEP,t.KEEP,t.KEEP]),e.set("_stencilOpSeparateFront",[t.KEEP,t.KEEP,t.KEEP]),e.set("_stencilOpSeparateBack",[t.KEEP,t.KEEP,t.KEEP]),e.set("_stencilOpSeparateFrontAndBack",[t.KEEP,t.KEEP,t.KEEP]),e.set("vertexAttrib1f",[]),e.set("vertexAttrib1fv",[]),e.set("vertexAttrib2f",[]),e.set("vertexAttrib2fv",[]),e.set("vertexAttrib3f",[]),e.set("vertexAttrib3fv",[]),e.set("vertexAttrib4f",[]),e.set("vertexAttrib4fv",[])}return this._defaultSettings}static _getTextureTargetIndex(e){switch(e){case 3553:return 0;case 34067:return 1;default:throw new Error("Unknown texture target: "+e)}}static _getTextureTargetByIndex(e){return this._textureTargetIndices||(this._textureTargetIndices=[3553,34067]),this._textureTargetIndices[e]}static _getTextureIndex(e){return e-33984}static _getTextureByIndex(e){return e+33984}static _getPixelStoreiIndex(e){switch(e){case 3333:return 0;case 3317:return 1;case 37440:return 2;case 37441:return 3;case 37443:return 4;case 37445:return 5;default:throw new Error("Unknown pixelstorei: "+e)}}static _getPixelStoreiByIndex(e){return this._pixelStoreiIndices||(this._pixelStoreiIndices=[3333,3317,37440,37441,37443]),this._pixelStoreiIndices[e]}static _getDefaultPixelStoreiByIndex(e){return this._pixelStoreiDefaults||(this._pixelStoreiDefaults=[4,4,!1,!1,WebGLRenderingContext.prototype.BROWSER_DEFAULT_WEBGL]),this._pixelStoreiDefaults[e]}}class Gi{_initStateManager(e="default"){this._states={},this._state=this._getState(e)}_getState(e){return this._states[e]||(this._states[e]=new et(e,this)),this._states[e]}switchState(e="default"){if(this._state._id!==e){const t=this._getState(e);this._state.migrate(t),this._state=t}}$useProgram(e){this._state.setProgram(e)&&this._useProgram(e)}$bindBuffer(e,t){this._state.setBuffer(e,t)&&this._bindBuffer(e,t)}$bindFramebuffer(e,t){this._state.setFramebuffer(e,t)&&this._bindFramebuffer(e,t)}$bindRenderbuffer(e,t){this._state.setRenderbuffer(e,t)&&this._bindRenderbuffer(e,t)}$enable(e){this._state.setFlag(e,!0)&&this._enable(e)}$disable(e){this._state.setFlag(e,!1)&&this._disable(e)}$viewport(e,t,i,s){this._state.setSetting(this._viewport,[e,t,i,s])&&this._viewport(e,t,i,s)}$scissor(e,t,i,s){this._state.setSetting(this._scissor,[e,t,i,s])&&this._scissor(e,t,i,s)}$disableVertexAttribArray(e){this._state.disableVertexAttribArray(e)&&this._disableVertexAttribArray(e)}$enableVertexAttribArray(e){this._state.enableVertexAttribArray(e)&&this._enableVertexAttribArray(e)}$vertexAttribPointer(e,t,i,s,n,o){this._state.vertexAttribPointer(e,[t,i,s,n,o])&&this._vertexAttribPointer(e,t,i,s,n,o)}$activeTexture(e){this._state.setActiveTexture(e)&&this._activeTexture(e)}$bindTexture(e,t){this._state.bindTexture(e,t)&&this._bindTexture(e,t)}$pixelStorei(e,t){this._state.setPixelStorei(e,t)&&this._pixelStorei(e,t)}$stencilFuncSeparate(e,t,i,s){let n;switch(e){case this.FRONT:n=this._stencilFuncSeparateFront;break;case this.BACK:n=this._stencilFuncSeparateBack;break;case this.FRONT_AND_BACK:n=this._stencilFuncSeparateFrontAndBack;break}this._state.setSetting(n,[t,i,s])&&n.apply(this,[t,i,s])}_stencilFuncSeparateFront(e,t,i){this._stencilFuncSeparate(this.FRONT,e,t,i)}_stencilFuncSeparateBack(e,t,i){this._stencilFuncSeparate(this.BACK,e,t,i)}_stencilFuncSeparateFrontAndBack(e,t,i){this._stencilFuncSeparate(this.FRONT_AND_BACK,e,t,i)}$stencilMaskSeparate(e,t){let i;switch(e){case this.FRONT:i=this._stencilMaskSeparateFront;break;case this.BACK:i=this._stencilMaskSeparateBack;break;case this.FRONT_AND_BACK:i=this._stencilMaskSeparateFrontAndBack;break}this._state.setSetting(i,[t])&&i.apply(this,[t])}_stencilMaskSeparateFront(e){this._stencilMaskSeparate(this.FRONT,e)}_stencilMaskSeparateBack(e){this._stencilMaskSeparate(this.BACK,e)}_stencilMaskSeparateFrontAndBack(e){this._stencilMaskSeparate(this.FRONT_AND_BACK,e)}$stencilOpSeparate(e,t,i,s){let n;switch(e){case this.FRONT:n=this._stencilOpSeparateFront;break;case this.BACK:n=this._stencilOpSeparateBack;break;case this.FRONT_AND_BACK:n=this._stencilOpSeparateFrontAndBack;break}this._state.setSetting(n,[t,i,s])&&n.apply(this,[t,i,s])}_stencilOpSeparateFront(e,t,i){this._stencilOpSeparate(this.FRONT,e,t,i)}_stencilOpSeparateBack(e,t,i){this._stencilOpSeparate(this.BACK,e,t,i)}_stencilOpSeparateFrontAndBack(e,t,i){this._stencilOpSeparate(this.FRONT_AND_BACK,e,t,i)}$blendColor(e,t,i,s){this._state.setSetting(this._blendColor,[e,t,i,s])&&this._blendColor(e,t,i,s)}$blendEquation(e){this._state.setSetting(this._blendEquation,[e])&&this._blendEquation(e)}$blendEquationSeparate(e,t){this._state.setSetting(this._blendEquationSeparate,[e,t])&&this._blendEquationSeparate(e,t)}$blendFunc(e,t){this._state.setSetting(this._blendFunc,[e,t])&&this._blendFunc(e,t)}$blendFuncSeparate(e,t,i,s){this._state.setSetting(this._blendFuncSeparate,[e,t,i,s])&&this._blendFuncSeparate(e,t,i,s)}$clearColor(e,t,i,s){this._state.setSetting(this._clearColor,[e,t,i,s])&&this._clearColor(e,t,i,s)}$clearDepth(e){this._state.setSetting(this._clearDepth,[e])&&this._clearDepth(e)}$clearStencil(e){this._state.setSetting(this._clearStencil,[e])&&this._clearStencil(e)}$colorMask(e,t,i,s){this._state.setSetting(this._colorMask,[e,t,i,s])&&this._colorMask(e,t,i,s)}$cullFace(e){this._state.setSetting(this._cullFace,[e])&&this._cullFace(e)}$depthFunc(e){this._state.setSetting(this._depthFunc,[e])&&this._depthFunc(e)}$depthMask(e){this._state.setSetting(this._depthMask,[e])&&this._depthMask(e)}$depthRange(e,t){this._state.setSetting(this._depthRange,[e,t])&&this._depthRange(e,t)}$frontFace(e){this._state.setSetting(this._frontFace,[e])&&this._frontFace(e)}$lineWidth(e){this._state.setSetting(this._lineWidth,[e])&&this._lineWidth(e)}$polygonOffset(e,t){this._state.setSetting(this._polygonOffset,[e,t])&&this._polygonOffset(e,t)}$sampleCoverage(e,t){this._state.setSetting(this._sampleCoverage,[e,t])&&this._sampleCoverage(e,t)}$stencilFunc(e,t,i){this._state.setSetting(this._stencilFunc,[e,t,i])&&this._stencilFunc(e,t,i)}$stencilMask(e){this._state.setSetting(this._stencilMask,[e])&&this._stencilMask(e)}$stencilOp(e,t,i){this._state.setSetting(this._stencilOp,[e,t,i])&&this._stencilOp(e,t,i)}$vertexAttrib1f(e,t){this._state.setSetting(this._vertexAttrib1f,[e,t])&&this._vertexAttrib1f(e,t)}$vertexAttrib1fv(e,t){this._state.setSetting(this._vertexAttrib1fv,[e,t])&&this._vertexAttrib1fv(e,t)}$vertexAttrib2f(e,t,i){this._state.setSetting(this._vertexAttrib2f,[e,t,i])&&this._vertexAttrib2f(e,t,i)}$vertexAttrib2fv(e,t){this._state.setSetting(this._vertexAttrib2fv,[e,t])&&this._vertexAttrib2fv(e,t)}$vertexAttrib3f(e,t,i,s){this._state.setSetting(this._vertexAttrib3f,[e,t,i,s])&&this._vertexAttrib3f(e,t,i,s)}$vertexAttrib3fv(e,t){this._state.setSetting(this._vertexAttrib3fv,[e,t])&&this._vertexAttrib3fv(e,t)}$vertexAttrib4f(e,t,i,s,n){this._state.setSetting(this._vertexAttrib4f,[e,t,i,s,n])&&this._vertexAttrib4f(e,t,i,s,n)}$vertexAttrib4fv(e,t){this._state.setSetting(this._vertexAttrib4fv,[e,t])&&this._vertexAttrib4fv(e,t)}static enable(e,t="default"){const i=Object.getOwnPropertyNames(Gi.prototype);return e.__proto__,i.forEach(s=>{if(s!=="constructor"){const n=Gi.prototype[s];s.charAt(0)==="$"&&(s=s.substr(1)),e[s]!==n&&(e[s]&&(e[s].name||(e[s].xname=s),e["_"+s]=e[s]),e[s]=n)}}),Gi.prototype._initStateManager.call(e,t),e}}class Wf{constructor(e){this.stage=e,this._usedMemory=0,this._uploadedTextureSources=[],this.textureSourceHashmap=new Map}get usedMemory(){return this._usedMemory}destroy(){for(let e=0,t=this._uploadedTextureSources.length;e<t;e++)this._nativeFreeTextureSource(this._uploadedTextureSources[e]);this.textureSourceHashmap.clear(),this._usedMemory=0}getReusableTextureSource(e){return this.textureSourceHashmap.get(e)}getTextureSource(e,t){let i=t?this.textureSourceHashmap.get(t):null;return i||(i=new zi(this,e),t&&(i.lookupId=t,this.textureSourceHashmap.set(t,i))),i}uploadTextureSource(e,t){if(e.isLoaded())return;this._addMemoryUsage(e.w*e.h);const i=this._nativeUploadTextureSource(e,t);e._nativeTexture=i,i.w=e.w,i.h=e.h,i.update=this.stage.frameCounter,this._uploadedTextureSources.push(e),this.addToLookupMap(e),this._updateVramUsage(e,1)}_addMemoryUsage(e){this._usedMemory+=e,this.stage.addMemoryUsage(e)}_updateVramUsage(e,t){const i=e.nativeTexture;var s;Qt.isWebglSupported()&&e.isLoaded()&&(!i.hasOwnProperty("bytesPerPixel")||isNaN(i.bytesPerPixel)||(s=t*(e.w*e.h*i.bytesPerPixel),this.stage.addVramUsage(s,e.hasAlpha)))}addToLookupMap(e){const t=e.lookupId;t&&(this.textureSourceHashmap.has(t)||this.textureSourceHashmap.set(t,e))}gc(){this.freeUnusedTextureSources()}freeUnusedTextureSources(){let e=[];for(let t=0,i=this._uploadedTextureSources.length;t<i;t++){let s=this._uploadedTextureSources[t];s.allowCleanup()?this._freeManagedTextureSource(s):e.push(s)}this._uploadedTextureSources=e,this._cleanupLookupMap()}_freeManagedTextureSource(e){e.isLoaded()&&(this._nativeFreeTextureSource(e),this._addMemoryUsage(-e.w*e.h),this._updateVramUsage(e,-1)),e.loadingSince=null}_cleanupLookupMap(){this.textureSourceHashmap.forEach((e,t)=>{!(e.isLoaded()||e.isLoading())&&!e.isUsed()&&this.textureSourceHashmap.delete(t)})}freeTextureSource(e){const t=this._uploadedTextureSources.indexOf(e),i=t!==-1;e.isLoaded()&&(i&&(this._addMemoryUsage(-e.w*e.h),this._uploadedTextureSources.splice(t,1)),this._nativeFreeTextureSource(e)),e.loadingSince=null}_nativeUploadTextureSource(e,t){return this.stage.renderer.uploadTextureSource(e,t)}_nativeFreeTextureSource(e){this.stage.renderer.freeTextureSource(e),e.clearNativeTexture()}}class Fr{constructor(e){this.stage=e,this.genericCancelCb=t=>{this._remove(t)},this._sources=[],this._data=[]}destroy(){this._sources=[],this._data=[],this.stage=null,delete this._sources,delete this._data,delete this.stage}processSome(){if(this._sources.length){const e=Date.now();do this._processItem();while(this._sources.length&&Date.now()-e<Fr.MAX_UPLOAD_TIME_PER_FRAME)}}_processItem(){const e=this._sources.pop(),t=this._data.pop();e.isLoading()&&e.processLoadedSource(t)}add(e,t){this._sources.push(e),this._data.push(t)}_remove(e){const t=this._sources.indexOf(e);t>=0&&(this._sources.splice(t,1),this._data.splice(t,1))}}Fr.MAX_UPLOAD_TIME_PER_FRAME=10;class Vf{constructor(e){this.stage=e,this.root=null,this.updateTreeOrder=0,this.renderState=this.stage.renderer.createCoreRenderState(this),this.renderExec=this.stage.renderer.createCoreRenderExecutor(this),this.renderExec.init(),this._usedMemory=0,this._renderTexturePool=[],this._renderTextureId=1,this._zSorts=[],this.renderToTextureCount=0}get usedMemory(){return this._usedMemory}destroy(){this._renderTexturePool.forEach(e=>this._freeRenderTexture(e)),this._usedMemory=0,this.stage=null,this.root=null,this.renderState=null,this.renderExec=null,this._renderTexturePool=null,this._zSorts=null,delete this.stage,delete this.root,delete this.renderState,delete this.renderExec,delete this._renderTexturePool,delete this._zSorts}hasRenderUpdates(){return!!this.root._parent._hasRenderUpdates}render(){this.root._parent._hasRenderUpdates=0,this._render()}update(){this._update(),this.root._hasUpdates&&this._update(),this._performForcedZSorts()}_performForcedZSorts(){if(this._zSorts.length){for(let t=0,i=this._zSorts.length;t<i;t++)this._zSorts[t].zSort&&this._zSorts[t].sortZIndexedChildren();this._zSorts=[]}}_update(){this.updateTreeOrder=0,this.root.update()}_render(){const e=this.stage.getOption("debugFrame");this._fillRenderState(),this.stage.getOption("readPixelsBeforeDraw")&&this._readPixels(),this._performRender(),e&&console.log(`[Lightning] RTT Renders in frame: ${this.renderToTextureCount}`),this.stage.getOption("readPixelsAfterDraw")&&this.renderToTextureCount>=this.stage.getOption("readPixelsAfterDrawThreshold")&&(e&&console.log("[Lightning] readPixelsAfterDraw behavior triggered"),this._readPixels()),this.renderToTextureCount=0}_readPixels(){const e=new Uint8Array(4),t=this.stage.gl;t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,e)}_fillRenderState(){this.renderState.reset(),this.root.render(),this.renderState.finish()}_performRender(){this.renderExec.execute()}_addMemoryUsage(e){this._usedMemory+=e,this.stage.addMemoryUsage(e)}allocateRenderTexture(e,t){let i=this.stage.getRenderPrecision(),s=Math.max(1,Math.round(e*i)),n=Math.max(1,Math.round(t*i));const o=this._renderTexturePool.length;for(let l=o-1;l>=0;l--){const h=this._renderTexturePool[l];if(h.w===s&&h.h===n&&h.update!==this.stage.frameCounter)return h.f=this.stage.frameCounter,this._renderTexturePool.splice(l,1),h}const a=this._createRenderTexture(e,t,s,n);return a.precision=i,a}releaseRenderTexture(e){this._renderTexturePool.push(e)}freeUnusedRenderTextures(e=60){let t=this.stage.frameCounter-e;this._renderTexturePool=this._renderTexturePool.filter(i=>i.f<=t?(this._freeRenderTexture(i),!1):!0)}_createRenderTexture(e,t,i,s){this._addMemoryUsage(i*s);const n=this.stage.renderer.createRenderTexture(e,t,i,s);return n.id=this._renderTextureId++,n.f=this.stage.frameCounter,n.ow=e,n.oh=t,n.w=i,n.h=s,n}_freeRenderTexture(e){this.stage.renderer.freeRenderTexture(e),this._addMemoryUsage(-e.w*e.h)}copyRenderTexture(e,t,i){this.stage.renderer.copyRenderTexture(e,t,i)}forceZSort(e){this._zSorts.push(e)}}class Fn{constructor(e){this.stage=e,this._timingFunction="ease",this._timingFunctionImpl=D.getTimingFunction(this._timingFunction),this.delay=0,this.duration=.2,this.merger=null}get timingFunction(){return this._timingFunction}set timingFunction(e){this._timingFunction=e,this._timingFunctionImpl=D.getTimingFunction(e)}get timingFunctionImpl(){return this._timingFunctionImpl}patch(e){xe.patchObject(this,e)}}Fn.prototype.isTransitionSettings=!0;class Xf{constructor(e){this.stage=e,this.stage.on("frameStart",()=>this.progress()),this.active=new Set,this.defaultTransitionSettings=new Fn(this.stage)}progress(){if(this.active.size){let e=this.stage.dt,t=!1;this.active.forEach(function(i){i.progress(e),i.isRunning()||(t=!0)}),t&&(this.active=new Set([...this.active].filter(i=>i.isRunning())))}}createSettings(e){const t=new Fn;return xe.patchObject(t,e),t}addActive(e){this.active.add(e)}removeActive(e){this.active.delete(e)}}class le{constructor(){this._clear()}_clear(){this._p=[],this._pe=[],this._idp=[],this._f=[],this._v=[],this._lv=[],this._sm=[],this._s=[],this._ve=[],this._sme=[],this._se=[],this._length=0}parse(e,t){let i,s;w.isObjectLiteral(t)||(t={0:t});let n=.5,o=[];for(let a in t)if(t.hasOwnProperty(a)){let l=t[a];w.isObjectLiteral(l)||(l={v:l});let h=parseFloat(a);a==="sm"?n=l.v:!isNaN(h)&&h>=0&&h<=2&&(l.p=h,l.f=w.isFunction(l.v),l.lv=l.f?l.v(0,0):l.v,o.push(l))}for(o=o.sort(function(a,l){return a.p-l.p}),s=o.length,i=0;i<s;i++){let a=i===s-1;if(!o[i].hasOwnProperty("pe"))o[i].pe=a?o[i].p<=1?1:2:o[i+1].p;else{const l=i<s-1?o[i+1].p:1;o[i].pe>l&&(o[i].pe=l)}o[i].pe===o[i].p?o[i].idp=0:o[i].idp=1/(o[i].pe-o[i].p)}for(i=0;i<s;i++)if(o[i].hasOwnProperty("sm")||(o[i].sm=n),!o[i].hasOwnProperty("s"))if(i===0||i===s-1||o[i].p===1)o[i].s=e?[0,0,0,0]:0;else{const a=o[i-1],l=o[i+1];if(a.p===l.p)o[i].s=e?[0,0,0,0]:0;else if(e){const h=le.getRgbaComponents(l.lv),u=le.getRgbaComponents(a.lv),f=1/(l.p-a.p);o[i].s=[f*(h[0]-u[0]),f*(h[1]-u[1]),f*(h[2]-u[2]),f*(h[3]-u[3])]}else o[i].s=(l.lv-a.lv)/(l.p-a.p)}for(i=0;i<s-1;i++)if(!o[i].f){let a=i===s-1;o[i].hasOwnProperty("ve")||(o[i].ve=a?o[i].lv:o[i+1].lv),w.isNumber(o[i].v)&&w.isNumber(o[i].lv)&&(o[i].hasOwnProperty("sme")||(o[i].sme=a?n:o[i+1].sm),o[i].hasOwnProperty("se")||(o[i].se=a?e?[0,0,0,0]:0:o[i+1].s),e?o[i].v=le.getSplineRgbaValueFunction(o[i].v,o[i].ve,o[i].p,o[i].pe,o[i].sm,o[i].sme,o[i].s,o[i].se):o[i].v=le.getSplineValueFunction(o[i].v,o[i].ve,o[i].p,o[i].pe,o[i].sm,o[i].sme,o[i].s,o[i].se),o[i].f=!0)}for(this.length&&this._clear(),i=0,s=o.length;i<s;i++)this._add(o[i])}_add(e){this._p.push(e.p||0),this._pe.push(e.pe||0),this._idp.push(e.idp||0),this._f.push(e.f||!1),this._v.push(e.hasOwnProperty("v")?e.v:0),this._lv.push(e.lv||0),this._sm.push(e.sm||0),this._s.push(e.s||0),this._ve.push(e.ve||0),this._sme.push(e.sme||0),this._se.push(e.se||0),this._length++}_getItem(e){const t=this._length;if(!t)return-1;if(e<this._p[0])return 0;for(let i=0;i<t;i++)if(this._p[i]<=e&&e<this._pe[i])return i;return t-1}getValue(e){const t=this._getItem(e);if(t!==-1)if(this._f[t]){const i=Math.min(1,Math.max(0,(e-this._p[t])*this._idp[t]));return this._v[t](i)}else return this._v[t]}get length(){return this._length}static getRgbaComponents(e){let t=(e/65536|0)%256,i=(e/256|0)%256,s=e%256,n=e/16777216|0;return[t,i,s,n]}static getSplineValueFunction(e,t,i,s,n,o,a,l){let h=s-i;a*=h,l*=h;let u=le.getSplineHelpers(e,t,n,o,a,l);return u?function(f){return f===0?e:f===1?t:le.calculateSpline(u,f)}:function(f){return f===0?e:f===1?t:t*f+e*(1-f)}}static getSplineRgbaValueFunction(e,t,i,s,n,o,a,l){let h=s-i;a[0]*=h,a[1]*=h,a[2]*=h,a[3]*=h,l[0]*=h,l[1]*=h,l[2]*=h,l[3]*=h;let u=le.getRgbaComponents(e),f=le.getRgbaComponents(t),c=[le.getSplineHelpers(u[0],f[0],n,o,a[0],l[0]),le.getSplineHelpers(u[1],f[1],n,o,a[1],l[1]),le.getSplineHelpers(u[2],f[2],n,o,a[2],l[2]),le.getSplineHelpers(u[3],f[3],n,o,a[3],l[3])];return c[0]?function(p){return p===0?e:p===1?t:le.getArgbNumber([Math.min(255,le.calculateSpline(c[0],p)),Math.min(255,le.calculateSpline(c[1],p)),Math.min(255,le.calculateSpline(c[2],p)),Math.min(255,le.calculateSpline(c[3],p))])}:function(p){return p===0?e:p===1?t:le.mergeColors(t,e,p)}}static getSplineHelpers(e,t,i,s,n,o){if(!i&&!s)return null;let a=i,l=e+n*i,h=1-s,u=t-o*s,f=3*a-3*h+1,c=-6*a+3*h,p=3*a,_=3*l-3*u+t-e,g=3*(u+e)-6*l,x=3*(l-e);return[f,c,p,_,g,x,e]}static calculateSpline(e,t){let i=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],h=e[6];if(i===-2&&o===-2&&n===0&&l===0)return t;let u=.5,f,c;for(let g=0;g<20;g++){if(f=u*(u*(u*i+s)+n),c=t-f,c>-1e-8&&c<1e-8)return u*(u*(u*o+a)+l)+h;let x=u*(u*(3*i)+2*s)+n;if(x>1e-10&&x<1e-10)break;u+=c/x}let p=0,_=1;for(let g=0;g<20;g++){if(u=.5*(p+_),f=u*(u*(u*i+s)+n),c=t-f,c>-1e-8&&c<1e-8)return u*(u*(u*o+a)+l)+h;c<0?_=u:p=u}return u}static mergeColors(e,t,i){let s=(e/65536|0)%256,n=(e/256|0)%256,o=e%256,a=e/16777216|0,l=(t/65536|0)%256,h=(t/256|0)%256,u=t%256,f=t/16777216|0,c=s*i+l*(1-i),p=n*i+h*(1-i),_=o*i+u*(1-i),g=a*i+f*(1-i);return Math.round(g)*16777216+Math.round(c)*65536+Math.round(p)*256+Math.round(_)}static getArgbNumber(e){e[0]=Math.max(0,Math.min(255,e[0])),e[1]=Math.max(0,Math.min(255,e[1])),e[2]=Math.max(0,Math.min(255,e[2])),e[3]=Math.max(0,Math.min(255,e[3]));let t=((e[3]|0)<<24)+((e[0]|0)<<16)+((e[1]|0)<<8)+(e[2]|0);return t<0&&(t=4294967295+t+1),t}}class gl{constructor(e){this.animationSettings=e,this._selector="",this._items=new le,this._props=[],this._propSetters=[],this._resetValue=void 0,this._hasResetValue=!1,this._hasColorProperty=void 0}getResetValue(){return this._hasResetValue?this._resetValue:this._items.getValue(0)}apply(e,t,i){const s=this.getAnimatedElements(e);let n=this._items.getValue(t);if(n===void 0||!s.length)return;if(i!==1){let l=this.getResetValue();w.isNumber(n)&&w.isNumber(l)&&(this.hasColorProperty()?n=D.mergeColors(n,l,i):n=D.mergeNumbers(n,l,i))}const o=this._propSetters.length,a=s.length;for(let l=0;l<a;l++)for(let h=0;h<o;h++)this._propSetters[h](s[l],n)}getAnimatedElements(e){const t=this._selector;return typeof t=="string"?e.select(t):[t]}reset(e){const t=this.getAnimatedElements(e);let i=this.getResetValue();if(i===void 0||!t.length)return;const s=this._propSetters.length,n=t.length;for(let o=0;o<n;o++)for(let a=0;a<s;a++)this._propSetters[a](t[o],i)}set selector(e){this._selector=e}set t(e){this.selector=e}get resetValue(){return this._resetValue}set resetValue(e){this._resetValue=e,this._hasResetValue=e!==void 0}set rv(e){this.resetValue=e}set value(e){this._items.parse(this.hasColorProperty(),e)}set v(e){this.value=e}set properties(e){Array.isArray(e)||(e=[e]),this._props=[],e.forEach(t=>{this._props.push(t),this._propSetters.push(se.getSetter(t))})}set property(e){this._hasColorProperty=void 0,this.properties=e}set p(e){this.properties=e}patch(e){xe.patchObject(this,e)}hasColorProperty(){return this._hasColorProperty===void 0&&(this._hasColorProperty=this._props.length?se.isColorProperty(this._props[0]):!1),this._hasColorProperty}}gl.prototype.isAnimationActionSettings=!0;class Re{constructor(){this._actions=[],this.delay=0,this.duration=1,this.repeat=0,this.repeatOffset=0,this.repeatDelay=0,this.autostop=!1,this.stopMethod=Re.STOP_METHODS.FADE,this._stopTimingFunction="ease",this._stopTimingFunctionImpl=D.getTimingFunction(this._stopTimingFunction),this.stopDuration=0,this.stopDelay=0}get actions(){return this._actions}set actions(e){this._actions=[];for(let t=0,i=e.length;t<i;t++){const s=e[t];if(s.isAnimationActionSettings)this._actions.push(s);else{const n=new gl(this);n.patch(s),this._actions.push(n)}}}apply(e,t,i=1){this._actions.forEach(function(s){s.apply(e,t,i)})}reset(e){this._actions.forEach(function(t){t.reset(e)})}get stopTimingFunction(){return this._stopTimingFunction}set stopTimingFunction(e){this._stopTimingFunction=e,this._stopTimingFunctionImpl=D.getTimingFunction(e)}get stopTimingFunctionImpl(){return this._stopTimingFunctionImpl}patch(e){xe.patchObject(this,e)}}Re.STOP_METHODS={FADE:"fade",REVERSE:"reverse",FORWARD:"forward",IMMEDIATE:"immediate",ONETOTWO:"onetotwo"};class X extends ae{constructor(e,t,i){super(),this.manager=e,this._settings=t,this._element=i,this._state=X.STATES.IDLE,this._p=0,this._delayLeft=0,this._repeatsLeft=0,this._stopDelayLeft=0,this._stopP=0}start(){this._element&&this._element.attached?(this._p=0,this._delayLeft=this.settings.delay,this._repeatsLeft=this.settings.repeat,this._state=X.STATES.PLAYING,this.emit("start"),this.checkActive()):console.warn("[Lightning] Element must be attached before starting animation")}play(){this._state===X.STATES.PAUSED?(this._state=X.STATES.PLAYING,this.checkActive(),this.emit("resume")):this._state==X.STATES.STOPPING&&this.settings.stopMethod==Re.STOP_METHODS.REVERSE?(this._state=X.STATES.PLAYING,this.emit("stopContinue")):this._state!=X.STATES.PLAYING&&this._state!=X.STATES.FINISHED&&this.start()}pause(){this._state===X.STATES.PLAYING&&(this._state=X.STATES.PAUSED,this.emit("pause"))}replay(){this._state==X.STATES.FINISHED?this.start():this.play()}skipDelay(){this._delayLeft=0,this._stopDelayLeft=0}finish(){this._state===X.STATES.PLAYING?(this._delayLeft=0,this._p=1):this._state===X.STATES.STOPPING&&(this._stopDelayLeft=0,this._p=0)}stop(){this._state===X.STATES.STOPPED||this._state===X.STATES.IDLE||(this._stopDelayLeft=this.settings.stopDelay||0,this.settings.stopMethod===Re.STOP_METHODS.IMMEDIATE&&!this._stopDelayLeft||this._delayLeft>0?(this._state=X.STATES.STOPPING,this.emit("stop")):(this.settings.stopMethod===Re.STOP_METHODS.FADE&&(this._stopP=0),this._state=X.STATES.STOPPING,this.emit("stop")),this.checkActive())}stopNow(){(this._state!==X.STATES.STOPPED||this._state!==X.STATES.IDLE)&&(this._state=X.STATES.STOPPING,this._p=0,this.emit("stop"),this.reset(),this._state=X.STATES.STOPPED,this.emit("stopFinish"))}isPaused(){return this._state===X.STATES.PAUSED}isPlaying(){return this._state===X.STATES.PLAYING}isStopping(){return this._state===X.STATES.STOPPING}isFinished(){return this._state===X.STATES.FINISHED}checkActive(){this.isActive()&&this.manager.addActive(this)}isActive(){return(this._state==X.STATES.PLAYING||this._state==X.STATES.STOPPING)&&this._element&&this._element.attached}progress(e){this._element&&(this._progress(e),this.apply())}_progress(e){if(this._state==X.STATES.STOPPING){this._stopProgress(e);return}if(this._state==X.STATES.PLAYING){if(this._delayLeft>0)if(this._delayLeft-=e,this._delayLeft<0)e=-this._delayLeft,this._delayLeft=0,this.emit("delayEnd");else return;this.settings.duration===0?this._p=1:this.settings.duration>0&&(this._p+=e/this.settings.duration),this._p>=1?this.settings.repeat==-1||this._repeatsLeft>0?(this._repeatsLeft>0&&this._repeatsLeft--,this._p=this.settings.repeatOffset,this.emit("progress",this._p),this.settings.repeatDelay&&(this._delayLeft=this.settings.repeatDelay),this.emit("repeat",this._repeatsLeft)):(this._p=1,this.emit("progress",this._p),this._state=X.STATES.FINISHED,this.emit("finish"),this.settings.autostop&&this.stop()):this.emit("progress",this._p)}}_stopProgress(e){let t=this._getStopDuration();if(this._stopDelayLeft>0)if(this._stopDelayLeft-=e,this._stopDelayLeft<0)e=-this._stopDelayLeft,this._stopDelayLeft=0,this.emit("stopDelayEnd");else return;this.settings.stopMethod==Re.STOP_METHODS.IMMEDIATE?(this._state=X.STATES.STOPPED,this.emit("stopFinish")):this.settings.stopMethod==Re.STOP_METHODS.REVERSE?(t===0?this._p=0:t>0&&(this._p-=e/t),this._p<=0&&(this._p=0,this._state=X.STATES.STOPPED,this.emit("stopFinish"))):this.settings.stopMethod==Re.STOP_METHODS.FADE?(this._progressStopTransition(e),this._stopP>=1&&(this._p=0,this._state=X.STATES.STOPPED,this.emit("stopFinish"))):this.settings.stopMethod==Re.STOP_METHODS.ONETOTWO?this._p<2&&(t===0?this._p=2:t>0&&(this._p<1?this._p+=e/this.settings.duration:this._p+=e/t),this._p>=2?(this._p=2,this._state=X.STATES.STOPPED,this.emit("stopFinish")):this.emit("progress",this._p)):this.settings.stopMethod==Re.STOP_METHODS.FORWARD&&this._p<1&&(this.settings.duration==0?this._p=1:this._p+=e/this.settings.duration,this._p>=1?this.settings.stopMethod==Re.STOP_METHODS.FORWARD?(this._p=1,this._state=X.STATES.STOPPED,this.emit("stopFinish")):this._repeatsLeft>0?(this._repeatsLeft--,this._p=0,this.emit("repeat",this._repeatsLeft)):(this._p=1,this._state=X.STATES.STOPPED,this.emit("stopFinish")):this.emit("progress",this._p))}_progressStopTransition(e){if(this._stopP<1){if(this._stopDelayLeft>0)if(this._stopDelayLeft-=e,this._stopDelayLeft<0)e=-this._stopDelayLeft,this._stopDelayLeft=0,this.emit("delayEnd");else return;const t=this._getStopDuration();t==0?this._stopP=1:this._stopP+=e/t,this._stopP>=1&&(this._stopP=1)}}_getStopDuration(){return this.settings.stopDuration||this.settings.duration}apply(){if(this._state===X.STATES.STOPPED)this.reset();else{let e=1;this._state===X.STATES.STOPPING&&this.settings.stopMethod===Re.STOP_METHODS.FADE&&(e=1-this.settings.stopTimingFunctionImpl(this._stopP)),this._settings.apply(this._element,this._p,e)}}reset(){this._settings.reset(this._element)}get state(){return this._state}get p(){return this._p}get delayLeft(){return this._delayLeft}get element(){return this._element}get frame(){return Math.round(this._p*this._settings.duration*60)}get settings(){return this._settings}}X.STATES={IDLE:0,PLAYING:1,STOPPING:2,STOPPED:3,FINISHED:4,PAUSED:5};class Gf{constructor(e){this.stage=e,this.stage.on("frameStart",()=>this.progress()),this.active=new Set}progress(){if(this.active.size){let e=this.stage.dt,t=!1;this.active.forEach(function(i){i.isActive()?i.progress(e):t=!0}),t&&(this.active=new Set([...this.active].filter(i=>i.isActive())))}}createAnimation(e,t){return w.isObjectLiteral(t)&&(t=this.createSettings(t)),new X(this,t,e)}createSettings(e){const t=new Re;return xe.patchObject(t,e),t}addActive(e){this.active.add(e)}}class _l extends Oe{_getLookupId(){return"__whitepix"}_getSourceLoader(){return function(e){var t=new Uint8Array([255,255,255,255]);e(null,{source:t,w:1,h:1,permanent:!0})}}isAutosizeTexture(){return!1}}class Qt extends ae{constructor(e={}){super(),this._setOptions(e),this._usedMemory=0,this._lastGcFrame=0,this._usedVramAlpha=0,this._usedVramNonAlpha=0;const t=Qt.platform?Qt.platform:Hf.load(e);this.platform=new t,this.platform.init&&this.platform.init(this),this.gl=null,this.c2d=null;const i=this.getOption("context");if(i?i.useProgram?this.gl=i:this.c2d=i:w.isWeb&&(!Qt.isWebglSupported()||this.getOption("canvas2d"))?this.c2d=this.platform.createCanvasContext(this.getOption("w"),this.getOption("h")):this.gl=this.platform.createWebGLContext(this.getOption("w"),this.getOption("h")),this.gl&&Gi.enable(this.gl,"lightning"),this._mode=this.gl?0:1,this.getCanvas()){if(this.getOption("devicePixelRatio")!==1){const s=this.getOption("devicePixelRatio");this.getCanvas().style.width=this._options.w/s+"px",this.getCanvas().style.height=this._options.h/s+"px"}this._options.w=this.getCanvas().width,this._options.h=this.getCanvas().height}this._mode===0?w.isSpark?this._renderer=new Bf(this):this._renderer=new pl(this):this._renderer=new Uf(this),this.setClearColor(this.getOption("clearColor")),this.frameCounter=0,this.transitions=new Xf(this),this.animations=new Gf(this),this.textureManager=new Wf(this),this.textureThrottler=new Fr(this),this.startTime=0,this.currentTime=0,this.dt=0,this.rectangleTexture=new _l(this),this.rectangleTexture.load(),this.rectangleTexture.source.permanent=!0,this.ctx=new Vf(this),this._updateSourceTextures=new Set}get renderer(){return this._renderer}static isWebglSupported(){if(w.isNode)return!0;try{return!!window.WebGLRenderingContext}catch{return!1}}get mode(){return this._mode}isWebgl(){return this.mode===0}isC2d(){return this.mode===1}getOption(e){return this._options[e]}_setOptions(e){this._options={};let t=(i,s)=>{let n=e[i];n===void 0?this._options[i]=s:this._options[i]=n};t("canvas",null),t("context",null),t("w",1920),t("h",1080),t("srcBasePath",null),t("memoryPressure",24e6),t("bufferMemory",2e6),t("textRenderIssueMargin",0),t("fontSharp",{precision:.6666666667,fontSize:24}),t("clearColor",[0,0,0,0]),t("defaultFontFace","sans-serif"),t("fixedDt",0),t("useImageWorker",!0),t("autostart",!0),t("precision",1),t("canvas2d",!1),t("platform",null),t("readPixelsBeforeDraw",!1),t("devicePixelRatio",1),t("readPixelsAfterDraw",!1),t("readPixelsAfterDrawThreshold",0),t("debugFrame",!1),t("forceTxCanvasSource",!1),t("pauseRafLoopOnIdle",!1),e.devicePixelRatio!=null&&e.devicePixelRatio!==1&&(this._options.precision*=e.devicePixelRatio,this._options.w*=e.devicePixelRatio,this._options.h*=e.devicePixelRatio)}setApplication(e){this.application=e}init(){this.application.getOption("debug")&&this.platform._imageWorker&&console.log("[Lightning] Using image worker!"),this.application.getOption("debug")&&this.c2d&&console.log("[Lightning] Using canvas2d renderer"),this.application.setAsRoot(),this.getOption("autostart")&&this.platform.startLoop()}destroy(){this.platform.stopLoop(),this.platform.destroy(),this.ctx.destroy(),this.textureManager.destroy(),this._renderer.destroy(),this.gl?(this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)):this.c2d&&this.c2d.clearRect(0,0,this.c2d.canvas.width,this.c2d.canvas.height),this.gl=null,this.c2d=null,this.ctx=null,this._options=null,this.platform=null,this.textureManager=null,this._renderer=null,delete this.gl,delete this.c2d,delete this.ctx,delete this._options,delete this.platform,delete this.textureManager,delete this._renderer}stop(){this.platform.stopLoop()}resume(){this.platform.startLoop()}get root(){return this.application}getCanvas(){return this._mode?this.c2d.canvas:this.gl.canvas}getRenderPrecision(){return this._options.precision}addUpdateSourceTexture(e){this._updatingFrame?e._performUpdateSource():this._updateSourceTextures.add(e)}removeUpdateSourceTexture(e){this._updateSourceTextures&&this._updateSourceTextures.delete(e)}hasUpdateSourceTexture(e){return this._updateSourceTextures&&this._updateSourceTextures.has(e)}_performUpdateSource(){this._updateSourceTextures.size&&(this._updateSourceTextures.forEach(e=>{e._performUpdateSource()}),this._updateSourceTextures=new Set)}_calculateDt(){this.startTime=this.currentTime,this.currentTime=this.platform.getHrTime(),this._options.fixedDt?this.dt=this._options.fixedDt:this.dt=this.startTime?.001*(this.currentTime-this.startTime):.02}updateFrame(){this._calculateDt(),this.emit("frameStart"),this._performUpdateSource(),this.emit("update")}idleFrame(){this.textureThrottler.processSome(),this.emit("frameEnd"),this.frameCounter++}onIdle(){this.emit("idle")}renderFrame(){const e=this.ctx.hasRenderUpdates();this.textureThrottler.processSome(),e&&(this._updatingFrame=!0,this.ctx.update(),this.ctx.render(),this._updatingFrame=!1),this.platform.nextFrame(e),this.emit("frameEnd"),this.frameCounter++}isUpdatingFrame(){return this._updatingFrame}drawFrame(){this.updateFrame(),this.renderFrame()}forceRenderUpdate(){this.root&&this.root.core._parent.setHasRenderUpdates(1)}setClearColor(e){this.forceRenderUpdate(),e===null?this._clearColor=null:Array.isArray(e)?this._clearColor=e:this._clearColor=D.getRgbaComponentsNormalized(e)}getClearColor(){return this._clearColor}createElement(e){return e?this.element(e):new se(this)}createShader(e){return ns.create(this,e)}element(e){if(e.isElement)return e;let t;return e.type?t=new e.type(this):t=new se(this),t.patch(e),t}c(e){return this.element(e)}get w(){return this._options.w}get h(){return this._options.h}get coordsWidth(){return this.w/this._options.precision}get coordsHeight(){return this.h/this._options.precision}addMemoryUsage(e){this._usedMemory+=e,e>0&&this._lastGcFrame!==this.frameCounter&&this._usedMemory>this.getOption("memoryPressure")&&(this.gc(!1),this._usedMemory>this.getOption("memoryPressure")-2e6&&this.gc(!0))}get usedMemory(){return this._usedMemory}addVramUsage(e,t){t?this._usedVramAlpha+=e:this._usedVramNonAlpha+=e}get usedVramAlpha(){return this._usedVramAlpha}get usedVramNonAlpha(){return this._usedVramNonAlpha}get usedVram(){return this._usedVramAlpha+this._usedVramNonAlpha}gc(e){if(this._lastGcFrame!==this.frameCounter){this._lastGcFrame=this.frameCounter;const t=this._usedMemory;if(this.gcTextureMemory(e),this.gcRenderTextureMemory(e),this.renderer.gc(e),this.application.getOption("debug")){console.log(`[Lightning] GC${e?"[aggressive]":""}! Frame ${this._lastGcFrame} Freed ${((t-this._usedMemory)/1e6).toFixed(2)}MP from GPU memory. Remaining: ${(this._usedMemory/1e6).toFixed(2)}MP`);const i=this._usedMemory-this.textureManager.usedMemory-this.ctx.usedMemory;console.log(`[Lightning] Textures: ${(this.textureManager.usedMemory/1e6).toFixed(2)}MP, Render Textures: ${(this.ctx.usedMemory/1e6).toFixed(2)}MP, Renderer caches: ${(i/1e6).toFixed(2)}MP`)}}}gcTextureMemory(e=!1){e&&this.ctx.root.visible?(this.ctx.root.visible=!1,this.textureManager.gc(),this.ctx.root.visible=!0):this.textureManager.gc()}gcRenderTextureMemory(e=!1){e&&this.root.visible?(this.root.visible=!1,this.ctx.freeUnusedRenderTextures(0),this.root.visible=!0):this.ctx.freeUnusedRenderTextures(0)}getDrawingCanvas(){return this.platform.getDrawingCanvas()}update(){this.ctx.update()}addServiceProvider(e){w.isSpark&&this.platform.addServiceProvider(e)}getChildrenByPosition(e,t){const i=[];return this.root.core.update(),this.root.core.collectAtCoord(e,t,i),i}}class Lt extends ue{constructor(e={},t){Lt._temp_options=e,Lt.booting=!0;const i=new Qt(e.stage);super(i,t),Lt.booting=!1,this.__updateFocusCounter=0,this.__keypressTimers=new Map,this.__hoveredChild=null,this.stage.init(),this.updateFocusSettings(),this.__keymap=this.getOption("keys"),this.__keymap&&(this.stage.platform.registerKeydownHandler(s=>{this._receiveKeydown(s)}),this.stage.platform.registerKeyupHandler(s=>{this._receiveKeyup(s)})),this.getOption("enablePointer")&&(this.stage.platform.registerClickHandler(s=>{this._receiveClick(s)}),this.stage.platform.registerHoverHandler(s=>{this._receiveHover(s)}),this.stage.platform.registerScrollWheelHandler(s=>{this._recieveScrollWheel(s)}),this.cursor="default")}getOption(e){return this.__options[e]}_setOptions(e){this.__options={};let t=(i,s)=>{let n=e[i];n===void 0?this.__options[i]=s:this.__options[i]=n};t("debug",!1),t("keys",{38:"Up",40:"Down",37:"Left",39:"Right",13:"Enter",8:"Back",27:"Exit"}),t("enablePointer",!1)}__construct(){this.stage.setApplication(this),this._setOptions(Lt._temp_options),delete Lt._temp_options,super.__construct()}__init(){super.__init(),this.__updateFocus()}updateFocusPath(){this.__updateFocus()}__updateFocus(){const e=this.__updateFocusRec();!Lt.booting&&e&&this.updateFocusSettings()}__updateFocusRec(){const e=++this.__updateFocusCounter;this.__updateFocusId=e;const t=this.__getFocusPath(),i=t[t.length-1],s=this._focusPath?this._focusPath[this._focusPath.length-1]:void 0;if(s){let n=Math.min(this._focusPath.length,t.length),o;for(o=0;o<n&&this._focusPath[o]===t[o];o++);if(this._focusPath.length!==t.length||o!==t.length){this.getOption("debug")&&console.log("[Lightning] Focus changed: "+i.getLocationString());for(let a=this._focusPath.length-1;a>=o;a--)if(this._focusPath.pop()._unfocus(i,s),this.__updateFocusId!==e)return!1;for(let a=o,l=t.length;a<l;a++)if(this._focusPath.push(t[a]),this._focusPath[a]._focus(i,s),this.__updateFocusId!==e)return!1;for(let a=0;a<o;a++)this._focusPath[a]._focusChange(i,s)}}else{this._focusPath=[];for(let n=0,o=t.length;n<o;n++)if(this._focusPath.push(t[n]),this._focusPath[n]._focus(i,void 0),this.__updateFocusId!==e)return!1;return!0}return!0}updateFocusSettings(){const e=this._focusPath[this._focusPath.length-1],t={},i=ue.prototype._setFocusSettings;for(let n=0,o=this._focusPath.length;n<o;n++)this._focusPath[n]._setFocusSettings!==i&&this._focusPath[n]._setFocusSettings(t);const s=ue.prototype._handleFocusSettings;for(let n=0,o=this._focusPath.length;n<o;n++)this._focusPath[n]._handleFocusSettings!==s&&this._focusPath[n]._handleFocusSettings(t,this.__prevFocusSettings,e);this.__prevFocusSettings=t}_handleFocusSettings(e,t,i,s){}__getFocusPath(){const e=[this];let t=this;do{const i=t._getFocused();if(!i||i===t)break;let s=i.cparent;if(s===t)e.push(i);else{const n=[i];do s||t._throwError("Return value for _getFocused must be an attached descendant component but its '"+i.getLocationString()+"'"),n.push(s),s=s.cparent;while(s!==t);for(let o=0,a=n.length;o<a;o++)e.push(n[a-o-1])}t=i}while(!0);return e}get focusPath(){return this._focusPath}focusTopDownEvent(e,...t){const i=this.focusPath,s=i.length;for(let n=0;n<s;n++){const o=i[n]._getMostSpecificHandledMember(e);if(o!==void 0&&i[n][o](...t)!==!1)return!0}return!1}focusBottomUpEvent(e,...t){const i=this.focusPath,s=i.length;for(let n=s-1;n>=0;n--){const o=i[n]._getMostSpecificHandledMember(e);if(o!==void 0&&i[n][o](...t)!==!1)return!0}return!1}_receiveKeydown(e){const t=e,i=this.__keymap[e.keyCode],s=this.focusPath;let n;if(i&&(n=Array.isArray(i)?i:[i]),n)for(let a=0,l=n.length;a<l;a++){const h=this.__keypressTimers.has(n[a]);if(s[s.length-1].longpress&&h)return;this.stage.application.focusTopDownEvent([`_capture${n[a]}`,"_captureKey"],t)||this.stage.application.focusBottomUpEvent([`_handle${n[a]}`,"_handleKey"],t)}else this.stage.application.focusTopDownEvent(["_captureKey"],t)||this.stage.application.focusBottomUpEvent(["_handleKey"],t);this.updateFocusPath();const o=s[s.length-1];if(n&&o.longpress)for(let a=0,l=n.length;a<l;a++)this._startLongpressTimer(n[a],o)}_receiveKeyup(e){const t=e,i=this.__keymap[e.keyCode];let s;if(i&&(s=Array.isArray(i)?i:[i]),s)for(let n=0,o=s.length;n<o;n++)this.stage.application.focusTopDownEvent([`_capture${s[n]}Release`,"_captureKeyRelease"],t)||this.stage.application.focusBottomUpEvent([`_handle${s[n]}Release`,"_handleKeyRelease"],t);else this.stage.application.focusTopDownEvent(["_captureKeyRelease"],t)||this.stage.application.focusBottomUpEvent(["_handleKeyRelease"],t);if(this.updateFocusPath(),s)for(let n=0,o=s.length;n<o;n++)this.__keypressTimers.has(s[n])&&(clearTimeout(this.__keypressTimers.get(s[n])),this.__keypressTimers.delete(s[n]))}_startLongpressTimer(e,t){const i=t.longpress,s=e.toLowerCase();if(i[s]){const n=i[s];w.isNumber(n)?this.__keypressTimers.set(e,setTimeout(()=>{this.stage.application.focusTopDownEvent([`_capture${e}Long`,"_captureKey"],{})||this.stage.application.focusBottomUpEvent([`_handle${e}Long`,"_handleKey"],{}),this.__keypressTimers.delete(e)},n||500)):t._throwError("config value for longpress must be a number")}}_recieveScrollWheel(e){const t=e,{clientX:i,clientY:s}=t;i<=this.stage.w&&s<=this.stage.h&&(this.fireTopDownScrollWheelHandler("_captureScroll",t)||this.fireBottomUpScrollWheelHandler("_handleScroll",t))}fireTopDownScrollWheelHandler(e,t){let i=this.stage.application.children,s=this._findChildren([],i).reverse(),n=s.length;for(;n--;){const o=s[n];if(o&&o[e])return o._captureScroll(t),!0}return!1}fireBottomUpScrollWheelHandler(e,t){const{clientX:i,clientY:s}=t;let o=this._getTargetChild(i,s);for(;o!==null;){if(o&&o[e])return o._handleScroll(t),!0;o=o.parent}return!1}_receiveClick(e){const t=e,{clientX:i,clientY:s}=t;i<=this.stage.w&&s<=this.stage.h&&this.stage.application.fireBottomUpClickHandler(t)}fireBottomUpClickHandler(e){const{clientX:t,clientY:i}=e,s=this._getTargetChild(t,i),n=this.stage.getRenderPrecision()/this.stage.getOption("devicePixelRatio");let o=s;for(;o!==null;){if(o&&o._handleClick){const{px:a,py:l}=o.core._worldContext,h=a*n,u=l*n,f={x:t-h,y:i-u};if(o._handleClick(s,f)!==!1)break}o=o.parent}}_receiveHover(e){const t=e,{clientX:i,clientY:s}=t;i<=this.stage.w&&s<=this.stage.h&&this.stage.application.fireBottomUpHoverHandler(t)}fireBottomUpHoverHandler(e){const{clientX:t,clientY:i}=e,s=this._getTargetChild(t,i);if(s!==this.__hoveredChild){let n=new Set,o=new Set;if(s&&(o=new Set(s.getAncestors())),this.__hoveredChild){n=new Set(this.__hoveredChild.getAncestors());for(const h of[...n].filter(u=>!o.has(u))){const u=ue.getComponent(h);u._handleUnhover&&u._handleUnhover(h),h.parent&&h.parent.cursor&&(this.stage.getCanvas().style.cursor=h.parent.cursor)}}this.__hoveredChild=s;const a=[...o].filter(h=>!n.has(h));for(const h of a){const u=ue.getComponent(h);u._handleHover&&u._handleHover(h)}const l=a[0];if(l&&l.cursor&&(this.stage.getCanvas().style.cursor=l.cursor),a.length===0&&s){const h=ue.getComponent(s);h._handleHover&&h._handleHover(s)}}}_getTargetChild(e,t){let i=this.stage.application.children,s=this._findChildren([],i),n=this._withinClickableRange(s,e,t);return n.sort((o,a)=>o.zIndex>a.zIndex?1:o.zIndex<a.zIndex?-1:o.id>a.id?1:-1),n.length?n.slice(-1)[0]:null}_findChildren(e,t){let i=t.length;for(;i--;){const s=t[i];s.__active&&s.collision&&(s.collision===!0&&e.push(s),s.hasChildren()&&this._findChildren(e,s.children))}return e}_withinClickableRange(e,t,i){let s=e.length;const n=[];for(;s--;){const o=e[s],a=this.stage.getRenderPrecision()/this.stage.getOption("devicePixelRatio"),l=o.core._worldContext,h=l.px*a,u=l.py*a,f=o.finalW*l.ta*a,c=o.finalH*l.td*a;if(!(h>this.stage.w||u>this.stage.h)){if(o.parent.core._scissor){const p=o.parent.core._scissor.map(_=>_*a);if(!this._testCollision(t,i,...p))continue}this._testCollision(t,i,h,u,f,c)&&n.push(o)}}return n}_testCollision(e,t,i,s,n,o){return e>=i&&e<=i+n&&t>=s&&t<=s+o}destroy(){this._destroyed||(this._destroy(),this.stage.destroy(),this._destroyed=!0)}_destroy(){if(this.stage.setApplication(void 0),this._updateAttachedFlag(),this._updateEnabledFlag(),this.__keypressTimers.size){for(const e of this.__keypressTimers.values())clearTimeout(e);this.__keypressTimers.clear()}}getCanvas(){return this.stage.getCanvas()}}class ml extends Oe{constructor(e){super(e),this._factory=void 0,this._lookupId=void 0}set content({factory:e,lookupId:t=void 0}){this._factory=e,this._lookupId=t,this._changed()}_getIsValid(){return!!this._factory}_getLookupId(){return this._lookupId}_getSourceLoader(){const e=this._factory;return t=>e((i,s)=>{if(i)return t(i);t(null,this.stage.platform.getTextureOptionsForDrawingCanvas(s))},this.stage)}}class Yi{static getCanvasTexture(e,t){return{type:ml,content:{factory:e,lookupId:t}}}static getRoundRect(e,t,i,s,n,o,a){Array.isArray(i)||(i=[i,i,i,i]);let l=(u,f)=>{w.isSpark?f.platform.createRoundRect(u,f,e,t,i,s,n,o,a):u(null,this.createRoundRect(f,e,t,i,s,n,o,a))},h="rect"+[e,t,s,n,o?1:0,a].concat(i).join(",");return Yi.getCanvasTexture(l,h)}static createRoundRect(e,t,i,s,n,o,a,l){a===void 0&&(a=!0),n===void 0&&(n=0);let h=e.platform.getDrawingCanvas(),u=h.getContext("2d");u.imageSmoothingEnabled=!0,h.width=t+n+2,h.height=i+n+2,u.beginPath();let f=.5*n+1,c=.5*n+1;return u.moveTo(f+s[0],c),u.lineTo(f+t-s[1],c),u.arcTo(f+t,c,f+t,c+s[1],s[1]),u.lineTo(f+t,c+i-s[2]),u.arcTo(f+t,c+i,f+t-s[2],c+i,s[2]),u.lineTo(f+s[3],c+i),u.arcTo(f,c+i,f,c+i-s[3],s[3]),u.lineTo(f,c+s[0]),u.arcTo(f,c,f+s[0],c,s[0]),u.closePath(),a&&(w.isNumber(l)?u.fillStyle=D.getRgbaString(l):u.fillStyle="white",u.fill()),n&&(w.isNumber(o)?u.strokeStyle=D.getRgbaString(o):u.strokeStyle="white",u.lineWidth=n,u.stroke()),h}static getShadowRect(e,t,i=0,s=5,n=s*2){Array.isArray(i)||(i=[i,i,i,i]);let o=(l,h)=>{w.isSpark?h.platform.createShadowRect(l,h,e,t,i,s,n):l(null,this.createShadowRect(h,e,t,i,s,n))},a="shadow"+[e,t,s,n].concat(i).join(",");return Yi.getCanvasTexture(o,a)}static createShadowRect(e,t,i,s,n,o){let a=e.platform.getDrawingCanvas(),l=a.getContext("2d");l.imageSmoothingEnabled=!0,a.width=t+o*2,a.height=i+o*2,l.globalAlpha=.01,l.fillRect(0,0,.01,.01),l.globalAlpha=1,l.shadowColor=D.getRgbaString(4294967295),l.fillStyle=D.getRgbaString(4294967295),l.shadowBlur=n,l.shadowOffsetX=t+10+o,l.shadowOffsetY=o,l.beginPath();const h=-(t+10),u=0;return l.moveTo(h+s[0],u),l.lineTo(h+t-s[1],u),l.arcTo(h+t,u,h+t,u+s[1],s[1]),l.lineTo(h+t,u+i-s[2]),l.arcTo(h+t,u+i,h+t-s[2],u+i,s[2]),l.lineTo(h+s[3],u+i),l.arcTo(h,u+i,h,u+i-s[3],s[3]),l.lineTo(h,u+s[0]),l.arcTo(h,u,h+s[0],u,s[0]),l.closePath(),l.fill(),a}static getSvgTexture(e,t,i){let s=(o,a)=>{w.isSpark?a.platform.createSvg(o,a,e,t,i):this.createSvg(o,a,e,t,i)},n="svg"+[t,i,e].join(",");return Yi.getCanvasTexture(s,n)}static createSvg(e,t,i,s,n){let o=t.platform.getDrawingCanvas(),a=o.getContext("2d");a.imageSmoothingEnabled=!0;let l=new Image;l.onload=()=>{o.width=s,o.height=n,a.drawImage(l,0,0,o.width,o.height),e(null,o)},l.onerror=h=>{e(h)},w.isPS4||(l.crossOrigin="Anonymous"),l.src=i}}class to{static isMf(e){return w.isFunction(e)&&e.__mf}static mf(e){return e.__mf=!0,e}static merge(e,t){const i=Object.keys(e),s=Object.keys(t);if(!s.length)return e;const n={},o={};for(let u=0,f=s.length;u<f;u++){const c=s[u];n[c]=-1,o[c]=u}for(let u=0,f=i.length;u<f;u++){const c=i[u];n[c]=u,o[c]===void 0&&(o[c]=-1)}const a=i.length,l={};for(let u=0,f=s.length;u<f;u++){const c=s[u],p=n[c];let _=p;for(;--_>=0;){const T=i[_];if(o[T]!==-1)break}for(;++_<p;){const T=i[_];l[T]=e[T]}const g=t[c],x=e[c];let m;this.isMf(g)?m=g(x):!w.isObjectLiteral(x)||!w.isObjectLiteral(g)?m=g:m=to.merge(x,g),m!==void 0&&(l[c]=m)}let h=a;for(;--h>=0;){const u=i[h];if(o[u]!==-1)break}for(;++h<a;){const u=i[h];l[u]=e[u]}return l}}class xl extends ll{constructor(e){super(),this._target=e}onAdd(e,t){this._target.addAt(e,t)}onRemove(e,t){this._target.removeAt(t)}onSync(e,t,i){this._target._setByArray(i)}onSet(e,t){this._target.setAt(e,t)}onMove(e,t,i){this._target.setAt(e,i)}createItem(e){return this._target.createItem(e)}isItem(e){return this._target.isItem(e)}}class yl extends xl{constructor(e,t){super(e),this._wrap=t}wrap(e){let t=this._wrap(e);return e._wrapper=t,t}onAdd(e,t){e=this.wrap(e),super.onAdd(e,t)}onRemove(e,t){super.onRemove(e,t)}onSync(e,t,i){t.forEach(s=>this.wrap(s)),i=i.map(s=>s._wrapper),super.onSync(e,t,i)}onSet(e,t){e=this.wrap(e),super.onSet(e,t)}onMove(e,t,i){super.onMove(e,t,i)}}class Tl extends Oe{_getLookupId(){return"__noise"}_getSourceLoader(){const e=this.stage.gl;return function(t){const i=new Uint8Array(65536);for(let n=0;n<128*128*4;n+=4){const o=Math.floor(Math.random()*256);i[n]=o,i[n+1]=o,i[n+2]=o,i[n+3]=255}const s={};e&&(s[e.TEXTURE_WRAP_S]=e.REPEAT,s[e.TEXTURE_WRAP_T]=e.REPEAT,s[e.TEXTURE_MIN_FILTER]=e.NEAREST,s[e.TEXTURE_MAG_FILTER]=e.NEAREST),t(null,{source:i,w:128,h:128,texParams:s})}}}class io extends Oe{constructor(e){super(e),this._htmlElement=void 0,this._scale=1}set htmlElement(e){this._htmlElement=e,this._changed()}get htmlElement(){return this._htmlElement}set scale(e){this._scale=e,this._changed()}get scale(){return this._scale}set html(e){if(!e)this.htmlElement=void 0;else{const t=document.createElement("div");t.innerHTML="<div>"+e+"</div>",this.htmlElement=t.firstElementChild}}get html(){return this._htmlElement.innerHTML}_getIsValid(){return this.htmlElement}_getLookupId(){return this._scale+":"+this._htmlElement.innerHTML}_getSourceLoader(){const e=this._htmlElement,t=this._scale;return function(i){if(!window.html2canvas)return i(new Error("Please include html2canvas (https://html2canvas.hertzen.com/)"));const s=io.getPreloadArea();s.appendChild(e),html2canvas(e,{backgroundColor:null,scale:t}).then(function(n){if(s.removeChild(e),n.height===0)return i(new Error("Canvas height is 0"));i(null,{source:n,width:n.width,height:n.height})}).catch(n=>{console.error("[Lightning]",n)})}}static getPreloadArea(){return this._preloadArea||(this._preloadArea=document.createElement("div"),this._preloadArea.attachShadow&&this._preloadArea.attachShadow({mode:"closed"}),this._preloadArea.style.opacity=0,this._preloadArea.style.pointerEvents="none",this._preloadArea.style.position="fixed",this._preloadArea.style.display="block",this._preloadArea.style.top="100vh",this._preloadArea.style.overflow="hidden",document.body.appendChild(this._preloadArea)),this._preloadArea}}class Yf extends Oe{constructor(e,t){super(e),this._options=t}set options(e){this._options!==e&&(this._options=e,this._changed())}get options(){return this._options}_getIsValid(){return!!this._options}_getSourceLoader(){return e=>{e(null,this._options)}}}class jf extends ue{constructor(e){super(e),this._wrapper=super._children.a({}),this._reloadVisibleElements=!1,this._visibleItems=new Set,this._index=0,this._started=!1,this._scrollTransitionSettings=this.stage.transitions.createSettings({}),this._itemSize=100,this._viewportScrollOffset=0,this._itemScrollOffset=0,this._roll=!1,this._rollMin=0,this._rollMax=0,this._progressAnimation=null,this._invertDirection=!1,this._horizontal=!0,this.itemList=new Kf(this)}_allowChildrenAccess(){return!1}get items(){return this.itemList.get()}set items(e){this.itemList.patch(e)}start(){this._wrapper.transition(this.property,this._scrollTransitionSettings),this._scrollTransition=this._wrapper.transition(this.property),this._scrollTransition.on("progress",e=>this.update()),this.setIndex(0,!0,!0),this._started=!0,this.update()}setIndex(e,t=!1,i=!1){let s=this.length;if(!s)return;if(this.emit("unfocus",this.getElement(this.realIndex),this._index,this.realIndex),i){let a=w.getModuloIndex(e,s),l=w.getModuloIndex(this.index,s),h=a-l;h>.5*s?h-=s:h<-.5*s&&(h+=s),this._index+=h}else this._index=e;(this._roll||this.viewportSize>this._itemSize*s)&&(this._index=w.getModuloIndex(this._index,s));let n=this._horizontal^this._invertDirection?-1:1,o=n*this._index*this._itemSize;if(this._roll){let a,l,h;if(n==1)l=(s-1)*this._itemSize,h=this._viewportScrollOffset*this.viewportSize-this._itemScrollOffset*this._itemSize,l-=h,a=this.viewportSize-(this._itemSize+h),this._rollMin&&(a-=this._rollMin),this._rollMax&&(l+=this._rollMax),o=Math.max(Math.min(o,l),a);else{l=s*this._itemSize-this.viewportSize,h=this._viewportScrollOffset*this.viewportSize-this._itemScrollOffset*this._itemSize,l+=h;let u=h;this._rollMin&&(u-=this._rollMin),this._rollMax&&(l+=this._rollMax),o=Math.min(Math.max(-l,o),-u)}}this._scrollTransition.start(o),t&&this._scrollTransition.finish(),this.emit("focus",this.getElement(this.realIndex),this._index,this.realIndex)}getAxisPosition(){let e=-this._scrollTransition._targetValue,i=-(this._horizontal^this._invertDirection?-1:1)*this._index*this._itemSize;return this._viewportScrollOffset*this.viewportSize+(i-e)}update(){if(!this._started)return;let e=this.length;if(!e)return;let t=this._horizontal^this._invertDirection?-1:1,i=this._horizontal?this._wrapper.x:this._wrapper.y,s=this.viewportSize,n=this._viewportScrollOffset*s-this._itemScrollOffset*this._itemSize;i+=n;let o,a,l,h;t==-1?(o=Math.floor(-i/this._itemSize),l=1-(-i/this._itemSize-o),a=Math.floor((s-i)/this._itemSize),h=(s-i)/this._itemSize-a):(o=Math.ceil(i/this._itemSize),l=1+i/this._itemSize-o,a=Math.ceil((i-s)/this._itemSize),h=a-(i-s)/this._itemSize),(this._roll||s>this._itemSize*e)&&(a>=e&&(a=e-1,h=1),o>=e&&(o=e-1,l=1),a<=-1&&(a=0,h=1),o<=-1&&(o=0,l=1));let u=-t*o*this._itemSize,f;for(let p=o;t==-1?p<=a:p>=a;t==-1?p++:p--){let _=w.getModuloIndex(p,e),g=this.getElement(_);f=g.parent,this._visibleItems.delete(f),this._horizontal?f.x=u+n:f.y=u+n;let x=f.visible;if(f.visible=!0,(!x||this._reloadVisibleElements)&&this.emit("visible",p,_),this._progressAnimation){let m=1;p==o?m=l:p==a&&(m=h),this._progressAnimation.apply(g,m)}u+=this._itemSize}let c=this;this._visibleItems.forEach(function(p){p.visible=!1,c._visibleItems.delete(p)});for(let p=o;t==-1?p<=a:p>=a;t==-1?p++:p--){let _=w.getModuloIndex(p,e);this._visibleItems.add(this.getWrapper(_))}this._reloadVisibleElements=!1}setPrevious(){this.setIndex(this._index-1)}setNext(){this.setIndex(this._index+1)}getWrapper(e){return this._wrapper.children[e]}getElement(e){let t=this._wrapper.children[e];return t?t.children[0]:null}reload(){this._reloadVisibleElements=!0,this.update()}get element(){let e=this._wrapper.children[this.realIndex];return e?e.children[0]:null}get length(){return this._wrapper.children.length}get property(){return this._horizontal?"x":"y"}get viewportSize(){return this._horizontal?this.w:this.h}get index(){return this._index}get realIndex(){return w.getModuloIndex(this._index,this.length)}get itemSize(){return this._itemSize}set itemSize(e){this._itemSize=e,this.update()}get viewportScrollOffset(){return this._viewportScrollOffset}set viewportScrollOffset(e){this._viewportScrollOffset=e,this.update()}get itemScrollOffset(){return this._itemScrollOffset}set itemScrollOffset(e){this._itemScrollOffset=e,this.update()}get scrollTransitionSettings(){return this._scrollTransitionSettings}set scrollTransitionSettings(e){this._scrollTransitionSettings.patch(e)}set scrollTransition(e){this._scrollTransitionSettings.patch(e)}get scrollTransition(){return this._scrollTransition}get progressAnimation(){return this._progressAnimation}set progressAnimation(e){w.isObjectLiteral(e)?this._progressAnimation=this.stage.animations.createSettings(e):this._progressAnimation=e,this.update()}get roll(){return this._roll}set roll(e){this._roll=e,this.update()}get rollMin(){return this._rollMin}set rollMin(e){this._rollMin=e,this.update()}get rollMax(){return this._rollMax}set rollMax(e){this._rollMax=e,this.update()}get invertDirection(){return this._invertDirection}set invertDirection(e){this._started||(this._invertDirection=e)}get horizontal(){return this._horizontal}set horizontal(e){e!==this._horizontal&&(this._started||(this._horizontal=e))}}class Kf extends yl{constructor(e){let t=i=>{let s=i.stage.createElement();return s.add(i),s.visible=!1,s};super(e._wrapper._children,t),this.list=e}onAdd(e,t){super.onAdd(e,t),this.checkStarted(t)}checkStarted(e){this.list._reloadVisibleElements=!0,this.list._started?(this.list.length===1?this.list.setIndex(0,!0,!0):this.list._index>=this.list.length&&this.list.setIndex(0),this.list.update()):this.list.start()}onRemove(e,t){super.onRemove(e,t);let i=this.list.realIndex;i===t?(i===this.list.length&&i--,i>=0&&this.list.setIndex(i)):i>t&&this.list.setIndex(i-1),this.list._reloadVisibleElements=!0}onSet(e,t){super.onSet(e,t),this.checkStarted(t)}onSync(e,t,i){super.onSync(e,t,i),this.checkStarted(0)}get _signalProxy(){return!0}}class Or extends ee{constructor(e){super(e),this._direction=new Float32Array([1,0]),this._kernelRadius=1}get x(){return this._direction[0]}set x(e){this._direction[0]=e,this.redraw()}get y(){return this._direction[1]}set y(e){this._direction[1]=e,this.redraw()}get kernelRadius(){return this._kernelRadius}set kernelRadius(e){this._kernelRadius=e,this.redraw()}useDefault(){return this._kernelRadius===0}setupUniforms(e){super.setupUniforms(e),this._setUniform("direction",this._direction,this.gl.uniform2fv),this._setUniform("kernelRadius",this._kernelRadius,this.gl.uniform1i);const t=e.getRenderWidth(),i=e.getRenderHeight();this._setUniform("resolution",new Float32Array([t,i]),this.gl.uniform2fv)}}Or.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    uniform vec2 resolution;
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform vec2 direction;
    uniform int kernelRadius;
    
    vec4 blur1(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
        vec4 color = vec4(0.0);
        vec2 off1 = vec2(1.3333333333333333) * direction;
        color += texture2D(image, uv) * 0.29411764705882354;
        color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;
        color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;
        return color; 
    }
    
    vec4 blur2(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
        vec4 color = vec4(0.0);
        vec2 off1 = vec2(1.3846153846) * direction;
        vec2 off2 = vec2(3.2307692308) * direction;
        color += texture2D(image, uv) * 0.2270270270;
        color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
        color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
        color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
        color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
        return color;
    }
    
    vec4 blur3(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
        vec4 color = vec4(0.0);
        vec2 off1 = vec2(1.411764705882353) * direction;
        vec2 off2 = vec2(3.2941176470588234) * direction;
        vec2 off3 = vec2(5.176470588235294) * direction;
        color += texture2D(image, uv) * 0.1964825501511404;
        color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;
        color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;
        color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;
        color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;
        color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;
        color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;
        return color;
    }    

    void main(void){
        if (kernelRadius == 1) {
            gl_FragColor = blur1(uSampler, vTextureCoord, resolution, direction) * vColor;
        } else if (kernelRadius == 2) {
            gl_FragColor = blur2(uSampler, vTextureCoord, resolution, direction) * vColor;
        } else {
            gl_FragColor = blur3(uSampler, vTextureCoord, resolution, direction) * vColor;
        }
    }
`;class Ve extends ee{setupUniforms(e){super.setupUniforms(e);const t=1/e.getTextureWidth(0),i=1/e.getTextureHeight(0);this._setUniform("stepTextureCoord",new Float32Array([t,i]),this.gl.uniform2fv)}}Ve.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    uniform vec2 stepTextureCoord;
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec4 vColor;
    varying vec2 vTextureCoordUl;
    varying vec2 vTextureCoordUr;
    varying vec2 vTextureCoordBl;
    varying vec2 vTextureCoordBr;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoordUl = aTextureCoord - stepTextureCoord;
        vTextureCoordBr = aTextureCoord + stepTextureCoord;
        vTextureCoordUr = vec2(vTextureCoordBr.x, vTextureCoordUl.y);
        vTextureCoordBl = vec2(vTextureCoordUl.x, vTextureCoordBr.y);
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;Ve.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoordUl;
    varying vec2 vTextureCoordUr;
    varying vec2 vTextureCoordBl;
    varying vec2 vTextureCoordBr;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    void main(void){
        vec4 color = 0.25 * (texture2D(uSampler, vTextureCoordUl) + texture2D(uSampler, vTextureCoordUr) + texture2D(uSampler, vTextureCoordBl) + texture2D(uSampler, vTextureCoordBr));
        gl_FragColor = color * vColor;
    }
`;class Sl extends Mr{constructor(e){super(e),this._kernelRadius=1}get kernelRadius(){return this._kernelRadius}set kernelRadius(e){this._kernelRadius=e,this.redraw()}useDefault(){return this._amount===0}_beforeDrawEl({target:e}){e.ctx.filter="blur("+this._kernelRadius+"px)"}_afterDrawEl({target:e}){e.ctx.filter="none"}}class qf extends ue{static _template(){return{}}get wrap(){return this.tag("Wrap")}set content(e){return this.wrap.content=e}get content(){return this.wrap.content}set padding(e){this.wrap._paddingX=e,this.wrap._paddingY=e,this.wrap._updateBlurSize()}set paddingX(e){this.wrap._paddingX=e,this.wrap._updateBlurSize()}set paddingY(e){this.wrap._paddingY=e,this.wrap._updateBlurSize()}set amount(e){return this.wrap.amount=e}get amount(){return this.wrap.amount}_onResize(){this.wrap.w=this.renderWidth,this.wrap.h=this.renderHeight}get _signalProxy(){return!0}_build(){this.patch({Wrap:{type:this.stage.gl?Zf:xr}})}}class xr extends ue{static _template(){return{forceZIndexContext:!0,rtt:!0,Textwrap:{shader:{type:Sl},Content:{}}}}constructor(e){super(e),this._textwrap=this.sel("Textwrap"),this._wrapper=this.sel("Textwrap>Content"),this._amount=0,this._paddingX=0,this._paddingY=0}static getSpline(){return this._multiSpline||(this._multiSpline=new le,this._multiSpline.parse(!1,{0:0,.25:1.5,.5:5.5,.75:18,1:39})),this._multiSpline}get content(){return this.sel("Textwrap>Content")}set content(e){this.sel("Textwrap>Content").patch(e,!0)}set padding(e){this._paddingX=e,this._paddingY=e,this._updateBlurSize()}set paddingX(e){this._paddingX=e,this._updateBlurSize()}set paddingY(e){this._paddingY=e,this._updateBlurSize()}_updateBlurSize(){let e=this.renderWidth,t=this.renderHeight,i=this._paddingX,s=this._paddingY;this._wrapper.x=i,this._textwrap.x=-i,this._wrapper.y=s,this._textwrap.y=-s,this._textwrap.w=e+i*2,this._textwrap.h=t+s*2}get amount(){return this._amount}set amount(e){this._amount=e,this._textwrap.shader.kernelRadius=xr._amountToKernelRadius(e)}static _amountToKernelRadius(e){return xr.getSpline().getValue(Math.min(1,e*.25))}get _signalProxy(){return!0}}class Zf extends ue{static _template(){const e=function(t,i){if(i._recalc&130){const s=i.w,n=i.h;let o=i;do o=o._children[0],o._element.w=s,o._element.h=n;while(o._children)}};return{Textwrap:{rtt:!0,forceZIndexContext:!0,renderOffscreen:!0,Content:{}},Layers:{L0:{rtt:!0,onUpdate:e,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ve}}},L1:{rtt:!0,onUpdate:e,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ve}}},L2:{rtt:!0,onUpdate:e,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ve}}},L3:{rtt:!0,onUpdate:e,renderOffscreen:!0,visible:!1,Content:{shader:{type:Ve}}}},Result:{shader:{type:bl},visible:!1}}}get _signalProxy(){return!0}constructor(e){super(e),this._textwrap=this.sel("Textwrap"),this._wrapper=this.sel("Textwrap>Content"),this._layers=this.sel("Layers"),this._output=this.sel("Result"),this._amount=0,this._paddingX=0,this._paddingY=0}_buildLayers(){const t=[{x:1,y:0,kernelRadius:1},{x:0,y:1,kernelRadius:1},{x:1.5,y:0,kernelRadius:1},{x:0,y:1.5,kernelRadius:1}].map(i=>ns.create(this.stage,Object.assign({type:Or},i)));this._setLayerTexture(this.getLayerContents(0),this._textwrap.getTexture(),[]),this._setLayerTexture(this.getLayerContents(1),this.getLayer(0).getTexture(),[t[0],t[1]]),this._setLayerTexture(this.getLayerContents(2),this.getLayer(1).getTexture(),[t[0],t[1],t[2],t[3]]),this._setLayerTexture(this.getLayerContents(3),this.getLayer(2).getTexture(),[t[0],t[1],t[2],t[3]])}_setLayerTexture(e,t,i){if(!i.length)e.texture=t;else{const s=i.pop(),n=e.stage.c({rtt:!0,shader:s});this._setLayerTexture(n,t,i),e.childList.add(n)}return e}get content(){return this.sel("Textwrap>Content")}set content(e){this.sel("Textwrap>Content").patch(e,!0)}set padding(e){this._paddingX=e,this._paddingY=e,this._updateBlurSize()}set paddingX(e){this._paddingX=e,this._updateBlurSize()}set paddingY(e){this._paddingY=e,this._updateBlurSize()}getLayer(e){return this._layers.sel("L"+e)}getLayerContents(e){return this.getLayer(e).sel("Content")}_onResize(){this._updateBlurSize()}_updateBlurSize(){let e=this.renderWidth,t=this.renderHeight,i=this._paddingX,s=this._paddingY,n=e+i*2,o=t+s*2;this._textwrap.w=n,this._wrapper.x=i,this.getLayer(0).w=this.getLayerContents(0).w=n/2,this.getLayer(1).w=this.getLayerContents(1).w=n/4,this.getLayer(2).w=this.getLayerContents(2).w=n/8,this.getLayer(3).w=this.getLayerContents(3).w=n/16,this._output.x=-i,this._textwrap.x=-i,this._output.w=n,this._textwrap.h=o,this._wrapper.y=s,this.getLayer(0).h=this.getLayerContents(0).h=o/2,this.getLayer(1).h=this.getLayerContents(1).h=o/4,this.getLayer(2).h=this.getLayerContents(2).h=o/8,this.getLayer(3).h=this.getLayerContents(3).h=o/16,this._output.y=-s,this._textwrap.y=-s,this._output.h=o,this.w=e,this.h=t}set amount(e){this._amount=e,this._update()}get amount(){return this._amount}_update(){let e=Math.min(4,Math.max(0,this._amount));e===0?(this._textwrap.renderToTexture=!1,this._output.shader.otherTextureSource=null,this._output.visible=!1):(this._textwrap.renderToTexture=!0,this._output.visible=!0,this.getLayer(0).visible=e>0,this.getLayer(1).visible=e>1,this.getLayer(2).visible=e>2,this.getLayer(3).visible=e>3,e<=1?(this._output.texture=this._textwrap.getTexture(),this._output.shader.otherTextureSource=this.getLayer(0).getTexture(),this._output.shader.a=e):e<=2?(this._output.texture=this.getLayer(0).getTexture(),this._output.shader.otherTextureSource=this.getLayer(1).getTexture(),this._output.shader.a=e-1):e<=3?(this._output.texture=this.getLayer(1).getTexture(),this._output.shader.otherTextureSource=this.getLayer(2).getTexture(),this._output.shader.a=e-2):e<=4&&(this._output.texture=this.getLayer(2).getTexture(),this._output.shader.otherTextureSource=this.getLayer(3).getTexture(),this._output.shader.a=e-3))}set shader(e){super.shader=e,this.renderToTexture||console.warn("[Lightning] Please enable renderToTexture to use with a shader.")}_firstActive(){this._buildLayers()}}class bl extends ee{constructor(e){super(e),this._a=0,this._otherTextureSource=null}get a(){return this._a}set a(e){this._a=e,this.redraw()}set otherTextureSource(e){this._otherTextureSource=e,this.redraw()}setupUniforms(e){super.setupUniforms(e),this._setUniform("a",this._a,this.gl.uniform1f),this._setUniform("uSampler2",1,this.gl.uniform1i)}beforeDraw(e){let t=this._otherTextureSource?this._otherTextureSource.nativeTexture:null,i=this.gl;i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,t),i.activeTexture(i.TEXTURE0)}}bl.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform sampler2D uSampler2;
    uniform float a;
    void main(void){
        if (a == 1.0) {
            gl_FragColor = texture2D(uSampler2, vTextureCoord) * vColor;
        } else {
            gl_FragColor = ((1.0 - a) * texture2D(uSampler, vTextureCoord) + (a * texture2D(uSampler2, vTextureCoord))) * vColor;
        }
    }
`;class Qf extends ue{static _template(){const e=function(t,i){if(i._recalc&130){const s=i.w,n=i.h;let o=i;do o=o._children[0],o._element.w=s,o._element.h=n;while(o._children)}};return{Textwrap:{rtt:!0,forceZIndexContext:!0,renderOffscreen:!0,BloomBase:{shader:{type:vl},Content:{}}},Layers:{L0:{rtt:!0,onUpdate:e,scale:2,pivot:0,visible:!1,Content:{shader:{type:Ve}}},L1:{rtt:!0,onUpdate:e,scale:4,pivot:0,visible:!1,Content:{shader:{type:Ve}}},L2:{rtt:!0,onUpdate:e,scale:8,pivot:0,visible:!1,Content:{shader:{type:Ve}}},L3:{rtt:!0,onUpdate:e,scale:16,pivot:0,visible:!1,Content:{shader:{type:Ve}}}}}}get _signalProxy(){return!0}constructor(e){super(e),this._textwrap=this.sel("Textwrap"),this._wrapper=this.sel("Textwrap.Content"),this._layers=this.sel("Layers"),this._amount=0,this._paddingX=0,this._paddingY=0}_build(){const t=[{x:1,y:0,kernelRadius:3},{x:0,y:1,kernelRadius:3},{x:1.5,y:0,kernelRadius:3},{x:0,y:1.5,kernelRadius:3}].map(i=>this.stage.createShader(Object.assign({type:Or},i)));this._setLayerTexture(this.getLayerContents(0),this._textwrap.getTexture(),[]),this._setLayerTexture(this.getLayerContents(1),this.getLayer(0).getTexture(),[t[0],t[1]]),this._setLayerTexture(this.getLayerContents(2),this.getLayer(1).getTexture(),[t[0],t[1],t[2],t[3]]),this._setLayerTexture(this.getLayerContents(3),this.getLayer(2).getTexture(),[t[0],t[1],t[2],t[3]])}_setLayerTexture(e,t,i){if(!i.length)e.texture=t;else{const s=i.pop(),n=e.stage.c({rtt:!0,shader:s});this._setLayerTexture(n,t,i),e.childList.add(n)}return e}get content(){return this.sel("Textwrap.Content")}set content(e){this.sel("Textwrap.Content").patch(e)}set padding(e){this._paddingX=e,this._paddingY=e,this._updateBlurSize()}set paddingX(e){this._paddingX=e,this._updateBlurSize()}set paddingY(e){this._paddingY=e,this._updateBlurSize()}getLayer(e){return this._layers.sel("L"+e)}getLayerContents(e){return this.getLayer(e).sel("Content")}_onResize(){this._updateBlurSize()}_updateBlurSize(){let e=this.renderWidth,t=this.renderHeight,i=this._paddingX,s=this._paddingY,n=e+i*2,o=t+s*2;this._textwrap.w=n,this._wrapper.x=i,this.getLayer(0).w=this.getLayerContents(0).w=n/2,this.getLayer(1).w=this.getLayerContents(1).w=n/4,this.getLayer(2).w=this.getLayerContents(2).w=n/8,this.getLayer(3).w=this.getLayerContents(3).w=n/16,this._textwrap.x=-i,this._textwrap.h=o,this._wrapper.y=s,this.getLayer(0).h=this.getLayerContents(0).h=o/2,this.getLayer(1).h=this.getLayerContents(1).h=o/4,this.getLayer(2).h=this.getLayerContents(2).h=o/8,this.getLayer(3).h=this.getLayerContents(3).h=o/16,this._textwrap.y=-s,this.w=e,this.h=t}set amount(e){this._amount=e,this._update()}get amount(){return this._amount}_update(){let e=Math.min(4,Math.max(0,this._amount));e>0&&(this.getLayer(0).visible=e>0,this.getLayer(1).visible=e>1,this.getLayer(2).visible=e>2,this.getLayer(3).visible=e>3)}set shader(e){super.shader=e,this.renderToTexture||console.warn("[Lightning] Please enable renderToTexture to use with a shader.")}_firstActive(){this._build()}}class vl extends ee{}vl.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    void main(void){
        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
        float m = max(max(color.r, color.g), color.b);
        float c = max(0.0, (m - 0.80)) * 5.0;
        color = color * c;
        gl_FragColor = color;
    }
`;class yr extends ue{static _template(){return{ContentWrap:{renderOffscreen:!0,forceZIndexContext:!0,onAfterUpdate:yr._updateDimensions,Content:{}},Scale:{visible:!1}}}constructor(e){super(e),this._smoothScale=1,this._iterations=0}get content(){return this.tag("Content")}set content(e){this.tag("Content").patch(e,!0)}get smoothScale(){return this._smoothScale}set smoothScale(e){if(this._smoothScale!==e){let t=0;for(;e<.5&&t<12;)t++,e=e*2;this.scale=e,this._setIterations(t),this._smoothScale=e}}_setIterations(e){if(this._iterations!==e){const t=this.sel("Scale").childList,i=this.sel("ContentWrap");for(;t.length<e;){const o=t.length===0?i.getTexture():t.last.getTexture();t.a({rtt:!0,renderOffscreen:!0,texture:o})}yr._updateDimensions(this.tag("ContentWrap"),!0);const s=e>0;this.patch({ContentWrap:{renderToTexture:s},Scale:{visible:s}});for(let n=0,o=t.length;n<o;n++)t.getAt(n).patch({visible:n<e,renderOffscreen:n!==e-1});this._iterations=e}}static _updateDimensions(e,t){const i=e.children[0];let s=i.renderWidth,n=i.renderHeight;if(s!==e.w||n!==e.h||t){e.w=s,e.h=n;const o=e.parent.tag("Scale").children;for(let a=0,l=o.length;a<l;a++)s=s*.5,n=n*.5,o[a].w=s,o[a].h=n}}get _signalProxy(){return!0}}class Jf extends ue{static _template(){return{Content:{},Borders:{Top:{rect:!0,visible:!1,mountY:1},Right:{rect:!0,visible:!1},Bottom:{rect:!0,visible:!1},Left:{rect:!0,visible:!1,mountX:1}}}}get _signalProxy(){return!0}constructor(e){super(e),this._borderTop=this.tag("Top"),this._borderRight=this.tag("Right"),this._borderBottom=this.tag("Bottom"),this._borderLeft=this.tag("Left"),this.onAfterUpdate=function(t){const i=t.childList.first;let s=t.core.w||i.renderWidth,n=t.core.h||i.renderHeight;t._borderTop.w=s,t._borderBottom.y=n,t._borderBottom.w=s,t._borderLeft.h=n+t._borderTop.h+t._borderBottom.h,t._borderLeft.y=-t._borderTop.h,t._borderRight.x=s,t._borderRight.h=n+t._borderTop.h+t._borderBottom.h,t._borderRight.y=-t._borderTop.h},this.borderWidth=1}get content(){return this.sel("Content")}set content(e){this.sel("Content").patch(e,!0)}get borderWidth(){return this.borderWidthTop}get borderWidthTop(){return this._borderTop.h}get borderWidthRight(){return this._borderRight.w}get borderWidthBottom(){return this._borderBottom.h}get borderWidthLeft(){return this._borderLeft.w}set borderWidth(e){this.borderWidthTop=e,this.borderWidthRight=e,this.borderWidthBottom=e,this.borderWidthLeft=e}set borderWidthTop(e){this._borderTop.h=e,this._borderTop.visible=e>0}set borderWidthRight(e){this._borderRight.w=e,this._borderRight.visible=e>0}set borderWidthBottom(e){this._borderBottom.h=e,this._borderBottom.visible=e>0}set borderWidthLeft(e){this._borderLeft.w=e,this._borderLeft.visible=e>0}get colorBorder(){return this.colorBorderTop}get colorBorderTop(){return this._borderTop.color}get colorBorderRight(){return this._borderRight.color}get colorBorderBottom(){return this._borderBottom.color}get colorBorderLeft(){return this._borderLeft.color}set colorBorder(e){this.colorBorderTop=e,this.colorBorderRight=e,this.colorBorderBottom=e,this.colorBorderLeft=e}set colorBorderTop(e){this._borderTop.color=e}set colorBorderRight(e){this._borderRight.color=e}set colorBorderBottom(e){this._borderBottom.color=e}set colorBorderLeft(e){this._borderLeft.color=e}get borderTop(){return this._borderTop}set borderTop(e){this.borderTop.patch(e)}get borderRight(){return this._borderRight}set borderRight(e){this.borderRight.patch(e)}get borderBottom(){return this._borderBottom}set borderBottom(e){this.borderBottom.patch(e)}get borderLeft(){return this._borderLeft}set borderLeft(e){this.borderLeft.patch(e)}set borders(e){this.borderTop=e,this.borderLeft=e,this.borderBottom=e,this.borderRight=e}}class so extends ee{constructor(e){super(e),this._amount=1}static getC2d(){return wl}set amount(e){this._amount=e,this.redraw()}get amount(){return this._amount}useDefault(){return this._amount===0}setupUniforms(e){super.setupUniforms(e),this._setUniform("amount",this._amount,this.gl.uniform1f)}}so.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform float amount;
    void main(void){
        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
        float grayness = 0.2 * color.r + 0.6 * color.g + 0.2 * color.b;
        gl_FragColor = vec4(amount * vec3(grayness, grayness, grayness) + (1.0 - amount) * color.rgb, color.a);
    }
`;class wl extends Mr{constructor(e){super(e),this._amount=1}static getWebGL(){return so}set amount(e){this._amount=e,this.redraw()}get amount(){return this._amount}useDefault(){return this._amount===0}_beforeDrawEl({target:e}){e.ctx.filter="grayscale("+this._amount+")"}_afterDrawEl({target:e}){e.ctx.filter="none"}}class ro extends ee{constructor(e){super(e),this._noiseTexture=new Tl(e.stage),this._graining=1/256,this._random=!1}set graining(e){this._graining=e,this.redraw()}set random(e){this._random=e,this.redraw()}setExtraAttribsInBuffer(e){this._noiseTexture.load();let t=e.extraAttribsDataByteOffset/4,i=e.quads.floats,s=e.length;for(let n=0;n<s;n++){let o=e.getElementWidth(n)/this._noiseTexture.getRenderWidth(),a=e.getElementHeight(n)/this._noiseTexture.getRenderHeight(),l=0,h=0;if(this._random){if(l=Math.random(),h=Math.random(),o+=l,a+=h,Math.random()<.5){const u=l;l=o,o=u}if(Math.random()<.5){const u=h;h=a,a=u}}i[t]=l,i[t+1]=h,i[t+2]=o,i[t+3]=h,i[t+4]=o,i[t+5]=a,i[t+6]=l,i[t+7]=a,t+=8}}beforeDraw(e){let t=this.gl;t.vertexAttribPointer(this._attrib("aNoiseTextureCoord"),2,t.FLOAT,!1,8,this.getVertexAttribPointerOffset(e));let i=this._noiseTexture.source.nativeTexture;t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,i),t.activeTexture(t.TEXTURE0)}getExtraAttribBytesPerVertex(){return 8}setupUniforms(e){super.setupUniforms(e),this._setUniform("uNoiseSampler",1,this.gl.uniform1i),this._setUniform("graining",2*this._graining,this.gl.uniform1f)}enableAttribs(){super.enableAttribs(),this.gl.enableVertexAttribArray(this._attrib("aNoiseTextureCoord"))}disableAttribs(){super.disableAttribs(),this.gl.disableVertexAttribArray(this._attrib("aNoiseTextureCoord"))}useDefault(){return this._graining===0}afterDraw(e){this._random&&this.redraw()}}ro.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec2 aNoiseTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec2 vNoiseTextureCoord;
    varying vec4 vColor;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vNoiseTextureCoord = aNoiseTextureCoord;
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;ro.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec2 vNoiseTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform sampler2D uNoiseSampler;
    uniform float graining;
    void main(void){
        vec4 noise = texture2D(uNoiseSampler, vNoiseTextureCoord);
        vec4 color = texture2D(uSampler, vTextureCoord);
        gl_FragColor = (color * vColor) + graining * (noise.r - 0.5);
    }
`;class no extends ee{constructor(e){super(e),this._inputValue=0,this._maxDerivative=.01,this._normalizedValue=0,this._offset=0,this._amount=.1,this._aspectRatio=1,this._offsetX=0,this._offsetY=0,this.buckets=100}get aspectRatio(){return this._aspectRatio}set aspectRatio(e){this._aspectRatio=e,this.redraw()}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this.redraw()}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this.redraw()}set amount(e){this._amount=e,this.redraw()}get amount(){return this._amount}set inputValue(e){this._inputValue=e}get inputValue(){return this._inputValue}set maxDerivative(e){this._maxDerivative=e}get maxDerivative(){return this._maxDerivative}set buckets(e){e>100&&(console.warn("[Lightning] CircularPushShader: supports max 100 buckets"),e=100),this._buckets=e,this._values=new Uint8Array(this._getValues(e)),this.redraw()}get buckets(){return this._buckets}_getValues(e){const t=[];for(let i=0;i<e;i++)t.push(this._inputValue);return t}progress(e){this._offset+=e*this._buckets;const t=Math.floor(this._offset);this._offset-=t,this._shiftBuckets(t),this.redraw()}_shiftBuckets(e){for(let t=this._buckets-1;t>=0;t--){const i=t-e;i<0?(this._normalizedValue=Math.min(this._normalizedValue+this._maxDerivative,Math.max(this._normalizedValue-this._maxDerivative,this._inputValue)),this._values[t]=255*this._normalizedValue):this._values[t]=this._values[i]}}set offset(e){this._offset=e,this.redraw()}setupUniforms(e){super.setupUniforms(e),this._setUniform("aspectRatio",this._aspectRatio,this.gl.uniform1f),this._setUniform("offsetX",this._offsetX,this.gl.uniform1f),this._setUniform("offsetY",this._offsetY,this.gl.uniform1f),this._setUniform("amount",this._amount,this.gl.uniform1f),this._setUniform("offset",this._offset,this.gl.uniform1f),this._setUniform("buckets",this._buckets,this.gl.uniform1f),this._setUniform("uValueSampler",1,this.gl.uniform1i)}useDefault(){return this._amount===0}beforeDraw(e){const t=this.gl;t.activeTexture(t.TEXTURE1),this._valuesTexture?t.bindTexture(t.TEXTURE_2D,this._valuesTexture):(this._valuesTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._valuesTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),w.isNode&&t.pixelStorei(t.UNPACK_FLIP_BLUE_RED,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this._buckets,1,0,t.ALPHA,t.UNSIGNED_BYTE,this._values),t.activeTexture(t.TEXTURE0)}cleanup(){this._valuesTexture&&this.gl.deleteTexture(this._valuesTexture)}}no.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    uniform float offsetX;
    uniform float offsetY;
    uniform float aspectRatio;
    varying vec2 vTextureCoord;
    varying vec2 vPos;
    varying vec4 vColor;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vPos = vTextureCoord * 2.0 - 1.0;
        vPos.y = vPos.y * aspectRatio;
        vPos.y = vPos.y + offsetY;
        vPos.x = vPos.x + offsetX;
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;no.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    varying vec2 vPos;
    uniform float amount;
    uniform float offset;
    uniform float values[100];
    uniform float buckets;
    uniform sampler2D uSampler;
    uniform sampler2D uValueSampler;
    void main(void){
        float l = length(vPos);
        float m = (l * buckets * 0.678 - offset) / buckets;
        float f = texture2D(uValueSampler, vec2(m, 0.0)).a * amount;
        vec2 unit = vPos / l;
        gl_FragColor = texture2D(uSampler, vTextureCoord - f * unit) * vColor;
    }
`;class Cl extends ee{constructor(e){super(e),this._amount=1}set amount(e){this._amount=e,this.redraw()}get amount(){return this._amount}useDefault(){return this._amount===0}setupUniforms(e){super.setupUniforms(e),this._setUniform("amount",this._amount,this.gl.uniform1f)}}Cl.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform float amount;
    void main(void){
        vec4 color = texture2D(uSampler, vTextureCoord);
        color.rgb = color.rgb * (1.0 - amount) + amount * (1.0 * color.a - color.rgb); 
        gl_FragColor = color * vColor;
    }
`;class oo extends ee{constructor(e){super(e),this._width=5,this._col=4294967295,this._color=[1,1,1,1]}set width(e){this._width=e,this.redraw()}get color(){return this._col}set color(e){if(this._col!==e){const t=D.getRgbaComponentsNormalized(e);t[0]=t[0]*t[3],t[1]=t[1]*t[3],t[2]=t[2]*t[3],this._color=t,this.redraw(),this._col=e}}useDefault(){return this._width===0||this._col[3]===0}setupUniforms(e){super.setupUniforms(e);let t=this.gl;this._setUniform("color",new Float32Array(this._color),t.uniform4fv)}enableAttribs(){super.enableAttribs(),this.gl.enableVertexAttribArray(this._attrib("aCorner"))}disableAttribs(){super.disableAttribs(),this.gl.disableVertexAttribArray(this._attrib("aCorner"))}setExtraAttribsInBuffer(e){let t=e.extraAttribsDataByteOffset/4,i=e.quads.floats,s=e.length;for(let n=0;n<s;n++){const o=e.getElementCore(n),a=this._width/o.w,l=a/(1-2*a),h=this._width/o.h,u=h/(1-2*h);i[t]=-l,i[t+1]=-u,i[t+2]=1+l,i[t+3]=-u,i[t+4]=1+l,i[t+5]=1+u,i[t+6]=-l,i[t+7]=1+u,t+=8}}beforeDraw(e){let t=this.gl;t.vertexAttribPointer(this._attrib("aCorner"),2,t.FLOAT,!1,8,this.getVertexAttribPointerOffset(e))}getExtraAttribBytesPerVertex(){return 8}}oo.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    attribute vec2 aCorner;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec2 vCorner;
    varying vec4 vColor;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vCorner = aCorner;
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;oo.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    varying vec2 vCorner;
    uniform vec4 color;
    uniform sampler2D uSampler;
    void main(void){
        vec2 m = min(vCorner, 1.0 - vCorner);
        float value = step(0.0, min(m.x, m.y));
        gl_FragColor = mix(color, texture2D(uSampler, vTextureCoord) * vColor, value);
    }
`;class ao extends ee{constructor(e){super(e),this._size=new Float32Array([4,4])}get x(){return this._size[0]}set x(e){this._size[0]=e,this.redraw()}get y(){return this._size[1]}set y(e){this._size[1]=e,this.redraw()}get size(){return this._size[0]}set size(e){this._size[0]=e,this._size[1]=e,this.redraw()}useDefault(){return this._size[0]===0&&this._size[1]===0}static getWebGLImpl(){return WebGLPixelateShaderImpl}setupUniforms(e){super.setupUniforms(e);let t=this.gl;this._setUniform("size",new Float32Array(this._size),t.uniform2fv)}getExtraAttribBytesPerVertex(){return 8}enableAttribs(){super.enableAttribs(),this.gl.enableVertexAttribArray(this._attrib("aTextureRes"))}disableAttribs(){super.disableAttribs(),this.gl.disableVertexAttribArray(this._attrib("aTextureRes"))}setExtraAttribsInBuffer(e){let t=e.extraAttribsDataByteOffset/4,i=e.quads.floats,s=e.length;for(let n=0;n<s;n++){let o=e.quads.getTextureWidth(e.index+n),a=e.quads.getTextureHeight(e.index+n);i[t]=o,i[t+1]=a,i[t+2]=o,i[t+3]=a,i[t+4]=o,i[t+5]=a,i[t+6]=o,i[t+7]=a,t+=8}}beforeDraw(e){let t=this.gl;t.vertexAttribPointer(this._attrib("aTextureRes"),2,t.FLOAT,!1,this.getExtraAttribBytesPerVertex(),this.getVertexAttribPointerOffset(e))}}ao.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    attribute vec2 aTextureRes;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    varying vec2 vTextureRes;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vColor = aColor;
        vTextureRes = aTextureRes;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;ao.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    varying vec2 vTextureRes;

    uniform vec2 size;
    uniform sampler2D uSampler;
    
    vec2 mapCoord( vec2 coord )
    {
        coord *= vTextureRes.xy;
        return coord;
    }
    
    vec2 unmapCoord( vec2 coord )
    {
        coord /= vTextureRes.xy;
        return coord;
    }
    
    vec2 pixelate(vec2 coord, vec2 size)
    {
        return floor( coord / size ) * size;
    }
    
    void main(void)
    {
        vec2 coord = mapCoord(vTextureCoord);
        coord = pixelate(coord, size);
        coord = unmapCoord(coord);
        gl_FragColor = texture2D(uSampler, coord) * vColor;
    }
`;class lo extends ee{constructor(e){super(e),this._radius=0,this._cutoff=1}set radius(e){this._radius=e,this.redraw()}get radius(){return this._radius}set cutoff(e){this._cutoff=e,this.redraw()}get cutoff(){return this._cutoff}useDefault(){return this._radius===0}setupUniforms(e){super.setupUniforms(e),this._setUniform("radius",2*(this._radius-.5)/e.getRenderWidth(),this.gl.uniform1f),this._setUniform("cutoff",.5*e.getRenderWidth()/this._cutoff,this.gl.uniform1f)}}lo.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec2 pos;
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
        pos = gl_Position.xy;
    }
`;lo.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec2 pos;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform float radius;
    uniform float cutoff;
    void main(void){
        vec4 color = texture2D(uSampler, vTextureCoord);
        float f = max(0.0, min(1.0, 1.0 - (length(pos) - radius) * cutoff));
        gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor * f;
    }
`;class ho extends ee{constructor(e){super(e),this._blend=0,this._radius=[1,1,1,1],this._stroke=0,this._fc=16777215,this._fillColor=this._getNormalizedColor(4294967295),this._strokeColor=this._getNormalizedColor(16777215)}set blend(e){this._blend=Math.min(Math.max(e,0),1)}get blend(){return this._blend}set radius(e){Array.isArray(e)?e.length===2?this._radius=[e[0],e[1],e[0],e[1]]:e.length===3?this._radius=[e[0],e[1],e[2],this._radius[3]]:e.length===4?this._radius=e:this._radius=[e[0],e[0],e[0],e[0]]:this._radius=[e,e,e,e],this.redraw()}get radius(){return this._radius}set topLeft(e){this._radius[0]=e,this.redraw()}get topLeft(){return this._radius[0]}set topRight(e){this._radius[1]=e,this.redraw()}get topRight(){return this._radius[1]}set bottomRight(e){this._radius[2]=e,this.redraw()}get bottomRight(){return this._radius[2]}set bottomLeft(e){this._radius[3]=e,this.redraw()}get bottomLeft(){return this._radius[3]}set strokeColor(e){this._sc=e,this._strokeColor=this._getNormalizedColor(e),this.redraw()}get strokeColor(){return this._sc}set fillColor(e){this._fc=e,this._fillColor=this._getNormalizedColor(e),this.redraw()}get fillColor(){return this._fc}set stroke(e){this._stroke=e,this.redraw()}get stroke(){return this._stroke}_getNormalizedColor(e){const t=D.getRgbaComponentsNormalized(e);return t[0]*=t[3],t[1]*=t[3],t[2]*=t[3],new Float32Array(t)}setupUniforms(e){super.setupUniforms(e);const t=e.shaderOwner,i=this.ctx.stage.getRenderPrecision(),s=this._radius.map(n=>(n+.5)*i);this._setUniform("radius",new Float32Array(s),this.gl.uniform4fv),this._setUniform("alpha",e.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._setUniform("blend",this._blend,this.gl.uniform1f),this._setUniform("strokeColor",this._strokeColor,this.gl.uniform4fv),this._setUniform("fillColor",this._fillColor,this.gl.uniform4fv),this._setUniform("stroke",this._stroke*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([t._w*i,t._h*i]),this.gl.uniform2fv)}}ho.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;

    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec4 vColor;

    void main(void){
        gl_Position = vec4(aVertexPosition.x * projection.x - 1.0, aVertexPosition.y * -abs(projection.y) + 1.0, 0.0, 1.0);
        vTextureCoord = aTextureCoord;
        vColor = aColor;
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;ho.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif

    #define PI 3.14159265359

    varying vec2 vTextureCoord;
    varying vec4 vColor;

    uniform sampler2D uSampler;
    uniform vec2 resolution;
    uniform vec4 radius;
    uniform float stroke;
    uniform vec4 strokeColor;
    uniform vec4 fillColor;
    uniform float alpha;
    uniform float fill;
    uniform float blend;
    
    float boxDist(vec2 p, vec2 size, float radius){
        size -= vec2(radius);
        vec2 d = abs(p) - size;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;
    }
    
    float fillMask(float dist){
        return clamp(-dist, 0.0, 1.0);
    }
    
    float innerBorderMask(float dist, float width){
        float alpha1 = clamp(dist + width, 0.0, 1.0);
        float alpha2 = clamp(dist, 0.0, 1.0);
        return alpha1 - alpha2;
    }

    void main() {
        vec2 halfRes = 0.5 * resolution.xy;
        float r = 0.0;
        if (vTextureCoord.x < 0.5 && vTextureCoord.y < 0.5) {
            r = radius[0];
        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y < 0.5) {
            r = radius[1];
        } else if (vTextureCoord.x >= 0.5 && vTextureCoord.y >= 0.5) {
            r = radius[2];
        } else {
            r = radius[3];
        }
        
        float b = boxDist(vTextureCoord.xy * resolution - halfRes, halfRes - 0.005, r);
        vec4 tex = texture2D(uSampler, vTextureCoord) * vColor;
        vec4 blend = mix(vec4(1.0) * alpha, tex, blend);     
        vec4 layer1 = mix(vec4(0.0), tex * fillColor, fillMask(b));
        gl_FragColor = mix(layer1, blend * strokeColor, innerBorderMask(b + 1.0, stroke));
    }
`;class Rl extends ee{constructor(e){super(e),this._fade=[0,0,0,0]}set top(e){this._fade[0]=e,this.redraw()}get top(){return this._fade[0]}set right(e){this._fade[1]=e,this.redraw()}get right(){return this._fade[1]}set bottom(e){this._fade[2]=e,this.redraw()}get bottom(){return this._fade[2]}set left(e){this._fade[3]=e,this.redraw()}get left(){return this._fade[3]}set fade(e){Array.isArray(e)?e.length===2?this._fade=[e[0],e[1],e[0],e[1]]:e.length===3?this._fade=[e[0],e[1],e[2],this._fade[3]]:e.length===4?this._fade=e:this._fade=[e[0],e[0],e[0],e[0]]:this._fade=[e,e,e,e],this.redraw()}get fade(){return this._fade}setupUniforms(e){super.setupUniforms(e);const t=e.shaderOwner,i=this.ctx.stage.getRenderPrecision(),s=this._fade.map(n=>n*i);this._setUniform("fade",new Float32Array(s),this.gl.uniform4fv),this._setUniform("resolution",new Float32Array([t._w*i,t._h*i]),this.gl.uniform2fv)}}Rl.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform vec2 resolution;
    uniform vec4 fade;
    
    void main() {
        vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
        vec2 halfRes = 0.5 * resolution.xy;
        vec2 point = vTextureCoord.xy * resolution.xy;
        
        vec2 pos1;
        vec2 pos2;
        vec2 d;
        float c;
        float t = 0.0;
             
        if(fade[0] > 0.0) {
            pos1 = vec2(point.x, point.y);
            pos2 = vec2(point.x, point.y + fade[0]);
            d = pos2 - pos1;
            c = dot(pos1, d) / dot(d, d);
            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));
            color = mix(vec4(0.0), color, t);
        }
        
        if(fade[1] > 0.0) {
            vec2 pos1 = vec2(point.x - resolution.x - fade[1], vTextureCoord.y);
            vec2 pos2 = vec2(point.x - resolution.x, vTextureCoord.y);
            d = pos1 - pos2;
            c = dot(pos2, d) / dot(d, d);
            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));
            color = mix(vec4(0.0), color, t);
        }
        
        if(fade[2] > 0.0) {
            vec2 pos1 = vec2(vTextureCoord.x, point.y - resolution.y - fade[2]);
            vec2 pos2 = vec2(vTextureCoord.x, point.y - resolution.y);
            d = pos1 - pos2;
            c = dot(pos2, d) / dot(d, d);
            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));
            color = mix(vec4(0.0), color, t);
        }
        
        if(fade[3] > 0.0) {
            pos1 = vec2(point.x, point.y);
            pos2 = vec2(point.x + fade[3], point.y);
            d = pos2 - pos1;
            c = dot(pos1, d) / dot(d, d);
            t = smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0));
            color = mix(vec4(0.0), color, t);
        }
        
        gl_FragColor = color;
    }
`;class uo extends ee{constructor(e){super(e),this._magnitude=1.3,this._intensity=.7,this._pivot=[.5,.5]}setupUniforms(e){super.setupUniforms(e),this._setUniform("magnitude",this._magnitude,this.gl.uniform1f),this._setUniform("intensity",this._intensity,this.gl.uniform1f),this._setUniform("pivot",new Float32Array(this._pivot),this.gl.uniform2fv),this.redraw()}set pivot(e){Array.isArray(e)?this._pivot=e:this._pivot=[e,e],this.redraw()}get pivotX(){return this._pivot[0]}set pivotX(e){this._pivot[0]=e,this.redraw()}get pivotY(){return this._pivot[1]}set pivotY(e){this._pivot[1]=e,this.redraw()}get intensity(){return this._intensity}set intensity(e){this._intensity=e,this.redraw()}get magnitude(){return this._magnitude}set magnitude(e){this._magnitude=e,this.redraw()}}uo.vertexShaderSource=ee.vertexShaderSource;uo.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;

    uniform float magnitude;
    uniform float intensity;
    uniform vec2 pivot;

    void main() {
        vec2 uv = vTextureCoord.xy - pivot + vec2(0.5);
        uv.x = clamp(uv.x, 0.0, 1.0);
        uv.y = clamp(uv.y, 0.0, 1.0);
   
        uv *=  1.00 - uv.yx;
        float vig = uv.x * uv.y * 25.0 * intensity;
        vig = pow(vig, 0.45 * magnitude);
        vec4 fragColor = vec4(vig) * vColor;
        gl_FragColor = texture2D(uSampler, vTextureCoord) * fragColor;

    }
`;class co extends ee{constructor(e){super(e),this._radius=100,this._width=50,this._period=1,this._angle=.5,this._smooth=.005,this._color=4294967295,this._backgroundColor=4278190080,this._time=Date.now()}set radius(e){this._radius=e,this.redraw()}set width(e){this._width=e,this.redraw()}set period(e){this._period=e,this.redraw()}set angle(e){this._angle=e,this.redraw()}set smooth(e){this._smooth=e,this.redraw()}set color(e){this._color=e,this.redraw()}set backgroundColor(e){this._backgroundColor=e,this.redraw()}setupUniforms(e){super.setupUniforms(e);const t=e.shaderOwner;this._setUniform("iTime",Date.now()-this._time,this.gl.uniform1f);const i=this.ctx.stage.getRenderPrecision();this._setUniform("radius",this._radius*i,this.gl.uniform1f),this._setUniform("width",this._width*i,this.gl.uniform1f),this._setUniform("period",this._period,this.gl.uniform1f),this._setUniform("angle",this._angle,this.gl.uniform1f),this._setUniform("smooth",this._smooth,this.gl.uniform1f),this._setUniform("color",new Float32Array(D.getRgbaComponentsNormalized(this._color)),this.gl.uniform4fv),this._setUniform("backgroundColor",new Float32Array(D.getRgbaComponentsNormalized(this._backgroundColor)),this.gl.uniform4fv),this._setUniform("resolution",new Float32Array([t._w*i,t._h*i]),this.gl.uniform2fv),this.redraw()}}co.vertexShaderSource=ee.vertexShaderSource;co.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;

    uniform float iTime;
    uniform float radius;
    uniform float width;
    uniform float period;
    uniform float angle;
    uniform float smooth;
    uniform vec2 resolution;

    uniform vec4 color;
    uniform vec4 backgroundColor;

    float ratio = resolution.y / resolution.x;

    vec2 transpose_pos(vec2 pos) {
        if (ratio < 1.) {
            float diff = 0.5 - pos.x;
            pos.x = 0.5 - diff / ratio;
        } else {
            float diff = 0.5 - pos.y;
            pos.y = 0.5 - diff * ratio;
        }
        return pos;
    }

    float get_angle(vec2 pos) {
        pos = transpose_pos(pos);
        float a = atan(pos.y - 0.5, pos.x - 0.5);
        a = (1.0+a/3.14159)/2.0;
        
        return a;
    }

    float dist(vec2 pos1, vec2 pos2) {
        pos1 = transpose_pos(pos1);
        return distance(pos1, pos2);
    }

    void main()
    {
        vec2 fragCoord = vTextureCoord;
        vec4 fragColor = vColor;
        
        vec2 st = vTextureCoord;
        float pct = dist(st, vec2(0.5));

        float a = get_angle(st);
        float t = iTime / 1000.0 / period;

        float inner = max((radius - width) / resolution.x, (radius - width) / resolution.y);
        float outer = max(radius / resolution.x, radius / resolution.y);

        float x1 = mod(t, 1.0);
        float x2 = mod(t + angle, 1.0);

        if (x1 < x2) {
            if (a > x1 && a < x2) {
                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));
                fragColor = mix(backgroundColor, color, val);
            } else {
                fragColor = backgroundColor;
            }
        } else {
            if (a < x2) {
                float val = (1.0 - (x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (x2 - a));
                fragColor = mix(backgroundColor, color, val);
            } else if (a > x1) {
                float val = (1.0 - (1.0 + x2 - a) / angle) * smoothstep(0.0, 3. * smooth, (1.0 + x2 - a));
                fragColor = mix(backgroundColor, color, val);
            } else {
                fragColor = backgroundColor;
            }
        }

        float s = smoothstep(inner, inner + smooth + 0.00001, pct) * (1.0 - smoothstep(outer, outer + smooth + 0.00001, pct));
        gl_FragColor = texture2D(uSampler, fragCoord) * vColor * (1. - s * fragColor.a) + fragColor * s;
    }
`;class fo extends ee{constructor(e){super(e),this._x=0,this._y=0,this._w=0,this._h=0,this._radius=0}get x(){return this._x}set x(e){this._x=e,this.redraw()}get y(){return this._y}set y(e){this._y=e,this.redraw()}get w(){return this._w}set w(e){this._w=e,this.redraw()}get h(){return this._h}set h(e){this._h=e,this.redraw()}get radius(){return this._radius}set radius(e){this._radius=e,this.redraw()}setupUniforms(e){super.setupUniforms(e);const t=e.shaderOwner,i=this.ctx.stage.getRenderPrecision();this._setUniform("x",this._x*i,this.gl.uniform1f),this._setUniform("y",this._y*i,this.gl.uniform1f),this._setUniform("w",this._w*i,this.gl.uniform1f),this._setUniform("h",this._h*i,this.gl.uniform1f),this._setUniform("radius",(this._radius+.5)*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([t._w*i,t._h*i]),this.gl.uniform2fv)}useDefault(){return this._x===0&&this._y===0&&this._w===0&&this._h===0}}fo.vertexShaderSource=ee.vertexShaderSource;fo.fragmentShaderSource=`
   #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform float x;
    uniform float y;
    uniform float w;
    uniform float h;
    uniform vec2 resolution;
    uniform float radius;

    float roundBox(vec2 p, vec2 b, float r) {
        float d = length(max(abs(p)-b+r, 0.1))-r;
        return smoothstep(1.0, 0.0, d);
    }

    void main(void){
        vec4 color = texture2D(uSampler, vTextureCoord);
        vec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;
        vec2 size = vec2(w, h) / 2.0;
        float b = roundBox(pos, size, radius);
        gl_FragColor = mix(color, vec4(0.0), b) * vColor;
    }
`;class Al extends ee{constructor(e){super(e),this._pivot=[0,0],this._ic=4294967295,this._normalizedIC=this._getNormalizedColor(this._ic),this._oc=16777215,this._normalizedOC=this._getNormalizedColor(this._oc),this._radius=0}set radiusX(e){this.radius=e}get radiusX(){return this._radius}set radiusY(e){this._radiusY=e,this.redraw()}get radiusY(){return this._radiusY}set radius(e){this._radius=e,this.redraw()}set innerColor(e){this._ic=e,this._normalizedIC=this._getNormalizedColor(e),this.redraw()}get innerColor(){return this._ic}set outerColor(e){this._oc=e,this._normalizedOC=this._getNormalizedColor(e),this.redraw()}set color(e){this.innerColor=e}get color(){return this.innerColor}get outerColor(){return this._ic}set x(e){this._x=e,this.redraw()}set y(e){this._y=e,this.redraw()}set pivot(e){Array.isArray(e)&&e.length===2?this._pivot=e:Array.isArray(e)?this._pivot=[e[0],e[1]||e[0]]:this._pivot=[e,e],this.redraw()}get pivot(){return this._pivot[0]}set pivotY(e){this._pivot[1]=e,this.redraw()}get pivotY(){return this._pivot[1]}set pivotX(e){this._pivot[0]=e,this.redraw()}get pivotX(){return this._pivot[0]}_getNormalizedColor(e){const t=D.getRgbaComponentsNormalized(e);return t[0]*=t[3],t[1]*=t[3],t[2]*=t[3],new Float32Array(t)}setupUniforms(e){super.setupUniforms(e);const t=e.shaderOwner;this._x&&(this._pivot[0]=this._x/t.w),this._y&&(this._pivot[1]=this._y/t.h),this._radius===0&&(this._radius=t.w*.5),this._setUniform("innerColor",this._normalizedIC,this.gl.uniform4fv),this._setUniform("fill",D.getRgbaComponentsNormalized(this._oc)[3],this.gl.uniform1f),this._setUniform("outerColor",this._normalizedOC,this.gl.uniform4fv),this._setUniform("pivot",new Float32Array(this._pivot),this.gl.uniform2fv),this._setUniform("resolution",new Float32Array([t._w,t._h]),this.gl.uniform2fv),this._setUniform("alpha",e.getElementCore(0).renderContext.alpha,this.gl.uniform1f),this._setUniform("radius",this._radius,this.gl.uniform1f),this._setUniform("radiusY",this._radiusY||this._radius,this.gl.uniform1f)}}Al.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    
    #define PI 3.14159265359
    
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform vec2 resolution;
    uniform vec2 pivot;
    uniform vec4 innerColor;
    uniform vec4 outerColor;
    uniform float radius;
    uniform float radiusY;
    uniform float alpha;
    uniform float fill;
    uniform float aspectRatio;
    
    void main() {
        vec2 point = vTextureCoord.xy * resolution;
        vec2 projection = vec2(pivot.x * resolution.x, pivot.y * resolution.y);
        float d = length((point - projection) / vec2(radius * 2.0, radiusY * 2.0));
        vec4 color = mix(texture2D(uSampler, vTextureCoord) * vColor, outerColor * alpha, fill);
        gl_FragColor = mix(innerColor * alpha, color, smoothstep(0.0, 1.0, d));
    }
`;class po extends ee{constructor(e){super(e),this._strength=.5,this._ambient=.5,this._fudge=.4,this._rx=0,this._ry=0,this._z=0,this._pivotX=NaN,this._pivotY=NaN,this._pivotZ=0,this._lightY=0,this._lightZ=0}setupUniforms(e){super.setupUniforms(e);let t=e.shaderOwner,i=t.element,s=isNaN(this._pivotX)?i.pivotX*t.w:this._pivotX,n=isNaN(this._pivotY)?i.pivotY*t.h:this._pivotY,o=t.getRenderTextureCoords(s,n),a=-Math.atan2(t._renderContext.tc,t._renderContext.ta),l=this.gl;this._setUniform("pivot",new Float32Array([o[0],o[1],this._pivotZ]),l.uniform3fv),this._setUniform("rot",new Float32Array([this._rx,this._ry,a]),l.uniform3fv),this._setUniform("z",this._z,l.uniform1f),this._setUniform("lightY",this.lightY,l.uniform1f),this._setUniform("lightZ",this.lightZ,l.uniform1f),this._setUniform("strength",this._strength,l.uniform1f),this._setUniform("ambient",this._ambient,l.uniform1f),this._setUniform("fudge",this._fudge,l.uniform1f)}set strength(e){this._strength=e,this.redraw()}get strength(){return this._strength}set ambient(e){this._ambient=e,this.redraw()}get ambient(){return this._ambient}set fudge(e){this._fudge=e,this.redraw()}get fudge(){return this._fudge}get rx(){return this._rx}set rx(e){this._rx=e,this.redraw()}get ry(){return this._ry}set ry(e){this._ry=e,this.redraw()}get z(){return this._z}set z(e){this._z=e,this.redraw()}get pivotX(){return this._pivotX}set pivotX(e){this._pivotX=e+1,this.redraw()}get pivotY(){return this._pivotY}set pivotY(e){this._pivotY=e+1,this.redraw()}get lightY(){return this._lightY}set lightY(e){this._lightY=e,this.redraw()}get pivotZ(){return this._pivotZ}set pivotZ(e){this._pivotZ=e,this.redraw()}get lightZ(){return this._lightZ}set lightZ(e){this._lightZ=e,this.redraw()}useDefault(){return this._rx===0&&this._ry===0&&this._z===0&&this._strength===0&&this._ambient===1}}po.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec4 vColor;

    uniform float fudge;
    uniform float strength;
    uniform float ambient;
    uniform float z;
    uniform float lightY;
    uniform float lightZ;
    uniform vec3 pivot;
    uniform vec3 rot;
    varying vec3 pos;

    void main(void) {
        pos = vec3(aVertexPosition.xy, z);
        
        pos -= pivot;
        
        // Undo XY rotation
        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), 
                           -sin(rot.z), cos(rot.z));
        pos.xy = iRotXy * pos.xy;
        
        // Perform 3d rotations
        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;
        gl_Position.y = pos.y;
        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;
        
        pos.x = gl_Position.x;
        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;
        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;
        
        // Redo XY rotation
        iRotXy[0][1] = -iRotXy[0][1];
        iRotXy[1][0] = -iRotXy[1][0];
        pos.xy = iRotXy * pos.xy; 

        // Undo translate to pivot position
        pos.xyz += pivot;

        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);
        
        // Set depth perspective
        float perspective = 1.0 + fudge * pos.z;

        pos.z += lightZ * projection.x;

        // Map coords to gl coordinate space.
        // Set z to 0 because we don't want to perform z-clipping
        gl_Position = vec4(pos.xy, 0.0, perspective);

        // Correct light source position.
        pos.y += lightY * abs(projection.y);

        vTextureCoord = aTextureCoord;
        vColor = aColor;
        
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;po.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    varying vec3 pos;
    uniform sampler2D uSampler;
    uniform float ambient;
    uniform float strength;
    void main(void){
        vec4 rgba = texture2D(uSampler, vTextureCoord);
        float d = length(pos);
        float n = 1.0 / max(0.1, d);
        rgba.rgb = rgba.rgb * (strength * n + ambient);
        gl_FragColor = rgba * vColor;
    }
`;class go extends ee{constructor(e){super(e),this._fudge=.2,this._rx=0,this._ry=0,this._z=1}setupUniforms(e){super.setupUniforms(e);const t=e.shaderOwner,i=t.element,s=i.pivotX*t.w,n=i.pivotY*t.h,o=t.getRenderTextureCoords(s,n),a=-Math.atan2(t._renderContext.tc,t._renderContext.ta),l=this.gl;this._setUniform("pivot",new Float32Array([o[0],o[1],0]),l.uniform3fv),this._setUniform("rot",new Float32Array([this._rx,this._ry,a]),l.uniform3fv),this._setUniform("z",this._z,l.uniform1f),this._setUniform("fudge",this._fudge,l.uniform1f)}set fudge(e){this._fudge=e,this.redraw()}get fudge(){return this._fudge}get rx(){return this._rx}set rx(e){this._rx=e,this.redraw()}get ry(){return this._ry}set ry(e){this._ry=e,this.redraw()}get z(){return this._z}set z(e){this._z=e,this.redraw()}useDefault(){return this._rx===0&&this._ry===0&&this._z===0}}go.vertexShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    attribute vec2 aVertexPosition;
    attribute vec2 aTextureCoord;
    attribute vec4 aColor;
    uniform vec2 projection;
    varying vec2 vTextureCoord;
    varying vec4 vColor;

    uniform float z;
    uniform vec3 pivot;
    uniform vec3 rot;
    varying vec3 pos;

    void main(void) {
        pos = vec3(aVertexPosition.xy, z);
        
        pos -= pivot;
        
        // Undo XY rotation
        mat2 iRotXy = mat2( cos(rot.z), sin(rot.z), 
                           -sin(rot.z), cos(rot.z));
        pos.xy = iRotXy * pos.xy;
        
        // Perform 3d rotations
        gl_Position.x = cos(rot.x) * pos.x - sin(rot.x) * pos.z;
        gl_Position.y = pos.y;
        gl_Position.z = sin(rot.x) * pos.x + cos(rot.x) * pos.z;
        
        pos.x = gl_Position.x;
        pos.y = cos(rot.y) * gl_Position.y - sin(rot.y) * gl_Position.z;
        pos.z = sin(rot.y) * gl_Position.y + cos(rot.y) * gl_Position.z;
        
        // Redo XY rotation
        iRotXy[0][1] = -iRotXy[0][1];
        iRotXy[1][0] = -iRotXy[1][0];
        pos.xy = iRotXy * pos.xy; 

        // Undo translate to pivot position
        pos.xyz += pivot;

        pos = vec3(pos.x * projection.x - 1.0, pos.y * -abs(projection.y) + 1.0, pos.z * projection.x);
        
        // Map coords to gl coordinate space.
        // Set z to 0 because we don't want to perform z-clipping
        gl_Position = vec4(pos.xy, 0.0, z);

        vTextureCoord = aTextureCoord;
        vColor = aColor;
        
        gl_Position.y = -sign(projection.y) * gl_Position.y;
    }
`;go.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;

    uniform vec3 rot;
    uniform float fudge;

    void main(void) {
        vec2 coords = vTextureCoord;

        coords.xy -= vec2(0.5);
        coords.y = coords.y + (sign(rot[0]) * 0.5 - coords.x) * sin(rot[0]) * fudge * coords.y;
        coords.x = coords.x + (sign(rot[1]) * 0.5 - coords.y) * sin(rot[1]) * fudge * coords.x;
        coords.xy += vec2(0.5);

        if (coords.x < 0.0 || coords.x > 1.0 || coords.y < 0.0 || coords.y > 1.0) {
            gl_FragColor = vec4(0.0);
        } else {
            gl_FragColor = texture2D(uSampler, coords) * vColor;
        }
    }
`;class _o extends ee{constructor(e){super(e),this._x=0,this._y=0,this._w=0,this._h=0,this._radius=0,this._magnification=.6}get x(){return this._x}set x(e){this._x=e,this.redraw()}get y(){return this._y}set y(e){this._y=e,this.redraw()}get w(){return this._w}set w(e){this._w=e,this.redraw()}get h(){return this._h}set h(e){this._h=e,this.redraw()}get magnification(){return this._magnification}set magnification(e){this._magnification=e,this.redraw()}get radius(){return this._radius}set radius(e){this._radius=e,this.redraw()}setupUniforms(e){super.setupUniforms(e);const t=e.shaderOwner,i=this.ctx.stage.getRenderPrecision();this._setUniform("x",this._x*i,this.gl.uniform1f),this._setUniform("y",this._y*i,this.gl.uniform1f),this._setUniform("w",this._w*i,this.gl.uniform1f),this._setUniform("h",this._h*i,this.gl.uniform1f),this._setUniform("magnification",this._magnification,this.gl.uniform1f),this._setUniform("radius",(this._radius+.5)*i,this.gl.uniform1f),this._setUniform("resolution",new Float32Array([t._w*i,t._h*i]),this.gl.uniform2fv)}useDefault(){return this._w===0&&this._h===0}}_o.vertexShaderSource=ee.vertexShaderSource;_o.fragmentShaderSource=`
	  #ifdef GL_ES
		# ifdef GL_FRAGMENT_PRECISION_HIGH
		precision highp float;
		# else
		precision lowp float;
		# endif
	  #endif

	  varying vec2 vTextureCoord;
	  varying vec4 vColor;
	  uniform sampler2D uSampler;
	  uniform float x;
	  uniform float y;
	  uniform float w;
	  uniform float h;
	  uniform vec2 resolution;
	  uniform float radius;
	  uniform float magnification;
  
	  float roundBox(vec2 p, vec2 b, float r) {
		  float d = length(max(abs(p)-b+r, 0.1))-r;
		  return smoothstep(1.0, 0.0, d);
	  }

	  float inside(vec2 v) {
		vec2 s = step(vec2(0.0, 0.0), v) - step(vec2(1.0, 1.0), v);
		return s.x * s.y;   
      }
  
	  void main(void) {
		vec4 color = texture2D(uSampler, vTextureCoord);
		vec2 pos = vTextureCoord.xy * resolution - vec2(x, y) - vec2(w, h) / 2.0;
		vec2 size = vec2(w, h) / 2.0;
		float b = roundBox(pos, size, radius);
		vec2 pos2 = (vTextureCoord.xy * magnification * resolution + vec2(x, y) * magnification) / resolution;
		gl_FragColor = mix(color, texture2D(uSampler, pos2) * inside(pos2), b) * vColor;
	  }
  `;class os extends ee{constructor(e){super(e),this._period=1,this._stroke=0,this._showDot=!0,this._clockwise=!0,this._bc=4278190080,this._normalizedBC=this._getNormalizedColor(this._bc),this._c=4294967295,this._normalizedC=this._getNormalizedColor(this._c)}set radius(e){e===0&&(e=1),this._radius=e}set stroke(e){this._stroke=Math.abs(e)}get stroke(){return this._stroke}set color(e){this._c=e,this._normalizedC=this._getNormalizedColor(e)}get color(){return this._c}set backgroundColor(e){this._bc=e,this._normalizedBC=this._getNormalizedColor(e)}get backgroundColor(){return this._sc}set showDot(e){this._showDot=e}get showDot(){return this._showDot}set clockwise(e){this._clockwise=e}get clockwise(){return this._clockwise}set period(e){this._period=e}get period(){return this._period}_getNormalizedColor(e){const t=D.getRgbaComponentsNormalized(e);return t[0]*=t[3],t[1]*=t[3],t[2]*=t[3],new Float32Array(t)}setupUniforms(e){super.setupUniforms(e);const t=e.shaderOwner,i=this._radius||t._w/2;this._stroke===0&&(this._stroke=i*.33),this._setUniform("resolution",new Float32Array([t._w,t._h]),this.gl.uniform2fv),this._setUniform("color",this._normalizedC,this.gl.uniform4fv),this._setUniform("backgroundColor",this._normalizedBC,this.gl.uniform4fv),this._setUniform("stroke",this._stroke,this.gl.uniform1f),this._setUniform("radius",i,this.gl.uniform1f),this._setUniform("direction",this._clockwise?-1:1,this.gl.uniform1f),this._setUniform("showDot",!!this._showDot,this.gl.uniform1f),this._setUniform("time",Date.now()-os.spinSync,this.gl.uniform1f),this._setUniform("period",this._period,this.gl.uniform1f),this._setUniform("alpha",e.getElementCore(0).renderContext.alpha,this.gl.uniform1f),(this._sc!==this._bc||this._stroke!==i*.5)&&this.redraw()}}os.spinSync=Date.now();os.fragmentShaderSource=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
    
    #define PI 3.14159265359
    
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    
    uniform sampler2D uSampler;
    uniform vec2 resolution;
    uniform vec4 color;
    uniform vec4 backgroundColor;
    uniform float direction;
    uniform float radius;
    uniform float time;
    uniform float stroke;
    uniform float showDot;
    uniform float period;
    uniform float alpha;
    
    float circleDist(vec2 p, float radius){
        return length(p) - radius;
    }
    
    float fillMask(float dist){
        return clamp(-dist, 0.0, 1.0);
    }
    
    void main() {
        vec2 halfRes = 0.5 * resolution.xy;
        vec2 center = vTextureCoord.xy * resolution - halfRes;
        
        float c = max(-circleDist(center, radius - stroke), circleDist(center, radius));
        float rot = -(time / 1000.0 / period) * 6.0 * direction;
        center *= mat2(cos(rot), sin(rot), -sin(rot), cos(rot));
        
        float a = direction * atan(center.x, center.y) * PI * 0.05 + 0.45;
        
        float strokeRad = stroke * 0.5;
        a = mix(a, max(a, fillMask(circleDist(vec2(center.x, center.y + (radius - strokeRad)), strokeRad))), showDot);
        vec4 base = mix(vec4(0.0), backgroundColor * alpha, fillMask(c));
        gl_FragColor = mix(base, color * alpha, fillMask(c) * a);
    }
`;const me={Application:Lt,Component:ue,Base:xe,Utils:w,StageUtils:D,Element:se,Tools:Yi,Stage:Qt,ElementCore:Ft,ElementTexturizer:nl,Texture:Oe,EventEmitter:ae,shaders:{Grayscale:so,BoxBlur:Ve,Dithering:ro,CircularPush:no,Inversion:Cl,LinearBlur:Or,Outline:oo,Pixelate:ao,RadialFilter:lo,RoundedRectangle:ho,Spinner2:os,FadeOut:Rl,Hole:fo,Vignette:uo,Spinner:co,RadialGradient:Al,Light3d:po,Perspective:go,Magnifier:_o,WebGLShader:Ir,WebGLDefaultShader:ee,C2dShader:Jn,C2dDefaultShader:Mr,c2d:{Grayscale:wl,Blur:Sl}},textures:{RectangleTexture:_l,NoiseTexture:Tl,TextTexture:ot,ImageTexture:In,HtmlTexture:io,StaticTexture:Yf,StaticCanvasTexture:ml,SourceTexture:al},components:{FastBlurComponent:qf,BloomComponent:Qf,SmoothScaleComponent:yr,BorderComponent:Jf,ListComponent:jf},tools:{ObjMerger:to,ObjectListProxy:xl,ObjectListWrapper:yl}};w.isWeb&&(window.lng=me);class Te extends me.shaders.WebGLDefaultShader{set brightness(e){this._brightness=(e-50)/100,this.redraw()}set contrast(e){this._contrast=(e+50)/100,this.redraw()}set gamma(e){this._gamma=(e+50)/100,this.redraw()}setupUniforms(e){super.setupUniforms(e);const t=this.gl;this._setUniform("colorAdjust",[this._brightness||0,this._contrast||1,this._gamma||1],t.uniform3fv)}}Te.before=`
    #ifdef GL_ES
    # ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    # else
    precision lowp float;
    # endif
    #endif
        
    varying vec2 vTextureCoord;
    varying vec4 vColor;
    uniform sampler2D uSampler;
    uniform vec3 colorAdjust;
    
    const mat3 RGBtoOpponentMat = mat3(0.2814, -0.0971, -0.0930, 0.6938, 0.1458,-0.2529, 0.0638, -0.0250, 0.4665);
    const mat3 OpponentToRGBMat = mat3(1.1677, 0.9014, 0.7214, -6.4315, 2.5970, 0.1257, -0.5044, 0.0159, 2.0517);    
`;Te.after=`    
    vec3 brightnessContrast(vec3 value, float brightness, float contrast)
    {
        return (value - 0.5) * contrast + 0.5 + brightness;
    }   
    
    vec3 updateGamma(vec3 value, float param)
    {
        return vec3(pow(abs(value.r), param),pow(abs(value.g), param),pow(abs(value.b), param));
    } 
       
    void main(void){
        vec4 fragColor = texture2D(uSampler, vTextureCoord);        
        vec4 color = filter(fragColor) * vColor;       
        
        vec3 bc = brightnessContrast(color.rgb,colorAdjust[0],colorAdjust[1]);        
        vec3 ga = updateGamma(bc.rgb, colorAdjust[2]);  
              
        gl_FragColor = vec4(ga.rgb, color.a);          
    }    
`;class ed extends Te{}ed.fragmentShaderSource=`
    ${Te.before}    
    vec4 vision(vec4 color)
    {
        vec4 r = vec4( 0.20,  0.99, -0.19, 0.0);
        vec4 g = vec4( 0.16,  0.79,  0.04, 0.0);
        vec4 b = vec4( 0.01, -0.01,  1.00, 0.0);
       
        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);	
    }
    
    vec4 filter( vec4 color )
    {   
        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);
        opponentColor.x -= opponentColor.y * 1.5; 
        vec3 rgbColor = OpponentToRGBMat * opponentColor;
        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));      
    }    
    ${Te.after} 
`;class td extends Te{}td.fragmentShaderSource=`
    ${Te.before}
    vec4 vision(vec4 color)
    {
        vec4 r = vec4( 0.43,  0.72, -0.15, 0.0 );
        vec4 g = vec4( 0.34,  0.57,  0.09, 0.0 );
        vec4 b = vec4(-0.02,  0.03,  1.00, 0.0 );
       
        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);	
    }
       
    vec4 filter( vec4 color )
    {   
        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);
        opponentColor.x -= opponentColor.y * 1.5; 
        vec3 rgbColor = OpponentToRGBMat * opponentColor;
        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));    
    }
    ${Te.after}    
`;class id extends Te{}id.fragmentShaderSource=`
    ${Te.before}    
    vec4 vision(vec4 color)
    {
        vec4 r = vec4( 0.97,  0.11, -0.08, 0.0 );
        vec4 g = vec4( 0.02,  0.82,  0.16, 0.0 );
        vec4 b = vec4(-0.06,  0.88,  0.18, 0.0 );
       
        return vec4(dot(color, r), dot(color, g), dot(color, b), color.a);	
    }   
    
    vec4 filter( vec4 color )
    {   
        vec3 opponentColor = RGBtoOpponentMat * vec3(color.r, color.g, color.b);
        opponentColor.x -= ((3.0 * opponentColor.z) - opponentColor.y) * 0.25;
        vec3 rgbColor = OpponentToRGBMat * opponentColor;
        return vision(vec4(rgbColor.r, rgbColor.g, rgbColor.b, color.a));
    }   
    ${Te.after} 
`;class sd extends Te{}sd.fragmentShaderSource=`
    ${Te.before}
    vec4 filter( vec4 color )
    {
        return color;
    }
    ${Te.after}
`;class rd extends Te{}rd.fragmentShaderSource=`
    ${Te.before}
    vec4 filter( vec4 color )
    {   
        float grey = dot(color.rgb, vec3(0.299, 0.587, 0.114));
        return vec4(vec3(grey, grey, grey), 1.0 ); 
    }
    ${Te.after}
`;function nd(r=[]){const e=[];for(var t=0;t<r.length&&(typeof r[t]=="string"&&!r[t].includes("PAUSE-"));t++)e.push(r[t]);return[e.join(",\b ")].concat(r.slice(t))}function ta(r){return new Promise(e=>{setTimeout(e,r)})}function od(r,e,t="en-US"){const i=window.speechSynthesis;return new Promise((s,n)=>{const o=new SpeechSynthesisUtterance(r);o.lang=t,o.onend=()=>{s()},o.onerror=a=>{n(a)},e.push(o),i.speak(o)})}function On(r,e,t=!0){const i=window.speechSynthesis,s=nd(Array.isArray(r)?r:[r]),n=[],o=[];let a=!0;return{series:(async()=>{try{for(;a&&s.length;){const h=await Promise.resolve(s.shift());if(a){if(typeof h=="string"&&h.includes("PAUSE-")){let u=h.split("PAUSE-")[1]*1e3;isNaN(u)&&(u=0),await ta(u)}else if(typeof h=="string"&&h.length){let f=3;for(;a&&f>0;)try{await od(h,o,e),f=0}catch(c){if(c instanceof SpeechSynthesisErrorEvent)if(c.error==="network")f--,console.warn(`Speech synthesis network error. Retries left: ${f}`),await ta(500*(3-f));else if(c.error==="canceled"||c.error==="interrupted")f=0;else throw new Error(`SpeechSynthesisErrorEvent: ${c.error}`);else throw c}}else if(typeof h=="function"){const u=On(h(),e,!1);n.push(u),await u.series}else if(Array.isArray(h)){const u=On(h,e,!1);n.push(u),await u.series}}else break}}finally{a=!1}})(),get active(){return a},append:h=>{s.push(h)},cancel:()=>{a&&(t&&i.cancel(),n.forEach(h=>{h.cancel()}),a=!1)}}}let Hs;function ad(r,e){return Hs&&Hs.cancel(),Hs=On(r,e),Hs}function Ws(r){return r.ref||r.constructor.name}function ia(r,e,t){var i,s,n,o,a;e==null&&(e=100);function l(){var u=Date.now()-o;u<e&&u>=0?i=setTimeout(l,e-u):(i=null,a=r.apply(n,s),n=s=null)}var h=function(){return n=this,s=arguments,o=Date.now(),i||(i=setTimeout(l,e)),a};return h.clear=function(){i&&(clearTimeout(i),i=null)},h.flush=function(){i&&(a=r.apply(n,s),n=s=null,clearTimeout(i),i=null)},h}let zn,ji=[],At,Un=!1;const ld=3e5;function hd(r=[]){if(!Ke.enabled)return;const e=r.every(n=>!n.loading),t=r.filter(n=>!ji.includes(n));if(zn(),!e){Ke.onFocusChange();return}ji=r.slice(0);let i=[],s=t.reduce((n,o)=>(o.announce?(n.push([Ws(o),"Announce",o.announce]),i.push(o.announce)):o.title&&(n.push([Ws(o),"Title",o.title]),i.push(o.title)),n),[]);if(t.reverse().reduce((n,o)=>(o.announceContext?(n.push([Ws(o),"Context",o.announceContext]),i.push(o.announceContext)):n.push([Ws(o),"No Context",""]),n),s),Ke.debug&&console.table(s),i.length)return Ke.speak(i.reduce((n,o)=>n.concat(o),[]))}function ud(r){if(!Un)return At=ad(r)}const Ke={enabled:!0,debug:!1,cancel:function(){At&&At.cancel()},clearPrevFocus:function(r=0){ji=ji.slice(0,r),zn()},speak:function(r,{append:e=!1,notification:t=!1}={}){return Ke.enabled&&(Ke.onFocusChange.flush(),e&&At&&At.active?At.append(r):(Ke.cancel(),ud(r)),t&&(Un=!0,At.series.finally(()=>{Un=!1,Ke.refresh()}))),At},setupTimers:function({focusDebounce:r=400,focusChangeTimeout:e=ld}={}){Ke.onFocusChange=ia(hd,r),zn=ia(()=>{ji=[]},e)}};Ke.setupTimers();let as,vi,Ot,er,Bn;const ai={set log(r){as=r},set settings(r){vi=r},set ads(r){er=r},set lightning(r){Bn=r},set appInstance(r){Ot=r}};let Tr=(r,e,t)=>{as.info("Sending metric",r,e,t)};const cd={app:["launch","loaded","ready","close"],page:["view","leave"],user:["click","input"],media:["abort","canplay","ended","pause","play","volumechange","waiting","seeking","seeked"]},El=(r,e,t,i,s={})=>{s={params:s,message:e,code:t,visible:i},Tr(r,"error",s)},sa=(r,e,t={})=>e.reduce((i,s)=>(i[s]=(n,o={})=>{o={...t,...n?{name:n}:{},...o},Tr(r,s,o)},i),{error(i,s,n){El(r,i,s,n)},event(i,s){Tr(r,i,s)}}),fd=r=>Object.keys(r).reduce((e,t)=>(t==="media"?e[t]=i=>sa(t,r[t],{url:i}):e[t]=sa(t,r[t]),e),{error:El,event:Tr}),Ll=fd(cd);new Date(new Date-60*5*1e3).toUTCString(),60*30,new Date(new Date-60*20*1e3).toUTCString(),60*45,new Date(new Date-60*10*1e3).toUTCString(),60*60;const dd=(r,e=null,t=null)=>{let i;if(r&&typeof r=="function")try{i=r.apply(t,e)}catch(s){i=s}else i=r;return i!==null&&typeof i=="object"&&i.then&&typeof i.then=="function"?i:new Promise((s,n)=>{i instanceof Error?n(i):s(i)})},ra={abort:"Abort",canplay:"CanPlay",canplaythrough:"CanPlayThrough",durationchange:"DurationChange",emptied:"Emptied",encrypted:"Encrypted",ended:"Ended",error:"Error",interruptbegin:"InterruptBegin",interruptend:"InterruptEnd",loadeddata:"LoadedData",loadedmetadata:"LoadedMetadata",loadstart:"LoadStart",pause:"Pause",play:"Play",playing:"Playing",progress:"Progress",ratechange:"Ratechange",seeked:"Seeked",seeking:"Seeking",stalled:"Stalled",timeupdate:"TimeUpdate",volumechange:"VolumeChange",waiting:"Waiting"},pd=(r,e=()=>{})=>{let t=!1;const i=()=>{t===!1&&(e(),t=!0)};return Object.keys(r).reduce((s,n)=>(typeof r[n]=="function"?s[n]=function(){return i(),r[n].apply(r,arguments)}:typeof Object.getOwnPropertyDescriptor(r,n).get=="function"?s.__defineGetter__(n,function(){return i(),Object.getOwnPropertyDescriptor(r,n).get.apply(r)}):typeof Object.getOwnPropertyDescriptor(r,n).set=="function"?s.__defineSetter__(n,function(){return i(),Object.getOwnPropertyDescriptor(r,n).set.sourceObject[n].apply(r,arguments)}):s[n]=r[n],s),{})};let na=null;const gd=(r,e)=>{clearTimeout(na),na=setTimeout(()=>{r()},e)},_d=()=>class extends Bn.Component{static _template(){return{Video:{alpha:1,visible:!1,pivot:.5,texture:{type:Bn.textures.StaticTexture,options:{}}}}}set videoEl(e){this._videoEl=e}get videoEl(){return this._videoEl}get videoView(){return this.tag("Video")}get videoTexture(){return this.videoView.texture}get isVisible(){return this.videoView.alpha===1&&this.videoView.visible===!0}_init(){this._createVideoTexture()}_createVideoTexture(){const t=this.stage.gl,i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.videoTexture.options={source:i,w:this.videoEl.width,h:this.videoEl.height},this.videoView.w=this.videoEl.width/this.stage.getRenderPrecision(),this.videoView.h=this.videoEl.height/this.stage.getRenderPrecision()}start(){const e=this.stage;this._lastTime=0,this._updateVideoTexture||(this._updateVideoTexture=()=>{if(this.videoTexture.options.source&&this.videoEl.videoWidth&&this.active){const t=e.gl,i=new Date().getTime(),s=this.videoEl.getVideoPlaybackQuality(),n=s?s.totalVideoFrames:this.videoEl.webkitDecodedFrameCount;if(n?this._lastFrame!==n:this._lastTime<i-30){this._lastTime=i,this._lastFrame=n;try{t.bindTexture(t.TEXTURE_2D,this.videoTexture.options.source),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.videoEl),this._lastFrame=this.videoEl.webkitDecodedFrameCount,this.videoView.visible=!0,this.videoTexture.options.w=this.videoEl.width,this.videoTexture.options.h=this.videoEl.height;const a=this.videoView.w/this.videoView.h,l=this.videoEl.width/this.videoEl.height;a>l?(this.videoView.scaleX=l/a,this.videoView.scaleY=1):(this.videoView.scaleY=a/l,this.videoView.scaleX=1)}catch(a){as.error("texImage2d video",a),this.stop()}this.videoTexture.source.forceRenderUpdate()}}}),this._updatingVideoTexture||(e.on("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!0)}stop(){const e=this.stage;if(e.removeListener("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!1,this.videoView.visible=!1,this.videoTexture.options.source){const t=e.gl;t.bindTexture(t.TEXTURE_2D,this.videoTexture.options.source),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)}}position(e,t){this.videoView.patch({x:t,y:e})}size(e,t){this.videoView.patch({w:e,h:t})}show(){this.videoView.alpha=1}hide(){this.videoView.alpha=0}};let Pl=r=>r,F,Et,Wi,Li,kn=1,tt=!1,tr={};const he={adsEnabled:!1,playing:!1,_playingAds:!1,get playingAds(){return this._playingAds},set playingAds(r){this._playingAds!==r&&(this._playingAds=r,Yt(r===!0?"AdStart":"AdEnd"))},skipTime:!1,playAfterSeek:null},on={play(){he.playing=!0},pause(){he.playing=!1},seeked(){he.playAfterSeek===!0&&Il.play(),he.playAfterSeek=null},abort(){Dn()}},je=r=>Math.round(kn*r)+"px",Yt=(r,e)=>{Li&&(Li.fire("$videoPlayer"+r,e,F.currentTime),Li.fire("$videoPlayerEvent",r,e,F.currentTime))},md=(r,e)=>{on[r]&&typeof on[r]=="function"&&on[r].call(null,r,e)};let ir=null,sr=null;const xd=(r,e,t)=>ir&&typeof ir=="function"?ir(r,e,t):new Promise(i=>{r=Pl(r),e.setAttribute("src",r),e.load(),i()}),yd=r=>sr&&typeof sr=="function"?sr(r):new Promise(e=>{r.removeAttribute("src"),r.load(),e()}),Td=()=>{const r=document.getElementsByTagName("video");if(r&&r.length)return r[0];{const e=document.createElement("video"),t=vi.get("platform","width")?vi.get("platform","width"):1920,i=vi.get("platform","height")?vi.get("platform","height"):1080;return e.setAttribute("id","video-player"),e.setAttribute("width",je(t)),e.setAttribute("height",je(i)),e.style.position="absolute",e.style.zIndex="1",e.style.display="none",e.style.visibility="hidden",e.style.top=je(0),e.style.left=je(0),e.style.width=je(t),e.style.height=je(i),document.body.appendChild(e),e}},Sd=()=>{if(!Ot.tag("VideoTexture")){const r=Ot.stage.c({type:_d(),ref:"VideoTexture",zIndex:0,videoEl:F});Ot.childList.addAt(r,0)}return Ot.tag("VideoTexture")},bd=()=>{as.info("VideoPlayer","Registering event listeners"),Object.keys(ra).forEach(r=>{const e=t=>{Wi&&Wi[r]&&typeof Wi[r]=="function"&&Wi[r]({currentTime:F.currentTime}),md(r,{videoElement:F,event:t}),Yt(ra[r],{videoElement:F,event:t})};tr[r]=e,F.addEventListener(r,e)})},Dn=()=>{as.info("VideoPlayer","Deregistering event listeners"),Object.keys(tr).forEach(r=>{F.removeEventListener(r,tr[r])}),tr={}},Il={consumer(r){Li=r},loader(r){ir=r},unloader(r){sr=r},position(r=0,e=0){F.style.left=je(e),F.style.top=je(r),tt===!0&&Et.position(r,e)},size(r=1920,e=1080){F.style.width=je(r),F.style.height=je(e),F.width=parseFloat(F.style.width),F.height=parseFloat(F.style.height),tt===!0&&Et.size(r,e)},area(r=0,e=1920,t=1080,i=0){this.position(r,i),this.size(e-i,t-r)},open(r,e={}){if(this.canInteract)if(Wi=Ll.media(r),this.hide(),Dn(),this.src==r)this.clear().then(this.open(r,e));else{const t={enabled:he.adsEnabled,duration:300};e.videoId&&(t.caid=e.videoId),er.get(t,Li).then(i=>{he.playingAds=!0,i.prerolls().then(()=>{he.playingAds=!1,xd(r,F,e).then(()=>{bd(),this.show(),this.play()}).catch(s=>{Yt("Error",{videoElement:F,event:s}),Yt("error",{videoElement:F,event:s})})})})}},reload(){if(!this.canInteract)return;const r=F.getAttribute("src");this.close(),this.open(r)},close(){er.cancel(),he.playingAds&&(he.playingAds=!1,er.stop(),setTimeout(()=>{this.close()})),this.canInteract&&(this.clear(),this.hide(),Dn())},clear(){if(this.canInteract)return this.pause(),tt===!0&&Et.stop(),yd(F).then(()=>{Yt("Clear",{videoElement:F})})},play(){this.canInteract&&(tt===!0&&Et.start(),dd(F.play,null,F).catch(r=>{Yt("Error",{videoElement:F,event:r}),Yt("error",{videoElement:F,event:r})}))},pause(){this.canInteract&&F.pause()},playPause(){this.canInteract&&(this.playing===!0?this.pause():this.play())},mute(r=!0){this.canInteract&&(F.muted=r)},loop(r=!0){F.loop=r},seek(r){this.canInteract&&this.src&&(he.playAfterSeek===null&&(he.playAfterSeek=!!he.playing),this.pause(),F.currentTime=Math.max(0,Math.min(r,this.duration-.1)))},skip(r){this.canInteract&&this.src&&(he.skipTime=(he.skipTime||F.currentTime)+r,gd(()=>{this.seek(he.skipTime),he.skipTime=!1},300))},show(){this.canInteract&&(tt===!0?Et.show():(F.style.display="block",F.style.visibility="visible"))},hide(){this.canInteract&&(tt===!0?Et.hide():(F.style.display="none",F.style.visibility="hidden"))},enableAds(r=!0){he.adsEnabled=r},get duration(){return F&&(isNaN(F.duration)?1/0:F.duration)},get currentTime(){return F&&F.currentTime},get muted(){return F&&F.muted},get looped(){return F&&F.loop},get src(){return F&&F.getAttribute("src")},get playing(){return he.playing},get playingAds(){return he.playingAds},get canInteract(){return he.playingAds===!1},get top(){return F&&parseFloat(F.style.top)},get left(){return F&&parseFloat(F.style.left)},get bottom(){return F&&parseFloat(F.style.top-F.style.height)},get right(){return F&&parseFloat(F.style.left-F.style.width)},get width(){return F&&parseFloat(F.style.width)},get height(){return F&&parseFloat(F.style.height)},get visible(){return tt===!0?Et.isVisible:F&&F.style.display==="block"},get adsEnabled(){return he.adsEnabled},get _videoEl(){return F},get _consumer(){return Li}},vd=pd(Il,()=>{kn=Ot&&Ot.stage&&Ot.stage.getRenderPrecision()||kn,F=Td(),tt=vi.get("platform","textureMode",!1),tt===!0&&(F.setAttribute("crossorigin","anonymous"),Et=Sd())});let rr,wd=()=>Promise.resolve({prerolls:[],midrolls:[],postrolls:[]});const Vi={active:!1},Cd=(r=[])=>r.reduce((e,t)=>e.then(()=>Rd(t)),Promise.resolve(null)),Rd=r=>new Promise(e=>{if(Vi.active===!1)return Z.info("Ad","Skipping add due to inactive state"),e();const t=document.getElementsByTagName("video")[0];t.style.display="block",t.style.visibility="visible",t.src=Pl(r.url),t.load();let i=null,s;const n=()=>{Object.keys(o).forEach(a=>t.removeEventListener(a,o[a])),e()},o={play(){Z.info("Ad","Play ad",r.url),$e("Play",r),jt(r.callbacks,"defaultImpression")},ended(){$e("Ended",r),jt(r.callbacks,"complete"),n()},timeupdate(){!i&&t.duration&&(i={firstQuartile:t.duration/4,midPoint:t.duration/2,thirdQuartile:t.duration/4*3},Z.info("Ad","Calculated quartiles times",{timeEvents:i})),i&&i.firstQuartile&&t.currentTime>=i.firstQuartile&&($e("FirstQuartile",r),delete i.firstQuartile,jt(r.callbacks,"firstQuartile")),i&&i.midPoint&&t.currentTime>=i.midPoint&&($e("MidPoint",r),delete i.midPoint,jt(r.callbacks,"midPoint")),i&&i.thirdQuartile&&t.currentTime>=i.thirdQuartile&&($e("ThirdQuartile",r),delete i.thirdQuartile,jt(r.callbacks,"thirdQuartile"))},stalled(){$e("Stalled",r),s=setTimeout(()=>{n()},5e3)},canplay(){s&&clearTimeout(s)},error(){$e("Error",r),n()},abort(){n()}};Object.keys(o).forEach(a=>t.addEventListener(a,o[a])),t.play()}),jt=(r,e)=>{if(r&&r[e])return Z.info("Ad","Sending beacon",e,r[e]),r[e].reduce((t,i)=>t.then(()=>fetch(i).then(s=>{s.status===200?$e("Beacon"+e+"Sent"):$e("Beacon"+e+"Failed"+s.status),Promise.resolve(null)}).catch(()=>{Promise.resolve(null)})),Promise.resolve(null));Z.info("Ad","No callback found for "+e)},$e=(r,e)=>{rr&&(rr.fire("$ad"+r,e),rr.fire("$adEvent",r,e))},Ad={get(r,e){return r.enabled===!1?Promise.resolve({prerolls(){return Promise.resolve()}}):(rr=e,new Promise(t=>{Z.info("Ad","Starting session"),wd().then(i=>{Z.info("Ad","API result",i),t({prerolls(){return i.preroll?(Vi.active=!0,$e("PrerollSlotImpression",i),jt(i.preroll.callbacks,"slotImpression"),Cd(i.preroll.ads).then(()=>{$e("PrerollSlotEnd",i),jt(i.preroll.callbacks,"slotEnd"),Vi.active=!1})):Promise.resolve()},midrolls(){return Promise.resolve()},postrolls(){return Promise.resolve()}})})}))},cancel(){Z.info("Ad","Cancel Ad"),Vi.active=!1},stop(){Z.info("Ad","Stop Ad"),Vi.active=!1;const r=document.getElementsByTagName("video")[0];r.pause(),r.removeAttribute("src")}};var an,oa;function Ed(){if(oa)return an;oa=1;var r=function(T){return e(T)&&!t(T)};function e(m){return!!m&&typeof m=="object"}function t(m){var T=Object.prototype.toString.call(m);return T==="[object RegExp]"||T==="[object Date]"||n(m)}var i=typeof Symbol=="function"&&Symbol.for,s=i?Symbol.for("react.element"):60103;function n(m){return m.$$typeof===s}function o(m){return Array.isArray(m)?[]:{}}function a(m,T){return T.clone!==!1&&T.isMergeableObject(m)?g(o(m),m,T):m}function l(m,T,b){return m.concat(T).map(function(S){return a(S,b)})}function h(m,T){if(!T.customMerge)return g;var b=T.customMerge(m);return typeof b=="function"?b:g}function u(m){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(m).filter(function(T){return Object.propertyIsEnumerable.call(m,T)}):[]}function f(m){return Object.keys(m).concat(u(m))}function c(m,T){try{return T in m}catch{return!1}}function p(m,T){return c(m,T)&&!(Object.hasOwnProperty.call(m,T)&&Object.propertyIsEnumerable.call(m,T))}function _(m,T,b){var S={};return b.isMergeableObject(m)&&f(m).forEach(function(R){S[R]=a(m[R],b)}),f(T).forEach(function(R){p(m,R)||(c(m,R)&&b.isMergeableObject(T[R])?S[R]=h(R,b)(m[R],T[R],b):S[R]=a(T[R],b))}),S}function g(m,T,b){b=b||{},b.arrayMerge=b.arrayMerge||l,b.isMergeableObject=b.isMergeableObject||r,b.cloneUnlessOtherwiseSpecified=a;var S=Array.isArray(T),R=Array.isArray(m),A=S===R;return A?S?b.arrayMerge(m,T,b):_(m,T,b):a(T,b)}g.all=function(T,b){if(!Array.isArray(T))throw new Error("first argument should be an array");return T.reduce(function(S,R){return g(S,R,b)},{})};var x=g;return an=x,an}Ed();class Kp extends me.Component{static _template(){return{rect:!0,color:3137370284,h:40,w:100,x:e=>e-50,y:e=>e-50,mount:1,Text:{w:e=>e,h:e=>e,y:5,x:20,text:{fontSize:22,lineHeight:26}}}}_firstActive(){this.tag("Text").text=`APP - v${this.version}
SDK - v${this.sdkVersion}`,this.tag("Text").loadTexture(),this.w=this.tag("Text").renderWidth+40,this.h=this.tag("Text").renderHeight+5}}class qp extends me.Component{static _template(){return{rect:!0,color:4294967295,texture:me.Tools.getRoundRect(80,80,40),h:80,w:80,x:100,y:100,mount:1,Background:{x:3,y:3,texture:me.Tools.getRoundRect(72,72,36),color:4278222848},Counter:{w:e=>e,h:e=>e,y:10,text:{fontSize:32,textAlign:"center"}},Text:{w:e=>e,h:e=>e,y:48,text:{fontSize:15,textAlign:"center",text:"FPS"}}}}_setup(){this.config={log:!1,interval:500,threshold:1,...We.get("platform","showFps")},this.fps=0,this.lastFps=this.fps-this.config.threshold;const e=()=>{this.fps=~~(1/this.stage.dt)};this.stage.on("frameStart",e),this.stage.off("framestart",e),this.interval=setInterval(this.showFps.bind(this),this.config.interval)}_firstActive(){this.showFps()}_detach(){clearInterval(this.interval)}showFps(){if(Math.abs(this.lastFps-this.fps)<=this.config.threshold)return;this.lastFps=this.fps;let e=4278222848;this.fps<=40&&this.fps>20?e=4294944e3:this.fps<=20&&(e=4294901760),this.tag("Background").setSmooth("color",e),this.tag("Counter").text=`${this.fps}`,this.config.log&&Z.info("FPS",this.fps)}}const H={eventListeners:[],timeouts:[],intervals:[],targets:[]},Ld={setTimeout(r,e,...t){const i=setTimeout(()=>{H.timeouts=H.timeouts.filter(s=>s!==i),r.apply(null,t)},e,t);return Z.info("Set Timeout","ID: "+i),H.timeouts.push(i),i},clearTimeout(r){H.timeouts.indexOf(r)>-1?(H.timeouts=H.timeouts.filter(e=>e!==r),Z.info("Clear Timeout","ID: "+r),clearTimeout(r)):Z.error("Clear Timeout","ID "+r+" not found")},clearTimeouts(){H.timeouts.forEach(r=>{this.clearTimeout(r)})},setInterval(r,e,...t){const i=setInterval(()=>{H.intervals.filter(s=>s!==i),r.apply(null,t)},e,t);return Z.info("Set Interval","ID: "+i),H.intervals.push(i),i},clearInterval(r){H.intervals.indexOf(r)>-1?(H.intervals=H.intervals.filter(e=>e!==r),Z.info("Clear Interval","ID: "+r),clearInterval(r)):Z.error("Clear Interval","ID "+r+" not found")},clearIntervals(){H.intervals.forEach(r=>{this.clearInterval(r)})},addEventListener(r,e,t){r.addEventListener(e,t);const i=H.targets.indexOf(r)>-1?H.targets.indexOf(r):H.targets.push(r)-1;H.eventListeners[i]=H.eventListeners[i]||{},H.eventListeners[i][e]=H.eventListeners[i][e]||[],H.eventListeners[i][e].push(t),Z.info("Add eventListener","Target:",r,"Event: "+e,"Handler:",t.toString())},removeEventListener(r,e,t){const i=H.targets.indexOf(r);i>-1&&H.eventListeners[i]&&H.eventListeners[i][e]&&H.eventListeners[i][e].indexOf(t)>-1?(H.eventListeners[i][e]=H.eventListeners[i][e].filter(s=>s!==t),Z.info("Remove eventListener","Target:",r,"Event: "+e,"Handler:",t.toString()),r.removeEventListener(e,t),Object.keys(H.eventListeners[i]).forEach(s=>{H.eventListeners[i][s].length===0&&delete H.eventListeners[i][s]}),Object.keys(H.eventListeners[i]).length===0&&(H.targets.splice(i,1),H.eventListeners.splice(i,1))):Z.error("Remove eventListener","Not found","Target",r,"Event: "+e,"Handler",t.toString())},removeEventListeners(r,e){if(r&&e){const t=H.targets.indexOf(r);t>-1&&H.eventListeners[t][e].forEach(i=>{this.removeEventListener(r,e,i)})}else if(r){const t=H.targets.indexOf(r);t>-1&&Object.keys(H.eventListeners[t]).forEach(i=>{this.removeEventListeners(r,i)})}else Object.keys(H.eventListeners).forEach(t=>{this.removeEventListeners(H.targets[t])})},clear(){this.clearTimeouts(),this.clearIntervals(),this.removeEventListeners(),H.eventListeners=[],H.timeouts=[],H.intervals=[],H.targets=[]}};let Pd;class Zp extends me.textures.ImageTexture{constructor(e){super(e),this._scalingOptions=void 0}set options(e){this.resizeMode=this._scalingOptions=e}_getLookupId(){return`${this._src}-${this._scalingOptions.type}-${this._scalingOptions.w}-${this._scalingOptions.h}`}getNonDefaults(){const e=super.getNonDefaults();return this._src&&(e.src=this._src),e}}const aa=["timeupdate","error","ended","loadeddata","canplay","play","playing","pause","loadstart","seeking","seeked","encrypted"];let Id=r=>r;class Qp extends me.Component{_construct(){this._skipRenderToTexture=!1,this._metrics=null,this._textureMode=We.get("platform","textureMode")||!1,Z.info("Texture mode: "+this._textureMode),console.warn(["The 'MediaPlayer'-plugin in the Lightning-SDK is deprecated and will be removed in future releases.","Please consider using the new 'VideoPlayer'-plugin instead.","https://rdkcentral.github.io/Lightning-SDK/#/plugins/videoplayer"].join(`

`))}static _template(){return{Video:{VideoWrap:{VideoTexture:{visible:!1,pivot:.5,texture:{type:me.textures.StaticTexture,options:{}}}}}}}set skipRenderToTexture(e){this._skipRenderToTexture=e}get textureMode(){return this._textureMode}get videoView(){return this.tag("Video")}_init(){const e=document.getElementsByTagName("video");e&&e.length>0?this.videoEl=e[0]:(this.videoEl=document.createElement("video"),this.videoEl.setAttribute("id","video-player"),this.videoEl.style.position="absolute",this.videoEl.style.zIndex="1",this.videoEl.style.display="none",this.videoEl.setAttribute("width","100%"),this.videoEl.setAttribute("height","100%"),this.videoEl.style.visibility=this.textureMode?"hidden":"visible",document.body.appendChild(this.videoEl)),this.textureMode&&!this._skipRenderToTexture&&this._createVideoTexture(),this.eventHandlers=[]}_registerListeners(){aa.forEach(e=>{const t=i=>{this._metrics&&this._metrics[e]&&typeof this._metrics[e]=="function"&&this._metrics[e]({currentTime:this.videoEl.currentTime}),this.fire(e,{videoElement:this.videoEl,event:i})};this.eventHandlers.push(t),this.videoEl.addEventListener(e,t)})}_deregisterListeners(){Z.info("Deregistering event listeners MediaPlayer"),aa.forEach((e,t)=>{this.videoEl.removeEventListener(e,this.eventHandlers[t])}),this.eventHandlers=[]}_attach(){this._registerListeners()}_detach(){this._deregisterListeners(),this.close()}_createVideoTexture(){const t=this.stage.gl,i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.videoTexture.options={source:i,w:this.videoEl.width,h:this.videoEl.height}}_startUpdatingVideoTexture(){if(this.textureMode&&!this._skipRenderToTexture){const e=this.stage;this._updateVideoTexture||(this._updateVideoTexture=()=>{if(this.videoTexture.options.source&&this.videoEl.videoWidth&&this.active){const t=e.gl,i=new Date().getTime(),s=this.videoEl.webkitDecodedFrameCount;if(s?this._lastFrame!==s:this._lastTime<i-30){this._lastTime=i,this._lastFrame=s;try{t.bindTexture(t.TEXTURE_2D,this.videoTexture.options.source),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.videoEl),this._lastFrame=this.videoEl.webkitDecodedFrameCount,this.videoTextureView.visible=!0,this.videoTexture.options.w=this.videoEl.videoWidth,this.videoTexture.options.h=this.videoEl.videoHeight;const o=this.videoTextureView.w/this.videoTextureView.h,a=this.videoEl.videoWidth/this.videoEl.videoHeight;o>a?(this.videoTextureView.scaleX=a/o,this.videoTextureView.scaleY=1):(this.videoTextureView.scaleY=o/a,this.videoTextureView.scaleX=1)}catch(o){Z.error("texImage2d video",o),this._stopUpdatingVideoTexture(),this.videoTextureView.visible=!1}this.videoTexture.source.forceRenderUpdate()}}}),this._updatingVideoTexture||(e.on("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!0)}}_stopUpdatingVideoTexture(){if(this.textureMode){const e=this.stage;if(e.removeListener("frameStart",this._updateVideoTexture),this._updatingVideoTexture=!1,this.videoTextureView.visible=!1,this.videoTexture.options.source){const t=e.gl;t.bindTexture(t.TEXTURE_2D,this.videoTexture.options.source),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)}}}updateSettings(e={}){this._consumer=e.consumer,this._consumer&&this._consumer.getMediaplayerSettings&&(e=Object.assign(e,this._consumer.getMediaplayerSettings())),me.Utils.equalValues(this._stream,e.stream)||(e.stream&&e.stream.keySystem?navigator.requestMediaKeySystemAccess(e.stream.keySystem.id,e.stream.keySystem.config).then(t=>t.createMediaKeys()).then(t=>this.videoEl.setMediaKeys(t)).then(()=>{e.stream&&e.stream.src&&this.open(e.stream.src)}).catch(()=>{console.error("Failed to set up MediaKeys")}):e.stream&&e.stream.src?We.get("app","hls")?(window.Hls||(window.Hls=class{static isSupported(){return console.warn("hls-light not included"),!1}}),window.Hls.isSupported()&&(this._hls||(this._hls=new window.Hls({liveDurationInfinity:!0})),this._hls.loadSource(e.stream.src),this._hls.attachMedia(this.videoEl),this.videoEl.style.display="block")):this.open(e.stream.src):this.close(),this._stream=e.stream),this._setHide(e.hide),this._setVideoArea(e.videoPos)}_setHide(e){this.textureMode?this.tag("Video").setSmooth("alpha",e?0:1):this.videoEl.style.visibility=e?"hidden":"visible"}open(e,t={hide:!1,videoPosition:null}){if(e=Id(e),this._metrics=Ll.media(e),Z.info("Playing stream",e),this.application.noVideo){Z.info("noVideo option set, so ignoring: "+e);return}this.videoEl.getAttribute("src")===e&&this.close(),this.videoEl.setAttribute("src",e),this.videoEl.style.visibility="hidden",this.videoEl.style.display="none",setTimeout(()=>{this.videoEl.style.display="block",this.videoEl.style.visibility="visible"}),this._setHide(t.hide),this._setVideoArea(t.videoPosition||[0,0,1920,1080])}close(){this.videoEl.pause(),this.videoEl.removeAttribute("src"),this.videoEl.load(),this._clearSrc(),this.videoEl.style.display="none"}playPause(){this.isPlaying()?this.doPause():this.doPlay()}get muted(){return this.videoEl.muted}set muted(e){this.videoEl.muted=e}get loop(){return this.videoEl.loop}set loop(e){this.videoEl.loop=e}isPlaying(){return this._getState()==="Playing"}doPlay(){this.videoEl.play()}doPause(){this.videoEl.pause()}reload(){var e=this.videoEl.getAttribute("src");this.close(),this.videoEl.src=e}getPosition(){return Promise.resolve(this.videoEl.currentTime)}setPosition(e){this.videoEl.currentTime=e}getDuration(){return Promise.resolve(this.videoEl.duration)}seek(e,t=!1){t?this.videoEl.currentTime=e:this.videoEl.currentTime+=e}get videoTextureView(){return this.tag("Video").tag("VideoTexture")}get videoTexture(){return this.videoTextureView.texture}_setVideoArea(e){if(!me.Utils.equalValues(this._videoPos,e))if(this._videoPos=e,this.textureMode)this.videoTextureView.patch({smooth:{x:e[0],y:e[1],w:e[2]-e[0],h:e[3]-e[1]}});else{const t=this.stage.getRenderPrecision();this.videoEl.style.left=Math.round(e[0]*t)+"px",this.videoEl.style.top=Math.round(e[1]*t)+"px",this.videoEl.style.width=Math.round((e[2]-e[0])*t)+"px",this.videoEl.style.height=Math.round((e[3]-e[1])*t)+"px"}}_fireConsumer(e,t){this._consumer&&this._consumer.fire(e,t)}_equalInitData(e,t){if(!e||!t||e.byteLength!=t.byteLength)return!1;const i=new Int8Array(e),s=new Int8Array(t);for(let n=0;n!=e.byteLength;n++)if(i[n]!=s[n])return!1;return!0}error(e){return this._fireConsumer("$mediaplayerError",e),this._setState(""),""}loadeddata(e){this._fireConsumer("$mediaplayerLoadedData",e)}play(e){this._fireConsumer("$mediaplayerPlay",e)}playing(e){this._fireConsumer("$mediaplayerPlaying",e),this._setState("Playing")}canplay(e){this.videoEl.play(),this._fireConsumer("$mediaplayerStart",e)}loadstart(e){this._fireConsumer("$mediaplayerLoad",e)}seeked(){this._fireConsumer("$mediaplayerSeeked",{currentTime:this.videoEl.currentTime,duration:this.videoEl.duration||1})}seeking(){this._fireConsumer("$mediaplayerSeeking",{currentTime:this.videoEl.currentTime,duration:this.videoEl.duration||1})}durationchange(e){this._fireConsumer("$mediaplayerDurationChange",e)}encrypted(e){const t=e.videoElement,i=e.event;t.mediaKeys&&!this._equalInitData(this._previousInitData,i.initData)&&(this._previousInitData=i.initData,this._fireConsumer("$mediaplayerEncrypted",e))}static _states(){return[class extends this{$enter(){this._startUpdatingVideoTexture()}$exit(){this._stopUpdatingVideoTexture()}timeupdate(){this._fireConsumer("$mediaplayerProgress",{currentTime:this.videoEl.currentTime,duration:this.videoEl.duration||1})}ended(t){this._fireConsumer("$mediaplayerEnded",t),this._setState("")}pause(t){this._fireConsumer("$mediaplayerPause",t),this._setState("Playing.Paused")}_clearSrc(){this._fireConsumer("$mediaplayerStop",{}),this._setState("")}static _states(){return[class extends this{}]}}]}}const Sr=/\{\/(.*?)\/([igm]{0,3})\}/g,mo=/^[!*$]$/,la=/\/:\w+?@@([0-9]+?)@@/,ha=/^\/:/,zr=(r,e="R")=>(Sr.test(r)&&(r=r.replace(Sr,e)),r),Md=r=>{const e=new Map;return[...Object.keys(r),...Object.getOwnPropertySymbols(r)].forEach(t=>{e.set(t,r[t])}),e};class Fd{constructor(e="",t,i){this._hash=e,this._storeCaller=i,this._register=new Map,this._isCreated=!1,this._isSharedInstance=!1,this._cancelled=!1,this._copiedHistoryState=null,Xe(t)?this._register=Md(t):Ze(t)&&(this._storeCaller=t),this._register.set(pe.store,this._storeCaller)}cancel(){Z.debug("[router]:",`cancelled ${this._hash}`),this._cancelled=!0}get url(){return this._hash}get register(){return this._register}get hash(){return this._hash}set hash(e){this._hash=e}get route(){return this._route}set route(e){this._route=e}get provider(){return this._provider}set provider(e){this._provider=e}get providerType(){return this._providerType}set providerType(e){this._providerType=e}set page(e){this._page=e}get page(){return this._page}set isCreated(e){this._isCreated=e}get isCreated(){return this._isCreated}get isSharedInstance(){return this._isSharedInstance}set isSharedInstance(e){this._isSharedInstance=e}get isCancelled(){return this._cancelled}set copiedHistoryState(e){this._copiedHistoryState=e}get copiedHistoryState(){return this._copiedHistoryState}}class Od{constructor(e={}){let t=["on","before","after"].reduce((i,s)=>ye(e[s])?s:i,void 0);this._cfg=e,t&&(this._provider={type:t,request:e[t]})}get path(){return this._cfg.path}get name(){return this._cfg.name}get component(){return this._cfg.component}get options(){return this._cfg.options}get widgets(){return this._cfg.widgets}get cache(){return this._cfg.cache}get hook(){return this._cfg.hook}get beforeNavigate(){return this._cfg.beforeNavigate}get provider(){return this._provider}}const xo=r=>zr(r).split("/").length,zd=r=>{const e=[];for(let[t]of lt.entries())xo(t)===r&&e.push(t);return e},Ur=r=>{r=r.replace(/^#/,"");const e=/(\/?:?[^/]+)/g,t=zd(xo(r)),i=r.match(e)||[];let s=[],n=t.filter(o=>{let a=!0;if(Sr.test(o)){const h=o.match(Sr);h&&h.length&&(o=h.reduce((u,f)=>{const c=s.length;return u=u.replace(f,`@@${c}@@`),s.push(f.substring(1,f.length-1)),u},o))}const l=o.match(e)||[];for(let h=0,u=l.length;h<u;h++){const f=l[h],c=i[h];if(la.test(f)){const _=la.exec(f)[1],g=s[_],x=/\/([^\/]+)\/([igm]{0,3})/.exec(g);if(x&&x.length){const m=x[1],T=x[2];new RegExp(`^/${m}$`,T).test(c)||(a=!1)}}else{if(ha.test(f))continue;c&&f.toLowerCase()!==c.toLowerCase()&&(a=!1)}}return a});if(n.length){if(n.indexOf(r)!==-1){const o=n[n.indexOf(r)];return lt.get(o)}else if(n=n.sort(o=>ha.test(o)?-1:1),Dt(n[0]))return lt.get(n[0])}return!1},Ml=(r="",e)=>{e=zr(e,"");const t=/(\/?:?[\w%\s:.-]+)/g,i=r.match(t)||[],s=e.match(t)||[],n=/^\/:([\w-]+)\/?/;return s.reduce((o,a,l)=>{const h=n.exec(a);return h&&h.length&&o.set(h[1],decodeURIComponent(i[l].replace(/^\//,""))),o},new Map)},Br=(r,e)=>{if(r&&r.hasOwnProperty(e))return r[e]},Ud=r=>{if(r.path==="$"){let e={preventStorage:!0};Xe(r.options)&&(e={...r.options,...e}),r.options=e,es&&(r.after=es)}return new Od(r)},Bd=(r,e,t)=>new Fd(r,e,t),kd=r=>{if(!r.to&&!r.name)return!1;const e=Dd(r.to||r.name),t=/\/:([\w-]+)\/?/;let i=e;return t.test(e)&&(r.params&&(i=Object.keys(r.params).reduce((n,o)=>n.replace(`:${o}`,r.params[o]),e)),r.query)?`${i}${up(r.query)}`:i},Dd=r=>{for(let[e,t]of lt.entries())if(t.name===r)return e;return!1},Nd=(r,e)=>{if(ii(r)){const s=ap();if(s.has(r))r=s.get(r);else return!1}const t=e.register,i=r.options;return t.has("keepAlive")?t.get("keepAlive"):i&&i.keepAlive?i.keepAlive:!1},Ii=(r,e=[],t={})=>{bo(e)||(e=[e]),e.forEach(i=>{const s=`_on${jl(i)}`;ye(r[s])&&r[s](t)})};let Jt=null;const $d=()=>{if(ei)return ei.get().reduce((r,e)=>{const t=e.ref.toLowerCase();return r[t]=e,r},{})},Hd=(r,e)=>{const t=(r||[]).map(i=>i.toLowerCase());ei.forEach(i=>{i.visible=t.indexOf(i.ref.toLowerCase())!==-1,i.visible&&Ii(i,["activated"],e)}),re.state==="Widgets"&&Jt&&!Jt.visible&&re._setState("")},Wd=r=>(r=jl(r),ei.getByRef(r)||!1),Vd=r=>{const e=Wd(r);e&&(Xd(e),re.state==="Widgets"?re.reload(Jt):re._setState("Widgets",[Jt]))},ua=()=>{Jt=null,re._setState("")},Fl=()=>Jt,Xd=r=>{Jt=r},Ol=(r,e)=>r.c({type:e,visible:!1,widgets:$d()});let Ee=[];const zl=r=>{const e=Mi();if(!e)return;const i=r.register.get(pe.store),s=Ur(e),n=Br(s.options,"preventStorage");if(Ze(i)?i:!n){const a=e.replace(/^\//,""),l=br(a),h=jd(kt(),r),u=Yl();if(l===-1||u.get("storeSameHash"))Ee.push({hash:a,state:h});else{const f=Ee.splice(l,1)[0];Ee.push({hash:f.hash,state:h})}}},br=r=>{for(let e=0;e<Ee.length;e++)if(Ee[e].hash===r)return e;return-1},Gd=r=>{let e=null;return Ee.length&&(r?br(r)!==-1&&(e=Ee[br(r)].state):e=Ee[Ee.length-1].state),e},Yd=(r=null,e)=>{if(!Ee.length)return;const t=e?br(e):Ee.length-1;t!==-1&&Xe(r)&&(Ee[t].state=r)},jd=(r,e)=>{if(e.isSharedInstance){if(e.copiedHistoryState)return e.copiedHistoryState}else if(r&&ye(r.historyState))return r.historyState();return null},Ul=()=>Ee.slice(0),kr=(r=[])=>{bo(r)&&(Ee=r)};let ca,re,at,Dr,ke,ei,Bl,es,Nn=!0,kl=async(r,e)=>!0,Dl=()=>{},lt=new Map,qe=new Map,Nl=!1,yo=null,$l,vr,Hl,Wl;const Kd=r=>{r.pages&&(at=r.pages.childList),r.widgets&&r.widgets.children&&(ei=r.widgets.childList,ei.forEach(e=>e.visible=!1)),r._handleBack=e=>{nr(-1),e.preventDefault()}},qd=(r,e)=>{let{appInstance:t,routes:i}=r;e&&To(e)&&(re=e),re||(re=t||Pd),ca=re.application,at=ca.childList,Dr=re.stage,ke=hp(),Kd(re),bo(i)?Zd(r):ye(i)&&(console.warn("[Router]: Calling Router.route() directly is deprecated."),console.warn("Use object config: https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration"))},Zd=r=>{Nl||Qd(r),r.routes.forEach(e=>{const t=vo(e.path);if(Dt(t))console.error(`${t} already exists in routes configuration`);else{const i=Ud(e);if(lt.set(t,i),i.component){let s=i.component;So(s)&&(ke.get("lazyCreate")||(s=Ol(Dr,s),at.a(s))),qe.set(t,s)}}})},Qd=r=>{Bl=r.root,ye(r.boot)&&(es=r.boot),Ze(r.updateHash)&&(Nn=r.updateHash),ye(r.beforeEachRoute)&&(kl=r.beforeEachRoute),ye(r.afterEachRoute)&&(Dl=r.afterEachRoute),r.bootComponent&&(console.warn("[Router]: Boot Component is now available as a special router: https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration?id=special-routes"),console.warn("[Router]: setting { bootComponent } property will be deprecated in a future release"),To(r.bootComponent)?r.routes.push({path:"$",component:r.bootComponent,after:es||null,options:{preventStorage:!0}}):console.error(`[Router]: ${r.bootComponent} is not a valid boot component`)),r.routes.forEach(e=>{const t=zr(e.path);if(/.*\/:.*?\?$/u.test(t)){const s=e.path.substring(0,e.path.lastIndexOf("/")),n=e.path.substring(0,e.path.lastIndexOf("?"));e.path=n;let o={...e};o.path=s,r.routes.push(o)}}),Nl=!0},Nr=(r,e)=>{qe.has(r)&&qe.set(r,e)},Vl=r=>qe.has(r)?qe.get(r):null,Jd=r=>{qe.has(r)&&at.getIndex(qe.get(r))!==-1&&(at.remove(qe.get(r)),Nr(r,qe.get(r)._routedType||qe.get(r).constructor))},$n=()=>{if(!ke||!ke.size)return!1;const r=ke.get("updateHash");return!(Ze(r)&&!r||Ze(Nn)&&!Nn)},ep=r=>{const e=r.hash,t=r.route,i=r.register,s=r.page;Br(t.options,"clearHistory")?kr([]):e&&!mo.test(t.path)&&zl(r),Nr(t.path,s),r.isSharedInstance||!r.isCreated?Ii(s,"changed"):r.isCreated&&Ii(s,"mounted"),ei&&Hd(t.widgets,s),kt()&&!r.isSharedInstance&&tp(yo,r),i.get(pe.historyState)&&ye(s.historyState)&&s.historyState(i.get(pe.historyState)),ip(s),$l=r.hash,vr=t.path;for(let n of Fe.values())n.isCancelled&&n.hash&&Fe.delete(n.hash);Dl(r),Z.info("[route]:",t.path),Z.info("[hash]:",e)},tp=(r,e)=>{const t=vr,i=e.register,s=ke.get("lazyDestroy"),n=ke.get("destroyOnHistoryBack"),o=i.get("keepAlive"),a=i.get(pe.backtrack);let l=!1;a&&(n||s)&&(l=!0),s&&!o&&(l=!0),vr===e.route.path&&(l=!0),l?(Nr(t,r._routedType||r.constructor),at.remove(r),ke.get("gcOnUnload")&&Dr.gc()):r.patch({x:0,y:0,scale:1,visible:!1,alpha:1})},Mi=()=>$l,ip=r=>{yo=r},kt=()=>yo,Hn=()=>vr,Xl=()=>Hl,sp=r=>{Hl=r},rp=r=>{Wl=r},np=()=>Wl,Dt=r=>lt.has(r),Gl=()=>Bl,op=()=>es,Yl=()=>ke,ap=()=>lt,ye=r=>typeof r=="function",Xe=r=>typeof r=="object"&&r!==null,Ze=r=>typeof r=="boolean",To=r=>!!(r instanceof me.Element||So(r)),So=r=>r.prototype&&"isComponent"in r.prototype,bo=r=>Array.isArray(r),jl=r=>`${r.charAt(0).toUpperCase()}${r.slice(1)}`,ii=r=>typeof r=="string",lp=r=>{let e;if(ye(r))try{e=r.apply(null)}catch(t){e=t}else e=r;return Xe(e)&&ye(e.then)},vo=(r="")=>r.replace(/^#/,"").replace(/\/+$/,""),hp=()=>{const r=We.get("platform","router"),e=Xe(r);return["backtrack","gcOnUnload","destroyOnHistoryBack","lazyCreate","lazyDestroy","reuseInstance","autoRestoreRemote","numberNavigation","updateHash","storeSameHash"].reduce((t,i)=>(t.set(i,e?r[i]:We.get("platform",i)),t),new Map)},wo=(r=Mi())=>{const e=Ip();(r==="$"||!r)&&e&&ii(e)&&(r=e);let t="";const s=/([?&].*)/.exec(r),n={};if(document.location&&document.location.search&&(t=document.location.search),s&&s.length){let o=s[1];t?(o=o.replace(/^\?/,""),t=`${t}&${o}`):t=o}if(t){const o=new URLSearchParams(t);for(const[a,l]of o.entries())n[a]=l;return n}else return!1},up=r=>Xe(r)?"?"+Object.keys(r).map(e=>`${e}=${r[e]}`).join("&"):"",pe={route:Symbol("route"),hash:Symbol("hash"),store:Symbol("store"),fromHistory:Symbol("fromHistory"),expires:Symbol("expires"),resume:Symbol("resume"),backtrack:Symbol("backtrack"),historyState:Symbol("historyState"),queryParams:Symbol("queryParams")},cp={on:r=>(rp(re.state||""),re._setState("Loading"),ln(r)),before:r=>ln(r),after:r=>{try{ln(r,!0)}catch{}return Promise.resolve()}},ln=(r,e)=>{const t=r.route,i=t.provider,s=t.cache?t.cache*1e3:0,n=Kl(r);return i.request(r.page,{...n}).then(()=>{r.page[pe.expires]=Date.now()+s,e&&Ii(r.page,"dataProvided")}).catch(o=>{throw r.page[pe.expires]=Date.now(),o})},Kl=({page:r,route:e,hash:t,register:i=new Map})=>{const s=Ml(t,e.path),n=wo(t),o=new Map([...s,...i]),a={};for(let[l,h]of o)a[l]=h;if(n&&(a[pe.queryParams]=n),i.size){const l={};for(let[h,u]of i)l[h]=u;r.persist=l}return r.params=a,Ii(r,["urlParams"],a),a},fp=r=>{if(!r[pe.expires])return!1;const e=r[pe.expires];return Date.now()>=e},fa=r=>Dt(r)?!!lt.get(r).provider:!1,dp=r=>{if(Dt(r.path)){const{provider:e}=lt.get(r.path);return{type:e.type,provider:e.request}}},pp=(r,e)=>new Promise(t=>{r.patch({alpha:0,visible:!0,smooth:{alpha:[1,{duration:.5,delay:.1}]}}),r.transition("alpha").on("finish",()=>{e&&(e.visible=!1),t()})}),gp=(r,e)=>new Promise(t=>{r.patch({alpha:0,visible:!0,smooth:{alpha:[1,{duration:.5,delay:.1}]}}),e&&e.patch({smooth:{alpha:[0,{duration:.5,delay:.3}]}}),r.transition("alpha").on("finish",()=>{t()})}),$r=(r,e,t,i)=>{const s=r==="x"?1920:1080;return new Promise(n=>{t.patch({[`${r}`]:e?s*-1:s,visible:!0,smooth:{[`${r}`]:[0,{duration:.4,delay:.2}]}}),i&&i.patch({[`${r}`]:0,smooth:{[`${r}`]:[e?s:s*-1,{duration:.4,delay:.2}]}}),t.transition(r).on("finish",()=>{n()})})},_p=(r,e)=>$r("y",0,r,e),mp=(r,e)=>$r("y",1,r,e),xp=(r,e)=>$r("x",0,r,e),yp=(r,e)=>$r("x",1,r,e),da={fade:pp,crossFade:gp,up:_p,down:mp,left:xp,right:yp},Tp=(r,e=null)=>{const t=r.pageTransition||r.easing,i=!!(r.smoothIn||r.smoothInOut||t),s=Yl().get("disableTransitions");if(r.easing&&console.warn("easing() method is deprecated and will be removed. Use pageTransition()"),!i||s)return r.visible=!0,e&&(e.visible=!1),Promise.resolve();if(t){let n;try{n=t.call(r,r,e)}catch{n="crossFade"}if(lp(n))return n;if(ii(n)){const o=da[n];if(o)return o(r,e)}if(r.smoothIn){const o=(a,l,h={})=>new Promise(u=>{r.visible=!0,r.setSmooth(a,l,h),r.transition(a).on("finish",()=>{u()})});return r.smoothIn({pageIn:r,smooth:o})}}return da.crossFade(r,e)},pa=async r=>{let e=!1;try{if(r=await Sp(r),r&&!r.isCancelled?(re.state==="Loading"&&(np()==="Widgets"?re._setState("Widgets",[Fl()]):re._setState("")),!r.isSharedInstance&&!r.isCancelled&&await Tp(r.page,kt())):e=!0,e||r.isCancelled)Z.debug("[router]:",`Rejected ${r.hash} because route to ${Xl()} started`),r.isCreated&&!r.isSharedInstance&&at.remove(r.page);else return ep(r),r.page}catch(t){if(!t.route)console.error(t);else if(!e){const{route:i}=t;Br(i.options,"clearHistory")?kr([]):mo.test(i.path)||zl(t),t.isCreated&&!t.isSharedInstance&&at.remove(t.page),bp(t)}}},Sp=async r=>{const e=r.route,t=r.hash,i=r.register;let s=Vl(e.path),n=So(s),o=!1;if(!n&&!i.get(pe.backtrack)&&(vp(e)||(s=s.constructor,n=!0)),n)r.page=Ol(Dr,s),at.a(r.page),fa(e.path)&&(o=!0),r.isCreated=!0;else{r.page=s,fa(e.path)&&(fp(s)||s[pe.hash]!==t)&&(o=!0);let a=kt()&&kt()[pe.route];e.path===a&&(r.isSharedInstance=!0,ye(r.page.historyState)&&(r.copiedHistoryState=r.page.historyState()))}r.page[pe.hash]=t,r.page[pe.route]=e.path;try{if(o){const{type:a,provider:l}=dp(e);return r.provider=l,r.providerType=a,await cp[a](r),t!==Xl()?!1:(r.providerType!=="after"&&Ii(r.page,"dataProvided"),r)}else return Kl(r),r}catch(a){return r.error=a,Promise.reject(r)}},bp=r=>{r&&r.error?console.error(r.error):r&&Z.error(r),r.page&&Dt("!")&&ce("!",{request:r},!1)},vp=r=>{const e=Br(r.options,"reuseInstance"),t=ke.get("reuseInstance");return Ze(e)?e:!(Ze(t)&&t===!1)};class wp extends me.Component{static _template(){return{Pages:{forceZIndexContext:!0},Loading:{rect:!0,w:1920,h:1080,color:4278190080,visible:!1,zIndex:99,Label:{mount:.5,x:960,y:540,text:{text:"Loading.."}}}}}static _states(){return[class extends this{$enter(){this.tag("Loading").visible=!0}$exit(){this.tag("Loading").visible=!1}},class extends this{$enter(t,i){this._widget=i,this._refocus()}_getFocused(){return this._widget}reload(t){this._widget=t,this._refocus()}_handleKey(){const t=ke.get("autoRestoreRemote");(!Ze(t)||t===!0)&&ga.focusPage()}}]}get pages(){return this.tag("Pages")}get widgets(){return this.tag("Widgets")}_handleBack(){}_getFocused(){return ga.getActivePage()}}let Fe=new Map,hn="",nt="";const Cp=(r,e)=>{qd(r,e),Fp(),Rp()},Rp=()=>{let r=(Hr()||"").replace(/^#/,"");const e="$",t=wo(r),i=op(),s=Gl(),n=r.indexOf(e)!==-1;mo.test(r)&&r!==e&&(r=""),nt=n?s:r||s;const o=()=>{!r&&s?ii(s)?ce(s):ye(s)&&s().then(a=>{Xe(a)?ce(a.path,a.params):ce(a)}):(wr(r),Cr().then(()=>{re._refocus()}).catch(a=>{console.error(a)}))};if(Dt(e)){if(r&&!n&&!Ur(r)){ce("*",{failedHash:r});return}ce(e,{resume:nt,reload:e===r},!1)}else ye(i)?i(t).then(()=>{o()}).catch(a=>{Ap(a)}):o()},Ap=r=>{Dt("!")?ce("!",{request:{error:r}}):console.error(r)},ce=(r,e={},t)=>{if(Xe(r)&&(r=kd(r),!r))return;let i=Hr();!$n()&&hn&&(i=hn),i.replace(/^#/,"")!==r?(wr(r,e,t),$n()?Mp(r):(hn=r,Cr(r).then(()=>{re._refocus()}).catch(s=>{console.error(s)}))):e.reload&&(wr(r,e,t),Cr(r).then(()=>{re._refocus()}).catch(s=>{console.error(s)}))},wr=(r,e={},t)=>{if(r=vo(r),!Fe.has(r)){for(let s of Fe.values())s.cancel();const i=Bd(r,e,t);return Fe.set(decodeURIComponent(r),i),i}return!1},Cr=async r=>{const e=vo(r||Hr()),t=decodeURIComponent(e);let i=Fe.get(t);!i&&!Fe.size&&(i=wr(e));const s=Ur(e);if(!s){Dt("*")?ce("*",{failedHash:e}):console.error(`Unable to navigate to: ${e}`);return}i.hash=e,i.route=s;let n=await kl(Mi(),i);if(n&&s.beforeNavigate&&(n=await s.beforeNavigate(Mi(),i)),Ze(n)){if(n)return Ep(i)}else if(i.cancel(),Fe.delete(t),ii(n))ce(n);else if(Xe(n)){let o=!0;Ze(n.store)&&(o=n.store),ce(n.path,n.params,o)}},Ep=r=>{const e=r.hash,t=r.route,i=decodeURIComponent(e);if(sp(e),t.path){const s=Vl(t.path);if(ye(t.hook)){const n=Ml(e,t.path),o={};for(const a of n.keys())o[a]=n.get(a);t.hook(re,{...o})}if(s){const n=kt();if(n){const o=Nd(Hn(),r);n&&t.path===Hn()&&!o&&n._setState("")}To(s)?pa(r).then(()=>{re._refocus(),Fe.delete(i)}):s().then(o=>o.default).then(o=>(Nr(t.path,o),pa(r))).then(()=>{re._refocus(),Fe.delete(i)})}else Fe.delete(i)}},nr=(r=0)=>{if(!r||isNaN(r))return!1;const e=Ul();if(r=Math.abs(r),e.length){const t=e.splice(e.length-r,r)[0];return kr(e),ce(t.hash,{[pe.backtrack]:!0,[pe.historyState]:t.state},!1)}else if(ke.get("backtrack")){const t=/(\/:?[\w%\s-]+)$/;let i=zr(Hr()),s=xo(i);if(s>1){for(;s--;)if(i=i.replace(t,""),Ur(i))return ce(i,{[pe.backtrack]:!0},!1)}}return r>e.length?ye(re._handleAppClose)?re._handleAppClose():re.application.closeApp():!1},Lp=()=>{ii(nt)?(ce(nt,!1),nt=""):ye(nt)?nt().then(r=>{nt="",Xe(r)?ce(r.path,r.params):ce(r)}):console.warn("[Router]: resume() called but no hash found")},Pp=()=>{if(!ql()){const r=Mi();ce(r,{reload:!0},!1)}},ql=()=>{if(Fe.size){let r=!1;for(let e of Fe.values())e.isCancelled||(r=!0);return r}return!1},Ip=()=>nt;let Hr=()=>document.location.hash,Mp=r=>{document.location.hash=r};const Fp=()=>{Ld.addEventListener(window,"hashchange",async()=>{if($n())try{await Cr()}catch(r){console.error(r)}})},Op=()=>{const r=Gl();ii(r)?ce(r):ye(r)&&r().then(e=>{Xe(e)?ce(e.path,e.params):ce(e)})},zp=r=>{Jd(r)},ga={startRouter:Cp,navigate:ce,resume:Lp,step:nr,go:nr,back:nr.bind(null,-1),activePage:kt,getActivePage(){return kt()},deletePage:zp,getActiveRoute:Hn,getActiveHash:Mi,focusWidget:Vd,getActiveWidget:Fl,restoreFocus:ua,isNavigating:ql,getHistory:Ul,setHistory:kr,getHistoryState:Gd,replaceHistoryState:Yd,getQueryStringParams:wo,reload:Pp,symbols:pe,App:wp,focusPage:ua,root:Op,setupRoutes(){console.warn("Router: setupRoutes is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},on(){console.warn("Router.on() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},before(){console.warn("Router.before() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")},after(){console.warn("Router.after() is deprecated, consolidate your configuration"),console.warn("https://rdkcentral.github.io/Lightning-SDK/#/plugins/router/configuration")}};class rg extends me.Component{static _template(){return{visible:!1,rect:!0,color:2415919104,shader:{type:me.shaders.RoundedRectangle,radius:5},Text:{y:5,x:20,text:{textColor:4294967295,fontSize:38,lineHeight:38*1.4,textAlign:"center",wordWrap:!0,maxLines:3,shadow:!0,shadowColor:4281545523}}}}_init(){this._textTextureDefaults=new me.textures.TextTexture(this.stage).cloneArgs(),this.tag("Text").on("txLoaded",({_source:e})=>{this.w=e.w+this.tag("Text").x*2,this.h=e.h,this.position()})}get textFormat(){const e=this.tag("Text").text;return{fontFace:e.fontFace||"sans-serif",fontSize:e.fontSize,lineHeight:e.lineHeight,textAlign:e.textAlign,wordWrap:!0,maxLines:e.maxLines}}show(){this.visible=!0}hide(){this.visible=!1}position(){this.x=this._calculateX(this.xPos),this.y=this._calculateY(this.yPos)}set viewportW(e){this._viewportW=e,this.x=this._calculateX(this.xPos)}get viewportW(){return this._viewportW||this.application.finalW}set viewportH(e){this._viewportH=e,this.y=this._calculateY(this.yPos)}get viewportH(){return this._viewportH||this.application.finalH}_calculateX(e){return e==="center"?e=(this.viewportW-this.finalW)/2:e==="left"?e=60:e==="right"&&(e=this.viewportW-this.finalW-60),e}set xPos(e){this._x=e,this.x=this._calculateX(e)}get xPos(){return this._x||"center"}_calculateY(e){return e==="center"?(this.viewportH-this.finalH)/2:e==="top"?60:e==="bottom"?this.viewportH-this.finalH-60:e}set yPos(e){this._y=e,this.y=this._calculateY(e)}get yPos(){return this._y||"bottom"}set fontFamily(e){this.tag("Text").text.fontFace=e}set fontSize(e){this.tag("Text").text.fontSize=e,this.tag("Text").text.lineHeight=e*1.3}set fontColor(e){this.tag("Text").color=e}set backgroundColor(e){this.color=e}_defineBreakpoint(e,t){if(t>=this.maxWidth)return this.maxWidth;const i=me.textures.TextTexture.renderer(this.stage,this.stage.platform.getDrawingCanvas(),{...this._textTextureDefaults,...this.textFormat,wordWrapWidth:t,text:e})._calculateRenderInfo();return i.width<=t&&i.lines.length<=2?t:this._defineBreakpoint(e,t*1.25)}set text(e){if(this.alpha=0,e&&e.length){const t=this._defineBreakpoint(e,640);this.tag("Text").text.wordWrapWidth=t,this.tag("Text").text=e,this.alpha=1}}set textAlign(e){this._textAlign=e,this.tag("Text").text.textAlign=e}set maxWidth(e){this._maxWidth=e}get maxWidth(){return(this._maxWidth||1200)-this.tag("Text").x*2}set maxLines(e){this.tag("Text").text.maxLines=e}}const Er=class Er{constructor(){d(this,"videoPlayer");d(this,"initialized");d(this,"opened");d(this,"appInstance");this.videoPlayer=vd,this.initialized=!1,this.appInstance=null,this.opened=!1}setAppInstance(e){this.appInstance=e,ai.appInstance=e;const t=e;t.fire===void 0&&t.$emit!==void 0&&(t.fire=(i,...s)=>{t.$emit(i,...s)}),this.initialized&&this.videoPlayer.consumer(t)}logVideoElement(){const e=document.querySelector("video"),t=this.videoPlayer._videoEl??null;e===null?console.info("Video element not found in DOM"):console.info("Video element found in DOM",e),t===null?console.info("VideoPlayer._videoEl is null"):console.info("VideoPlayer._videoEl",t)}initialize(e,t){if(console.debug(`VideoPlayerState.initialize: width=${e} height=${t}`),this.appInstance===null){console.warn("VideoPlayerState.initialize skipped: no app instance provided");return}this.initialized||(cf({},{width:e,height:t,textureMode:!1}),ai.log=Z,ai.settings=We,ai.ads=Ad,ai.lightning=me,this.appInstance!==null?(ai.appInstance=this.appInstance,this.videoPlayer.consumer(this.appInstance)):console.warn("VideoPlayerState.initialize called without an app instance"),this.videoPlayer.hide(),this.logVideoElement(),console.info("VideoPlayer plugin initialized"),console.info("After hide()",{videoElement:this.videoPlayer._videoEl}),this.initialized=!0);const i=this.videoPlayer._videoEl;if(i!==void 0&&(i.isConnected||document.body.appendChild(i),i.setAttribute("crossorigin","anonymous")),this.videoPlayer.position(0,0),this.videoPlayer.size(e,t),this.videoPlayer.show(),console.info("VideoPlayer shown on stage"),console.info("VideoPlayer internal state",{videoElement:this.videoPlayer._videoEl,consumer:this.videoPlayer._consumer}),!this.opened){const s=Er.DEMO_URL;this.videoPlayer.open(s),this.opened=!0}if(this.appInstance!==null&&We.get("platform","textureMode")){const s=this.appInstance.tag("VideoTexture"),n=this.appInstance.tag("VideoBackground");s!==void 0&&n!==void 0&&(n.childList.add(s),s.patch({x:0,y:0,w:e,h:t,zIndex:2}),console.debug("Video texture added to stage"))}this.logVideoElement(),console.info("VideoPlayer initialization complete")}};d(Er,"DEMO_URL","https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4");let Wn=Er;const _a=new Wn,Up=Zn.Application({state(){return{stageW:window.innerWidth,stageH:window.innerHeight}},methods:{$videoPlayerEvent(r,e,t){console.debug(`VideoPlayer event: ${r} at ${t.toFixed(2)}s`,e)}},components:{Icon:uf},hooks:{init(){const r=this,e=()=>{r.stageW=window.innerWidth,r.stageH=window.innerHeight};r.resizeListener=e,window.addEventListener("resize",e),_a.setAppInstance(r),_a.initialize(r.stageW,r.stageH)},destroy(){const r=this;r.resizeListener&&window.removeEventListener("resize",r.resizeListener)}},code:{render:function(e,t,i,s,n,o,a){const l=[];let h,u,f,c=!1,p=0;const _={};l[0]=this.element({parent:e||"root"},c===!0?f:t),_.w=t.stageW,_.h=t.stageH,l[0].populate(_),c===!0&&(p-=1);const g=i.components&&i.components.Icon||s.Icon;e=l[0];const x={};l[1]=this.element({parent:e||"root"},c===!0?f:t),x.stageW=t.stageW,x.stageH=t.stageH;const m=[];if(typeof g<"u")for(let R in g[Symbol.for("config")].props)delete x[g[Symbol.for("config")].props[R]],m.push(g[Symbol.for("config")].props[R]);l[1].populate(x),c===!0&&(p-=1),e=l[1];const T={};u=t.stageW,Array.isArray(u)===!0&&(u=o(u).slice(0)),T.stageW=u,u=t.stageH,Array.isArray(u)===!0&&(u=o(u).slice(0)),T.stageH=u,h=T.is||"Icon";let b;if(typeof h=="string"){if(b=i.components&&i.components[h]||s[h],!b)throw new Error('Component "Icon" not found')}else typeof h=="function"&&h[Symbol.for("isComponent")]===!0&&(b=h);l[2]=b.call(null,{props:T},l[1],t),l[2][Symbol.for("slots")][0]?(e=l[2][Symbol.for("slots")][0],f=l[2],c=!0):e=l[2][Symbol.for("children")][0],c===!0&&p===0&&(c=!1),e=l[0];const S={};return l[3]=this.element({parent:e||"root"},c===!0?f:t),S.ref="VideoBackground",l[3].populate(S),c===!0&&(p-=1),l},effects:[function(e,t,i,s,n,o){t[0].set("w",e.stageW)},function(e,t,i,s,n,o){t[0].set("h",e.stageH)},function(e,t,i,s,n,o){(typeof skip1>"u"||skip1.indexOf("stageW")===-1)&&t[1].set("stageW",e.stageW)},function(e,t,i,s,n,o){(typeof skip1>"u"||skip1.indexOf("stageH")===-1)&&t[1].set("stageH",e.stageH)},function(e,t,i,s,n,o){t[2][Symbol.for("props")].stageW=e.stageW},function(e,t,i,s,n,o){t[2][Symbol.for("props")].stageH=e.stageH}],context:{}}}),Bp=100;function kp(r,e){Zn.Launch(Up,"app",{w:r,h:e})}function ma(r,e){const i=document.getElementById("app").querySelector("canvas");kp(r,e),i!==null&&i.remove()}function Dp(){const r=hf(ma,Bp);window.addEventListener("resize",()=>{r(window.innerWidth,window.innerHeight)}),ma(window.innerWidth,window.innerHeight)}Dp();
